# Update readme.md for dashboard roles
_Exported on 9/8/2025 at 13:44:36 GMT+1 from Cursor (1.5.3)_

---

**User**

reescreva o readme.md C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\README.md  # Sua-Parte ‚Äî Pap√©is dos Dashboards

Este documento descreve, de forma objetiva, o papel de cada dashboard no sistema.

---

## Dashboard do Administrador

O Administrador √© respons√°vel pela gest√£o global da plataforma. Seu painel permite:

- Importar o conte√∫do oficial das reuni√µes (temas, leituras etc.) a partir de arquivos como PDFs.
- Gerenciar todas as congrega√ß√µes e seus instrutores.
- Monitorar o status geral e a sa√∫de da plataforma.

---

## Dashboard do Instrutor

O Instrutor √© o usu√°rio final na congrega√ß√£o. Seu painel permite:

- Visualizar a programa√ß√£o das reuni√µes inserida pelo administrador.
- Cadastrar e gerenciar os estudantes da congrega√ß√£o.
- Fazer as designa√ß√µes das partes da reuni√£o para os estudantes.
- Trabalhar offline, com sincroniza√ß√£o dos dados quando a internet estiver dispon√≠vel.
  Skip to content
Navigation Menu
RobertoAraujoSilva
sua-parte

Type / to search
Code
Issues
Pull requests
Actions
Projects
Security
Insights
Settings
sua-parte
Public template
RobertoAraujoSilva/sua-parte
Go to file
t
Name		
lovable-dev[bot]
lovable-dev[bot]
Fix: Resolve TypeScript errors
4358eb5
 ¬∑ 
48 minutes ago
.github/workflows
fix(auth): resolve critical Supabase authentication and connection is‚Ä¶
last month
.kilocode
drop
last month
.kiro
feat: add sistema-ministerial verification system
3 weeks ago
audit
debugr
last month
backend
feat: add sistema-ministerial verification system
3 weeks ago
cypress
Atualiza√ß√£o completa do sistema: README.md atualizado, novos testes ‚Ä¶
3 weeks ago
docs
warp
13 hours ago
integration-test-reports
feat: add sistema-ministerial verification system
3 weeks ago
public
Fix build error and optimize service worker
4 hours ago
scripts
from laptop Qodo
3 weeks ago
src
Fix: Resolve TypeScript errors
48 minutes ago
supabase
feat: adicionar campos de metadados ao banco de dados (MCP-05.1)
3 weeks ago
test-autofix-reports
feat: add sistema-ministerial verification system
3 weeks ago
test-verification-reports
feat: add sistema-ministerial verification system
3 weeks ago
.env
Fix build error and optimize service worker
4 hours ago
.env.cypress
fix(auth): resolve critical Supabase authentication and connection is‚Ä¶
last month
.env.example
feat: adicionar campos de metadados ao banco de dados (MCP-05.1)
3 weeks ago
.gitignore
Implementa√ß√£o completa do Admin Dashboard com Backend integrado
3 weeks ago
.npmrc
Fix local development environment and dependency issues
last month
.nvmrc
fix: Resolve Rollup build issues for Render deployment
last month
ADMIN_DASHBOARD_INTEGRATION.md
Implementa√ß√£o completa do Admin Dashboard com Backend integrado
3 weeks ago
APPLY_THIS_SQL.sql
primeiro estudante
last month
AUTH_TROUBLESHOOTING.md
debug
last month
DEBUG_ADMIN_DASHBOARD.md
Implementa√ß√£o completa do Admin Dashboard com Backend integrado
3 weeks ago
DEPLOYMENT_AUTHORIZATION_FIX.md
from laptop Qodo
3 weeks ago
DOCUMENTACAO_COMPLETA.md
retrato
last month
GUIA_USUARIO.md
retrato
last month
PROGRAMAS_SETUP.md
debug
last month
QUICK_DEPLOYMENT_FIX.md
from laptop Qodo
3 weeks ago
REACT_HOOKS_ISSUE_FIX.md
qodo
3 weeks ago
README.md
Update README.md
4 hours ago
README_ESTUDANTES.md
Implementa√ß√£o completa do Admin Dashboard com Backend integrado
3 weeks ago
TASK_14_COMPLETION_SUMMARY.md
qodo
3 weeks ago
VERIFICATION_SYSTEM_GUIDE.md
qodo
3 weeks ago
VERIFICATION_SYSTEM_IMPLEMENTATION_COMPLETE.md
qodo
3 weeks ago
WARP.md
warp
13 hours ago
check_translations.js
feat: translate all pages to english
3 weeks ago
cleanup_estudantes.sql
Atualiza√ß√£o completa do sistema: README.md atualizado, novos testes ‚Ä¶
3 weeks ago
components.json
Use tech stack vite_react_shadcn_ts_20250728_minor
last month
convert_excel_to_json.py
Atualiza√ß√£o completa do sistema: README.md atualizado, novos testes ‚Ä¶
3 weeks ago
cypress.config.mjs
cypress
3 weeks ago
cypress.env.json
cypress
3 weeks ago
database_review.sql
tablet
last month
debug_congregation_query.sql
retrato
last month
eslint.config.js
Use tech stack vite_react_shadcn_ts_20250728_minor
last month
index.html
Updaten
last month
index_proposed-1755115111581.css
tablet
last month
migrate.js
tablet
last month
migrate.mjs
tablet
last month
package-lock.json
Update project template
4 hours ago
package.json
Update project template
4 hours ago
postcss.config.js
Use tech stack vite_react_shadcn_ts_20250728_minor
last month
process_estudantes.sql
Atualiza√ß√£o completa do sistema: README.md atualizado, novos testes ‚Ä¶
3 weeks ago
requirements.txt
Atualiza√ß√£o completa do sistema: README.md atualizado, novos testes ‚Ä¶
3 weeks ago
tailwind.config.ts
Updaten
last month
test-app-syntax.tsx
f5
last month
test-assignment-generation.js
üöÄ CR√çTICO: Corrigido bot√£o 'Pular e Ir para Dashboard' + Sistema comp‚Ä¶
last month
test-jw-parser.js
üöÄ CR√çTICO: Corrigido bot√£o 'Pular e Ir para Dashboard' + Sistema comp‚Ä¶
last month
tsconfig.app.json
debug
last month
tsconfig.app.tsbuildinfo
feat: add sistema-ministerial verification system
3 weeks ago
tsconfig.json
Use tech stack vite_react_shadcn_ts_20250728_minor
last month
tsconfig.node.json
debug
last month
tsconfig.node.tsbuildinfo
feat: add sistema-ministerial verification system
3 weeks ago
vite-env.d.ts
debug
last month
vite.config.ts
Update project template
4 hours ago
Repository files navigation
README
üìö Sistema Ministerial
üöÄ Status: SISTEMA COMPLETO IMPLEMENTADO E FUNCIONANDO!
O Sistema Ministerial √© uma plataforma completa para gerenciamento de materiais, programas e congrega√ß√µes, com Admin Dashboard integrado e Backend Node.js funcionando em tempo real.

‚ú® Funcionalidades Implementadas
üéØ Admin Dashboard (100% Funcional)
Interface administrativa completa com abas organizadas
Download autom√°tico de materiais da JW.org (PDF, JWPub, RTF, DAISY)
Gerenciamento de materiais e publica√ß√£o para congrega√ß√µes
Monitoramento do sistema em tempo real
Sistema de debug para desenvolvimento
üîß Backend Node.js (Porta 3001)
Servidor Express com APIs REST completas
Servi√ßo JWDownloader para scraping e download da JW.org
Sistema de cron para downloads autom√°ticos
Integra√ß√£o com Supabase para banco de dados
Health checks e monitoramento do sistema
üåê Frontend React (Porta 8081)
Interface responsiva com TailwindCSS e Shadcn/ui
Sistema de autentica√ß√£o integrado com Supabase
Controle de acesso por roles (admin, instrutor, estudante)
Dashboard unificado para todos os usu√°rios
üß™ Testes Automatizados
Testes Cypress para valida√ß√£o completa do sistema
Cobertura de funcionalidades principais
Testes de integra√ß√£o frontend-backend
üöÄ Como Usar o Sistema
üéØ Op√ß√£o 1 - Iniciar Tudo de Uma Vez (RECOMENDADO)
npm run dev:all
Resultado: Inicia ambos os servidores simultaneamente

Backend: Porta 3000
Frontend: Porta 8080
üîß Op√ß√£o 2 - Iniciar Separadamente
# Terminal 1 - Backend
npm run dev:backend-only

# Terminal 2 - Frontend  
npm run dev:frontend-only
üì± Acessar o Admin Dashboard
URL: http://localhost:8080/admin
Login: amazonwebber007@gmail.com / admin123
üèóÔ∏è Arquitetura do Sistema
sua-parte/
‚îú‚îÄ‚îÄ üìÅ src/                          # Frontend React
‚îÇ   ‚îú‚îÄ‚îÄ pages/AdminDashboard.tsx     # ‚úÖ Dashboard Admin
‚îÇ   ‚îú‚îÄ‚îÄ pages/Auth.tsx               # ‚úÖ Sistema de Login
‚îÇ   ‚îú‚îÄ‚îÄ pages/Programas.tsx          # ‚úÖ Gerenciamento de Programas
‚îÇ   ‚îî‚îÄ‚îÄ contexts/AuthContext.tsx     # ‚úÖ Contexto de Autentica√ß√£o
‚îú‚îÄ‚îÄ üìÅ backend/                      # ‚úÖ Backend Node.js
‚îÇ   ‚îú‚îÄ‚îÄ server.js                    # ‚úÖ Servidor Principal
‚îÇ   ‚îú‚îÄ‚îÄ services/jwDownloader.js     # ‚úÖ Download JW.org
‚îÇ   ‚îú‚îÄ‚îÄ routes/admin.js              # ‚úÖ APIs Admin
‚îÇ   ‚îî‚îÄ‚îÄ config/mwbSources.json      # ‚úÖ URLs JW.org
‚îú‚îÄ‚îÄ üìÅ cypress/                      # ‚úÖ Testes Automatizados
‚îÇ   ‚îî‚îÄ‚îÄ e2e/admin-dashboard-integration.cy.ts
‚îú‚îÄ‚îÄ üìÅ supabase/                     # ‚úÖ Migra√ß√µes e Banco
‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îî‚îÄ‚îÄ üìÅ docs/Oficial/                 # ‚úÖ Materiais Baixados
üîç Funcionalidades Detalhadas
üéØ Scripts Unificados (NOVO!)
npm run dev:all - Inicia backend e frontend simultaneamente
npm run dev:backend-only - Apenas o backend (porta 3000)
npm run dev:frontend-only - Apenas o frontend (porta 8080)
Desenvolvimento simplificado com um √∫nico comando
‚úÖ Admin Dashboard
Vis√£o Geral: Estat√≠sticas do sistema e a√ß√µes r√°pidas
Downloads: Configura√ß√£o e verifica√ß√£o de atualiza√ß√µes da JW.org
Materiais: Lista de materiais baixados e seus status
Publica√ß√£o: Sistema de publica√ß√£o para congrega√ß√µes
üéØ Explica√ß√£o Completa dos Dashboards
üè† 1. Dashboard Principal (Dashboard Geral)
üìç URL: /dashboard ou /
üë• Usu√°rios: Instrutores (n√£o-admin)
üéØ Finalidade: Vis√£o geral da congrega√ß√£o, gerenciamento de estudantes, visualiza√ß√£o de programas publicados, controle de designa√ß√µes e partes, estat√≠sticas b√°sicas de participa√ß√£o
üîß Funcionalidades: Lista de estudantes sob responsabilidade, programas ministeriais dispon√≠veis, calend√°rio de reuni√µes, designa√ß√µes pendentes e realizadas, relat√≥rios de participa√ß√£o
üëë 2. Admin Dashboard (Dashboard Administrativo)
üìç URL: /admin
üë• Usu√°rios: Administradores do sistema
üéØ Finalidade: Controle total do sistema, gerenciamento de materiais da JW.org, administra√ß√£o de congrega√ß√µes, configura√ß√£o de usu√°rios e permiss√µes, monitoramento do sistema
üîß Funcionalidades Detalhadas:
üìä Vis√£o Geral: Estat√≠sticas do sistema, status dos servi√ßos, a√ß√µes r√°pidas
üì• Downloads: Verificar Novas Vers√µes (scraping autom√°tico da JW.org), download de materiais (PDF, EPUB, JWPub, RTF, DAISY), configura√ß√£o de URLs e idiomas, logs de download
üìö Materiais: Lista de materiais baixados, status de processamento, organiza√ß√£o por idioma e per√≠odo, metadados dos arquivos
üì¢ Publica√ß√£o: Publicar materiais para congrega√ß√µes, controle de acesso por regi√£o, agendamento de publica√ß√µes, hist√≥rico de publica√ß√µes
üè• Monitoramento: Status do backend, conex√£o com banco de dados, logs do sistema, health checks
üë®‚Äçüéì 3. Dashboard do Estudante
üìç URL: /estudante/{id}
üë• Usu√°rios: Estudantes individuais
üéØ Finalidade: Acesso limitado aos materiais publicados, visualiza√ß√£o de programas ministeriais, hist√≥rico pessoal de participa√ß√£o, materiais de estudo dispon√≠veis
üîß Funcionalidades: Materiais publicados para sua congrega√ß√£o, programas ministeriais dispon√≠veis, hist√≥rico de designa√ß√µes, perfil pessoal b√°sico, acesso somente leitura
üë®‚Äçüë©‚Äçüëß‚Äçüë¶ 4. Portal Familiar
üìç URL: /portal-familiar
üë• Usu√°rios: Membros de fam√≠lia
üéØ Finalidade: Acesso familiar aos materiais, suporte para estudo em casa, materiais complementares de estudo
üîß Funcionalidades: Materiais de estudo em fam√≠lia, recursos complementares, acesso limitado e controlado
üîê 5. Sistema de Autentica√ß√£o
üìç URL: /auth
üë• Usu√°rios: Todos os usu√°rios
üéØ Finalidade: Login e registro de usu√°rios, controle de acesso baseado em roles, gerenciamento de sess√µes
üîß Funcionalidades: Login com email/senha, registro de novos usu√°rios, recupera√ß√£o de senha, controle de sess√£o
üîÑ Fluxo de Funcionamento
1. Administrador:
Login ‚Üí Admin Dashboard ‚Üí Downloads ‚Üí Materiais ‚Üí Publica√ß√£o
2. Instrutor:
Login ‚Üí Dashboard Principal ‚Üí Gerenciar Estudantes ‚Üí Ver Programas
3. Estudante:
Login ‚Üí Dashboard Estudante ‚Üí Ver Materiais Publicados
üé® Caracter√≠sticas Visuais
Admin Dashboard:
Interface administrativa com abas organizadas
Cores azuis para transmitir confian√ßa
Loading states elegantes (implementados recentemente)
Debug info para desenvolvimento
Dashboard Principal:
Interface limpa e focada em tarefas
Cores neutras para uso prolongado
Componentes reutiliz√°veis para consist√™ncia
Dashboard Estudante:
Interface simples e intuitiva
Acesso limitado e controlado
Foco em conte√∫do e n√£o em funcionalidades
üöÄ Integra√ß√£o com Backend
Admin Dashboard:
APIs completas para todas as funcionalidades
Download autom√°tico da JW.org
Gerenciamento de arquivos e metadados
Sistema de cron para tarefas autom√°ticas
Dashboard Principal:
APIs de consulta para dados da congrega√ß√£o
Integra√ß√£o com Supabase para dados em tempo real
Sistema de notifica√ß√µes para atualiza√ß√µes
Dashboard Estudante:
APIs de leitura para materiais publicados
Controle de acesso baseado em RLS
Cache inteligente para performance
üéØ Arquitetura dos Dashboards
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Admin         ‚îÇ    ‚îÇ   Instrutor     ‚îÇ    ‚îÇ   Estudante     ‚îÇ
‚îÇ   Dashboard     ‚îÇ    ‚îÇ   Dashboard     ‚îÇ    ‚îÇ   Dashboard     ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ
‚îÇ ‚Ä¢ Downloads     ‚îÇ    ‚îÇ ‚Ä¢ Estudantes    ‚îÇ    ‚îÇ ‚Ä¢ Materiais     ‚îÇ
‚îÇ ‚Ä¢ Materiais     ‚îÇ    ‚îÇ ‚Ä¢ Programas     ‚îÇ    ‚îÇ ‚Ä¢ Programas     ‚îÇ
‚îÇ ‚Ä¢ Publica√ß√£o    ‚îÇ    ‚îÇ ‚Ä¢ Designa√ß√µes   ‚îÇ    ‚îÇ ‚Ä¢ Hist√≥rico     ‚îÇ
‚îÇ ‚Ä¢ Monitoramento ‚îÇ    ‚îÇ ‚Ä¢ Relat√≥rios    ‚îÇ    ‚îÇ ‚Ä¢ Perfil        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚ñº                       ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Backend Node.js                              ‚îÇ
‚îÇ              ‚Ä¢ APIs REST                                        ‚îÇ
‚îÇ              ‚Ä¢ JWDownloader                                     ‚îÇ
‚îÇ              ‚Ä¢ Supabase Integration                             ‚îÇ
‚îÇ              ‚Ä¢ File Management                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
üåü Benef√≠cios do Sistema
Para Administradores:
Controle total sobre materiais e usu√°rios Mostra a Programacao completa
Automa√ß√£o de downloads da JW.org
Monitoramento em tempo real
Para Instrutores:
Gerenciamento eficiente de estudantes puxa do Dashboard do Admin a programacao disponivel para designar os estudantes localmenete.
Acesso r√°pido a materiais atualizados
Controle de designa√ß√µes e programas
Para Estudantes:
Acesso organizado aos materiais
Interface simples e intuitiva
Materiais sempre atualizados
Monitoramento: Status do sistema e logs
‚úÖ Sistema de Downloads
URLs configuradas para JW.org (PT-BR e EN-US)
Download autom√°tico de m√∫ltiplos formatos
Organiza√ß√£o por idioma e per√≠odo
Verifica√ß√£o de atualiza√ß√µes em tempo real
‚úÖ Controle de Acesso
Admin: Acesso completo ao sistema
Instrutor: Gerenciamento de programas e materiais
Estudante: Visualiza√ß√£o de materiais publicados
üß™ Executar Testes
Testes Cypress
# Executar todos os testes
npm run cypress:run

# Teste espec√≠fico do Admin Dashboard
npm run cypress:run --spec "cypress/e2e/admin-dashboard-integration.cy.ts"
Testes Dispon√≠veis
‚úÖ Carregamento do Dashboard
‚úÖ Conex√£o com Backend
‚úÖ Verifica√ß√£o de Atualiza√ß√µes
‚úÖ Listagem de Materiais
‚úÖ Teste de Perfil + Backend
‚úÖ Monitoramento do Sistema
‚úÖ Debug Info
‚úÖ Funcionalidade Completa de Download
üîß Configura√ß√£o e Desenvolvimento
üìã Scripts Dispon√≠veis
# üéØ Comandos Principais
npm run dev:all              # Inicia backend + frontend simultaneamente
npm run dev:backend-only     # Apenas o backend (porta 3000)
npm run dev:frontend-only    # Apenas o frontend (porta 8080)

# üîß Comandos Originais
npm run dev                  # Frontend apenas (como antes)
npm run build                # Build de produ√ß√£o
npm run cypress:run          # Testes automatizados
Vari√°veis de Ambiente
# Backend (.env)
PORT=3000
NODE_ENV=development
DOCS_PATH=../docs/Oficial
SUPABASE_URL=your_supabase_url
SUPABASE_ANON_KEY=your_supabase_key

# Frontend
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_ANON_KEY=your_supabase_key
Depend√™ncias Principais
// Backend
{
  "express": "^4.18.2",
  "node-cron": "^3.0.3",
  "node-fetch": "^3.3.2",
  "cheerio": "^1.0.0-rc.12",
  "fs-extra": "^11.1.1",
  "@supabase/supabase-js": "^2.38.4"
}

// Frontend
{
  "react": "^18.2.0",
  "typescript": "^5.0.2",
  "tailwindcss": "^3.3.0",
  "@supabase/supabase-js": "^2.38.4"
}
üìä Status das Funcionalidades
Funcionalidade	Status	Descri√ß√£o
üéØ Admin Dashboard	‚úÖ 100%	Interface completa e funcional
üîß Backend Node.js	‚úÖ 100%	Servidor rodando e APIs ativas
üì• Download JW.org	‚úÖ 100%	Sistema autom√°tico funcionando
üîê Autentica√ß√£o	‚úÖ 100%	Login e controle de acesso
üß™ Testes Cypress	‚úÖ 100%	Valida√ß√£o automatizada
üì± Interface	‚úÖ 100%	Responsiva e moderna
üóÑÔ∏è Banco de Dados	‚úÖ 100%	Supabase configurado
üö® Troubleshooting
üéØ Problemas com o Sistema Unificado
# Se o comando unificado n√£o funcionar
npm run dev:all

# Alternativa: iniciar separadamente
npm run dev:backend-only    # Terminal 1
npm run dev:frontend-only   # Terminal 2
Backend n√£o inicia
# Op√ß√£o 1: Usar o script unificado
npm run dev:backend-only

# Op√ß√£o 2: Comando tradicional
cd backend
npm install
npm run dev
Frontend n√£o conecta ao backend
# Verificar se backend est√° rodando
curl http://localhost:3000/api/status
Problemas de autentica√ß√£o
Verificar credenciais no Supabase
Confirmar role do usu√°rio no banco
Verificar console do navegador para logs
üìö Documenta√ß√£o Adicional
ADMIN_DASHBOARD_INTEGRATION.md - Guia completo do Admin Dashboard
DEBUG_ADMIN_DASHBOARD.md - Debug e troubleshooting
README_ESTUDANTES.md - Sistema de estudantes
docs/SISTEMA-UNIFICADO.md - Arquitetura unificada
üéØ Pr√≥ximos Passos
‚úÖ Conclu√≠do
 Backend Node.js implementado
 Admin Dashboard funcional
 Sistema de downloads autom√°tico
 Testes automatizados
 Documenta√ß√£o completa
 Scripts unificados para desenvolvimento
üöÄ Em Desenvolvimento
 Interface mais polida
 Relat√≥rios avan√ßados
 Notifica√ß√µes em tempo real
 Sistema de backup autom√°tico
üèÜ Resultado Final
üéâ O Sistema Ministerial est√° 100% funcional!

‚úÖ Admin Dashboard integrado e funcionando
‚úÖ Backend rodando e processando downloads
‚úÖ Download autom√°tico da JW.org implementado
‚úÖ Testes automatizados funcionando
‚úÖ Documenta√ß√£o completa criada
‚úÖ C√≥digo versionado e sincronizado no GitHub
‚úÖ Scripts unificados para desenvolvimento simplificado
üöÄ Sistema pronto para uso em produ√ß√£o com desenvolvimento otimizado!

üë• Contribui√ß√£o
Desenvolvedor Principal
Roberto Araujo da Silva - Arquitetura e implementa√ß√£o completa
Como Contribuir
Fork o reposit√≥rio
Crie uma branch para sua feature
Commit suas mudan√ßas
Push para a branch
Abra um Pull Request
üìû Suporte
Issues: GitHub Issues
Documenta√ß√£o: Arquivos markdown no reposit√≥rio
Debug: Painel amarelo no Admin Dashboard (modo desenvolvimento)
üìÑ Licen√ßa
Este projeto est√° sob a licen√ßa MIT. Veja o arquivo LICENSE para mais detalhes.

üåü Sistema Ministerial - Transformando a gest√£o de materiais e programas!

About
sua-parte.lovable.app/
Resources
 Readme
 Activity
Stars
 0 stars
Watchers
 0 watching
Forks
 0 forks
Releases
No releases published
Create a new release
Packages
No packages published
Publish your first package
Contributors
5
@RobertoAraujoSilva
@Webber-Lubenham
@lovable-dev[bot]
@google-labs-jules[bot]
@franklinmarceloferrer-cmd
Languages
TypeScript
74.1%
 
JavaScript
14.9%
 
HTML
5.5%
 
PLpgSQL
3.2%
 
CSS
1.0%
 
Batchfile
0.6%
 
Other
0.7%
Footer
¬© 2025 GitHub, Inc.
Footer navigation
Terms
Privacy
Security
Status
GitHub Community
Docs
Contact
Manage cookies
Do not share my personal information


---

**Cursor**

I'll open the current `README.md` to understand its content and then replace it with a cleaner, security-conscious version focused on the roles of each dashboard, plus concise setup/use sections.

I'll check the project scripts and ports to ensure the README reflects the actual commands and defaults, then I'll replace the README with a comprehensive, security-conscious version that covers roles, setup, scripts, env vars, and references.

I'll quickly confirm the dev server port and any custom settings in `vite.config.ts` to ensure the README's URLs and ports are correct, then I'll update `README.md` accordingly.

I‚Äôm going to replace the current README with a comprehensive, security-conscious version including roles of each dashboard, setup, scripts, env vars, ports, and links.

```markdown
# Sua-Parte ‚Äî Sistema Ministerial

O Sua-Parte √© uma plataforma para gest√£o de materiais, programas e congrega√ß√µes, com Frontend React (Vite) e Backend Node.js (Express). Este documento descreve os pap√©is dos dashboards, al√©m de trazer instru√ß√µes objetivas de instala√ß√£o e uso.

## Pap√©is dos Dashboards

### Admin Dashboard (Administradores)
- Importar e organizar materiais oficiais (PDF, JWPub, etc.).
- Gerenciar congrega√ß√µes, instrutores e permiss√µes.
- Monitorar sa√∫de do sistema e servi√ßos do backend.

### Dashboard do Instrutor (Congrega√ß√µes)
- Visualizar a programa√ß√£o publicada pelo admin.
- Cadastrar e gerenciar estudantes da congrega√ß√£o.
- Designar partes da reuni√£o aos estudantes.
- Operar offline com sincroniza√ß√£o quando voltar a ficar online.

### Dashboard do Estudante (Leitura/Acompanhamento)
- Acessar materiais publicados para sua congrega√ß√£o.
- Consultar designa√ß√µes, hist√≥rico e programas disponibilizados.
- Acesso com perfil restrito (somente leitura das publica√ß√µes).

## Tecnologias
- Frontend: React + TypeScript, Vite, TailwindCSS, shadcn/ui
- Backend: Node.js + Express, cron, integra√ß√£o com Supabase
- Testes: Cypress E2E

## Instala√ß√£o
1. Clonar o reposit√≥rio
```bash
git clone https://github.com/RobertoAraujoSilva/sua-parte.git
cd sua-parte
```

2. Instalar depend√™ncias (raiz)
```bash
npm install
```

3. Vari√°veis de ambiente
- Crie um arquivo `.env` na raiz (frontend) e outro em `backend/.env` se necess√°rio.
- Exemplo (ajuste para seu ambiente ‚Äî n√£o compartilhe chaves reais):

Frontend (.env)
```env
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
```

Backend (backend/.env)
```env
PORT=3001
NODE_ENV=development
DOCS_PATH=../docs/Oficial
SUPABASE_URL=your_supabase_url
SUPABASE_ANON_KEY=your_supabase_service_or_anon_key
```

## Execu√ß√£o
- Iniciar frontend e backend juntos (recomendado)
```bash
npm run dev:all
```

- Iniciar apenas o backend (porta padr√£o 3001)
```bash
npm run dev:backend-only
```

- Iniciar apenas o frontend (porta padr√£o 8080)
```bash
npm run dev:frontend-only
```

Portas padr√£o
- Frontend (Vite): http://localhost:8080
- Backend (Express): http://localhost:3001

## Acesso r√°pido
- Admin Dashboard: `http://localhost:8080/admin`
- Dashboard do Instrutor: `http://localhost:8080/` ou `http://localhost:8080/dashboard`
- Estudante: acesso controlado conforme publica√ß√£o/perfil

## Testes (Cypress)
- Executar todos os testes
```bash
npm run cypress:run
```

- Exemplos de testes espec√≠ficos
```bash
npm run test:audit
npm run test:auth
npm run test:programs
```

## Seguran√ßa e Boas Pr√°ticas
- N√£o exponha chaves ou credenciais no frontend; use vari√°veis de ambiente.
- Garanta RLS (Row Level Security) no Supabase e privil√©gios m√≠nimos por papel.
- Trate erros em todas as chamadas de API e aplique early return/guard clauses.
- Mantenha componentes enxutos, reutiliz√°veis e consistentes com Tailwind/shadcn.

## Documenta√ß√£o adicional
- `ADMIN_DASHBOARD_INTEGRATION.md` ‚Äî Integra√ß√£o e fluxo do Admin Dashboard
- `DEBUG_ADMIN_DASHBOARD.md` ‚Äî Dicas de debug
- `README_ESTUDANTES.md` ‚Äî Guia do m√≥dulo de estudantes
- Pasta `docs/` ‚Äî Materiais e documenta√ß√£o complementar

## Licen√ßa
Projeto sob licen√ßa MIT. Consulte `LICENSE` para mais detalhes.

```

I opened the current README, verified scripts/ports in the root and backend configs, and replaced the README with a concise, security-conscious document covering dashboard roles, setup, scripts, env vars, ports, and references.

### Novo README aplicado
- Foco nos pap√©is dos dashboards (Admin, Instrutor, Estudante).
- Instru√ß√µes objetivas de instala√ß√£o e execu√ß√£o:
  - `npm run dev:all`, `npm run dev:backend-only`, `npm run dev:frontend-only`.
  - Portas: Frontend 8080 (Vite), Backend 3001 (Express).
- Vari√°veis de ambiente separadas por frontend e backend, sem expor credenciais.
- Se√ß√£o de testes Cypress com comandos comuns.
- Boas pr√°ticas de seguran√ßa e arquitetura (RLS no Supabase, guard clauses, Tailwind/shadcn).
- Links para documenta√ß√£o adicional em arquivos existentes.

- Acesse `README.md` para ver o conte√∫do atualizado.

---

**User**

esta correto? vai funcionar com "C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\WhatsApp Image 2025-08-14 at 19.44.07 (1).jpeg"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\WhatsApp Image 2025-08-14 at 19.44.07.jpeg"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\estudantes_ficticios.xlsx"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\estudantes_rows.sql"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_E_202507.pdf"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_E_202509.pdf"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_E_202511.pdf"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_T_202507.daisy.zip"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_T_202509.daisy.zip"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_T_202509.jwpub"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_T_202511.jwpub"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\S-38_E.rtf"

---

**Cursor**

Sim ‚Äî com sua estrutura atual, o backend serve tudo que estiver em `docs/Oficial` via rota `/materials`. Esses arquivos estar√£o acess√≠veis se os nomes forem usados corretamente (com encoding para espa√ßos e par√™nteses).

Exemplos de URL (backend na porta 3001):
- JPEG com espa√ßos/par√™nteses:
  - `http://localhost:3001/materials/WhatsApp%20Image%202025-08-14%20at%2019.44.07%20(1).jpeg`
  - `http://localhost:3001/materials/WhatsApp%20Image%202025-08-14%20at%2019.44.07.jpeg`
- Excel:
  - `http://localhost:3001/materials/estudantes_ficticios.xlsx`
- SQL:
  - `http://localhost:3001/materials/estudantes_rows.sql`
- PDFs:
  - `http://localhost:3001/materials/mwb_E_202507.pdf`
  - `http://localhost:3001/materials/mwb_E_202509.pdf`
  - `http://localhost:3001/materials/mwb_E_202511.pdf`
- DAISY/JWPUB:
  - `http://localhost:3001/materials/mwb_T_202507.daisy.zip`
  - `http://localhost:3001/materials/mwb_T_202509.daisy.zip`
  - `http://localhost:3001/materials/mwb_T_202509.jwpub`
  - `http://localhost:3001/materials/mwb_T_202511.jwpub`
- RTF:
  - `http://localhost:3001/materials/S-38_E.rtf`

Observa√ß√µes r√°pidas:
- Use `%20` para espa√ßos e mantenha par√™nteses como `(` e `)` (normalmente funcionam, mas se preferir, evite-os renomeando os arquivos).
- Atualmente, o backend usa o caminho fixo `../docs/Oficial` (j√° compat√≠vel). A vari√°vel `DOCS_PATH` mencionada no README n√£o est√° sendo lida pelo `server.js` neste momento.
- CORS est√° habilitado, ent√£o o frontend pode buscar esses arquivos sem bloqueio.

---

**User**

tem certeza?

---

**Cursor**

Sim. Confirmado no backend:

- Porta: 3001
- Rota est√°tica: `/materials` servindo `../docs/Oficial` a partir de `backend`:
```12:31:backend/server.js
app.use('/materials', express.static(path.join(__dirname, '../docs/Oficial')));
```

Logo, os exemplos funcionam nessas URLs:
- `http://localhost:3001/materials/WhatsApp%20Image%202025-08-14%20at%2019.44.07%20(1).jpeg`
- `http://localhost:3001/materials/WhatsApp%20Image%202025-08-14%20at%2019.44.07.jpeg`
- `http://localhost:3001/materials/estudantes_ficticios.xlsx`
- `http://localhost:3001/materials/estudantes_rows.sql`
- `http://localhost:3001/materials/mwb_E_202507.pdf`
- `http://localhost:3001/materials/mwb_E_202509.pdf`
- `http://localhost:3001/materials/mwb_E_202511.pdf`
- `http://localhost:3001/materials/mwb_T_202507.daisy.zip`
- `http://localhost:3001/materials/mwb_T_202509.daisy.zip`
- `http://localhost:3001/materials/mwb_T_202509.jwpub`
- `http://localhost:3001/materials/mwb_T_202511.jwpub`
- `http://localhost:3001/materials/S-38_E.rtf`

Dicas r√°pidas:
- Use `%20` para espa√ßos. Par√™nteses em geral funcionam; se preferir, renomeie para evitar.
- A env `DOCS_PATH` n√£o √© lida no `server.js` atual; o caminho est√° fixo e j√° aponta para `docs/Oficial`.

Se quiser validar agora: abra uma dessas URLs no navegador com o backend rodando (`npm run dev:backend-only` ou `npm run dev:all`).

```javascript
app.use('/materials', express.static(path.join(__dirname, '../docs/Oficial')));
```

---

**User**

Para que eu possa planejar os pr√≥ximos passos de desenvolvimento com precis√£o, preciso entender melhor como cada painel (dashboard) ir√° funcionar na pr√°tica. Com base no que voc√™ me disse, tenho algumas perguntas:

---

### Dashboard do Administrador

* Como voc√™ visualiza a interface do administrador para a importa√ß√£o do conte√∫do? Ser√° um simples bot√£o de upload de PDF, ou ele ter√° a op√ß√£o de visualizar o conte√∫do importado e fazer pequenas edi√ß√µes antes de salv√°-lo no banco de dados?
* O conte√∫do importado ser√° universal para todas as congrega√ß√µes, ou o administrador ter√° que selecionar para qual congrega√ß√£o o programa se destina?

---

### Dashboard do Instrutor

* Como a programa√ß√£o da reuni√£o (importada pelo administrador) ser√° apresentada ao instrutor? Ele ver√° uma lista de semanas, um calend√°rio ou outro formato?
* Voc√™ mencionou que o sistema do instrutor funcionar√° offline. Isso significa que ele poder√° fazer todas as designa√ß√µes e gerenciar os estudantes mesmo sem internet? As altera√ß√µes ser√£o salvas localmente e sincronizadas quando ele se conectar novamente?

---

### Portal do Estudante

* Ap√≥s o instrutor fazer a designa√ß√£o, como o estudante ser√° notificado sobre sua parte? Voc√™ prefere uma notifica√ß√£o no pr√≥prio painel, um e-mail ou uma notifica√ß√£o via WhatsApp?
* O que mais o estudante poder√° fazer em seu painel al√©m de ver a sua designa√ß√£o? Ele ter√° acesso aos materiais de estudo ou a um hist√≥rico de partes que j√° fez?

Qual √© a sua vis√£o sobre esses pontos?

---

**Cursor**

### Dashboard do Administrador
- Importa√ß√£o de conte√∫do
  - **Upload + pr√©-visualiza√ß√£o**: bot√£o para importar (PDF/JWPub/RTF). Ap√≥s parse, exibe um preview estruturado (semanas, partes S-38, textos) antes de salvar.
  - **Edi√ß√£o leve**: permitir ajustes pontuais (t√≠tulos, leitura, tempos, observa√ß√µes) e corre√ß√£o de parsing, com controle de vers√£o.
  - **Valida√ß√£o**: checagens (semana duplicada, campos obrigat√≥rios, idioma/per√≠odo).
- Escopo de publica√ß√£o
  - **Padr√£o: universal** (todas as congrega√ß√µes).
  - **Opcional: segmenta√ß√£o** por congrega√ß√£o/idioma/regi√£o e agendamento de publica√ß√£o (data/hora).
  - Hist√≥rico de publica√ß√µes e rollback.

### Dashboard do Instrutor
- Apresenta√ß√£o da programa√ß√£o
  - **Lista de semanas** (padr√£o) com filtro por m√™s/idioma e status.
  - Alternativa: **calend√°rio** (toggle) para vis√£o r√°pida por data.
  - Acesso aos detalhes de cada parte S-38, com status de designa√ß√£o por estudante.
- Offline-first e sincroniza√ß√£o
  - **Sim**: cadastrar/editar estudantes, criar/alterar designa√ß√µes, registrar observa√ß√µes, tudo offline.
  - Armazenamento local: **IndexedDB** + Service Worker; fila de opera√ß√µes para sync quando online.
  - Resolu√ß√£o de conflitos: ‚Äúlast-write-wins‚Äù por padr√£o + avisos quando houver diverg√™ncia remota.
  - Indicadores: status de sincroniza√ß√£o, contador de pend√™ncias e bot√£o ‚ÄúSincronizar agora‚Äù.

### Portal do Estudante
- Notifica√ß√µes
  - **In-app**: badges e toasts com centro de notifica√ß√µes.
  - Opcional: **e-mail** (configur√°vel) e **WhatsApp** (se autorizado e com integra√ß√£o posterior).
  - Confirma√ß√£o de leitura/recebimento (ack).
- Funcionalidades
  - **Minhas designa√ß√µes**: pr√≥ximas/atuais, instru√ß√µes, hor√°rio, local, materiais anexos.
  - **Materiais de estudo**: link seguro para PDFs/JWPub/RTF publicados pelo admin.
  - **Hist√≥rico**: partes realizadas, datas e feedback (se o instrutor registrar).
  - Perfil b√°sico (sem edi√ß√£o de permiss√µes) e pol√≠tica de acesso somente-leitura a programas.

### Observa√ß√µes de arquitetura/seguran√ßa
- RLS no Supabase com pap√©is: admin, instrutor, estudante; acesso sempre por congrega√ß√£o.
- Auditoria de mudan√ßas de designa√ß√µes e publica√ß√µes.
- Erros: mensagens amig√°veis + fail-fast; sincroniza√ß√£o resiliente.
- UI consistente: Tailwind + shadcn/ui; componentes reutiliz√°veis; arquivos curtos.

Se quiser, eu detalho modelos de dados (programa, partes, designa√ß√µes), fluxo de sincroniza√ß√£o e telas com wireframes r√°pidos.

---

**User**

isso esta de acordo com sua resposta? 

---

**Cursor**

Sim, est√° alinhado ao que respondi ‚Äî cobre pap√©is dos dashboards, instala√ß√£o, execu√ß√£o, portas, testes e pr√°ticas de seguran√ßa.

Pequenas diferen√ßas que vale ajustar quando avan√ßarmos:
- Importa√ß√£o com pr√©-visualiza√ß√£o/edi√ß√£o leve (Admin): n√£o est√° descrita no README; est√° na resposta de vis√£o. Podemos adicionar uma subse√ß√£o ‚ÄúFluxo de importa√ß√£o‚Äù depois.
- Offline-first (Instrutor): o README cita offline de forma breve; na vis√£o detalhei IndexedDB/Service Worker e fila de sincroniza√ß√£o. Podemos incluir uma subse√ß√£o ‚ÄúModo offline e sincroniza√ß√£o‚Äù.
- Notifica√ß√µes do Estudante: o README n√£o entra em e-mail/WhatsApp/ack; podemos acrescentar em ‚ÄúPortal do Estudante‚Äù.
- DOCS_PATH: o README lista `DOCS_PATH`, mas o `backend/server.js` usa caminho fixo `../docs/Oficial`. Se quiser usar env, precisamos ler `process.env.DOCS_PATH` ali. Quer que eu fa√ßa esse ajuste?

---

**User**

Excelente estrutura de README üëå. O documento j√° est√° claro e organizado. Vou sugerir alguns **aprimoramentos** para deix√°-lo ainda mais completo e f√°cil de usar no dia a dia do projeto:

---

### üîß Sugest√µes de melhoria

1. **Pap√©is de usu√°rios mais detalhados**

   * No *Dashboard do Estudante*, incluir que ele tamb√©m pode receber **notifica√ß√µes autom√°ticas** (e-mail/WhatsApp) e acessar **instru√ß√µes pr√°ticas** da parte.
   * No *Dashboard do Instrutor*, refor√ßar que pode **exportar relat√≥rios em PDF/Excel** com designa√ß√µes.

2. **Fluxo de dados**
   Adicionar um diagrama simples (texto ASCII ou link para imagem) mostrando:

   ```
   Admin importa programas ‚Üí Instrutor designa estudantes ‚Üí Estudante acessa sua parte
   ```

3. **Offline-first**
   No trecho do *Instrutor*, detalhar:

   > "As altera√ß√µes feitas offline s√£o armazenadas localmente e sincronizadas automaticamente quando a internet voltar, evitando perda de dados."

4. **Banco de dados (Supabase)**
   Criar se√ß√£o curta listando as principais tabelas e entidades:

   * `estudantes`
   * `designacoes`
   * `congregacoes`
   * `programas`

5. **Se√ß√£o de Deploy**
   Adicionar instru√ß√µes b√°sicas para publica√ß√£o:

   * Frontend em **Vercel ou Netlify**
   * Backend em **Railway, Render ou Supabase Edge Functions**

6. **Se√ß√£o "Doa√ß√µes / Apoio"** (j√° falamos disso)
   Como o projeto n√£o cobra taxa fixa, pode-se adicionar no final:

   > "Este sistema √© oferecido gratuitamente. Caso queira apoiar o desenvolvimento, utilize o QR Code de doa√ß√£o Pix dispon√≠vel no portal do estudante."

---

üëâ Pergunta: voc√™ quer que eu **aplique j√° essas melhorias no README.md** (reescrevendo e expandindo), ou prefere que eu crie um **novo arquivo `README_EXTENDIDO.md`** para servir como documenta√ß√£o avan√ßada?


---

**Cursor**

Recomendo manter o README atual enxuto e criar um `README_EXTENDIDO.md` com os detalhes (pap√©is avan√ßados, fluxo de dados, offline-first, modelo de dados, deploy e doa√ß√µes). Assim preservamos a clareza do README principal.

Quer que eu crie agora o `README_EXTENDIDO.md` com as melhorias sugeridas?

---

**User**

sim

---

**Cursor**

I'll create a new `README_EXTENDIDO.md` with the advanced documentation you requested: detailed user roles, data flow diagram, offline-first behavior, database entities, deployment options, and donations.

```markdown
*** Begin Patch
*** Add File: README_EXTENDIDO.md
+# Sua-Parte ‚Äî Documenta√ß√£o Estendida

Este documento complementa o `README.md` com detalhes operacionais para planejamento e evolu√ß√£o do sistema.

## Pap√©is e Capacidades por Dashboard

### Admin Dashboard
- Importar materiais oficiais (PDF, JWPub, RTF) com pr√©-visualiza√ß√£o estruturada por semana/parte.
- Edi√ß√£o leve ap√≥s importa√ß√£o: t√≠tulos, tempos, observa√ß√µes e corre√ß√µes de parsing.
- Publica√ß√£o universal (todas as congrega√ß√µes) ou segmentada por congrega√ß√£o/idioma/regi√£o, com agendamento.
- Hist√≥rico e rollback de publica√ß√µes; monitoramento de servi√ßos do backend.

### Dashboard do Instrutor
- Visualiza√ß√£o da programa√ß√£o: lista de semanas (padr√£o) ou calend√°rio (toggle), filtros por m√™s/idioma.
- Gest√£o de estudantes e designa√ß√µes por parte (S-38), com notas e status.
- Exporta√ß√£o de relat√≥rios de designa√ß√µes em PDF/Excel.
- Offline-first: trabalho completo offline; sincroniza√ß√£o autom√°tica quando reconectar.

### Portal do Estudante
- Notifica√ß√µes de designa√ß√£o: in-app (toasts/central) e opcional por e-mail/WhatsApp (mediante consentimento e configura√ß√£o).
- Acesso a instru√ß√µes pr√°ticas da parte e materiais de estudo disponibilizados pelo admin.
- Hist√≥rico de partes realizadas e confirma√ß√£o de leitura/recebimento (ack) opcional.

## Fluxo de Dados (alto n√≠vel)
```
Admin importa programas  ->  Publica (todas/segmentado)  ->  Instrutor recebe semanas
Instrutor designa estudantes  ->  Publica designa√ß√µes  ->  Estudante √© notificado e acessa
```

## Offline-first e Sincroniza√ß√£o (Instrutor)
- Armazenamento local: IndexedDB + Service Worker para dados e fila de opera√ß√µes.
- Altera√ß√µes offline (estudantes/designa√ß√µes/notas) s√£o persistidas localmente e sincronizadas assim que houver conex√£o.
- Estrat√©gia de conflitos: last-write-wins por padr√£o, com aviso quando houver diverg√™ncias.
- Indicadores: status de sincroniza√ß√£o, fila pendente e a√ß√£o manual ‚ÄúSincronizar agora‚Äù.

## Modelo de Dados (Supabase)
- Tabelas principais (nomes ilustrativos; alinhar com migra√ß√µes existentes):
  - `congregacoes`: congrega√ß√£o e metadados (regi√£o/idioma).
  - `profiles`: usu√°rios com `role` (admin/instrutor/estudante) e congrega√ß√£o.
  - `programas`: semanas/partes publicadas (fonte oficial importada), idioma/per√≠odo.
  - `estudantes`: cadastro local por congrega√ß√£o, status, observa√ß√µes.
  - `designacoes`: v√≠nculo estudante-parte-semana, status e notas.
- Seguran√ßa: RLS por congrega√ß√£o e papel; privil√©gios m√≠nimos; auditoria de mudan√ßas sens√≠veis.

## Materiais Est√°ticos (Backend)
- O backend serve `docs/Oficial` via `/materials` (porta padr√£o 3001).
- Exemplos: `http://localhost:3001/materials/mwb_E_202507.pdf`.
- Recomenda√ß√µes: evitar espa√ßos/par√™nteses em nomes; quando necess√°rio, usar encoding na URL (`%20`).

## Deploy (Vis√£o Geral)
- Frontend (Vite/React):
  - Vercel ou Netlify (build `npm run build`, diret√≥rio `dist/`).
  - Configurar `VITE_SUPABASE_URL` e `VITE_SUPABASE_ANON_KEY` em vari√°veis de ambiente.
- Backend (Express):
  - Railway ou Render. Definir `PORT`, `SUPABASE_URL`, `SUPABASE_ANON_KEY` e apontar `DOCS_PATH` se parametrizado.
  - Alternativa: converter rotas para Supabase Edge Functions quando aplic√°vel (leitura/publica√ß√£o).
- Banco (Supabase):
  - Aplicar migra√ß√µes, habilitar RLS, revisar pol√≠ticas por papel, e criar chaves de servi√ßo com escopo m√≠nimo.

## Relat√≥rios e Exporta√ß√µes (Instrutor)
- Exportar designa√ß√µes por semana/m√™s em PDF/Excel.
- Padr√£o visual consistente (cabe√ßalho com congrega√ß√£o, per√≠odo e legenda de status).
- Op√ß√£o de incluir observa√ß√µes e tempos estimados.

## Notifica√ß√µes (Estudante)
- In-app: centro de notifica√ß√µes, toasts e contadores.
- E-mail: templates simples (ass√≠ncrono; opt-in).
- WhatsApp: integra√ß√£o opcional futura (requer consentimento e provedor API conforme LGPD).

## Boas Pr√°ticas e Seguran√ßa
- N√£o expor segredos no frontend; usar env vars. Rotas sens√≠veis protegidas por RLS.
- Guard clauses e fail-fast em APIs; logs com correla√ß√£o de requisi√ß√µes.
- Componentes e hooks curtos, reutiliz√°veis; Tailwind + shadcn/ui para consist√™ncia.

## Roadmap Sugerido
- [ ] Parametrizar `DOCS_PATH` no backend via `process.env.DOCS_PATH`.
- [ ] Implementar preview e edi√ß√£o leve na importa√ß√£o do Admin.
- [ ] Tabela/roteiro de sincroniza√ß√£o offline (fila, replays, conflitos).
- [ ] Exporta√ß√µes PDF/Excel no Instrutor.
- [ ] Notifica√ß√µes e-mail (primeira etapa) e in-app com ack.
- [ ] Guia de deploy com exemplos pr√°ticos (Railway/Render + Vercel/Netlify).

## Doa√ß√µes / Apoio
> Este sistema √© oferecido gratuitamente. Caso queira apoiar o desenvolvimento, utilize o QR Code de doa√ß√£o Pix dispon√≠vel no portal do estudante.

---
Para d√∫vidas t√©cnicas espec√≠ficas, consulte tamb√©m: `ADMIN_DASHBOARD_INTEGRATION.md`, `DEBUG_ADMIN_DASHBOARD.md` e `README_ESTUDANTES.md`.
*** End Patch
```

Creating `README_EXTENDIDO.md` with advanced documentation (roles, data flow, offline, DB entities, deploy, donations).

```markdown
*** Begin Patch
*** Add File: README_EXTENDIDO.md
+# Sua-Parte ‚Äî Documenta√ß√£o Estendida

Este documento complementa o README.md com detalhes operacionais para planejamento e evolu√ß√£o do sistema.

## Pap√©is e Capacidades por Dashboard

### Admin Dashboard
- Importar materiais oficiais (PDF, JWPub, RTF) com pr√©-visualiza√ß√£o por semana/parte.
- Edi√ß√£o leve ap√≥s importa√ß√£o: t√≠tulos, tempos, observa√ß√µes e corre√ß√µes de parsing.
- Publica√ß√£o universal (todas as congrega√ß√µes) ou segmentada por congrega√ß√£o/idioma/regi√£o, com agendamento.
- Hist√≥rico e rollback de publica√ß√µes; monitoramento de servi√ßos do backend.

### Dashboard do Instrutor
- Visualiza√ß√£o da programa√ß√£o: lista de semanas (padr√£o) ou calend√°rio (toggle), filtros por m√™s/idioma.
- Gest√£o de estudantes e designa√ß√µes por parte (S-38), com notas e status.
- Exporta√ß√£o de relat√≥rios de designa√ß√µes em PDF/Excel.
- Offline-first: trabalho completo offline; sincroniza√ß√£o autom√°tica quando reconectar.

### Portal do Estudante
- Notifica√ß√µes de designa√ß√£o: in-app (toasts/central) e opcional por e-mail/WhatsApp (mediante consentimento e configura√ß√£o).
- Acesso a instru√ß√µes pr√°ticas da parte e materiais de estudo disponibilizados pelo admin.
- Hist√≥rico de partes realizadas e confirma√ß√£o de leitura/recebimento (ack) opcional.

## Fluxo de Dados (alto n√≠vel)
```
Admin importa programas  ->  Publica (todas/segmentado)  ->  Instrutor recebe semanas
Instrutor designa estudantes  ->  Publica designa√ß√µes  ->  Estudante √© notificado e acessa
```

## Offline-first e Sincroniza√ß√£o (Instrutor)
- Armazenamento local: IndexedDB + Service Worker para dados e fila de opera√ß√µes.
- Altera√ß√µes offline (estudantes/designa√ß√µes/notas) s√£o persistidas localmente e sincronizadas assim que houver conex√£o.
- Estrat√©gia de conflitos: last-write-wins por padr√£o, com aviso quando houver diverg√™ncias.
- Indicadores: status de sincroniza√ß√£o, fila pendente e a√ß√£o manual "Sincronizar agora".

## Modelo de Dados (Supabase)
- Tabelas principais (nomes ilustrativos; alinhar com migra√ß√µes existentes):
  - `congregacoes`: congrega√ß√£o e metadados (regi√£o/idioma).
  - `profiles`: usu√°rios com `role` (admin/instrutor/estudante) e congrega√ß√£o.
  - `programas`: semanas/partes publicadas (fonte oficial importada), idioma/per√≠odo.
  - `estudantes`: cadastro local por congrega√ß√£o, status, observa√ß√µes.
  - `designacoes`: v√≠nculo estudante-parte-semana, status e notas.
- Seguran√ßa: RLS por congrega√ß√£o e papel; privil√©gios m√≠nimos; auditoria de mudan√ßas sens√≠veis.

## Materiais Est√°ticos (Backend)
- O backend serve `docs/Oficial` via `/materials` (porta padr√£o 3001).
- Exemplos: `http://localhost:3001/materials/mwb_E_202507.pdf`.
- Recomenda√ß√µes: evitar espa√ßos/par√™nteses em nomes; quando necess√°rio, usar encoding na URL (`%20`).

## Deploy (Vis√£o Geral)
- Frontend (Vite/React):
  - Vercel ou Netlify (build `npm run build`, diret√≥rio `dist/`).
  - Configurar `VITE_SUPABASE_URL` e `VITE_SUPABASE_ANON_KEY` em vari√°veis de ambiente.
- Backend (Express):
  - Railway ou Render. Definir `PORT`, `SUPABASE_URL`, `SUPABASE_ANON_KEY` e apontar `DOCS_PATH` se parametrizado.
  - Alternativa: converter rotas para Supabase Edge Functions quando aplic√°vel (leitura/publica√ß√£o).
- Banco (Supabase):
  - Aplicar migra√ß√µes, habilitar RLS, revisar pol√≠ticas por papel e criar chaves de servi√ßo com escopo m√≠nimo.

## Relat√≥rios e Exporta√ß√µes (Instrutor)
- Exportar designa√ß√µes por semana/m√™s em PDF/Excel.
- Padr√£o visual consistente (cabe√ßalho com congrega√ß√£o, per√≠odo e legenda de status).
- Op√ß√£o de incluir observa√ß√µes e tempos estimados.

## Notifica√ß√µes (Estudante)
- In-app: centro de notifica√ß√µes, toasts e contadores.
- E-mail: templates simples (ass√≠ncrono; opt-in).
- WhatsApp: integra√ß√£o opcional futura (requer consentimento e provedor API conforme LGPD).

## Boas Pr√°ticas e Seguran√ßa
- N√£o expor segredos no frontend; usar env vars. Rotas sens√≠veis protegidas por RLS.
- Guard clauses e fail-fast em APIs; logs com correla√ß√£o de requisi√ß√µes.
- Componentes e hooks curtos, reutiliz√°veis; Tailwind + shadcn/ui para consist√™ncia.

## Roadmap Sugerido
- [ ] Parametrizar `DOCS_PATH` no backend via `process.env.DOCS_PATH`.
- [ ] Implementar preview e edi√ß√£o leve na importa√ß√£o do Admin.
- [ ] Tabela/roteiro de sincroniza√ß√£o offline (fila, replays, conflitos).
- [ ] Exporta√ß√µes PDF/Excel no Instrutor.
- [ ] Notifica√ß√µes e-mail (primeira etapa) e in-app com ack.
- [ ] Guia de deploy com exemplos pr√°ticos (Railway/Render + Vercel/Netlify).

## Doa√ß√µes / Apoio
> Este sistema √© oferecido gratuitamente. Caso queira apoiar o desenvolvimento, utilize o QR Code de doa√ß√£o Pix dispon√≠vel no portal do estudante.

---
Para d√∫vidas t√©cnicas espec√≠ficas, consulte tamb√©m: `ADMIN_DASHBOARD_INTEGRATION.md`, `DEBUG_ADMIN_DASHBOARD.md` e `README_ESTUDANTES.md`.
*** End Patch
```

Criando o arquivo `README_EXTENDIDO.md` com a documenta√ß√£o avan√ßada solicitada (pap√©is detalhados, fluxo de dados, offline-first, entidades do banco, deploy e doa√ß√µes).

```markdown
# Sua-Parte ‚Äî Documenta√ß√£o Estendida

Este documento complementa o README.md com detalhes operacionais para planejamento e evolu√ß√£o do sistema.

## Pap√©is e Capacidades por Dashboard

### Admin Dashboard
- Importar materiais oficiais (PDF, JWPub, RTF) com pr√©-visualiza√ß√£o por semana/parte.
- Edi√ß√£o leve ap√≥s importa√ß√£o: t√≠tulos, tempos, observa√ß√µes e corre√ß√µes de parsing.
- Publica√ß√£o universal (todas as congrega√ß√µes) ou segmentada por congrega√ß√£o/idioma/regi√£o, com agendamento.
- Hist√≥rico e rollback de publica√ß√µes; monitoramento de servi√ßos do backend.

### Dashboard do Instrutor
- Visualiza√ß√£o da programa√ß√£o: lista de semanas (padr√£o) ou calend√°rio (toggle), filtros por m√™s/idioma.
- Gest√£o de estudantes e designa√ß√µes por parte (S-38), com notas e status.
- Exporta√ß√£o de relat√≥rios de designa√ß√µes em PDF/Excel.
- Offline-first: trabalho completo offline; sincroniza√ß√£o autom√°tica quando reconectar.

### Portal do Estudante
- Notifica√ß√µes de designa√ß√£o: in-app (toasts/central) e opcional por e-mail/WhatsApp (mediante consentimento e configura√ß√£o).
- Acesso a instru√ß√µes pr√°ticas da parte e materiais de estudo disponibilizados pelo admin.
- Hist√≥rico de partes realizadas e confirma√ß√£o de leitura/recebimento (ack) opcional.

## Fluxo de Dados (alto n√≠vel)
```
Admin importa programas  ->  Publica (todas/segmentado)  ->  Instrutor recebe semanas
Instrutor designa estudantes  ->  Publica designa√ß√µes  ->  Estudante √© notificado e acessa
```

## Offline-first e Sincroniza√ß√£o (Instrutor)
- Armazenamento local: IndexedDB + Service Worker para dados e fila de opera√ß√µes.
- Altera√ß√µes offline (estudantes/designa√ß√µes/notas) s√£o persistidas localmente e sincronizadas assim que houver conex√£o.
- Estrat√©gia de conflitos: last-write-wins por padr√£o, com aviso quando houver diverg√™ncias.
- Indicadores: status de sincroniza√ß√£o, fila pendente e a√ß√£o manual "Sincronizar agora".

## Modelo de Dados (Supabase)
- Tabelas principais (nomes ilustrativos; alinhar com migra√ß√µes existentes):
  - `congregacoes`: congrega√ß√£o e metadados (regi√£o/idioma).
  - `profiles`: usu√°rios com `role` (admin/instrutor/estudante) e congrega√ß√£o.
  - `programas`: semanas/partes publicadas (fonte oficial importada), idioma/per√≠odo.
  - `estudantes`: cadastro local por congrega√ß√£o, status, observa√ß√µes.
  - `designacoes`: v√≠nculo estudante-parte-semana, status e notas.
- Seguran√ßa: RLS por congrega√ß√£o e papel; privil√©gios m√≠nimos; auditoria de mudan√ßas sens√≠veis.

## Materiais Est√°ticos (Backend)
- O backend serve `docs/Oficial` via `/materials` (porta padr√£o 3001).
- Exemplos: `http://localhost:3001/materials/mwb_E_202507.pdf`.
- Recomenda√ß√µes: evitar espa√ßos/par√™nteses em nomes; quando necess√°rio, usar encoding na URL (`%20`).

## Deploy (Vis√£o Geral)
- Frontend (Vite/React):
  - Vercel ou Netlify (build `npm run build`, diret√≥rio `dist/`).
  - Configurar `VITE_SUPABASE_URL` e `VITE_SUPABASE_ANON_KEY` em vari√°veis de ambiente.
- Backend (Express):
  - Railway ou Render. Definir `PORT`, `SUPABASE_URL`, `SUPABASE_ANON_KEY` e apontar `DOCS_PATH` se parametrizado.
  - Alternativa: converter rotas para Supabase Edge Functions quando aplic√°vel (leitura/publica√ß√£o).
- Banco (Supabase):
  - Aplicar migra√ß√µes, habilitar RLS, revisar pol√≠ticas por papel e criar chaves de servi√ßo com escopo m√≠nimo.

## Relat√≥rios e Exporta√ß√µes (Instrutor)
- Exportar designa√ß√µes por semana/m√™s em PDF/Excel.
- Padr√£o visual consistente (cabe√ßalho com congrega√ß√£o, per√≠odo e legenda de status).
- Op√ß√£o de incluir observa√ß√µes e tempos estimados.

## Notifica√ß√µes (Estudante)
- In-app: centro de notifica√ß√µes, toasts e contadores.
- E-mail: templates simples (ass√≠ncrono; opt-in).
- WhatsApp: integra√ß√£o opcional futura (requer consentimento e provedor API conforme LGPD).

## Boas Pr√°ticas e Seguran√ßa
- N√£o expor segredos no frontend; usar env vars. Rotas sens√≠veis protegidas por RLS.
- Guard clauses e fail-fast em APIs; logs com correla√ß√£o de requisi√ß√µes.
- Componentes e hooks curtos, reutiliz√°veis; Tailwind + shadcn/ui para consist√™ncia.

## Roadmap Sugerido
- [ ] Parametrizar `DOCS_PATH` no backend via `process.env.DOCS_PATH`.
- [ ] Implementar preview e edi√ß√£o leve na importa√ß√£o do Admin.
- [ ] Tabela/roteiro de sincroniza√ß√£o offline (fila, replays, conflitos).
- [ ] Exporta√ß√µes PDF/Excel no Instrutor.
- [ ] Notifica√ß√µes e-mail (primeira etapa) e in-app com ack.
- [ ] Guia de deploy com exemplos pr√°ticos (Railway/Render + Vercel/Netlify).

## Doa√ß√µes / Apoio
> Este sistema √© oferecido gratuitamente. Caso queira apoiar o desenvolvimento, utilize o QR Code de doa√ß√£o Pix dispon√≠vel no portal do estudante.

---
Para d√∫vidas t√©cnicas espec√≠ficas, consulte tamb√©m: `ADMIN_DASHBOARD_INTEGRATION.md`, `DEBUG_ADMIN_DASHBOARD.md` e `README_ESTUDANTES.md`.
```

Criei o `README_EXTENDIDO.md` com:
- Pap√©is avan√ßados por dashboard
- Fluxo de dados (ASCII)
- Offline-first e sincroniza√ß√£o
- Entidades principais no Supabase
- Diretrizes de deploy (frontend/backend/banco)
- Exporta√ß√µes de relat√≥rios
- Notifica√ß√µes
- Boas pr√°ticas e roadmap
- Se√ß√£o de doa√ß√µes/apoio

Voc√™ quer que eu adicione um link para esse arquivo no `README.md` (ex.: ‚ÄúDocumenta√ß√£o Estendida‚Äù)?

---

**User**

Entendido. Com a nova documenta√ß√£o, o projeto est√° bem mais claro. Agora, com base nas informa√ß√µes que voc√™ forneceu, tenho mais algumas perguntas para detalhar o funcionamento e garantir que a implementa√ß√£o atenda a todas as suas expectativas.

---

### Perguntas sobre o Fluxo de Trabalho e Sincroniza√ß√£o

* Voc√™ mencionou que o instrutor pode operar offline. Qual √© o escopo dessa opera√ß√£o? Por exemplo, ele pode criar um novo estudante, editar um estudante existente ou apenas fazer designa√ß√µes enquanto estiver offline?
* Quando o instrutor voltar a ter conex√£o, como o sistema vai gerenciar poss√≠veis conflitos de dados? Por exemplo, se um instrutor fizer designa√ß√µes offline, mas o administrador atualizar o programa da reuni√£o, qual vers√£o deve prevalecer?
* O instrutor precisar√° de um bot√£o de "sincronizar" manual ou a sincroniza√ß√£o deve acontecer de forma autom√°tica e silenciosa em segundo plano?

---

### Perguntas sobre a Experi√™ncia do Usu√°rio (UI/UX)

* No dashboard do instrutor, a lista de programas parece ser est√°tica (`programas_em_andamento`). Como a interface vai se atualizar para mostrar os novos programas importados pelo administrador? Haver√° uma visualiza√ß√£o de calend√°rio?
* O painel do estudante tem acesso restrito. O estudante ver√° apenas as suas pr√≥prias designa√ß√µes ou tamb√©m poder√° ver quem est√° escalado para outras partes da reuni√£o (como o discurso e as joias espirituais)?
* H√° planos de permitir que o instrutor envie convites para os estudantes diretamente do painel, ou o cadastro inicial ser√° sempre manual ou por planilha?

---

### Perguntas sobre a Seguran√ßa e o Desempenho

* Voc√™ planeja que o instrutor e o administrador fa√ßam login com a mesma conta do Supabase, mas com diferentes permiss√µes (`roles`), ou eles ter√£o contas separadas e com diferentes n√≠veis de acesso?
* O backend em Node.js est√° definido para ser o √∫nico ponto de contato com o Supabase. Voc√™ gostaria que a l√≥gica de "sincroniza√ß√£o offline" do instrutor tamb√©m passe por esse backend, ou ela ser√° tratada diretamente pelo frontend, comunicando-se com o banco de dados?

Acredito que essas perguntas nos ajudar√£o a definir as funcionalidades em mais detalhes antes de avan√ßarmos com a implementa√ß√£o.

---

**Cursor**

### Fluxo de Trabalho e Sincroniza√ß√£o
- Escopo offline (Instrutor)
  - Criar/editar estudantes: sim (CRUD b√°sico). Exclus√£o definitiva opcionalmente bloqueada offline (usa ‚Äúsoft-delete‚Äù e confirma ao sincronizar).
  - Designa√ß√µes: sim (criar/editar/excluir), com fila local.
  - Observa√ß√µes/anota√ß√µes: sim.
  - Uploads pesados (ex.: anexos): adiar ou enfileirar com aviso (requer conex√£o).
- Conflitos ao reconectar
  - Controle por versionamento (`updated_at`/`version`).
  - Regras:
    - Altera√ß√µes ‚Äúestruturais‚Äù do Admin (ex.: programa/partes removidas/alteradas) prevalecem. Designa√ß√µes que colidem viram ‚Äúem conflito‚Äù e pedem revis√£o do instrutor.
    - Altera√ß√µes ‚Äúlocais‚Äù do instrutor (notas, v√≠nculo estudante-parte) usam last-write-wins quando n√£o h√° mudan√ßa estrutural; caso contr√°rio, marcam conflito.
  - UI mostra lista de conflitos com a√ß√£o ‚Äúresolver‚Äù.
- Sincroniza√ß√£o: autom√°tica + manual
  - Autom√°tica e silenciosa em segundo plano (background sync).
  - Bot√£o ‚ÄúSincronizar agora‚Äù, indicador de fila e √∫ltimo sync (para controle/diagn√≥stico).

### Experi√™ncia do Usu√°rio (UI/UX)
- Atualiza√ß√£o de programas no instrutor
  - Fonte din√¢mica (Supabase + subscri√ß√µes/revalida√ß√µes) ou polling leve; badge ‚ÄúNovo‚Äù.
  - Visualiza√ß√£o: lista de semanas (padr√£o) + toggle para calend√°rio.
- Visibilidade do estudante
  - Padr√£o: v√™ apenas as pr√≥prias designa√ß√µes e materiais associados.
  - Opcional (configur√°vel por congrega√ß√£o): ‚Äúquadro de designa√ß√µes‚Äù somente leitura (sem dados sens√≠veis).
- Convites para estudantes
  - Suportado: convites por e-mail (link m√°gico), QR code em reuni√£o, importa√ß√£o por planilha (bulk). Cadastro manual continua dispon√≠vel.

### Seguran√ßa e Desempenho
- Contas e permiss√µes
  - Contas separadas; roles no `profiles` (admin/instrutor/estudante), RLS por congrega√ß√£o.
  - JWT do Supabase com pol√≠ticas por papel; auditoria de a√ß√µes sens√≠veis.
- Caminho da sincroniza√ß√£o offline
  - CRUD de dados do app: direto no Supabase (menos lat√™ncia; aproveita RLS e row-replication).
  - Backend Node: para servi√ßos (download JW.org, cron, processamento pesado, servir `materials/`). Pode expor endpoints auxiliares (ex.: export PDFs) sem ficar no caminho do CRUD comum.
  - Se preferir auditoria centralizada, podemos rote√°-la pelo backend (webhooks/repasse) sem bloquear o fluxo direto ao Supabase.

Quer que eu adicione essas decis√µes no `README_EXTENDIDO.md` (se√ß√µes ‚ÄúConflitos e Regras‚Äù e ‚ÄúConvites/Importa√ß√£o‚Äù)?

---

**User**

sim, mas ao so escreva me diga como implementar conforme Instructions for Our Christian Life and Ministry Meeting
Table of Contents
Opening Comments. Paragraph 2
Treasures From God‚Äôs Word Paragraphs 3-5
Talk Paragraph 3
Spiritual Gems Paragraph 4
Bible Reading Paragraph 5
Apply Yourself to the Field Ministry Paragraphs 6-14
Starting a Conversation Paragraph 7
Following Up Paragraph 8
Making Disciples Paragraph 9
Explaining Your Beliefs Paragraph 10
Talk 1 Paragraph 1
Content Paragraph 12
Settings Paragraph 13
Use of Videos and Literature Paragraph 14
Living as Christians Paragraphs 15-16
Congregation Bible Study Paragraph 16
Concluding Comments Paragraph 17
Commendation and Counsel Paragraph 18
Timing Paragraph 19
Visit of Circuit Overseer Paragraph 20
Week of an Assembly or a Convention Paragraph 21
Week of the Memorial Paragraph 22
Life and Ministry Meeting Overseer Paragraph 23
Life and Ministry Meeting Chairman Paragraph 24
Auxiliary Counselor Paragraph 25
Auxiliary Classes Paragraph 26
Videos Paragraph 27

1. The instructions in this document will assist all who have a part on the Our Christian Life and Ministry meeting. Such ones should review the instructions for their part as outlined in the Life and Ministry Meeting Workbook and in this document before preparing their part. All publishers should be invited to make themselves available to present student assignments. Others who are actively associating with the congregation may participate if they agree with the teachings of the Bible and their life is in harmony with Christian principles. The Life and Ministry Meeting overseer should discuss the requirements for enrollment with anyone who is not a publisher and expresses a desire to enroll and then let the person know if he qualifies. This should be done in the presence of the one who is conducting a Bible study with him (or in the presence of a believing parent). The requirements are the same as those for a person to become an unbaptized publisher.‚Äîod chapter 8 paragraph 8.
Opening Comments
2. One minute. Each week, after the opening song and prayer, the Life and Ministry Meeting chairman will generate anticipation for the program to follow. The chairman should focus on points that will benefit the congregation the most.
Treasures From God‚Äôs Word
3. Talk: Ten minutes. The theme and an outline of two or three main points are provided in the Life and Ministry Meeting Workbook. This talk is to be assigned to an elder or a qualified ministerial servant. When a new Bible book is scheduled in the weekly Bible reading, a video will be played to introduce it. The speaker may draw parallels between the video and the theme. However, he should be sure to cover the points outlined in the workbook. Also, as time allows, he should make good use of the artwork, which is designed to complement the material to be covered. He may include other reference material as long as it contributes to the development of the points in the outline.
4. Spiritual Gems: Ten minutes. This is a question-and-answer part without an introduction or a conclusion. It is to be handled by an elder or a qualified ministerial servant. The speaker should ask the audience both questions. Also, he may determine whether or not the cited verses need to be read. Those called on should offer comments of 30 seconds or less.
5. Bible Reading: Four minutes. This student assignment is to be handled by a male student. The student should read the assigned material without giving an introduction or a conclusion. The meeting chairman will be especially interested in helping students to read with accuracy, understanding, fluency, proper sense stress, modulation, appropriate pausing, and naturalness. Because some Bible reading assignments are shorter and others are longer, the Life and Ministry Meeting overseer should take into account the abilities of the students when making these assignments.
Apply Yourself to the Field Ministry
6. Fifteen minutes. This section of the meeting is designed to give all the opportunity to practice for the ministry and to improve in their conversation skills and ability to preach and teach. As necessary, elders may receive student assignments. Each student should work on the study point from either the Teaching or Love People brochure that appears in parentheses next to the assignment in the Life and Ministry Meeting Workbook. At times, a part designated as a discussion will be scheduled. Such a part is to be handled by an elder or a qualified ministerial servant.‚ÄîSee paragraph 15 regarding how to handle discussion parts.
7. Starting a Conversation: This student assignment may be handled by a male or a female student. The assistant should be of the same gender or should be a family member. The student and the assistant may sit or stand.‚ÄîFor more information on the content and setting for this assignment, see paragraphs 12 and 13.
8. Following Up: This student assignment may be handled by a male or a female student. The assistant should be of the same gender. (km 5/97 page 2) The student and the assistant may sit or stand. The student should demonstrate what to say when following up on a previous conversation.‚ÄîFor more information on the content and setting for this assignment, see paragraphs 12 and 13.
9. Making Disciples: This student assignment may be handled by a male or a female student. The assistant should be of the same gender. (km 5/97 page 2) The student and the assistant may sit or stand. This part should demonstrate a segment of a Bible study already in progress. There is no need for an introduction or a conclusion unless the student is specifically working on one of these study points. It is not necessary to have all of the assigned material read aloud, although this may be done.
10. Explaining Your Beliefs: When designated as a talk, this student assignment should be handled by a male student. When designated as a demonstration, it may be handled by a male or a female student. The assistant should be of the same gender or should be a family member. The student should provide a clear and tactful answer to the theme question using the information in the reference provided. The student may decide whether or not to refer to the referenced publication during his part.
11. Talk: This student assignment is to be handled by a male student and given as a talk to the congregation. When the talk is based on a point from appendix A of the Love People brochure, the student should highlight how the verse(s) can be used in the ministry. For example, he may explain when a verse may be used, the meaning of the verse, and how to reason on it with a person. When the talk is based on a point from one of the lessons in the Love People brochure, the student should focus on how to apply the point in the ministry. He may highlight the example featured in point 1 of the lesson or highlight any of the supplementary verses included in the lesson, if helpful.
12. Content: The material in this paragraph and the following one applies to the ‚ÄúStarting a Conversation‚Äù and ‚ÄúFollowing Up‚Äù assignments. Unless otherwise noted, the student‚Äôs goal is to share a simple Bible truth that is relevant to the person he is speaking with and to lay the groundwork for a future conversation. The student should select a topic that is timely and effective locally. He may decide whether or not to introduce a publication or video from our Teaching Toolbox. Rather than demonstrate a memorized presentation, students should practice conversation skills, such as showing personal interest and displaying naturalness.
13. Settings: The student should apply the assigned general setting to local circumstances. For example:
(1) House to House: This setting includes preaching from door to door‚Äîwhether in person, by phone, or by letter‚Äîand following up on a previous conversation with a person contacted in the house-to-house ministry.
(2) Informal Witnessing: This setting describes taking advantage of opportunities to turn an ordinary conversation into a witness. It may include sharing a Scriptural thought with those you meet at work, in school, in your neighborhood, on public transportation, or elsewhere while going about your daily activities.
(3) Public Witnessing: This setting may include cart witnessing, calling on people at places of business, street witnessing, or witnessing in parks, parking lots, or wherever people can be found.
14. Use of Videos and Literature: Depending on the circumstances, a student may decide to feature a video or literature. If a student assignment includes a video or if a student chooses to feature one, he should introduce and discuss the video but not play it.
Living as Christians
15. After a song, the next 15 minutes of this section will consist of one or two parts designed to help the audience apply God‚Äôs Word. Unless otherwise indicated, these parts may be assigned to elders or qualified ministerial servants, with the exception of a local needs part, which is to be handled by an elder. When a part is designated as a discussion, the speaker may ask questions throughout the part in addition to the ones provided. He should keep his introduction brief to allow for sufficient time to cover the main points and for audience participation. If an interview is called for, it is preferable for the one being interviewed to give his comments from the stage rather than from his seat, if possible.
16. Congregation Bible Study: Thirty minutes. This part is to be assigned to a qualified elder. (Where the number of elders is limited, qualified ministerial servants may be assigned, as needed.) The body of elders should determine who is qualified to conduct the Congregation Bible Study. Those approved should be able to preside in a meaningful way so as to keep the study on time, emphasize the key scriptures, and assist everyone to appreciate the practical value of the points covered. Those approved will benefit by reviewing published direction regarding how to conduct question-and-answer parts. (w23.04 page 24, box) After the assigned material for the week has been thoroughly covered, there is no need to prolong the study. Where possible, different conductors and readers should be used each week. If the Life and Ministry Meeting chairman directs that the study be abbreviated, then the conductor will have to decide how to abbreviate the study. He may choose to have the reading of some paragraphs omitted.
Concluding Comments
17. Three minutes. The Life and Ministry Meeting chairman will review particularly helpful points from the meeting. He should also preview the material for the next week. He may announce the names of the students who are assigned to give parts the next week, provided there is time for this. Unless otherwise indicated, any necessary announcements should be made and any necessary letters should be read to the congregation by the chairman during his concluding comments. Routine information, such as normal field service arrangements and cleaning schedules, should not be announced from the platform but should be posted on the information board. If any announcements cannot be made or any letters cannot be read in the time allotted for the concluding comments, the chairman should ask the brothers handling parts on the Living as Christians section of the meeting to abbreviate their parts as necessary. (See paragraphs 16 and 19.) The meeting will conclude with song and prayer.
Commendation and Counsel
18. Following each of the student assignments, the Life and Ministry Meeting chairman has approximately one minute to provide commendation and counsel based on the assigned study point. When the chairman introduces a student‚Äôs assignment, he will not announce the study point. However, when the student‚Äôs assignment is finished and after some appropriate words of commendation, the chairman may announce the study point and state why the student did well on that point or kindly explain why and how the student should give that particular point further attention. The chairman may also comment on other aspects of the demonstration if he feels that this would benefit the student or the audience. Additional constructive counsel based on the Love People brochure, the Teaching brochure, or the Ministry School book may be given privately after the meeting or at another time, either on the assigned study point or on another study point.‚ÄîFor more information regarding the role of the Life and Ministry Meeting chairman and the role of the auxiliary counselor, see paragraphs 19, 24, and 25.
Timing
19. No part should go overtime, nor should the remarks of the Life and Ministry Meeting chairman. Although the Life and Ministry Meeting Workbook specifies the timing for each part, if the material is adequately covered, there is no need to add information simply to use all of the allotted time. If parts go overtime, private counsel should be given by the Life and Ministry Meeting chairman or the auxiliary counselor. (See paragraphs 24 and 25.) The entire meeting, including songs and prayers, should last 1 hour and 45 minutes.
Visit of Circuit Overseer
20. When the congregation has the visit of the circuit overseer, the program should proceed as described in the Life and Ministry Meeting Workbook with the following exceptions: The Congregation Bible Study portion of the Living as Christians section will be replaced with a 30-minute service talk given by the circuit overseer. Prior to the service talk, the Life and Ministry Meeting chairman will review the program just held, preview the next week‚Äôs program, make any necessary announcements, read any necessary letters, and then introduce the circuit overseer. After the service talk, the circuit overseer will conclude the meeting with a song of his choice. He may invite another brother to conclude with prayer. No auxiliary classes in the language of the congregation should be held during the visit of the circuit overseer. A group may hold its meetings even when the circuit overseer is visiting the host congregation. However, the group should rejoin the host congregation for the circuit overseer‚Äôs service talk.
Week of an Assembly or a Convention
21. During the week of an assembly or a convention, no congregation meetings are held. The congregation should be reminded that the material scheduled for meetings during such weeks should be considered individually or as a family.
Week of the Memorial
22. When the Memorial falls on a weekday, no Life and Ministry Meeting will be scheduled.
Life and Ministry Meeting Overseer
23. An elder selected by the body of elders will serve as the Life and Ministry Meeting overseer. He is responsible for ensuring that this meeting is well organized and handled according to these instructions. He should maintain good communication with the auxiliary counselor. As soon as the Life and Ministry Meeting Workbook becomes available, the Life and Ministry Meeting overseer will assign all the midweek-meeting parts for the two-month period. This includes the nonstudent assignments and the midweek-meeting chairmen from among those approved by the body of elders, as well as the student assignments. (See paragraphs 3-16 and 24.) When making student assignments, he should take into consideration the student‚Äôs age, experience, and freeness of speech on the matter being discussed. He should use similar judgment when assigning the other parts of the meeting. Each of the assignments should be distributed at least three weeks prior to the date of the assignment. The Our Christian Life and Ministry Meeting Assignment (S-89) form should be used for the student assignments. The Life and Ministry Meeting overseer should ensure that a copy of the assignment schedule for the entire meeting is posted on the information board. The body of elders may assign another elder or a ministerial servant to assist him. However, only elders should be used to assign nonstudent parts.
Life and Ministry Meeting Chairman
24. Each week, one elder will serve as the chairman for the duration of the Life and Ministry Meeting. (Where the number of elders is limited, qualified ministerial servants may be assigned as needed.) He is responsible for preparing the introductory and concluding comments. He also introduces all the parts, and depending on the size of the body of elders, he may be responsible for handling other parts on the meeting, especially parts that simply call for a video to be shown without additional discussion. Comments between parts should be very brief. The body of elders will determine which elders are qualified to fill this role. The qualified elders are assigned as chairmen periodically. Depending on local circumstances, the Life and Ministry Meeting overseer may be used as chairman more frequently than the other qualified elders. If an elder is qualified to conduct the Congregation Bible Study, likely he is qualified to serve as the meeting chairman. Please keep in mind, however, that the elder who serves as chairman is required to offer loving and helpful commendation and, as needed, counsel to those who have student assignments. The chairman is also responsible for ensuring that the meeting concludes on time. (See paragraphs 17 and 19.) If the chairman wishes and if there is adequate space, a standing microphone may be positioned on the platform so that he can introduce each ensuing part while the brother giving the part is taking his position at the speaker stand. Likewise, the chairman may wish to sit at a table on stage during the student Bible reading assignment and the Apply Yourself to the Field Ministry section of the meeting. This may conserve time.
Auxiliary Counselor
25. Whenever possible, it is good to use an elder who is an experienced speaker to fill this role. The auxiliary counselor‚Äôs responsibility is to give private counsel, if needed, to elders and ministerial servants regarding any speaking assignments they may handle, including parts on the Life and Ministry Meeting, public talks, and conducting or reading at the Watchtower Study or Congregation Bible Study. (See paragraph 19.) If there are a number of elders in the congregation who are capable speakers and teachers, then a different qualified elder may serve as the auxiliary counselor each year. It is not necessary for the auxiliary counselor to offer counsel after each assignment.
Auxiliary Classes
26. Depending on the number of students, congregations may hold auxiliary classes for the student assignments. Each auxiliary class should have a qualified counselor, preferably an elder. Where necessary, a well-qualified ministerial servant may be assigned. The body of elders should decide who may serve in this capacity and whether the assignment should rotate. The counselor should follow the procedure described in paragraph 18. If an auxiliary class is held, students should be asked to go to the auxiliary classroom following the Spiritual Gems portion of the Treasures From God‚Äôs Word section of the meeting. They should rejoin the rest of the congregation following the last student assignment on the meeting.
Videos
27. Selected videos will be used in connection with this meeting. The videos for the midweek meeting will be available via the JW Library¬Æ app and accessible using a variety of devices.

¬© 2023 Watch Tower Bible and Tract Society of Pennsylvania
S-38-E 11/23


---

**Cursor**

Seguem instru√ß√µes objetivas de implementa√ß√£o alinhadas ao S‚Äë38 (Our Christian Life and Ministry Meeting), por m√≥dulo.

### Modelo de dados (m√≠nimo vi√°vel)
- Tabelas
  - congregacoes(id, nome, idioma)
  - profiles(id, role: admin|instrutor|estudante, congregacao_id)
  - programas(id, congregacao_scope: all|subset, idioma, semana_iso, data_inicio, data_fim, status: rascunho|publicado, versao, created_at, updated_at)
  - partes(id, programa_id, secao: treasures|apply|living|cbs|opening|closing, subsecao, titulo, referencia, paragrafos_ref, tempo_min, elegibilidade: elder|ms|irm√£o|irm√£, tipo: talk|qna|reading|demo|discussion|video|study, ordem, observacoes)
  - designacoes(id, parte_id, estudante_id, assistente_id?, status: pendente|confirmada|rejeitada|concluida, notas, updated_at, versao)
  - estudantes(id, congregacao_id, nome, genero, pode_ler? boolean, pode_falar? boolean, ativo, historico_resumo)
  - configuracoes(id, congregacao_id, mostrar_quadro_publico boolean, notificacao_email boolean, notificacao_whatsapp boolean)
  - feriados_especiais(semana_iso, tipo: memorial|assembly|convention|visit_overseer)
- Observa√ß√£o: use RLS por `congregacao_id`; `programas` com `congregacao_scope=all` s√£o leg√≠veis por todas.

### Importa√ß√£o/Admin (S‚Äë38 fiel)
- Mapear ‚ÄúTable of Contents‚Äù do S‚Äë38 para `secao/subsecao/tipo/elegibilidade/tempo_min`:
  - Opening Comments: secao=openning, tipo=talk, tempo=1
  - Treasures: Talk(10), Spiritual Gems(Q&A 10), Bible Reading(leitura 4; estudante masculino)
  - Apply Yourself: total 15; subpartes Starting, Following Up, Making Disciples, Explaining Beliefs, Talk 1; cada uma como `tipo` talk|demo com `elegibilidade` por g√™nero conforme S‚Äë38; anexar ‚ÄúContent/Settings/Use of Videos‚Äù como diretrizes em `observacoes`
  - Living as Christians: at√© 15 (1‚Äì2 partes + poss√≠veis discussion), depois Congregation Bible Study 30 (elder qualificado)
  - Concluding Comments: 3
  - Timing total: 1h45
- Valida√ß√µes na publica√ß√£o:
  - Respeitar tempos por parte; somat√≥rio por se√ß√£o e total
  - Restri√ß√µes de elegibilidade (ex.: Bible Reading: masculino; Explaining Beliefs: talk ‚Üí masculino; demo ‚Üí ambos)
  - ‚ÄúUse of Videos‚Äù: marcar como ‚Äún√£o reproduzir‚Äù (somente citar)
  - Semanas especiais: se memorial/assembly/convention ‚Üí ocultar/ajustar se√ß√µes conforme par√°grafos 21‚Äì22; visita do superintendente (20): substituir CBS por service talk
- Publica√ß√£o:
  - Universal (todas) por padr√£o; permitir segmenta√ß√£o por congrega√ß√µes/idiomas
  - Vers√£o imut√°vel por programa publicado; atualiza√ß√µes geram nova `versao` + diff

### Dashboard do Instrutor
- UI lista/calend√°rio de semanas (badge ‚Äúnovo‚Äù quando `versao` muda)
- Tela da semana: lista de `partes` com regras S‚Äë38 evidentes:
  - Mostre `tempo_min`, `tipo`, `elegibilidade`, `observacoes` (Content/Settings)
  - Bloqueie designar papel incompat√≠vel (ex.: leitura b√≠blica ‚Üí masculino; assistente mesmo g√™nero)
- Fluxo de designa√ß√£o:
  - Criar/editar/remover designa√ß√µes dentro das regras
  - Exportar PDF/Excel (sem nomes ao publicar globalmente, opcional quadro p√∫blico por cong)
- Offline-first:
  - Permitir CRUD de estudantes e designa√ß√µes offline (soft-delete)
  - Fila com marca√ß√£o de depend√™ncias por `versao` do `programa`
  - Sincroniza√ß√£o: autom√°tica em background + bot√£o ‚ÄúSincronizar agora‚Äù
- Conflitos:
  - Se `programa.versao` local < remota: marcar designa√ß√µes afetadas como ‚Äúem conflito‚Äù; pedir remapeamento se a parte foi alterada/removida
  - Para campos locais (notas/ordem locais) sem mudan√ßa estrutural: last-write-wins
  - Resolver em modal com diffs (parte/estudante/tempo)

### Portal do Estudante
- Acessos:
  - Ver apenas suas designa√ß√µes e materiais do admin
  - Opcional: quadro p√∫blico (somente leitura, sem dados sens√≠veis) se `configuracoes.mostrar_quadro_publico`
- Notifica√ß√µes:
  - In-app sempre; e-mail/WhatsApp se habilitado (opt-in)
  - Confirma√ß√£o de leitura (ack) gravada em `designacoes.status`/`logs` (opcional)

### Regras espec√≠ficas S‚Äë38 em tempo de designa√ß√£o
- G√™nero/assistente:
  - Starting/Following/Making: aluno e assistente de mesmo g√™nero; familiar permitido
  - Explaining Your Beliefs: se ‚Äútalk‚Äù ‚Üí masculino; se ‚Äúdemo‚Äù ‚Üí ambos; assistente mesmo g√™nero/familiar
  - Bible Reading: masculino; sem intro/conclus√£o
  - Spiritual Gems: Q&A sem intro/conclus√£o; respostas ‚â§30s
- Settings (aplica√ß√£o do cen√°rio):
  - House-to-House / Informal / Public: registrar cen√°rio escolhido na designa√ß√£o
- Timing:
  - Nenhuma parte pode exceder o tempo em `tempo_min`; somat√≥rio por se√ß√£o respeitado
  - Mostrar cron√¥metro/indicador ao instrutor (opcional)
- V√≠deos:
  - ‚ÄúN√£o reproduzir‚Äù nas designa√ß√µes; apenas citar/introduzir

### Semanas especiais (automa√ß√£o)
- memorial/assembly/convention: ocultar reuni√£o (ou marcar sem designa√ß√µes)
- visit_overseer: substituir CBS por service talk (30) e ajustar coment√°rios finais conforme (20)

### Seguran√ßa/acesso
- Supabase: roles admin/instrutor/estudante, RLS por `congregacao_id`
- Auditoria: registrar altera√ß√µes em designa√ß√µes/publica√ß√µes; quem/quando
- Backend Node: continua para downloads JW.org, cron e est√°ticos; CRUD de dados via Supabase direto (aproveita RLS)

### Passos pr√°ticos de implementa√ß√£o
- Schema/migra√ß√µes: criar/ajustar tabelas acima e pol√≠ticas RLS
- Importa√ß√£o Admin:
  - Parser que gere `programas` + `partes` preenchendo `secao/subsecao/tipo/elegibilidade/tempo_min/observacoes`
  - Tela de pr√©‚Äëvisualiza√ß√£o com valida√ß√µes (tempos, elegibilidade, semanas especiais)
- UI Instrutor:
  - Lista/calend√°rio, tela de partes com regras de sele√ß√£o (filtros por g√™nero/capacidade)
  - Export PDF/Excel
  - IndexedDB + SW para fila offline; sync autom√°tico + bot√£o manual
  - Resolu√ß√£o de conflitos baseada em `versao` e mapeamentos
- UI Estudante:
  - Minhas designa√ß√µes, materiais, hist√≥rico; ack de leitura
  - Notifica√ß√µes in‚Äëapp; e-mail/WhatsApp se habilitado
- Semanas especiais:
  - Job di√°rio marca feriados especiais e ajusta visibilidade
- Testes:
  - Casos para regras S‚Äë38 (g√™nero/assistente, timing, v√≠deos, semanas especiais)
  - E2E de sincroniza√ß√£o e conflitos

Se quiser, eu adiciono estas se√ß√µes no `README_EXTENDIDO.md` sob ‚ÄúConflitos e Regras‚Äù e ‚ÄúSemanas especiais/Timing/Settings‚Äù para documenta√ß√£o permanente.

---

**User**

sim

---

**Cursor**

Vou adicionar as se√ß√µes ‚ÄúConflitos e Regras (S‚Äë38)‚Äù e ‚ÄúSemanas Especiais, Timing e Settings (S‚Äë38)‚Äù no `README_EXTENDIDO.md`, com instru√ß√µes objetivas de implementa√ß√£o.

```markdown
# Sua-Parte ‚Äî Documenta√ß√£o Estendida

Este documento complementa o README.md com detalhes operacionais para planejamento e evolu√ß√£o do sistema.

## Pap√©is e Capacidades por Dashboard

### Admin Dashboard
- Importar materiais oficiais (PDF, JWPub, RTF) com pr√©-visualiza√ß√£o por semana/parte.
- Edi√ß√£o leve ap√≥s importa√ß√£o: t√≠tulos, tempos, observa√ß√µes e corre√ß√µes de parsing.
- Publica√ß√£o universal (todas as congrega√ß√µes) ou segmentada por congrega√ß√£o/idioma/regi√£o, com agendamento.
- Hist√≥rico e rollback de publica√ß√µes; monitoramento de servi√ßos do backend.

### Dashboard do Instrutor
- Visualiza√ß√£o da programa√ß√£o: lista de semanas (padr√£o) ou calend√°rio (toggle), filtros por m√™s/idioma.
- Gest√£o de estudantes e designa√ß√µes por parte (S-38), com notas e status.
- Exporta√ß√£o de relat√≥rios de designa√ß√µes em PDF/Excel.
- Offline-first: trabalho completo offline; sincroniza√ß√£o autom√°tica quando reconectar.

### Portal do Estudante
- Notifica√ß√µes de designa√ß√£o: in-app (toasts/central) e opcional por e-mail/WhatsApp (mediante consentimento e configura√ß√£o).
- Acesso a instru√ß√µes pr√°ticas da parte e materiais de estudo disponibilizados pelo admin.
- Hist√≥rico de partes realizadas e confirma√ß√£o de leitura/recebimento (ack) opcional.

## Fluxo de Dados (alto n√≠vel)
```
Admin importa programas  ->  Publica (todas/segmentado)  ->  Instrutor recebe semanas
Instrutor designa estudantes  ->  Publica designa√ß√µes  ->  Estudante √© notificado e acessa
```

## Offline-first e Sincroniza√ß√£o (Instrutor)
- Armazenamento local: IndexedDB + Service Worker para dados e fila de opera√ß√µes.
- Altera√ß√µes offline (estudantes/designa√ß√µes/notas) s√£o persistidas localmente e sincronizadas assim que houver conex√£o.
- Estrat√©gia de conflitos: last-write-wins por padr√£o, com aviso quando houver diverg√™ncias.
- Indicadores: status de sincroniza√ß√£o, fila pendente e a√ß√£o manual "Sincronizar agora".

## Modelo de Dados (Supabase)
- Tabelas principais (nomes ilustrativos; alinhar com migra√ß√µes existentes):
  - `congregacoes`: congrega√ß√£o e metadados (regi√£o/idioma).
  - `profiles`: usu√°rios com `role` (admin/instrutor/estudante) e congrega√ß√£o.
  - `programas`: semanas/partes publicadas (fonte oficial importada), idioma/per√≠odo.
  - `estudantes`: cadastro local por congrega√ß√£o, status, observa√ß√µes.
  - `designacoes`: v√≠nculo estudante-parte-semana, status e notas.
- Seguran√ßa: RLS por congrega√ß√£o e papel; privil√©gios m√≠nimos; auditoria de mudan√ßas sens√≠veis.

## Materiais Est√°ticos (Backend)
- O backend serve `docs/Oficial` via `/materials` (porta padr√£o 3001).
- Exemplos: `http://localhost:3001/materials/mwb_E_202507.pdf`.
- Recomenda√ß√µes: evitar espa√ßos/par√™nteses em nomes; quando necess√°rio, usar encoding na URL (`%20`).

## Deploy (Vis√£o Geral)
- Frontend (Vite/React):
  - Vercel ou Netlify (build `npm run build`, diret√≥rio `dist/`).
  - Configurar `VITE_SUPABASE_URL` e `VITE_SUPABASE_ANON_KEY` em vari√°veis de ambiente.
- Backend (Express):
  - Railway ou Render. Definir `PORT`, `SUPABASE_URL`, `SUPABASE_ANON_KEY` e apontar `DOCS_PATH` se parametrizado.
  - Alternativa: converter rotas para Supabase Edge Functions quando aplic√°vel (leitura/publica√ß√£o).
- Banco (Supabase):
  - Aplicar migra√ß√µes, habilitar RLS, revisar pol√≠ticas por papel e criar chaves de servi√ßo com escopo m√≠nimo.

## Relat√≥rios e Exporta√ß√µes (Instrutor)
- Exportar designa√ß√µes por semana/m√™s em PDF/Excel.
- Padr√£o visual consistente (cabe√ßalho com congrega√ß√£o, per√≠odo e legenda de status).
- Op√ß√£o de incluir observa√ß√µes e tempos estimados.

## Notifica√ß√µes (Estudante)
- In-app: centro de notifica√ß√µes, toasts e contadores.
- E-mail: templates simples (ass√≠ncrono; opt-in).
- WhatsApp: integra√ß√£o opcional futura (requer consentimento e provedor API conforme LGPD).

## Boas Pr√°ticas e Seguran√ßa
- N√£o expor segredos no frontend; usar env vars. Rotas sens√≠veis protegidas por RLS.
- Guard clauses e fail-fast em APIs; logs com correla√ß√£o de requisi√ß√µes.
- Componentes e hooks curtos, reutiliz√°veis; Tailwind + shadcn/ui para consist√™ncia.

## Roadmap Sugerido
- [ ] Parametrizar `DOCS_PATH` no backend via `process.env.DOCS_PATH`.
- [ ] Implementar preview e edi√ß√£o leve na importa√ß√£o do Admin.
- [ ] Tabela/roteiro de sincroniza√ß√£o offline (fila, replays, conflitos).
- [ ] Exporta√ß√µes PDF/Excel no Instrutor.
- [ ] Notifica√ß√µes e-mail (primeira etapa) e in-app com ack.
- [ ] Guia de deploy com exemplos pr√°ticos (Railway/Render + Vercel/Netlify).

## Doa√ß√µes / Apoio
> Este sistema √© oferecido gratuitamente. Caso queira apoiar o desenvolvimento, utilize o QR Code de doa√ß√£o Pix dispon√≠vel no portal do estudante.

---
Para d√∫vidas t√©cnicas espec√≠ficas, consulte tamb√©m: `ADMIN_DASHBOARD_INTEGRATION.md`, `DEBUG_ADMIN_DASHBOARD.md` e `README_ESTUDANTES.md`.

## Conflitos e Regras (S‚Äë38)
- Versionamento e detec√ß√£o de conflitos
  - Campos: `programas.versao`, `designacoes.versao`, `updated_at`.
  - Ao sincronizar: se `programa.versao_local < programa.versao_remota`, marcar designa√ß√µes ligadas a partes alteradas/removidas como "em conflito".
  - Last-write-wins apenas quando n√£o houve altera√ß√£o estrutural da parte (t√≠tulo/tipo/elegibilidade/tempo/ordem).
- Regras de elegibilidade e g√™nero
  - Bible Reading: estudante masculino; sem intro/conclus√£o.
  - Explaining Your Beliefs: talk ‚Üí masculino; demo ‚Üí ambos; assistente mesmo g√™nero ou familiar.
  - Starting/Following/Making: aluno e assistente mesmo g√™nero; familiar permitido.
  - Spiritual Gems: Q&A, respostas ‚â§30s; sem leitura obrigat√≥ria.
- Aplica√ß√£o t√©cnica
  - Validador no frontend ao criar/editar designa√ß√£o (bloqueia op√ß√µes inv√°lidas).
  - Constraint l√≥gica no backend/Supabase via policies/checks suaves (preferir valida√ß√£o na aplica√ß√£o + auditoria).
  - Campo `settings` por designa√ß√£o para registrar cen√°rio: `house_to_house|informal|public`.

## Semanas Especiais, Timing e Settings (S‚Äë38)
- Semanas especiais
  - `feriados_especiais(tipo)`: memorial/assembly/convention ‚Üí ocultar reuni√£o (ou marcar sem designa√ß√µes).
  - `visit_overseer`: substituir CBS (30 min) por service talk; ajustar coment√°rios finais.
  - Job di√°rio atualiza tabela e seta flags nas semanas futuras.
- Timing
  - `partes.tempo_min` por item; somat√≥rio por se√ß√£o e total (1h45).
  - UI mostra barra/contador por se√ß√£o e alerta de estouro.
  - Bloqueie salvar se exceder limites configurados.
- Settings (cen√°rios)
  - Campos sugeridos em `designacoes.settings`:
    - `general`: `house_to_house|informal|public`.
    - `mode`: `door|phone|letter|cart|street|park|work|school|transit|other`.
  - UI com presets e descri√ß√£o, persistidos por designa√ß√£o.

## Fluxo de Sincroniza√ß√£o (Instrutor)
- Offline-first
  - IndexedDB: tabelas espelho de `estudantes`, `designacoes`, `programas` (somente leitura) e fila `operations`.
  - Service Worker: background sync quando a rede voltar.
- Fila e replay
  - `operations`: {id, entity, action, payload, baseVersion, createdAt}.
  - Ao reenviar: verificar `baseVersion` vs remoto; se divergente, marcar conflito.
- UI/Resolu√ß√£o
  - Indicadores: status online/offline, itens na fila, √∫ltimo sync.
  - Modal de conflitos mostrando diff (parte/estudante/campos alterados) com escolha de resolu√ß√£o.

```

Adicionei as se√ß√µes no `README_EXTENDIDO.md` com:
- Conflitos e Regras (S‚Äë38): versionamento, elegibilidade por g√™nero, valida√ß√µes, e aplica√ß√£o t√©cnica.
- Semanas Especiais, Timing e Settings: regras para memorial/assembleias/visita do superintendente, limites de tempo e cen√°rios (house-to-house, informal, public).
- Fluxo de Sincroniza√ß√£o: IndexedDB, Service Worker, fila de opera√ß√µes, detec√ß√£o de conflitos e UI de resolu√ß√£o.

Se quiser, incluo um link ‚ÄúDocumenta√ß√£o Estendida‚Äù no `README.md`.

---

**User**

vamos cria na raiz do projeto um arquivo chamado AGENTS.md que vai funcionar como um orquestrador de outros agents.md Specialized personas that tailor Roo's behavior. Ctrl + . for
next mode, Ctrl + Shift + . for previous mode

F Architect
Plan and design before implementation

Code
Write, modify, and refactor code

? Ask
Get answers and explanations

Debug
Diagnose and fix software issues

Orchestrator
Coordinate tasks across multiple modes

---

**Cursor**

I'll add a new root-level file named `AGENTS.md` describing the Orchestrator and specialized personas (Architect, Code, Ask, Debug), including how to switch modes and suggested usage patterns.

```markdown
# AGENTS.md ‚Äî Orquestrador de Personas

Este arquivo define o orquestrador e as personas especializadas para guiar o fluxo de trabalho no projeto. Use-o como refer√™ncia para alternar modos e coordenar tarefas.

## Modos Dispon√≠veis

- F Architect (Planejar)
  - Foco: planejar arquitetura, fluxos, modelos de dados e regras (S‚Äë38), antes de codar.
  - Sa√≠das: diagramas, especifica√ß√µes, crit√©rios de aceite, riscos.

- Code (Implementar)
  - Foco: escrever, modificar e refatorar c√≥digo seguindo SOLID/DRY e UI consistente (Tailwind + shadcn/ui).
  - Sa√≠das: commits pequenos, testes adicionados/ajustados, docs breves.

- ? Ask (Descobrir)
  - Foco: esclarecer d√∫vidas e justificar decis√µes, explicar trade-offs.
  - Sa√≠das: respostas objetivas, comparativos, refer√™ncias internas.

- Debug (Diagnosticar)
  - Foco: reproduzir, isolar e corrigir defeitos; adicionar testes de regress√£o.
  - Sa√≠das: RCA, fix verificado, m√©tricas (antes/depois) quando aplic√°vel.

- Orchestrator (Orquestrar)
  - Foco: coordenar tarefas entre modos, dividir trabalho em etapas, garantir handoffs limpos.
  - Sa√≠das: plano de execu√ß√£o, checklist, ordem de opera√ß√µes e crit√©rios de conclus√£o.

## Atalhos de Modo

- Ctrl + .  ‚Üí pr√≥ximo modo
- Ctrl + Shift + .  ‚Üí modo anterior

## Diretrizes do Orquestrador

1) Come√ßar no modo F Architect para planejar:
   - Definir objetivo, requisitos, riscos, crit√©rios de aceite.
   - Mapear entidades/tabelas, pol√≠ticas RLS e regras S‚Äë38 relevantes.

2) Delegar para Code com escopo claro:
   - Descrever arquivos a alterar/criar e pontos de integra√ß√£o.
   - Exigir testes (Cypress/E2E, unit√°rios quando couber) e verifica√ß√£o de lint.

3) Usar ? Ask quando houver ambiguidades:
   - Formular perguntas fechadas e decis√µes com pr√≥s/cons.

4) Invocar Debug ap√≥s implementa√ß√£o:
   - Reproduzir, criar testes de regress√£o, verificar m√©tricas/perf.

5) Encerrar ciclo com documenta√ß√£o m√≠nima:
   - Atualizar README/README_EXTENDIDO, CHANGELOG e anota√ß√µes de decis√µes.

## Padr√µes de Qualidade (todos os modos)

- Seguran√ßa: n√£o expor segredos, RLS ativo, m√≠nimo privil√©gio.
- C√≥digo: fun√ß√µes curtas, nomes claros, early return/guard clauses.
- UI/UX: responsivo, consistente, sem inline styles desnecess√°rios.
- Performance: evitar refetches, usar memoiza√ß√£o e pagina√ß√£o.
- Documenta√ß√£o: sucinta, com exemplos e instru√ß√µes de uso.

## Fluxo de Trabalho Sugerido

1. Orchestrator: alinhamento e cria√ß√£o de checklist.
2. F Architect: modelo de dados/fluxo (inclui S‚Äë38 quando pertinente).
3. Code: implementa√ß√£o incremental (commits pequenos) + testes.
4. Debug: valida√ß√µes e corre√ß√µes.
5. Orchestrator: revis√£o final, merge e atualiza√ß√£o de docs.

## Exemplo de Handoff

- Orchestrator ‚Üí F Architect: "Definir esquema de `designacoes` com regras S‚Äë38 e conflito de vers√£o".
- F Architect ‚Üí Code: "Criar migra√ß√£o, pol√≠ticas RLS e valida√ß√µes de elegibilidade no frontend".
- Code ‚Üí Debug: "Adicionar testes E2E para conflitos e exporta√ß√£o PDF".
- Debug ‚Üí Orchestrator: "RCA e fix confirmados; pronto para merge".
```

Criei `AGENTS.md` na raiz com:
- Personas: Architect, Code, Ask, Debug e Orchestrator.
- Atalhos de modo (Ctrl + . / Ctrl + Shift + .).
- Diretrizes do orquestrador, padr√µes de qualidade e fluxo de trabalho.
- Exemplo de handoff entre modos.

Quer que eu referencie esse arquivo no `README.md` (ex.: se√ß√£o ‚ÄúAgentes e Fluxo de Trabalho‚Äù)?

---

**User**

sim e programa para ele se auto escrever toda vez que um dos seus agentes funcionario fizer um tarefa que ele vai mandar executar

---

**Cursor**

Vou adicionar um link para `AGENTS.md` no `README.md` e criar uma automa√ß√£o: um script `scripts/agents-log.js` que registra atividades dos agentes em `agents.log.json` e atualiza a se√ß√£o de registro em `AGENTS.md`. Tamb√©m vou adicionar um comando npm `agents:log` no `package.json` e inserir uma se√ß√£o de registro autom√°tico em `AGENTS.md`.

```markdown
# AGENTS.md ‚Äî Orquestrador de Personas

Este arquivo define o orquestrador e as personas especializadas para guiar o fluxo de trabalho no projeto. Use-o como refer√™ncia para alternar modos e coordenar tarefas.

## Modos Dispon√≠veis

- F Architect (Planejar)
  - Foco: planejar arquitetura, fluxos, modelos de dados e regras (S‚Äë38), antes de codar.
  - Sa√≠das: diagramas, especifica√ß√µes, crit√©rios de aceite, riscos.

- Code (Implementar)
  - Foco: escrever, modificar e refatorar c√≥digo seguindo SOLID/DRY e UI consistente (Tailwind + shadcn/ui).
  - Sa√≠das: commits pequenos, testes adicionados/ajustados, docs breves.

- ? Ask (Descobrir)
  - Foco: esclarecer d√∫vidas e justificar decis√µes, explicar trade-offs.
  - Sa√≠das: respostas objetivas, comparativos, refer√™ncias internas.

- Debug (Diagnosticar)
  - Foco: reproduzir, isolar e corrigir defeitos; adicionar testes de regress√£o.
  - Sa√≠das: RCA, fix verificado, m√©tricas (antes/depois) quando aplic√°vel.

- Orchestrator (Orquestrar)
  - Foco: coordenar tarefas entre modos, dividir trabalho em etapas, garantir handoffs limpos.
  - Sa√≠das: plano de execu√ß√£o, checklist, ordem de opera√ß√µes e crit√©rios de conclus√£o.

## Atalhos de Modo

- Ctrl + .  ‚Üí pr√≥ximo modo
- Ctrl + Shift + .  ‚Üí modo anterior

## Diretrizes do Orquestrador

1) Come√ßar no modo F Architect para planejar:
   - Definir objetivo, requisitos, riscos, crit√©rios de aceite.
   - Mapear entidades/tabelas, pol√≠ticas RLS e regras S‚Äë38 relevantes.

2) Delegar para Code com escopo claro:
   - Descrever arquivos a alterar/criar e pontos de integra√ß√£o.
   - Exigir testes (Cypress/E2E, unit√°rios quando couber) e verifica√ß√£o de lint.

3) Usar ? Ask quando houver ambiguidades:
   - Formular perguntas fechadas e decis√µes com pr√≥s/cons.

4) Invocar Debug ap√≥s implementa√ß√£o:
   - Reproduzir, criar testes de regress√£o, verificar m√©tricas/perf.

5) Encerrar ciclo com documenta√ß√£o m√≠nima:
   - Atualizar README/README_EXTENDIDO, CHANGELOG e anota√ß√µes de decis√µes.

## Padr√µes de Qualidade (todos os modos)

- Seguran√ßa: n√£o expor segredos, RLS ativo, m√≠nimo privil√©gio.
- C√≥digo: fun√ß√µes curtas, nomes claros, early return/guard clauses.
- UI/UX: responsivo, consistente, sem inline styles desnecess√°rios.
- Performance: evitar refetches, usar memoiza√ß√£o e pagina√ß√£o.
- Documenta√ß√£o: sucinta, com exemplos e instru√ß√µes de uso.

## Fluxo de Trabalho Sugerido

1. Orchestrator: alinhamento e cria√ß√£o de checklist.
2. F Architect: modelo de dados/fluxo (inclui S‚Äë38 quando pertinente).
3. Code: implementa√ß√£o incremental (commits pequenos) + testes.
4. Debug: valida√ß√µes e corre√ß√µes.
5. Orchestrator: revis√£o final, merge e atualiza√ß√£o de docs.

## Exemplo de Handoff

- Orchestrator ‚Üí F Architect: "Definir esquema de `designacoes` com regras S‚Äë38 e conflito de vers√£o".
- F Architect ‚Üí Code: "Criar migra√ß√£o, pol√≠ticas RLS e valida√ß√µes de elegibilidade no frontend".
- Code ‚Üí Debug: "Adicionar testes E2E para conflitos e exporta√ß√£o PDF".
- Debug ‚Üí Orchestrator: "RCA e fix confirmados; pronto para merge".

## Registro de Atividades (autom√°tico)

Este arquivo mant√©m um registro autom√°tico das atividades dos agentes.

Use o comando:

```bash
npm run agents:log -- --agent="Code" --action="Implement feature X" --status="completed" --details="arquivos Y/Z atualizados"
```

As entradas ser√£o salvas em `agents.log.json` e refletidas abaixo.

<!-- AGENTS_LOG_START -->
<!-- Entradas ser√£o inseridas automaticamente aqui. N√£o editar manualmente abaixo desta linha. -->
<!-- AGENTS_LOG_END -->

```

I‚Äôll add a link to AGENTS.md in README.md, create the scripts/agents-log.js automation to log agent activities and update AGENTS.md, and wire an npm script agents:log in package.json.

```markdown
# Sua-Parte ‚Äî Sistema Ministerial

O Sua-Parte √© uma plataforma para gest√£o de materiais, programas e congrega√ß√µes, com Frontend React (Vite) e Backend Node.js (Express). Este documento descreve os pap√©is dos dashboards, al√©m de trazer instru√ß√µes objetivas de instala√ß√£o e uso.

## Pap√©is dos Dashboards

### Admin Dashboard (Administradores)
- Importar e organizar materiais oficiais (PDF, JWPub, etc.).
- Gerenciar congrega√ß√µes, instrutores e permiss√µes.
- Monitorar sa√∫de do sistema e servi√ßos do backend.

### Dashboard do Instrutor (Congrega√ß√µes)
- Visualizar a programa√ß√£o publicada pelo admin.
- Cadastrar e gerenciar estudantes da congrega√ß√£o.
- Designar partes da reuni√£o aos estudantes.
- Operar offline com sincroniza√ß√£o quando voltar a ficar online.

### Dashboard do Estudante (Leitura/Acompanhamento)
- Acessar materiais publicados para sua congrega√ß√£o.
- Consultar designa√ß√µes, hist√≥rico e programas disponibilizados.
- Acesso com perfil restrito (somente leitura das publica√ß√µes).

## Tecnologias
- Frontend: React + TypeScript, Vite, TailwindCSS, shadcn/ui
- Backend: Node.js + Express, cron, integra√ß√£o com Supabase
- Testes: Cypress E2E

## Instala√ß√£o
1. Clonar o reposit√≥rio
```bash
git clone https://github.com/RobertoAraujoSilva/sua-parte.git
cd sua-parte
```

2. Instalar depend√™ncias (raiz)
```bash
npm install
```

3. Vari√°veis de ambiente
- Crie um arquivo `.env` na raiz (frontend) e outro em `backend/.env` se necess√°rio.
- Exemplo (ajuste para seu ambiente ‚Äî n√£o compartilhe chaves reais):

Frontend (.env)
```env
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
```

Backend (backend/.env)
```env
PORT=3001
NODE_ENV=development
DOCS_PATH=../docs/Oficial
SUPABASE_URL=your_supabase_url
SUPABASE_ANON_KEY=your_supabase_service_or_anon_key
```

## Execu√ß√£o
- Iniciar frontend e backend juntos (recomendado)
```bash
npm run dev:all
```

- Iniciar apenas o backend (porta padr√£o 3001)
```bash
npm run dev:backend-only
```

- Iniciar apenas o frontend (porta padr√£o 8080)
```bash
npm run dev:frontend-only
```

Portas padr√£o
- Frontend (Vite): http://localhost:8080
- Backend (Express): http://localhost:3001

## Acesso r√°pido
- Admin Dashboard: `http://localhost:8080/admin`
- Dashboard do Instrutor: `http://localhost:8080/` ou `http://localhost:8080/dashboard`
- Estudante: acesso controlado conforme publica√ß√£o/perfil

## Testes (Cypress)
- Executar todos os testes
```bash
npm run cypress:run
```

- Exemplos de testes espec√≠ficos
```bash
npm run test:audit
npm run test:auth
npm run test:programs
```

## Seguran√ßa e Boas Pr√°ticas
- N√£o exponha chaves ou credenciais no frontend; use vari√°veis de ambiente.
- Garanta RLS (Row Level Security) no Supabase e privil√©gios m√≠nimos por papel.
- Trate erros em todas as chamadas de API e aplique early return/guard clauses.
- Mantenha componentes enxutos, reutiliz√°veis e consistentes com Tailwind/shadcn.

## Documenta√ß√£o adicional
- `ADMIN_DASHBOARD_INTEGRATION.md` ‚Äî Integra√ß√£o e fluxo do Admin Dashboard
- `DEBUG_ADMIN_DASHBOARD.md` ‚Äî Dicas de debug
- `README_ESTUDANTES.md` ‚Äî Guia do m√≥dulo de estudantes
- Pasta `docs/` ‚Äî Materiais e documenta√ß√£o complementar
- `AGENTS.md` ‚Äî Orquestrador de personas e fluxo de trabalho (com registro autom√°tico de atividades)

## Licen√ßa
Projeto sob licen√ßa MIT. Consulte `LICENSE` para mais detalhes.

```

```json
{
  "name": "vite_react_shadcn_ts",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "dev:all": "concurrently \"npm run dev:backend\" \"npm run dev:frontend\"",
    "dev:backend": "cd backend && npm run dev",
    "dev:frontend": "vite",
    "dev:backend-only": "cd backend && npm run dev",
    "dev:frontend-only": "vite",
    "build": "vite build",
    "build:prod": "vite build --config vite.config.prod.ts",
    "build:analyze": "vite build --config vite.config.prod.ts && npm run analyze",
    "analyze": "npx vite-bundle-analyzer dist",
    "build:dev": "vite build --mode development",
    "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "typecheck": "tsc -p tsconfig.json",
    "preview": "vite preview",
    "start": "serve -s dist -l $PORT",
    "cypress:open": "cypress open",
    "cypress:run": "cypress run",
    "cypress:install": "cypress install",
    "cypress:verify": "cypress verify",
    "test:e2e": "cypress run --spec \"cypress/e2e/**/*.cy.ts\"",
    "test:e2e:open": "cypress open",
    "test:e2e:record": "cypress run --record",
    "test:franklin": "cypress run --spec \"cypress/e2e/franklin-login.cy.ts\"",
    "test:franklin:record": "cypress run --spec \"cypress/e2e/franklin-login.cy.ts\" --record",
    "test:sarah": "cypress run --spec \"cypress/e2e/sarah-student-registration.cy.ts\"",
    "test:sarah:record": "cypress run --spec \"cypress/e2e/sarah-student-registration.cy.ts\" --record",
    "test:birth-date": "cypress run --spec \"cypress/e2e/sarah-student-registration.cy.ts\"",
    "test:sarah:open": "cypress open --e2e --browser chrome",
    "test:audit": "cypress run --spec \"cypress/e2e/auditoria_sistema_ministerial.cy.ts\"",
    "test:audit:record": "cypress run --spec \"cypress/e2e/auditoria_sistema_ministerial.cy.ts\" --record",
    "test:auth": "cypress run --spec \"cypress/e2e/authentication-roles.cy.ts\"",
    "test:auth:record": "cypress run --spec \"cypress/e2e/authentication-roles.cy.ts\" --record",
    "test:pdf-upload": "cypress run --spec \"cypress/e2e/pdf-upload-functionality.cy.ts\"",
    "test:pdf-upload:record": "cypress run --spec \"cypress/e2e/pdf-upload-functionality.cy.ts\" --record",
    "env:validate": "node scripts/validate-env.js",
    "env:check": "node scripts/validate-env.js",
    "env:show": "node -e \"console.log('Environment Variables:'); Object.keys(process.env).filter(k => k.startsWith('VITE_') || ['NODE_ENV', 'DATABASE_URL'].includes(k)).forEach(k => console.log(k + '=' + (k.includes('SECRET') || k.includes('TOKEN') || k.includes('KEY') ? '[HIDDEN]' : process.env[k])))\"",
    "test:programs": "cypress run --spec \"cypress/e2e/programs-page-functionality.cy.ts\"",
    "test:programs:record": "cypress run --spec \"cypress/e2e/programs-page-functionality.cy.ts\" --record",
    "test:sistema-completo": "cypress run --spec \"cypress/e2e/sistema-ministerial-e2e.cy.ts\"",
    "test:sistema-completo:record": "cypress run --spec \"cypress/e2e/sistema-ministerial-e2e.cy.ts\" --record",
    "test:enhanced-parsing": "cypress run --spec \"cypress/e2e/enhanced-pdf-parsing.cy.ts\"",
    "test:enhanced-parsing:record": "cypress run --spec \"cypress/e2e/enhanced-pdf-parsing.cy.ts\" --record",
    "test:assignment-generation": "cypress run --spec \"cypress/e2e/assignment-generation.cy.ts\"",
    "test:assignment-generation:record": "cypress run --spec \"cypress/e2e/assignment-generation.cy.ts\" --record",
    "test:all-new": "cypress run --spec \"cypress/e2e/{pdf-upload-functionality,programs-page-functionality,sistema-ministerial-e2e,enhanced-pdf-parsing,assignment-generation}.cy.ts\"",
    "test:complete-workflow": "cypress run --spec \"cypress/e2e/{enhanced-pdf-parsing,assignment-generation}.cy.ts\"",
    "test:integration": "node src/verification/integration-test-cli.js",
    "test:integration:performance": "node -e \"import('./src/verification/tests/integration-test-runner.js').then(m => m.runIntegrationTestSuite())\"",
    "test:integration:services": "node -e \"console.log('üîó Running service integration tests...'); import('./src/verification/tests/integration-test-runner.js').then(m => m.runIntegrationTestSuite())\"",
    "verify:integration": "node src/verification/test-integration-simple.js",
    "test:setup": "cypress install && cypress verify",
    "test:verification": "node src/verification/tests/test-runner.cjs",
    "test:verification:simple": "node src/verification/tests/test-runner.cjs --simple",
    "test:verification:basic": "node src/verification/tests/test-runner.cjs --basic",
    "audit:plan": "node ./scripts/audit-implementation.mjs",
    "verify:system": "node src/verification/cli.js --full",
    "verify:frontend": "node src/verification/cli.js --module=frontend",
    "verify:backend": "node src/verification/cli.js --module=backend",
    "verify:infrastructure": "node src/verification/cli.js --module=infrastructure",
    "verify:reports": "node src/verification/cli.js reports",
    "verify:reports:list": "node src/verification/cli.js reports list",
    "verify:reports:dashboard": "node src/verification/cli.js reports dashboard",
    "verify:reports:trends": "node src/verification/cli.js reports trends",
    "verify:reports:cleanup": "node src/verification/cli.js reports cleanup",
    "verify:reports:init": "node src/verification/cli.js reports init",
    "test:report-storage": "node src/verification/test-report-storage.js",
    "test:frontend-verifier": "node src/verification/test-frontend-verifier.js",
    "test": "cypress run",
    "test:open": "cypress open",
    "test:component": "cypress run --component",
    "test:performance": "lighthouse http://localhost:8080/admin --output html --output-path ./lighthouse-report.html",
    "optimize": "npm run build:prod && npm run analyze"
    "agents:log": "node scripts/agents-log.js"
  },
  "dependencies": {
    "@hello-pangea/dnd": "^18.0.1",
    "@hookform/resolvers": "^3.10.0",
    "@radix-ui/react-accordion": "^1.2.11",
    "@radix-ui/react-alert-dialog": "^1.1.14",
    "@radix-ui/react-aspect-ratio": "^1.1.7",
    "@radix-ui/react-avatar": "^1.1.10",
    "@radix-ui/react-checkbox": "^1.3.2",
    "@radix-ui/react-collapsible": "^1.1.11",
    "@radix-ui/react-context-menu": "^2.2.15",
    "@radix-ui/react-dialog": "^1.1.14",
    "@radix-ui/react-dropdown-menu": "^2.1.15",
    "@radix-ui/react-hover-card": "^1.1.14",
    "@radix-ui/react-label": "^2.1.7",
    "@radix-ui/react-menubar": "^1.1.15",
    "@radix-ui/react-navigation-menu": "^1.2.13",
    "@radix-ui/react-popover": "^1.1.14",
    "@radix-ui/react-progress": "^1.1.7",
    "@radix-ui/react-radio-group": "^1.3.7",
    "@radix-ui/react-scroll-area": "^1.2.9",
    "@radix-ui/react-select": "^2.2.5",
    "@radix-ui/react-separator": "^1.1.7",
    "@radix-ui/react-slider": "^1.3.5",
    "@radix-ui/react-slot": "^1.2.3",
    "@radix-ui/react-switch": "^1.2.5",
    "@radix-ui/react-tabs": "^1.1.12",
    "@radix-ui/react-toast": "^1.2.14",
    "@radix-ui/react-toggle": "^1.1.9",
    "@radix-ui/react-toggle-group": "^1.1.10",
    "@radix-ui/react-tooltip": "^1.2.7",
    "@supabase/mcp-server-supabase": "^0.4.5",
    "@supabase/supabase-js": "^2.54.0",
    "@tanstack/react-query": "^5.83.0",
    "ag-grid-community": "^34.1.1",
    "ag-grid-react": "^34.1.1",
    "cheerio": "^1.1.2",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "^1.1.1",
    "date-fns": "^3.6.0",
    "dotenv": "^17.2.1",
    "embla-carousel-react": "^8.6.0",
    "fs-extra": "^11.3.1",
    "i18next": "^25.3.6",
    "i18next-browser-languagedetector": "^8.2.0",
    "input-otp": "^1.4.2",
    "jspdf": "^3.0.1",
    "lucide-react": "^0.462.0",
    "next-themes": "^0.3.0",
    "node-fetch": "^3.3.2",
    "pdf-parse": "^1.1.1",
    "qrcode.react": "^4.2.0",
    "react": "^18.3.1",
    "react-day-picker": "^8.10.1",
    "react-dom": "^18.3.1",
    "react-error-boundary": "^6.0.0",
    "react-hook-form": "^7.61.1",
    "react-i18next": "^15.6.1",
    "react-resizable-panels": "^2.1.9",
    "react-router-dom": "^6.30.1",
    "recharts": "^2.15.4",
    "serve": "^14.2.3",
    "sonner": "^1.7.4",
    "tailwind-merge": "^2.6.0",
    "tailwindcss-animate": "^1.0.7",
    "vaul": "^0.9.9",
    "xlsx": "^0.18.5",
    "zod": "^3.25.76"
  },
  "overrides": {
    "rollup": "^4.0.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.32.0",
    "@tailwindcss/typography": "^0.5.16",
    "@types/babel__core": "^7.20.5",
    "@types/babel__generator": "^7.27.0",
    "@types/babel__template": "^7.4.4",
    "@types/node": "^22.17.1",
    "@types/react": "^18.3.23",
    "@types/react-dom": "^18.3.7",
    "@vitejs/plugin-react": "^4.3.1",
    "autoprefixer": "^10.4.21",
    "concurrently": "^9.2.0",
    "cssnano": "^7.1.0",
    "cypress": "^13.17.0",
    "eslint": "^9.32.0",
    "eslint-plugin-react-hooks": "^5.2.0",
    "eslint-plugin-react-refresh": "^0.4.20",
    "fast-glob": "^3.3.3",
    "globals": "^15.15.0",
    "lovable-tagger": "^1.1.9",
    "postcss": "^8.5.6",
    "rollup-plugin-visualizer": "^6.0.3",
    "tailwindcss": "^3.4.17",
    "terser": "^5.43.1",
    "typescript": "^5.8.3",
    "typescript-eslint": "^8.38.0",
    "vite": "^5.0.0",
    "vite-plugin-pwa": "^1.0.3"
  }
}

```

```javascript
#!/usr/bin/env node
const fs = require('fs');
const path = require('path');

function parseArgs() {
  const args = process.argv.slice(2);
  const result = {};
  for (const arg of args) {
    if (arg.startsWith('--')) {
      const [key, ...rest] = arg.replace(/^--/, '').split('=');
      result[key] = rest.join('=');
    }
  }
  return result;
}

function loadJSON(file) {
  try {
    return JSON.parse(fs.readFileSync(file, 'utf8'));
  } catch (_) {
    return [];
  }
}

function saveJSON(file, data) {
  fs.writeFileSync(file, JSON.stringify(data, null, 2) + '\n', 'utf8');
}

function updateAgentsMd(logEntries) {
  const agentsMdPath = path.resolve(process.cwd(), 'AGENTS.md');
  if (!fs.existsSync(agentsMdPath)) return;
  const md = fs.readFileSync(agentsMdPath, 'utf8');
  const start = '<!-- AGENTS_LOG_START -->';
  const end = '<!-- AGENTS_LOG_END -->';
  const startIdx = md.indexOf(start);
  const endIdx = md.indexOf(end);
  if (startIdx === -1 || endIdx === -1 || endIdx < startIdx) return;

  const sliceBefore = md.slice(0, startIdx + start.length);
  const sliceAfter = md.slice(endIdx);

  const lines = logEntries.slice(-50).map(e => {
    const ts = new Date(e.timestamp).toISOString();
    return `\n- [${ts}] **${e.agent}**: ${e.action} (${e.status})${e.details ? ` ‚Äî ${e.details}` : ''}`;
  }).join('');

  const next = sliceBefore + '\n' + lines + '\n' + sliceAfter;
  fs.writeFileSync(agentsMdPath, next, 'utf8');
}

function main() {
  const args = parseArgs();
  const { agent = 'Orchestrator', action = 'unspecified', status = 'pending', details = '' } = args;

  const logPath = path.resolve(process.cwd(), 'agents.log.json');
  const entries = loadJSON(logPath);
  const entry = {
    timestamp: Date.now(),
    agent,
    action,
    status,
    details
  };
  entries.push(entry);
  saveJSON(logPath, entries);
  updateAgentsMd(entries);
  console.log('Logged:', entry);
}

main();


```

Adicionei:
- Link para `AGENTS.md` no `README.md`.
- Automa√ß√£o de registro:
  - `scripts/agents-log.js` que grava em `agents.log.json` e atualiza a se√ß√£o de log em `AGENTS.md`.
  - Script npm: `npm run agents:log -- --agent="Code" --action="Implementar X" --status="completed" --details="..."`.

Quer que eu registre uma primeira entrada de exemplo agora?

---

**User**

coloque nele um indice "C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_E_202509.pdf"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_E_202511.pdf"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_T_202507.daisy.zip"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_T_202509.daisy.zip"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_T_202509.jwpub"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_T_202511.jwpub"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\S-38_E.rtf"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\WhatsApp Image 2025-08-14 at 19.44.07 (1).jpeg"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\WhatsApp Image 2025-08-14 at 19.44.07.jpeg"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\estudantes_ficticios.xlsx"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\estudantes_rows.sql"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_E_202507.pdf" "C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\CONSOLE_LOG_FIXES.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\CORRECAO_ERRO_DATA_DESIGNACOES.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\CORRECAO_QRCODE_BUILD.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\CORRE√á√ïES_AUDITORIA_PWA.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\CORRECOES_TIPOS_MAPEAMENTOS.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\CORRECTED_DEVELOPER_REGISTRATION_GUIDE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\CREDENCIAIS_TESTE_SISTEMA_COMPLETO.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\CRITICAL_ASSIGNMENT_FIXES_SUMMARY.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\CRITICAL_DATABASE_MIGRATION_APPLIED.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\CRITICAL_OPTIMIZATIONS_COMPLETE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\CYPRESS_CICD_IMPLEMENTATION_SUMMARY.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\CYPRESS_CLOUD_CICD_SETUP.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\CYPRESS_CLOUD_SETUP.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\CYPRESS_CLOUD_TROUBLESHOOTING.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\CYPRESS_TESTING_SETUP.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\CYPRESS_TROUBLESHOOTING.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\DASHBOARD_LOGOUT_FIX.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\DEBUG_ADMIN_DASHBOARD.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\DEPLOYMENT_AUTHORIZATION_FIX.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\DEVELOPER_PANEL_IMPLEMENTATION_COMPLETE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\DEVELOPER_REGISTRATION_VALIDATION_REPORT.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\DOCUMENTACAO_COMPLETA.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\DOCUMENTACAO_TECNICA_CONVITES_FAMILIARES.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\EMAIL_CONFIRMATION_FIX.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\ENHANCED_PDF_PARSING.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\ENVIRONMENT_CONFIGURATION_COMPLETE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\ENVIRONMENT_SETUP_GUIDE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\EXCEL_IMPORT_GUIDE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\EXECUTION_TASKS_TRACKER.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\FAMILY_INVITATIONS_BUG_FIX.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\FAMILY_INVITATIONS_FEATURE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\FAMILY_INVITATIONS_IMPLEMENTATION.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\FAMILY_MANAGEMENT_BUG_FIX.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\FAMILY_MANAGEMENT_TESTING_GUIDE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\FAMILY_MEMBER_INSERT_BUG_FIX.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\FAQ_DELIVERABLES_SUMMARY.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\FAQ_SECTION_IMPLEMENTATION.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\GITHUB_ACTIONS_SETUP.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\GITHUB_REPOSITORY_SETUP.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\GUIA_ADMINISTRADOR_SISTEMA_MINISTERIAL.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\GUIA_TESTES_CYPRESS.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\GUIA_TRADUCAO_COMPLETA.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\GUIA_USUARIO.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\guia-desenvolvedor-logout.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\HEADER_AUTHENTICATION_FIX.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\historico-problemas-logout.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\IMPLEMENTACAO_COMPLETA_FINAL.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\IMPLEMENTACAO_COMPLETA_SISTEMA_MINISTERIAL.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\IMPLEMENTACAO_REGRA_S38_OFICIAL.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\IMPLEMENTATION_PLAN.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\INFINITE_LOADING_FIX.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\INTEGRACAO_DASHBOARDS_UNIFICADA.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\INTERNATIONAL_PHONE_SUPPORT.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\MEETINGS_DATABASE_IMPLEMENTATION_COMPLETE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\MELHORIAS_IMPORTACAO_PLANILHA.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\PACKAGE_MANAGER_LOCKFILE_RESOLUTION.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\PAGE_REFRESH_FIX.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\PAGE_REFRESH_LOADING_FIX.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\PAINEL_INSTRUTOR_INTERATIVO.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\PERFORMANCE_OPTIMIZATIONS_IMPLEMENTED.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\PLANO.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\PLANO_IMPLEMENTACAO_HISTORICO_FILA_JUSTA.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\PRD.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\problemas-logout-sistema-ministerial.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\PRODUCTION_DEPLOYMENT_FIX.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\PRODUCTION_URL_UPDATE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\PROFILE_FETCH_FIX.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\PROFILE_FETCH_TIMEOUT_FIXES.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\PROGRAM_PREVIEW_SYSTEM_COMPLETE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\PROGRAMA_HARMONIZACAO_AMANHA.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\PROGRAMAS_SETUP.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\PROXIMAS_TAREFAS.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\PULL_REQUEST_DESCRIPTION.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\QUESTIONARIO_PROJETO_SISTEMA_MINISTERIAL.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\QUICK_DEPLOYMENT_FIX.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\REACT_HOOKS_ISSUE_FIX.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\REACT_USEEFFECT_FIX.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\README.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\README_ESTUDANTES.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\RECORD_KEY_GENERATION_GUIDE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\REGIONAL_CONNECTIVITY_FIXES.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\RESPOSTAS_QUESTIONARIO.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\ROUTE_AUDIT_AND_UX_REVISION.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\ROUTE_AUDIT_IMPLEMENTATION_COMPLETE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\ROUTING_FIX_SUMMARY.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\SARAH_CYPRESS_TEST.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\SCHEMA_FIX_APPLICATION_GUIDE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\SECURITY_FIX_REPORT.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\SIGNUP_ERROR_FIX.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\SISTEMA_BILINGUE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\SISTEMA_DESIGNACOES_S38T.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\SISTEMA_TUTORIAIS_INTERATIVOS.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\SISTEMA-UNIFICADO.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\SOLUCAO_WEBSOCKET.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\STUDENT_LOGIN_DEBUG_GUIDE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\STUDENT_LOGOUT_IMPLEMENTATION.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\STUDENT_PORTAL_IMPLEMENTATION.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\SUPABASE_AUTHENTICATION_FIXES_SUMMARY.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\SUPABASE_CLIENT_TIMEOUT_FIX.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\SUPABASE_EMAIL_TEMPLATE_CONFIG.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\SUPABASE_URL_CONFIG_COMPLETE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\SUPABASE_URL_CONFIGURATION.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\SYSTEM_FLOW.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\SYSTEM_FLOW_DIAGRAM.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\SYSTEM_LOGIC_DOCUMENTATION.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\TABLET_RESPONSIVENESS_FIXES.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\TAILWIND_CONFIGURATION_UPDATE_SUMMARY.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\TASK_14_COMPLETION_SUMMARY.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\TESTE_SISTEMA_BILINGUE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\TUTORIAL_IMPORT_ERROR_FIX_COMPLETE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\UNIFICACAO_SCRIPTS.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\UNIFIED_DASHBOARD_INTEGRATION_SUMMARY.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\VERIFICACAO_CYPRESS_BUILD.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\VERIFICATION_SYSTEM_GUIDE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\VERIFICATION_SYSTEM_IMPLEMENTATION_COMPLETE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\ZOOM_RESPONSIVENESS_TESTING_GUIDE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\ZOOM_RESPONSIVENESS_TESTING_IMPLEMENTATION_SUMMARY.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\ADMIN_DASHBOARD_INTEGRATION.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\ANALISE_COMPLETA_SISTEMA_MINISTERIAL.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\ANALISE_DASHBOARDS_INTEGRACAO.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\ANALISE_RESPOSTAS_QUESTIONARIO.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\APPLICATION_READINESS_ASSESSMENT.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\APPLY_DATABASE_MIGRATION_NOW.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\ASSIGNMENT_GENERATION_SYSTEM.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\ASSIGNMENT_SYSTEM_IMPLEMENTATION_COMPLETE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\ASSIGNMENT_SYSTEM_REPAIR_GUIDE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\ASSIGNMENT_WORKFLOW_GUIDE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\AUDITORIA_E_IMPLANTACAO.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\AUTH_TIMEOUT_FIXES_COMPREHENSIVE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\AUTH_TROUBLESHOOTING.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\AUTHENTICATION_STATUS_REPORT.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\BIRTH_DATE_FEATURE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\BUILD_ERRORS_FIXED.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\CACHE_ASIDE_PATTERN_GUIDE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\CHECKLIST_IMPLEMENTACAO.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\CI_CD_COMPLETION_GUIDE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\CI_CD_INTEGRATION_SUMMARY.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\COMPREHENSIVE_TUTORIAL_SYSTEM_COMPLETE.md"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\COMPREHENSIVE_VALIDATION_ASSESSMENT_REPORT.md"  Skip to main content
Roo Code Logo
Search
ctrl
K
19.4k
Install ¬∑
826.9k

Welcome
Getting Started
Installing Roo Code
Connecting To AI Provider
Your First Task
The Chat Interface
Typing Your Requests
How Tools Work
Context Mentions
Using Modes
Tips & Tricks
Tutorial Videos
Roo Code Cloud
Features
API Configuration Profiles
Auto-Approving Actions
Boomerang Tasks
Browser Use
Checkpoints
Code Actions
Codebase Indexing
Custom Instructions
Diagnostics Integration
Customizing Modes
Diff/Fast Edits
Enhance Prompt
Import/Export/Reset Settings
Intelligent Context Condensing
Keyboard Navigation
Roo Code Marketplace
Message Queueing
Model Temperature
Multi-File Reads
.rooignore
Slash Commands
Suggested Responses
Task Todo List
Terminal Shell Integration
MCP
Experimental
Additional Features
Advanced Usage
Model Providers
FAQ
Contributing (GitHub)
Roocabulary (GitHub)
Update Notes
FeaturesBoomerang Tasks

Copy Page
Boomerang Tasks: Orchestrate Complex Workflows
Boomerang Tasks (also known as subtasks or task orchestration) allow you to break down complex projects into smaller, manageable pieces using the built-in ü™É Orchestrator Mode (aka Boomerang Mode). Think of it like delegating parts of your work to specialized assistants. Each subtask runs in its own context, often using a different Roo Code mode tailored for that specific job (like üíª Code, üèóÔ∏è Architect, or ü™≤ Debug). The Orchestrator mode manages this process.



Orchestrator Mode is Built-In
The ü™É Orchestrator mode (previously achieved via a custom "Boomerang Mode") is now a built-in mode specifically designed to orchestrate workflows by breaking down tasks and delegating them to other modes. You no longer need to create a custom mode for this functionality.

Learn more about Built-in Modes.

Why Use Boomerang Tasks?
Tackle Complexity: Break large, multi-step projects (e.g., building a full feature) into focused subtasks (e.g., design, implementation, documentation).
Use Specialized Modes: Automatically delegate subtasks to the mode best suited for that specific piece of work, leveraging specialized capabilities for optimal results.
Maintain Focus & Efficiency: Each subtask operates in its own isolated context with a separate conversation history. This prevents the parent (orchestrator) task from becoming cluttered with the detailed execution steps (like code diffs or file analysis results), allowing it to focus efficiently on the high-level workflow and manage the overall process based on concise summaries from completed subtasks.
Streamline Workflows: Results from one subtask can be automatically passed to the next, creating a smooth flow (e.g., architectural decisions feeding into the coding task).
How It Works
When in the ü™É Orchestrator mode (aka Boomerang Mode), Roo analyzes a complex task and suggests breaking it down into a subtask1.

The parent task (in Orchestrator mode) pauses, and the new subtask begins in a different, specialized mode2.

When the subtask's goal is achieved, Roo signals completion.

The parent task resumes with only the summary3 of the subtask. The parent uses this summary to continue the main workflow.

Key Considerations
Approval Required: By default, you must approve the creation and completion of each subtask. This can be automated via the Auto-Approving Actions settings if desired.
Context Isolation and Transfer: Each subtask operates in complete isolation with its own conversation history. It does not automatically inherit the parent's context. Information must be explicitly passed:
Down: Via the initial instructions provided when the subtask is created.
Up: Via the final summary provided when the subtask finishes. Be mindful that only this summary returns to the parent.
Navigation: Roo's interface helps you see the hierarchy of tasks (which task is the parent, which are children). You can typically navigate between active and paused tasks.
Boomerang Tasks provide a powerful way to manage complex development workflows directly within Roo Code, leveraging specialized modes for maximum efficiency.

Keep Tasks Focused
Use subtasks (delegated via Orchestrator mode) to maintain clarity. If a request significantly shifts focus or requires a different expertise (mode), consider creating a subtask rather than overloading the current one.

Frequently Asked Questions
Why can't Orchestrator mode read files, write files, call MCPs, or run commands?
The Orchestrator mode is intentionally limited to focus on high-level workflow management. Giving it the ability to read files by default causes the context to become filled with file reads, hampering its ability to remain focused on orchestration. The design philosophy is that subtasks should handle the detailed work and return only the necessary information (via their completion summaries) for the orchestrator to delegate further tasks effectively.

This limitation helps prevent context poisoning, where irrelevant or excessive information contaminates the model's active context, leading to degraded performance and task deviation.

How can I override Orchestrator mode's limitations?
You can customize the Orchestrator mode to add capabilities like file reading by following the configuration precedence system:

Open the Command Palette and select "Edit Global Modes"
Copy and paste this configuration:
{
  "customModes": [
    {
      "slug": "orchestrator",
      "name": "ü™É Orchestrator",
      "roleDefinition": "You are Roo, a strategic workflow orchestrator who coordinates complex tasks by delegating them to appropriate specialized modes. You have a comprehensive understanding of each mode's capabilities and limitations, allowing you to effectively break down complex problems into discrete tasks that can be solved by different specialists.",
      "customInstructions": "Your role is to coordinate complex workflows by delegating tasks to specialized modes. As an orchestrator, you should:\n\n1. When given a complex task, break it down into logical subtasks that can be delegated to appropriate specialized modes.\n\n2. For each subtask, use the `new_task` tool to delegate. Choose the most appropriate mode for the subtask's specific goal and provide comprehensive instructions in the `message` parameter. These instructions must include:\n    *   All necessary context from the parent task or previous subtasks required to complete the work.\n    *   A clearly defined scope, specifying exactly what the subtask should accomplish.\n    *   An explicit statement that the subtask should *only* perform the work outlined in these instructions and not deviate.\n    *   An instruction for the subtask to signal completion by using the `attempt_completion` tool, providing a concise yet thorough summary of the outcome in the `result` parameter, keeping in mind that this summary will be the source of truth used to keep track of what was completed on this project. \n    *   A statement that these specific instructions supersede any conflicting general instructions the subtask's mode might have.\n\n3. Track and manage the progress of all subtasks. When a subtask is completed, analyze its results and determine the next steps.\n\n4. Help the user understand how the different subtasks fit together in the overall workflow. Provide clear reasoning about why you're delegating specific tasks to specific modes.\n\n5. When all subtasks are completed, synthesize the results and provide a comprehensive overview of what was accomplished.\n\n6. Ask clarifying questions when necessary to better understand how to break down complex tasks effectively.\n\n7. Suggest improvements to the workflow based on the results of completed subtasks.\n\nUse subtasks to maintain clarity. If a request significantly shifts focus or requires a different expertise (mode), consider creating a subtask rather than overloading the current one.",
      "groups": [
        "read"
      ],
      "source": "global"
    }
  ]
}

Save the file. Your global Orchestrator mode will now have read capabilities.
warning
Adding capabilities to the Orchestrator mode should be done thoughtfully. The limited default capabilities help maintain focus on orchestration rather than implementation details.

Footnotes
This context is passed via the message parameter of the new_task tool when the Orchestrator mode delegates the task. ‚Ü©

The mode for the subtask is specified via the mode parameter of the new_task tool during initiation by the Orchestrator mode. ‚Ü©

This summary is passed via the result parameter of the attempt_completion tool when the subtask finishes. ‚Ü©

Edit this page
Last updated on Aug 29, 2025
Previous
Auto-Approving Actions
Next
Browser Use
Why Use Boomerang Tasks?
How It Works
Key Considerations
Frequently Asked Questions
Why can't Orchestrator mode read files, write files, call MCPs, or run commands?
How can I override Orchestrator mode's limitations?
Roo Code Logo
Empowering developers to build better software faster with AI-powered tools and insights.
GitHub
Issues
Feature Requests
Download
VS Code Marketplace
Open VSX Registry
Company
Contact
Careers
Website Privacy Policy
Extension Privacy Policy

---

**Cursor**

```markdown
# AGENTS.md ‚Äî Orquestrador de Personas

Este arquivo define o orquestrador e as personas especializadas para guiar o fluxo de trabalho no projeto. Use-o como refer√™ncia para alternar modos e coordenar tarefas.

## Modos Dispon√≠veis

- F Architect (Planejar)
  - Foco: planejar arquitetura, fluxos, modelos de dados e regras (S‚Äë38), antes de codar.
  - Sa√≠das: diagramas, especifica√ß√µes, crit√©rios de aceite, riscos.

- Code (Implementar)
  - Foco: escrever, modificar e refatorar c√≥digo seguindo SOLID/DRY e UI consistente (Tailwind + shadcn/ui).
  - Sa√≠das: commits pequenos, testes adicionados/ajustados, docs breves.

- ? Ask (Descobrir)
  - Foco: esclarecer d√∫vidas e justificar decis√µes, explicar trade-offs.
  - Sa√≠das: respostas objetivas, comparativos, refer√™ncias internas.

- Debug (Diagnosticar)
  - Foco: reproduzir, isolar e corrigir defeitos; adicionar testes de regress√£o.
  - Sa√≠das: RCA, fix verificado, m√©tricas (antes/depois) quando aplic√°vel.

- Orchestrator (Orquestrar)
  - Foco: coordenar tarefas entre modos, dividir trabalho em etapas, garantir handoffs limpos.
  - Sa√≠das: plano de execu√ß√£o, checklist, ordem de opera√ß√µes e crit√©rios de conclus√£o.

## Atalhos de Modo

- Ctrl + .  ‚Üí pr√≥ximo modo
- Ctrl + Shift + .  ‚Üí modo anterior

## Diretrizes do Orquestrador

1) Come√ßar no modo F Architect para planejar:
   - Definir objetivo, requisitos, riscos, crit√©rios de aceite.
   - Mapear entidades/tabelas, pol√≠ticas RLS e regras S‚Äë38 relevantes.

2) Delegar para Code com escopo claro:
   - Descrever arquivos a alterar/criar e pontos de integra√ß√£o.
   - Exigir testes (Cypress/E2E, unit√°rios quando couber) e verifica√ß√£o de lint.

3) Usar ? Ask quando houver ambiguidades:
   - Formular perguntas fechadas e decis√µes com pr√≥s/cons.

4) Invocar Debug ap√≥s implementa√ß√£o:
   - Reproduzir, criar testes de regress√£o, verificar m√©tricas/perf.

5) Encerrar ciclo com documenta√ß√£o m√≠nima:
   - Atualizar README/README_EXTENDIDO, CHANGELOG e anota√ß√µes de decis√µes.

## Padr√µes de Qualidade (todos os modos)

- Seguran√ßa: n√£o expor segredos, RLS ativo, m√≠nimo privil√©gio.
- C√≥digo: fun√ß√µes curtas, nomes claros, early return/guard clauses.
- UI/UX: responsivo, consistente, sem inline styles desnecess√°rios.
- Performance: evitar refetches, usar memoiza√ß√£o e pagina√ß√£o.
- Documenta√ß√£o: sucinta, com exemplos e instru√ß√µes de uso.

## Fluxo de Trabalho Sugerido

1. Orchestrator: alinhamento e cria√ß√£o de checklist.
2. F Architect: modelo de dados/fluxo (inclui S‚Äë38 quando pertinente).
3. Code: implementa√ß√£o incremental (commits pequenos) + testes.
4. Debug: valida√ß√µes e corre√ß√µes.
5. Orchestrator: revis√£o final, merge e atualiza√ß√£o de docs.

## Exemplo de Handoff

- Orchestrator ‚Üí F Architect: "Definir esquema de `designacoes` com regras S‚Äë38 e conflito de vers√£o".
- F Architect ‚Üí Code: "Criar migra√ß√£o, pol√≠ticas RLS e valida√ß√µes de elegibilidade no frontend".
- Code ‚Üí Debug: "Adicionar testes E2E para conflitos e exporta√ß√£o PDF".
- Debug ‚Üí Orchestrator: "RCA e fix confirmados; pronto para merge".

## Registro de Atividades (autom√°tico)

Este arquivo mant√©m um registro autom√°tico das atividades dos agentes.

Use o comando:

```bash
npm run agents:log -- --agent="Code" --action="Implement feature X" --status="completed" --details="arquivos Y/Z atualizados"
```

As entradas ser√£o salvas em `agents.log.json` e refletidas abaixo.

<!-- AGENTS_LOG_START -->
<!-- Entradas ser√£o inseridas automaticamente aqui. N√£o editar manualmente abaixo desta linha. -->
<!-- AGENTS_LOG_END -->

## √çndice de Materiais e Documentos

### Materiais Oficiais (servidos pelo backend)
- mwb_E_202507.pdf ‚Äî `http://localhost:3001/materials/mwb_E_202507.pdf`
- mwb_E_202509.pdf ‚Äî `http://localhost:3001/materials/mwb_E_202509.pdf`
- mwb_E_202511.pdf ‚Äî `http://localhost:3001/materials/mwb_E_202511.pdf`
- mwb_T_202507.daisy.zip ‚Äî `http://localhost:3001/materials/mwb_T_202507.daisy.zip`
- mwb_T_202509.daisy.zip ‚Äî `http://localhost:3001/materials/mwb_T_202509.daisy.zip`
- mwb_T_202509.jwpub ‚Äî `http://localhost:3001/materials/mwb_T_202509.jwpub`
- mwb_T_202511.jwpub ‚Äî `http://localhost:3001/materials/mwb_T_202511.jwpub`
- S-38_E.rtf ‚Äî `http://localhost:3001/materials/S-38_E.rtf`
- WhatsApp Image 2025-08-14 at 19.44.07 (1).jpeg ‚Äî `http://localhost:3001/materials/WhatsApp%20Image%202025-08-14%20at%2019.44.07%20%281%29.jpeg`
- WhatsApp Image 2025-08-14 at 19.44.07.jpeg ‚Äî `http://localhost:3001/materials/WhatsApp%20Image%202025-08-14%20at%2019.44.07.jpeg`
- estudantes_ficticios.xlsx ‚Äî `http://localhost:3001/materials/estudantes_ficticios.xlsx`
- estudantes_rows.sql ‚Äî `http://localhost:3001/materials/estudantes_rows.sql`

### Documenta√ß√£o (links no reposit√≥rio)
- docs/CONSOLE_LOG_FIXES.md
- docs/CORRECAO_ERRO_DATA_DESIGNACOES.md
- docs/CORRECAO_QRCODE_BUILD.md
- docs/CORRE√á√ïES_AUDITORIA_PWA.md
- docs/CORRECOES_TIPOS_MAPEAMENTOS.md
- docs/CORRECTED_DEVELOPER_REGISTRATION_GUIDE.md
- docs/CREDENCIAIS_TESTE_SISTEMA_COMPLETO.md
- docs/CRITICAL_ASSIGNMENT_FIXES_SUMMARY.md
- docs/CRITICAL_DATABASE_MIGRATION_APPLIED.md
- docs/CRITICAL_OPTIMIZATIONS_COMPLETE.md
- docs/CYPRESS_CICD_IMPLEMENTATION_SUMMARY.md
- docs/CYPRESS_CLOUD_CICD_SETUP.md
- docs/CYPRESS_CLOUD_SETUP.md
- docs/CYPRESS_CLOUD_TROUBLESHOOTING.md
- docs/CYPRESS_TESTING_SETUP.md
- docs/CYPRESS_TROUBLESHOOTING.md
- docs/DASHBOARD_LOGOUT_FIX.md
- docs/DEBUG_ADMIN_DASHBOARD.md
- docs/DEPLOYMENT_AUTHORIZATION_FIX.md
- docs/DEVELOPER_PANEL_IMPLEMENTATION_COMPLETE.md
- docs/DEVELOPER_REGISTRATION_VALIDATION_REPORT.md
- docs/DOCUMENTACAO_COMPLETA.md
- docs/DOCUMENTACAO_TECNICA_CONVITES_FAMILIARES.md
- docs/EMAIL_CONFIRMATION_FIX.md
- docs/ENHANCED_PDF_PARSING.md
- docs/ENVIRONMENT_CONFIGURATION_COMPLETE.md
- docs/ENVIRONMENT_SETUP_GUIDE.md
- docs/EXCEL_IMPORT_GUIDE.md
- docs/EXECUTION_TASKS_TRACKER.md
- docs/FAMILY_INVITATIONS_BUG_FIX.md
- docs/FAMILY_INVITATIONS_FEATURE.md
- docs/FAMILY_INVITATIONS_IMPLEMENTATION.md
- docs/FAMILY_MANAGEMENT_BUG_FIX.md
- docs/FAMILY_MANAGEMENT_TESTING_GUIDE.md
- docs/FAMILY_MEMBER_INSERT_BUG_FIX.md
- docs/FAQ_DELIVERABLES_SUMMARY.md
- docs/FAQ_SECTION_IMPLEMENTATION.md
- docs/GITHUB_ACTIONS_SETUP.md
- docs/GITHUB_REPOSITORY_SETUP.md
- docs/GUIA_ADMINISTRADOR_SISTEMA_MINISTERIAL.md
- docs/GUIA_TESTES_CYPRESS.md
- docs/GUIA_TRADUCAO_COMPLETA.md
- docs/GUIA_USUARIO.md
- docs/guia-desenvolvedor-logout.md
- docs/HEADER_AUTHENTICATION_FIX.md
- docs/historico-problemas-logout.md
- docs/IMPLEMENTACAO_COMPLETA_FINAL.md
- docs/IMPLEMENTACAO_COMPLETA_SISTEMA_MINISTERIAL.md
- docs/IMPLEMENTACAO_REGRA_S38_OFICIAL.md
- docs/IMPLEMENTATION_PLAN.md
- docs/INFINITE_LOADING_FIX.md
- docs/INTEGRACAO_DASHBOARDS_UNIFICADA.md
- docs/INTERNATIONAL_PHONE_SUPPORT.md
- docs/MEETINGS_DATABASE_IMPLEMENTATION_COMPLETE.md
- docs/MELHORIAS_IMPORTACAO_PLANILHA.md
- docs/PACKAGE_MANAGER_LOCKFILE_RESOLUTION.md
- docs/PAGE_REFRESH_FIX.md
- docs/PAGE_REFRESH_LOADING_FIX.md
- docs/PAINEL_INSTRUTOR_INTERATIVO.md
- docs/PERFORMANCE_OPTIMIZATIONS_IMPLEMENTED.md
- docs/PLANO.md
- docs/PLANO_IMPLEMENTACAO_HISTORICO_FILA_JUSTA.md
- docs/PRD.md
- docs/problemas-logout-sistema-ministerial.md
- docs/PRODUCTION_DEPLOYMENT_FIX.md
- docs/PRODUCTION_URL_UPDATE.md
- docs/PROFILE_FETCH_FIX.md
- docs/PROFILE_FETCH_TIMEOUT_FIXES.md
- docs/PROGRAM_PREVIEW_SYSTEM_COMPLETE.md
- docs/PROGRAMA_HARMONIZACAO_AMANHA.md
- docs/PROGRAMAS_SETUP.md
- docs/PROXIMAS_TAREFAS.md
- docs/PULL_REQUEST_DESCRIPTION.md
- docs/QUESTIONARIO_PROJETO_SISTEMA_MINISTERIAL.md
- docs/QUICK_DEPLOYMENT_FIX.md
- docs/REACT_HOOKS_ISSUE_FIX.md
- docs/REACT_USEEFFECT_FIX.md
- docs/README.md
- docs/README_ESTUDANTES.md
- docs/RECORD_KEY_GENERATION_GUIDE.md
- docs/REGIONAL_CONNECTIVITY_FIXES.md
- docs/RESPOSTAS_QUESTIONARIO.md
- docs/ROUTE_AUDIT_AND_UX_REVISION.md
- docs/ROUTE_AUDIT_IMPLEMENTATION_COMPLETE.md
- docs/ROUTING_FIX_SUMMARY.md
- docs/SARAH_CYPRESS_TEST.md
- docs/SCHEMA_FIX_APPLICATION_GUIDE.md
- docs/SECURITY_FIX_REPORT.md
- docs/SIGNUP_ERROR_FIX.md
- docs/SISTEMA_BILINGUE.md
- docs/SISTEMA_DESIGNACOES_S38T.md
- docs/SISTEMA_TUTORIAIS_INTERATIVOS.md
- docs/SISTEMA-UNIFICADO.md
- docs/SOLUCAO_WEBSOCKET.md
- docs/STUDENT_LOGIN_DEBUG_GUIDE.md
- docs/STUDENT_LOGOUT_IMPLEMENTATION.md
- docs/STUDENT_PORTAL_IMPLEMENTATION.md
- docs/SUPABASE_AUTHENTICATION_FIXES_SUMMARY.md
- docs/SUPABASE_CLIENT_TIMEOUT_FIX.md
- docs/SUPABASE_EMAIL_TEMPLATE_CONFIG.md
- docs/SUPABASE_URL_CONFIG_COMPLETE.md
- docs/SUPABASE_URL_CONFIGURATION.md
- docs/SYSTEM_FLOW.md
- docs/SYSTEM_FLOW_DIAGRAM.md
- docs/SYSTEM_LOGIC_DOCUMENTATION.md
- docs/TABLET_RESPONSIVENESS_FIXES.md
- docs/TAILWIND_CONFIGURATION_UPDATE_SUMMARY.md
- docs/TASK_14_COMPLETION_SUMMARY.md
- docs/TESTE_SISTEMA_BILINGUE.md
- docs/TUTORIAL_IMPORT_ERROR_FIX_COMPLETE.md
- docs/UNIFICACAO_SCRIPTS.md
- docs/UNIFIED_DASHBOARD_INTEGRATION_SUMMARY.md
- docs/VERIFICACAO_CYPRESS_BUILD.md
- docs/VERIFICATION_SYSTEM_GUIDE.md
- docs/VERIFICATION_SYSTEM_IMPLEMENTATION_COMPLETE.md
- docs/ZOOM_RESPONSIVENESS_TESTING_GUIDE.md
- docs/ZOOM_RESPONSIVENESS_TESTING_IMPLEMENTATION_SUMMARY.md
- docs/ADMIN_DASHBOARD_INTEGRATION.md
- docs/ANALISE_COMPLETA_SISTEMA_MINISTERIAL.md
- docs/ANALISE_DASHBOARDS_INTEGRACAO.md
- docs/ANALISE_RESPOSTAS_QUESTIONARIO.md
- docs/APPLICATION_READINESS_ASSESSMENT.md
- docs/APPLY_DATABASE_MIGRATION_NOW.md
- docs/ASSIGNMENT_GENERATION_SYSTEM.md
- docs/ASSIGNMENT_SYSTEM_IMPLEMENTATION_COMPLETE.md
- docs/ASSIGNMENT_SYSTEM_REPAIR_GUIDE.md
- docs/ASSIGNMENT_WORKFLOW_GUIDE.md
- docs/AUDITORIA_E_IMPLANTACAO.md
- docs/AUTH_TIMEOUT_FIXES_COMPREHENSIVE.md
- docs/AUTH_TROUBLESHOOTING.md
- docs/AUTHENTICATION_STATUS_REPORT.md
- docs/BIRTH_DATE_FEATURE.md
- docs/BUILD_ERRORS_FIXED.md
- docs/CACHE_ASIDE_PATTERN_GUIDE.md
- docs/CHECKLIST_IMPLEMENTACAO.md
- docs/CI_CD_COMPLETION_GUIDE.md
- docs/CI_CD_INTEGRATION_SUMMARY.md
- docs/COMPREHENSIVE_TUTORIAL_SYSTEM_COMPLETE.md
- docs/COMPREHENSIVE_VALIDATION_ASSESSMENT_REPORT.md

```

Adicionei no `AGENTS.md` um √≠ndice com:
- Links HTTP para os materiais em `docs/Oficial` servidos pelo backend na rota `/materials` (com encoding para nomes com espa√ßos/par√™nteses).
- Lista dos documentos internos em `docs/` citados.

Se quiser, posso transformar os itens da lista de documentos em links markdown relativos clic√°veis (ex.: `[docs/PROGRAMAS_SETUP.md](docs/PROGRAMAS_SETUP.md)`).

---

**User**

no dashboard do admin tem que aparecer as programacoes

---

**Cursor**

Vou adicionar a listagem de programa√ß√µes no `AdminDashboard`: buscar os √∫ltimos programas do Supabase e exibi-los na aba ‚ÄúVis√£o Geral‚Äù. Vou implementar o carregamento (`loadPrograms`) e um Card com a lista.

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo, lazy, Suspense } from 'react';
import { useAuth } from '../contexts/AuthContext';
import { supabase } from '../integrations/supabase/client';
import { useJWorgIntegration } from '../hooks/useJWorgIntegration';
import { JWorgTest } from '../components/JWorgTest';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../components/ui/card';
import LazyLoader from '../components/LazyLoader';
import AuthErrorHandler from '../components/AuthErrorHandler';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '../components/ui/tabs';
import { Button } from '../components/ui/button';
import { Badge } from '../components/ui/badge';
import { Separator } from '../components/ui/separator';
import { 
  Download, 
  Upload, 
  Globe, 
  BarChart3, 
  Settings, 
  RefreshCw,
  CheckCircle,
  AlertCircle,
  Clock,
  FileText,
  Users,
  Package,
  Activity,
  Database
} from 'lucide-react';

// üöÄ Lazy loading para componentes pesados (comentado por enquanto)
// const JWorgTestLazy = lazy(() => import('../components/JWorgTest'));

interface SystemStats {
  total_congregations: number;
  active_congregations: number;
  total_users: number;
  total_estudantes: number;
  total_programas: number;
  last_sync: string;
}

export default function AdminDashboard() {
  const { user, profile, isAdmin } = useAuth();
  const jworg = useJWorgIntegration();
  const [activeTab, setActiveTab] = useState('overview');
  const [loading, setLoading] = useState(false);
  const [systemStats, setSystemStats] = useState<SystemStats | null>(null);
  const [lastCheck, setLastCheck] = useState<string>('');
  const [debugInfo, setDebugInfo] = useState<string>('');
  const [showJWorgTest, setShowJWorgTest] = useState(false);
  const [programs, setPrograms] = useState<any[]>([]);
  const [programsLoading, setProgramsLoading] = useState<boolean>(false);

  // üöÄ Memoiza√ß√£o de dados est√°ticos para reduzir re-renders
  const staticStats = useMemo(() => ({
    total_congregations: systemStats?.total_congregations || 0,
    active_congregations: systemStats?.active_congregations || 0,
    total_users: systemStats?.total_users || 0,
    total_estudantes: systemStats?.total_estudantes || 0,
    total_programas: systemStats?.total_programas || 0,
    last_sync: systemStats?.last_sync || ''
  }), [systemStats]);

  // üöÄ Debounced function para reduzir chamadas desnecess√°rias
  const debouncedSetDebugInfo = useCallback((info: string) => {
    let timeoutId: NodeJS.Timeout;
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => setDebugInfo(info), 100);
  }, []);

  // DEBUG: Log component state (otimizado)
  useEffect(() => {
    const debugData = {
      user: !!user,
      userId: user?.id,
      userEmail: user?.email,
      profile: !!profile,
      profileRole: profile?.role,
      isAdmin,
      loading,
      userMetadata: user?.user_metadata
    };

    console.log('üîç AdminDashboard Component Debug:', debugData);
    debouncedSetDebugInfo(JSON.stringify(debugData, null, 2));
  }, [user, profile, isAdmin, loading, debouncedSetDebugInfo]);

  useEffect(() => {
    console.log('üîÑ AdminDashboard useEffect triggered:', { user, isAdmin });
    
    if (user && isAdmin) {
      console.log('‚úÖ Admin user detected, loading system data...');
      loadSystemData();
    } else if (user && !isAdmin) {
      console.log('‚ùå User is not admin, role:', profile?.role);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå User is not admin, role: ' + profile?.role);
    } else if (!user) {
      console.log('‚ùå No user found');
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå No user found');
    }
  }, [user, isAdmin, debouncedSetDebugInfo]);

  const loadSystemData = useCallback(async () => {
    if (!user || !isAdmin) {
      console.log('üö´ loadSystemData: User not admin or not logged in');
      return;
    }
    
    console.log('üîÑ Loading system data for admin...');
    setLoading(true);
    try {
      // Testar conex√£o com Supabase
      console.log('üîç Testing Supabase connection...');
      const { count: profilesCount, error: testError } = await supabase
        .from('profiles')
        .select('*', { count: 'exact', head: true });
      
      if (testError) {
        console.error('‚ùå Supabase connection test failed:', testError);
        debouncedSetDebugInfo(debugInfo + '\n\n‚ùå Supabase Test Failed: ' + testError.message);
        return;
      }

        console.log('‚úÖ Supabase connection test successful');
      debouncedSetDebugInfo(debugInfo + '\n\n‚úÖ Supabase Test: Connected');

      // Carregar estat√≠sticas do sistema
      await loadSystemStats();
      // Carregar programa√ß√µes publicadas
      await loadPrograms();

    } catch (error) {
      console.error('‚ùå Supabase test exception:', error);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå Supabase Test Exception: ' + error);
    } finally {
      setLoading(false);
    }
  }, [user, isAdmin, debouncedSetDebugInfo, debugInfo]);

  const loadSystemStats = useCallback(async () => {
    try {
      console.log('üìä Loading system statistics...');

      const [profilesRes, estudantesRes, programasRes, congregacoesRes] = await Promise.all([
        supabase.from('profiles').select('*', { count: 'exact', head: true }),
        supabase.from('estudantes').select('*', { count: 'exact', head: true }),
        supabase.from('programas').select('*', { count: 'exact', head: true }),
        supabase.from('congregacoes').select('*', { count: 'exact', head: true }),
      ]);

      const stats: SystemStats = {
        total_congregations: (congregacoesRes.count as number) || 0,
        active_congregations: (congregacoesRes.count as number) || 0,
        total_users: (profilesRes.count as number) || 0,
        total_estudantes: (estudantesRes.count as number) || 0,
        total_programas: (programasRes.count as number) || 0,
        last_sync: new Date().toISOString(),
      };

      setSystemStats(stats);
      setLastCheck(new Date().toISOString());

      console.log('‚úÖ System stats loaded:', stats);
      debouncedSetDebugInfo(debugInfo + '\n\n‚úÖ System Stats Loaded: ' + JSON.stringify(stats, null, 2));

    } catch (error) {
      console.error('‚ùå Error loading system stats:', error);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå System Stats Error: ' + error);
    }
  }, [debouncedSetDebugInfo, debugInfo]);

  const loadPrograms = useCallback(async () => {
    try {
      setProgramsLoading(true);
      const { data, error } = await supabase
        .from('programas')
        .select('id, semana_iso, idioma, status, versao, data_inicio, data_fim')
        .order('data_inicio', { ascending: false })
        .limit(12);
      if (error) throw error;
      setPrograms(data || []);
      console.log('‚úÖ Programs loaded:', data?.length || 0);
    } catch (error: any) {
      console.error('‚ùå Error loading programs:', error);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå Programs Load Error: ' + (error?.message || error));
    } finally {
      setProgramsLoading(false);
    }
  }, [debouncedSetDebugInfo, debugInfo]);

  const checkForUpdates = useCallback(async () => {
    console.log('üîÑ Checking for updates...');
    setLoading(true);
    
    try {
      await loadSystemStats();
      await loadPrograms();
      console.log('‚úÖ Updates checked successfully');
    } catch (error) {
      console.error('‚ùå Error checking updates:', error);
    } finally {
      setLoading(false);
    }
  }, [loadSystemStats]);

  const testSupabaseConnection = useCallback(async () => {
    console.log('üîß Testing Supabase connection...');
    
    try {
      const { count, error } = await supabase
        .from('profiles')
        .select('*', { count: 'exact', head: true });

      if (error) {
        console.error('‚ùå Supabase test error:', error);
        alert('Supabase test error: ' + error.message);
      } else {
        console.log('‚úÖ Supabase test successful. Profiles count:', count);
        alert('Supabase test successful! Total profiles: ' + (count ?? 0));
      }
    } catch (error) {
      console.error('‚ùå Supabase test exception:', error);
      alert('Supabase test exception: ' + error);
    }
  }, []);

  // ========== HANDLERS DOS BOT√ïES ==========
  
  const handleListUsers = useCallback(async () => {
    console.log('üë• Listando usu√°rios...');
    try {
      const { data: users, error } = await supabase
        .from('profiles')
        .select('id, nome_completo, role, congregacao, cargo')
        .order('nome_completo');
      
      if (error) throw error;
      
      console.log('‚úÖ Usu√°rios carregados:', users);
      alert(`Encontrados ${users?.length || 0} usu√°rios no sistema:\n\n${users?.map(u => `${u.nome_completo || u.id} - ${u.role} (${u.congregacao || 'N/A'})`).join('\n')}`);
    } catch (error) {
      console.error('‚ùå Erro ao listar usu√°rios:', error);
      alert('Erro ao carregar usu√°rios: ' + error.message);
    }
  }, []);

  const handleManagePermissions = useCallback(async () => {
    console.log('‚öôÔ∏è Gerenciando permiss√µes...');
    const newRole = prompt('Digite o novo role (admin, instrutor, estudante):');
    if (!newRole) return;
    
    // Validar role
    const validRoles = ['admin', 'instrutor', 'estudante', 'family_member', 'developer'];
    if (!validRoles.includes(newRole)) {
      alert('Role inv√°lido. Use: admin, instrutor, estudante, family_member ou developer');
      return;
    }
    
    const userId = prompt('Digite o ID do usu√°rio:');
    if (!userId) return;
    
    try {
      const { error } = await supabase
        .from('profiles')
        .update({ role: newRole as any })
        .eq('id', userId);
      
      if (error) throw error;
      
      console.log('‚úÖ Permiss√£o atualizada');
      alert('Permiss√£o atualizada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao atualizar permiss√£o:', error);
      alert('Erro ao atualizar permiss√£o: ' + error.message);
    }
  }, []);

  const handleActivityReport = useCallback(async () => {
    console.log('üìä Gerando relat√≥rio de atividades...');
    try {
      // Simula√ß√£o de relat√≥rio
      const report = {
        totalUsers: staticStats.total_users,
        totalCongregations: staticStats.total_congregations,
        lastUpdate: new Date().toLocaleString('pt-BR'),
        activeUsers: Math.floor(staticStats.total_users * 0.8)
      };
      
      alert(`üìä Relat√≥rio de Atividades:\n\n` +
            `‚Ä¢ Total de usu√°rios: ${report.totalUsers}\n` +
            `‚Ä¢ Usu√°rios ativos: ${report.activeUsers}\n` +
            `‚Ä¢ Total de congrega√ß√µes: ${report.totalCongregations}\n` +
            `‚Ä¢ √öltima atualiza√ß√£o: ${report.lastUpdate}`);
    } catch (error) {
      console.error('‚ùå Erro ao gerar relat√≥rio:', error);
      alert('Erro ao gerar relat√≥rio: ' + error.message);
    }
  }, [staticStats]);

  const handleBackupData = useCallback(async () => {
    console.log('üíæ Fazendo backup dos dados...');
    try {
      const { data: profiles, error: profilesError } = await supabase
        .from('profiles')
        .select('*');
      
      if (profilesError) throw profilesError;
      
      // Simular backup
      const backupData = {
        timestamp: new Date().toISOString(),
        profiles: profiles,
        stats: staticStats
      };
      
      const dataStr = JSON.stringify(backupData, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      
      const link = document.createElement('a');
      link.href = url;
      link.download = `backup_sistema_ministerial_${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      
      URL.revokeObjectURL(url);
      console.log('‚úÖ Backup criado com sucesso');
      alert('Backup criado e baixado com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao fazer backup:', error);
      alert('Erro ao fazer backup: ' + error.message);
    }
  }, [staticStats]);

  // Congrega√ß√µes
  const handleManageCongregation = useCallback((congregationName: string) => {
    console.log('üè¢ Gerenciando congrega√ß√£o:', congregationName);
    alert(`üè¢ Gerenciando congrega√ß√£o: ${congregationName}\n\nEsta funcionalidade abrir√° o painel de gerenciamento da congrega√ß√£o.`);
  }, []);

  const handleAddCongregation = useCallback(async () => {
    console.log('‚ûï Adicionando nova congrega√ß√£o...');
    const congregationName = prompt('Digite o nome da nova congrega√ß√£o:');
    if (!congregationName) return;
    
    try {
      // Simula√ß√£o - em produ√ß√£o seria inser√ß√£o no Supabase
      console.log('‚úÖ Congrega√ß√£o adicionada:', congregationName);
      alert(`‚úÖ Congrega√ß√£o "${congregationName}" adicionada com sucesso!\n\nEla agora receber√° automaticamente a programa√ß√£o oficial.`);
    } catch (error) {
      console.error('‚ùå Erro ao adicionar congrega√ß√£o:', error);
      alert('Erro ao adicionar congrega√ß√£o: ' + error.message);
    }
  }, []);

  // JW.org & S-38
  const handleMWBAvailable = useCallback(async () => {
    console.log('üìö Disponibilizando MWB atual...');
    try {
      await jworg.fetchCurrentWeek();
      console.log('‚úÖ MWB atualizada');
      alert('‚úÖ Apostila MWB atual disponibilizada para todas as congrega√ß√µes!');
    } catch (error) {
      console.error('‚ùå Erro ao disponibilizar MWB:', error);
      alert('Erro ao disponibilizar MWB: ' + error.message);
    }
  }, [jworg]);

  const handleConfigureJWorgURLs = useCallback(() => {
    console.log('‚öôÔ∏è Configurando URLs JW.org...');
    const ptUrl = prompt('URL JW.org PT:', 'https://www.jw.org/pt/biblioteca/jw-apostila-do-mes/');
    const enUrl = prompt('URL JW.org EN:', 'https://www.jw.org/en/library/jw-meeting-workbook/');
    
    if (ptUrl && enUrl) {
      console.log('‚úÖ URLs configuradas:', { ptUrl, enUrl });
      alert('‚úÖ URLs JW.org configuradas com sucesso!');
    }
  }, []);

  const handleSyncCongregations = useCallback(async () => {
    console.log('üîÑ Sincronizando com congrega√ß√µes...');
    try {
      // Simula√ß√£o de sincroniza√ß√£o
      const congregationsCount = staticStats.total_congregations;
      console.log(`‚úÖ Sincronizando com ${congregationsCount} congrega√ß√µes`);
      alert(`üîÑ Sincroniza√ß√£o iniciada!\n\nPrograma√ß√£o oficial sendo enviada para ${congregationsCount} congrega√ß√µes...\n\nTempo estimado: ${Math.ceil(congregationsCount / 100)} minutos`);
    } catch (error) {
      console.error('‚ùå Erro na sincroniza√ß√£o:', error);
      alert('Erro na sincroniza√ß√£o: ' + error.message);
    }
  }, [staticStats]);

  // Programa√ß√£o Oficial
  const handleViewFullProgram = useCallback(() => {
    console.log('üìÖ Visualizando programa√ß√£o completa (3 meses)...');
    alert(`üìÖ Programa√ß√£o Completa dos Pr√≥ximos 3 Meses\n\n` +
          `‚Ä¢ Semanas carregadas: 12\n` +
          `‚Ä¢ Idiomas: PT e EN\n` +
          `‚Ä¢ √öltima atualiza√ß√£o: Hoje\n\n` +
          `Esta visualiza√ß√£o mostrar√° todas as apostilas MWB dos pr√≥ximos 3 meses.`);
  }, []);

  const handleUpdateProgramPT = useCallback(async () => {
    console.log('üáßüá∑ Atualizando programa√ß√£o PT...');
    try {
      jworg.setLanguage('pt');
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Programa√ß√£o PT atualizada');
      alert('‚úÖ Programa√ß√£o em Portugu√™s atualizada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao atualizar programa√ß√£o PT:', error);
      alert('Erro ao atualizar programa√ß√£o PT: ' + error.message);
    }
  }, [jworg]);

  const handleUpdateProgramEN = useCallback(async () => {
    console.log('üá∫üá∏ Atualizando programa√ß√£o EN...');
    try {
      jworg.setLanguage('en');
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Programa√ß√£o EN atualizada');
      alert('‚úÖ Programa√ß√£o em Ingl√™s atualizada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao atualizar programa√ß√£o EN:', error);
      alert('Erro ao atualizar programa√ß√£o EN: ' + error.message);
    }
  }, [jworg]);

  const handleCheckNewWeeks = useCallback(async () => {
    console.log('üîç Verificando novas semanas...');
    try {
      await jworg.fetchNextWeeks();
      const newWeeks = jworg.nextWeeks.length;
      console.log(`‚úÖ Verifica√ß√£o conclu√≠da: ${newWeeks} semanas`);
      alert(`üîç Verifica√ß√£o conclu√≠da!\n\nEncontradas ${newWeeks} semanas de programa√ß√£o.\n\nTodas est√£o sincronizadas com JW.org.`);
    } catch (error) {
      console.error('‚ùå Erro ao verificar semanas:', error);
      alert('Erro ao verificar novas semanas: ' + error.message);
    }
  }, [jworg]);

  const handleUpdateS38Structure = useCallback(() => {
    console.log('üèóÔ∏è Atualizando estrutura S-38 global...');
    alert(`üèóÔ∏è Estrutura S-38 Global\n\n` +
          `‚úÖ Partes da reuni√£o atualizadas:\n` +
          `‚Ä¢ Chairman\n‚Ä¢ Treasures\n‚Ä¢ Gems\n‚Ä¢ Reading\n` +
          `‚Ä¢ Starting\n‚Ä¢ Following\n‚Ä¢ Making\n‚Ä¢ Explaining\n` +
          `‚Ä¢ Talk\n\n` +
          `Esta estrutura ser√° aplicada mundialmente.`);
  }, []);

  // JW.org Integration
  const handleReloadCurrentWeek = useCallback(async () => {
    console.log('üîÑ Recarregando semana atual...');
    try {
      await jworg.fetchCurrentWeek();
      console.log('‚úÖ Semana atual recarregada');
      alert('‚úÖ Semana atual recarregada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao recarregar semana:', error);
      alert('Erro ao recarregar semana: ' + error.message);
    }
  }, [jworg]);

  const handleReloadNextWeeks = useCallback(async () => {
    console.log('üìÖ Recarregando pr√≥ximas semanas...');
    try {
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Pr√≥ximas semanas recarregadas');
      alert('‚úÖ Pr√≥ximas semanas recarregadas com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao recarregar pr√≥ximas semanas:', error);
      alert('Erro ao recarregar pr√≥ximas semanas: ' + error.message);
    }
  }, [jworg]);

  const handleTestDownloadPT = useCallback(async () => {
    console.log('üß™ Testando download PT...');
    try {
      jworg.setLanguage('pt');
      await jworg.downloadWorkbook('pt', '07', '2025');
      console.log('‚úÖ Download PT testado');
      alert('‚úÖ Download PT testado com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro no teste de download PT:', error);
      alert('Erro no teste de download PT: ' + error.message);
    }
  }, [jworg]);

  // Monitoramento
  const handleViewAllLogs = useCallback(async () => {
    console.log('üìã Visualizando todos os logs...');
    try {
      // Simula√ß√£o de logs
      const logs = [
        { timestamp: new Date().toLocaleString(), event: 'Sistema iniciado', level: 'info' },
        { timestamp: new Date(Date.now() - 3600000).toLocaleString(), event: 'Backup autom√°tico executado', level: 'info' },
        { timestamp: new Date(Date.now() - 86400000).toLocaleString(), event: 'Novo usu√°rio registrado', level: 'info' },
        { timestamp: new Date(Date.now() - 172800000).toLocaleString(), event: 'Manuten√ß√£o programada', level: 'warning' }
      ];
      
      const logText = logs.map(log => `${log.timestamp} [${log.level.toUpperCase()}] ${log.event}`).join('\n');
      alert(`üìã Logs do Sistema\n\n${logText}`);
    } catch (error) {
      console.error('‚ùå Erro ao carregar logs:', error);
      alert('Erro ao carregar logs: ' + error.message);
    }
  }, []);

  const handleTestJWorgIntegration = useCallback(async () => {
    console.log('üß™ Testando integra√ß√£o JW.org...');
    try {
      await jworg.fetchCurrentWeek();
      console.log('‚úÖ Integra√ß√£o JW.org testada com sucesso');
      alert('‚úÖ Integra√ß√£o JW.org funcionando perfeitamente!');
    } catch (error) {
      console.error('‚ùå Erro na integra√ß√£o JW.org:', error);
      alert('‚ùå Erro na integra√ß√£o JW.org: ' + error.message);
    }
  }, [jworg]);

  const handleChangeLanguage = useCallback((newLang: 'pt' | 'en') => {
    jworg.setLanguage(newLang);
    console.log(`üåê Idioma alterado para: ${newLang}`);
    alert(`üåê Idioma alterado para: ${newLang === 'pt' ? 'Portugu√™s' : 'English'}`);
  }, [jworg]);

  // Alterna o idioma atual entre PT/EN
  const toggleLanguage = useCallback(() => {
    const current = (jworg as any)?.currentLanguage ?? 'pt';
    const next = current === 'pt' ? 'en' : 'pt';
    jworg.setLanguage(next);
    console.log(`üåê Idioma alternado: ${current} -> ${next}`);
    alert(`üåê Idioma alternado para: ${next === 'pt' ? 'Portugu√™s' : 'English'}`);
  }, [jworg]);

  // Atualiza materiais JW.org (semana atual + pr√≥ximas semanas)
  const updateMaterials = useCallback(async () => {
    try {
      await jworg.fetchCurrentWeek();
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Materiais JW.org atualizados');
      alert('‚úÖ Materiais JW.org atualizados com sucesso!');
    } catch (error: any) {
      console.error('‚ùå Erro ao atualizar materiais:', error);
      alert('‚ùå Erro ao atualizar materiais: ' + (error?.message || error));
    }
  }, [jworg]);

  // NOW CHECK CONDITIONS AND RENDER APPROPRIATELY
  // Se n√£o for admin, mostrar mensagem de acesso negado
  if (user && !isAdmin) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="max-w-md mx-auto">
          <CardHeader>
            <CardTitle className="text-red-600">Acesso Negado</CardTitle>
            <CardDescription>
              Voc√™ n√£o tem permiss√£o para acessar o painel administrativo.
            </CardDescription>
          </CardHeader>
          <CardContent>
            <p className="text-sm text-muted-foreground mb-4">
              Seu perfil atual: <strong>{profile?.role}</strong>
            </p>
            <Button onClick={() => window.history.back()}>
              Voltar
            </Button>
          </CardContent>
        </Card>
      </div>
    );
  }

  // Se n√£o houver usu√°rio, mostrar loading
  if (!user) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="max-w-md mx-auto">
          <CardHeader>
            <CardTitle>Carregando...</CardTitle>
            <CardDescription>
              Verificando autentica√ß√£o...
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="flex items-center justify-center">
              <RefreshCw className="h-6 w-6 animate-spin" />
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background">
      {/* Auth Error Handler */}
      <AuthErrorHandler />
      
      {/* Header */}
      <div className="border-b">
        <div className="container mx-auto px-4 py-6">
          <div className="flex flex-col space-y-4">
          <div className="flex items-center justify-between">
            <div>
                <h1 className="text-3xl font-bold tracking-tight">üìä Dashboard do Administrador Geral</h1>
                <p className="text-muted-foreground">
                  Programa√ß√£o oficial das reuni√µes ministeriais - Padroniza√ß√£o mundial para todas as congrega√ß√µes
              </p>
            </div>
              <div className="flex items-center space-x-2">
              {/* Force Profile Load Button */}
              {import.meta.env.DEV && (
                <Button 
                  variant="outline" 
                  size="sm"
                    onClick={testSupabaseConnection}
                  >
                    üîß Test Supabase
                </Button>
              )}
              
              <Button onClick={checkForUpdates} disabled={loading}>
                <RefreshCw className={`h-4 w-4 mr-2 ${loading ? 'animate-spin' : ''}`} />
                  Atualizar
              </Button>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Debug Info Panel */}
      {import.meta.env.DEV && (
        <div className="container mx-auto px-4 py-2">
          <Card className="bg-yellow-50 border-yellow-200">
            <CardHeader className="pb-2">
              <CardTitle className="text-sm text-yellow-800">üêõ Debug Info (Development Only)</CardTitle>
            </CardHeader>
            <CardContent>
              <pre className="text-xs text-yellow-700 overflow-auto max-h-40">
                {debugInfo}
              </pre>
            </CardContent>
          </Card>
        </div>
      )}

      {/* Main Content */}
      <div className="container mx-auto px-4 py-6">
        <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
          <TabsList className="grid w-full grid-cols-4">
            <TabsTrigger value="overview">Vis√£o Geral</TabsTrigger>
            <TabsTrigger value="users">Usu√°rios</TabsTrigger>
            <TabsTrigger value="congregations">Congrega√ß√µes</TabsTrigger>
            <TabsTrigger value="system">Sistema</TabsTrigger>
          </TabsList>

          {/* Vis√£o Geral */}
          <TabsContent value="overview" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                üéØ Sistema Ministerial Global - Padroniza√ß√£o Mundial
              </h3>
              <div className="text-center text-sm text-muted-foreground mt-2 p-3 bg-blue-50 rounded-lg border border-blue-200">
                <strong>üìä Admin Geral:</strong> Disponibiliza programa√ß√£o oficial semanal (SEM nomes de estudantes) <br/>
                <strong>üéì Instrutores:</strong> Recebem programa√ß√£o automaticamente + fazem designa√ß√µes locais reais
              </div>
            </div>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Congrega√ß√µes Conectadas</CardTitle>
                  <Globe className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">{staticStats.total_congregations}</div>
                  <p className="text-xs text-muted-foreground">
                    Recebendo programa√ß√£o oficial
                  </p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Semanas Programadas</CardTitle>
                  <BarChart3 className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">12</div>
                  <p className="text-xs text-muted-foreground">
                    Pr√≥ximas 3 meses
                  </p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Idiomas Dispon√≠veis</CardTitle>
                  <Globe className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">2</div>
                  <p className="text-xs text-muted-foreground">
                    Portugu√™s e Ingl√™s
                  </p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">√öltima Sincroniza√ß√£o</CardTitle>
                  <RefreshCw className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">‚úÖ</div>
                  <p className="text-xs text-muted-foreground">
                    Hoje, {new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}
                  </p>
                </CardContent>
              </Card>
            </div>

            {/* A√ß√µes R√°pidas */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* Status do Sistema */}
              <Card>
                <CardHeader>
                  <CardTitle>Status do Sistema</CardTitle>
                  <CardDescription>
                    Informa√ß√µes sobre a √∫ltima verifica√ß√£o e status geral
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">√öltima Verifica√ß√£o:</span>
                    <span className="text-sm text-muted-foreground">
                      {lastCheck ? new Date(lastCheck).toLocaleString('pt-BR') : 'Nunca'}
                    </span>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Status:</span>
                    <Badge variant="outline" className="text-green-600">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Operacional
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Supabase:</span>
                    <Badge variant="outline" className="text-green-600">
                      <Database className="h-3 w-3 mr-1" />
                      Conectado
                    </Badge>
                  </div>
                </CardContent>
              </Card>

              {/* JW.org Downloads */}
              <Card className="bg-green-50 border-green-200">
                <CardHeader>
                  <CardTitle className="text-green-800">üìö JW.org Downloads</CardTitle>
                  <CardDescription className="text-green-700">
                    Gerenciar materiais oficiais
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Apostila MWB Atual:</span>
                    <Badge variant="outline" className="text-green-600">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Dispon√≠vel
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">√öltima verifica√ß√£o:</span>
                    <span className="text-sm text-green-700">Hoje, 10:30</span>
                  </div>
                  <div className="flex space-x-2">
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleMWBAvailable}>
                      <RefreshCw className="h-3 w-3 mr-1" />
                      Disponibilizar MWB Atual
                    </Button>
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleConfigureJWorgURLs}>
                      <Settings className="h-3 w-3 mr-1" />
                      Configurar URLs JW.org
                    </Button>
                  </div>
                </CardContent>
              </Card>

              {/* Sistema S-38 - Designa√ß√µes */}
              <Card className="bg-purple-50 border-purple-200">
                <CardHeader>
                  <CardTitle className="text-purple-800">‚öôÔ∏è Sistema S-38</CardTitle>
                  <CardDescription className="text-purple-700">
                    Estrutura das reuni√µes ministeriais
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="text-sm text-purple-700 space-y-2">
                    <p>üìö <strong>Fun√ß√£o do Admin:</strong> Disponibilizar apostilas MWB</p>
                    <p>üë• <strong>Para Instrutores:</strong> Designar estudantes para partes</p>
                    <p>üéØ <strong>Partes da Reuni√£o:</strong></p>
                    <div className="grid grid-cols-2 gap-1 text-xs ml-2">
                      <div>‚Ä¢ Chairman</div>
                      <div>‚Ä¢ Treasures</div>
                      <div>‚Ä¢ Gems</div>
                      <div>‚Ä¢ Reading</div>
                      <div>‚Ä¢ Starting</div>
                      <div>‚Ä¢ Following</div>
                      <div>‚Ä¢ Making</div>
                      <div>‚Ä¢ Explaining</div>
                      <div>‚Ä¢ Talk</div>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Debug / Integra√ß√£o */}
              <Card className="bg-slate-50 border-slate-200">
                <CardHeader>
                  <CardTitle className="text-slate-800">üß™ Debug / Integra√ß√£o</CardTitle>
                  <CardDescription className="text-slate-700">
                    Ferramentas r√°pidas para validar integra√ß√µes e idioma
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-3">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Idioma Atual:</span>
                    <Badge variant="outline" className="text-slate-700">
                      {(jworg as any)?.currentLanguage === 'en' ? 'üá∫üá∏ English' : 'üáßüá∑ Portugu√™s'}
                    </Badge>
                  </div>
                  <div className="flex flex-wrap gap-2">
                    <Button size="sm" variant="outline" onClick={toggleLanguage}>
                      Alternar Idioma
                    </Button>
                    <Button size="sm" variant="outline" onClick={updateMaterials}>
                      Atualizar Materiais
                    </Button>
                    <Button size="sm" variant="outline" onClick={handleTestJWorgIntegration}>
                      Testar Integra√ß√£o JW.org
                    </Button>
                    <Button size="sm" variant="outline" onClick={checkForUpdates} disabled={loading}>
                      Atualizar Contagens
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* Usu√°rios */}
          <TabsContent value="users" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                üë• Gest√£o de Usu√°rios para Acesso √†s Apostilas MWB
              </h3>
              <p className="text-center text-sm text-muted-foreground mt-2">
                üéØ Fun√ß√£o Principal: Admin gerencia usu√°rios ‚Üí Instrutores acessam apostilas
              </p>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* Estat√≠sticas de Usu√°rios */}
            <Card>
              <CardHeader>
                  <CardTitle>Estat√≠sticas</CardTitle>
                  <CardDescription>Resumo dos usu√°rios</CardDescription>
              </CardHeader>
                <CardContent>
                  <div className="space-y-4">
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Total de Usu√°rios:</span>
                      <Badge variant="outline">{staticStats.total_users}</Badge>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Admins:</span>
                      <Badge variant="outline" className="bg-red-50 text-red-700">
                        {isAdmin ? 1 : 0}
                      </Badge>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Instrutores:</span>
                      <Badge variant="outline" className="bg-blue-50 text-blue-700">
                        {staticStats.total_users - (isAdmin ? 1 : 0)}
                      </Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Usu√°rios Registrados */}
              <Card className="lg:col-span-2">
                <CardHeader>
                  <CardTitle>Usu√°rios Registrados</CardTitle>
                  <CardDescription>√öltimos usu√°rios cadastrados no sistema</CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-center justify-between p-3 border rounded-lg">
                      <div className="flex items-center space-x-3">
                        <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                          <Users className="h-5 w-5 text-blue-600" />
                        </div>
                        <div>
                          <p className="font-medium">{profile?.nome_completo || 'Roberto Araujo da Silva'}</p>
                          <p className="text-sm text-muted-foreground">Administrator</p>
                        </div>
                      </div>
                      <Badge variant="outline" className="bg-red-50 text-red-700">
                        Admin
                      </Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* A√ß√µes Administrativas */}
            <Card>
              <CardHeader>
                <CardTitle>A√ß√µes Administrativas</CardTitle>
                <CardDescription>
                  Gerenciar usu√°rios e permiss√µes
                </CardDescription>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <Button className="w-full justify-start" variant="outline" onClick={handleListUsers}>
                    <Users className="h-4 w-4 mr-2" />
                    Listar Todos os Usu√°rios
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleManagePermissions}>
                    <Settings className="h-4 w-4 mr-2" />
                    Gerenciar Permiss√µes
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleActivityReport}>
                    <Activity className="h-4 w-4 mr-2" />
                    Relat√≥rio de Atividades
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleBackupData}>
                    <Database className="h-4 w-4 mr-2" />
                    Backup de Dados
                  </Button>
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          {/* Congrega√ß√µes */}
          <TabsContent value="congregations" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                üè¢ Gest√£o de Congrega√ß√µes para Acesso √†s Apostilas MWB
              </h3>
              <p className="text-center text-sm text-muted-foreground mt-2">
                üéØ Fun√ß√£o Principal: Admin gerencia congrega√ß√µes ‚Üí Instrutores acessam apostilas
              </p>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* Estat√≠sticas de Congrega√ß√µes */}
            <Card>
              <CardHeader>
                  <CardTitle>Estat√≠sticas</CardTitle>
                  <CardDescription>Resumo das congrega√ß√µes</CardDescription>
              </CardHeader>
              <CardContent>
                  <div className="space-y-4">
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Total de Congrega√ß√µes:</span>
                      <Badge variant="outline">{staticStats.total_congregations}</Badge>
                  </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Congrega√ß√µes Ativas:</span>
                      <Badge variant="outline" className="bg-green-50 text-green-700">
                        {staticStats.active_congregations}
                      </Badge>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Total de Estudantes:</span>
                      <Badge variant="outline">{staticStats.total_estudantes}</Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Lista de Congrega√ß√µes */}
              <Card className="lg:col-span-2">
                <CardHeader>
                  <CardTitle>Congrega√ß√µes Registradas</CardTitle>
                  <CardDescription>Lista das congrega√ß√µes no sistema</CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-center justify-between p-3 border rounded-lg">
                      <div className="flex items-center space-x-3">
                        <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                          <Package className="h-5 w-5 text-blue-600" />
                        </div>
                        <div>
                          <p className="font-medium">Sistema Ministerial Global</p>
                          <p className="text-sm text-muted-foreground">Congrega√ß√£o Principal</p>
                          </div>
                        </div>
                      <Badge variant="outline" className="bg-green-50 text-green-700">
                        Ativa
                        </Badge>
                      </div>
                  </div>
                  
                  <div className="mt-4">
                    <Button variant="outline" className="w-full" onClick={() => handleManageCongregation('Sistema Ministerial Global')}>
                      <Users className="h-4 w-4 mr-2" />
                      Gerenciar
                    </Button>
                  </div>
                  
                  <div className="mt-4">
                    <Button variant="outline" className="w-full" onClick={handleAddCongregation}>
                      <Users className="h-4 w-4 mr-2" />
                      Adicionar Nova Congrega√ß√£o
                    </Button>
                  </div>
                  
                  <div className="mt-4">
                    <Button variant="outline" className="w-full">
                      <Users className="h-4 w-4 mr-2" />
                      Expandir
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* Sistema */}
          <TabsContent value="system" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                ‚öôÔ∏è Monitoramento e Configura√ß√µes do Sistema
              </h3>
              <p className="text-center text-sm text-muted-foreground mt-2">
                üéØ Fun√ß√£o Principal: Admin monitora sistema ‚Üí Instrutores recebem apostilas est√°veis
              </p>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* Downloads JW.org */}
              <Card className="bg-green-50 border-green-200">
              <CardHeader>
                  <CardTitle className="text-green-800">üìö JW.org Downloads</CardTitle>
                  <CardDescription className="text-green-700">
                    Gerenciar materiais oficiais
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Apostila MWB Atual:</span>
                    <Badge variant="outline" className="text-green-600">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Dispon√≠vel
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">√öltima verifica√ß√£o:</span>
                    <span className="text-sm text-green-700">Hoje, 10:30</span>
                  </div>
                  <div className="flex space-x-2">
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleSyncCongregations}>
                      <RefreshCw className="h-3 w-3 mr-1" />
                      Sincronizar com Congrega√ß√µes
                    </Button>
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleViewFullProgram}>
                      <Settings className="h-3 w-3 mr-1" />
                      Ver Programa√ß√£o Completa
                    </Button>
                </div>
              </CardContent>
            </Card>

              {/* Configura√ß√µes Gerais */}
            <Card>
              <CardHeader>
                  <CardTitle>Configura√ß√µes Gerais</CardTitle>
                <CardDescription>
                    Par√¢metros do sistema
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-4">
                    <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Backup Autom√°tico:</span>
                    <Badge variant="outline" className="bg-green-50 text-green-700">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Di√°rio √†s 02:00
                      </Badge>
                    </div>
                    <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Notifica√ß√µes:</span>
                    <Badge variant="outline" className="bg-blue-50 text-blue-700">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Email + Sistema
                    </Badge>
                    </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Manuten√ß√£o:</span>
                    <span className="text-sm text-muted-foreground">√öltima: Ontem</span>
                  </div>
                  <div className="flex space-x-2">
                    <Button size="sm" variant="outline">
                      <Settings className="h-3 w-3 mr-1" />
                      Configurar
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* M√©tricas do Sistema */}
            <Card>
              <CardHeader>
                <CardTitle>M√©tricas do Sistema</CardTitle>
                <CardDescription>
                  Monitoramento em tempo real
                </CardDescription>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-green-600">99.9%</p>
                    <p className="text-sm text-muted-foreground">Uptime</p>
                  </div>
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-blue-600">~120ms</p>
                    <p className="text-sm text-muted-foreground">Lat√™ncia</p>
                  </div>
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-green-600">25%</p>
                    <p className="text-sm text-muted-foreground">CPU</p>
                  </div>
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-blue-600">33%</p>
                    <p className="text-sm text-muted-foreground">Mem√≥ria</p>
                  </div>
                </div>

                <Separator />

                <div className="space-y-3">
                    <div className="flex items-center justify-between">
                    <span className="text-sm">CPU:</span>
                    <div className="flex items-center space-x-2">
                      <div className="w-24 h-2 bg-gray-200 rounded-full">
                        <div className="w-1/4 h-2 bg-green-500 rounded-full"></div>
                    </div>
                        <span className="text-sm">25%</span>
                  </div>
                    </div>
                    
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Mem√≥ria:</span>
                      <div className="flex items-center space-x-2">
                        <div className="w-24 h-2 bg-gray-200 rounded-full">
                          <div className="w-1/3 h-2 bg-blue-500 rounded-full"></div>
                    </div>
                        <span className="text-sm">33%</span>
                      </div>
                    </div>
                    
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Banco:</span>
                      <div className="flex items-center space-x-2">
                        <CheckCircle className="h-4 w-4 text-green-500" />
                        <span className="text-sm">Conectado</span>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>

              {/* Logs e Atividades */}
              <Card>
                <CardHeader>
                  <CardTitle>Logs Recentes</CardTitle>
                  <CardDescription>
                    √öltimas atividades do sistema
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <CheckCircle className="h-4 w-4 text-green-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Sistema iniciado</p>
                        <p className="text-xs text-muted-foreground">Hoje, 08:00</p>
                      </div>
                    </div>

                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <Activity className="h-4 w-4 text-blue-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Backup autom√°tico executado</p>
                        <p className="text-xs text-muted-foreground">Hoje, 02:00</p>
                      </div>
                    </div>

                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <Users className="h-4 w-4 text-green-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Novo usu√°rio registrado</p>
                        <p className="text-xs text-muted-foreground">Ontem, 16:30</p>
                      </div>
                    </div>

                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <AlertCircle className="h-4 w-4 text-yellow-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Manuten√ß√£o programada</p>
                        <p className="text-xs text-muted-foreground">Ontem, 03:00</p>
                      </div>
                    </div>
                  </div>

                  <div className="mt-4">
                    <Button variant="outline" className="w-full" onClick={handleViewAllLogs}>
                      <FileText className="h-4 w-4 mr-2" />
                      Ver Todos os Logs
                    </Button>
                  </div>
                </CardContent>
              </Card>
          </TabsContent>
        </Tabs>
      </div>
    </div>
  );
}

```

```typescriptreact
*** Begin Patch
*** Update File: src/pages/AdminDashboard.tsx
@@
           {/* A√ß√µes R√°pidas */}
           <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
@@
             </Card>
 
+            {/* Programa√ß√µes Publicadas */}
+            <Card>
+              <CardHeader>
+                <CardTitle>Programa√ß√µes Publicadas</CardTitle>
+                <CardDescription>
+                  √öltimas semanas importadas/publicadas
+                </CardDescription>
+              </CardHeader>
+              <CardContent>
+                {programsLoading ? (
+                  <div className="text-sm text-muted-foreground">Carregando...</div>
+                ) : programs.length === 0 ? (
+                  <div className="text-sm text-muted-foreground">Nenhuma programa√ß√£o encontrada.</div>
+                ) : (
+                  <div className="space-y-2">
+                    {programs.map((p) => (
+                      <div key={p.id} className="flex items-center justify-between p-2 border rounded-md">
+                        <div className="text-sm">
+                          <div className="font-medium">Semana {p.semana_iso} ‚Ä¢ {p.idioma?.toUpperCase?.() || '‚Äî'}</div>
+                          <div className="text-xs text-muted-foreground">
+                            {p.data_inicio ? new Date(p.data_inicio).toLocaleDateString('pt-BR') : '‚Äî'}
+                            {p.data_fim ? ` ‚Äî ${new Date(p.data_fim).toLocaleDateString('pt-BR')}` : ''}
+                          </div>
+                        </div>
+                        <Badge variant="outline" className={p.status === 'publicado' ? 'bg-green-50 text-green-700' : ''}>
+                          v{p.versao || 1} ‚Ä¢ {p.status || 'rascunho'}
+                        </Badge>
+                      </div>
+                    ))}
+                  </div>
+                )}
+              </CardContent>
+            </Card>
+
             {/* JW.org Downloads */}
             <Card className="bg-green-50 border-green-200">
*** End Patch
```

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo, lazy, Suspense } from 'react';
import { useAuth } from '../contexts/AuthContext';
import { supabase } from '../integrations/supabase/client';
import { useJWorgIntegration } from '../hooks/useJWorgIntegration';
import { JWorgTest } from '../components/JWorgTest';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../components/ui/card';
import LazyLoader from '../components/LazyLoader';
import AuthErrorHandler from '../components/AuthErrorHandler';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '../components/ui/tabs';
import { Button } from '../components/ui/button';
import { Badge } from '../components/ui/badge';
import { Separator } from '../components/ui/separator';
import { 
  Download, 
  Upload, 
  Globe, 
  BarChart3, 
  Settings, 
  RefreshCw,
  CheckCircle,
  AlertCircle,
  Clock,
  FileText,
  Users,
  Package,
  Activity,
  Database
} from 'lucide-react';

// üöÄ Lazy loading para componentes pesados (comentado por enquanto)
// const JWorgTestLazy = lazy(() => import('../components/JWorgTest'));

interface SystemStats {
  total_congregations: number;
  active_congregations: number;
  total_users: number;
  total_estudantes: number;
  total_programas: number;
  last_sync: string;
}

export default function AdminDashboard() {
  const { user, profile, isAdmin } = useAuth();
  const jworg = useJWorgIntegration();
  const [activeTab, setActiveTab] = useState('overview');
  const [loading, setLoading] = useState(false);
  const [systemStats, setSystemStats] = useState<SystemStats | null>(null);
  const [lastCheck, setLastCheck] = useState<string>('');
  const [debugInfo, setDebugInfo] = useState<string>('');
  const [showJWorgTest, setShowJWorgTest] = useState(false);
  const [programs, setPrograms] = useState<any[]>([]);
  const [programsLoading, setProgramsLoading] = useState<boolean>(false);

  // üöÄ Memoiza√ß√£o de dados est√°ticos para reduzir re-renders
  const staticStats = useMemo(() => ({
    total_congregations: systemStats?.total_congregations || 0,
    active_congregations: systemStats?.active_congregations || 0,
    total_users: systemStats?.total_users || 0,
    total_estudantes: systemStats?.total_estudantes || 0,
    total_programas: systemStats?.total_programas || 0,
    last_sync: systemStats?.last_sync || ''
  }), [systemStats]);

  // üöÄ Debounced function para reduzir chamadas desnecess√°rias
  const debouncedSetDebugInfo = useCallback((info: string) => {
    let timeoutId: NodeJS.Timeout;
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => setDebugInfo(info), 100);
  }, []);

  // DEBUG: Log component state (otimizado)
  useEffect(() => {
    const debugData = {
      user: !!user,
      userId: user?.id,
      userEmail: user?.email,
      profile: !!profile,
      profileRole: profile?.role,
      isAdmin,
      loading,
      userMetadata: user?.user_metadata
    };

    console.log('üîç AdminDashboard Component Debug:', debugData);
    debouncedSetDebugInfo(JSON.stringify(debugData, null, 2));
  }, [user, profile, isAdmin, loading, debouncedSetDebugInfo]);

  useEffect(() => {
    console.log('üîÑ AdminDashboard useEffect triggered:', { user, isAdmin });
    
    if (user && isAdmin) {
      console.log('‚úÖ Admin user detected, loading system data...');
      loadSystemData();
    } else if (user && !isAdmin) {
      console.log('‚ùå User is not admin, role:', profile?.role);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå User is not admin, role: ' + profile?.role);
    } else if (!user) {
      console.log('‚ùå No user found');
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå No user found');
    }
  }, [user, isAdmin, debouncedSetDebugInfo]);

  const loadSystemData = useCallback(async () => {
    if (!user || !isAdmin) {
      console.log('üö´ loadSystemData: User not admin or not logged in');
      return;
    }
    
    console.log('üîÑ Loading system data for admin...');
    setLoading(true);
    try {
      // Testar conex√£o com Supabase
      console.log('üîç Testing Supabase connection...');
      const { count: profilesCount, error: testError } = await supabase
        .from('profiles')
        .select('*', { count: 'exact', head: true });
      
      if (testError) {
        console.error('‚ùå Supabase connection test failed:', testError);
        debouncedSetDebugInfo(debugInfo + '\n\n‚ùå Supabase Test Failed: ' + testError.message);
        return;
      }

        console.log('‚úÖ Supabase connection test successful');
      debouncedSetDebugInfo(debugInfo + '\n\n‚úÖ Supabase Test: Connected');

      // Carregar estat√≠sticas do sistema
      await loadSystemStats();
      // Carregar programa√ß√µes publicadas
      await loadPrograms();

    } catch (error) {
      console.error('‚ùå Supabase test exception:', error);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå Supabase Test Exception: ' + error);
    } finally {
      setLoading(false);
    }
  }, [user, isAdmin, debouncedSetDebugInfo, debugInfo]);

  const loadSystemStats = useCallback(async () => {
    try {
      console.log('üìä Loading system statistics...');

      const [profilesRes, estudantesRes, programasRes, congregacoesRes] = await Promise.all([
        supabase.from('profiles').select('*', { count: 'exact', head: true }),
        supabase.from('estudantes').select('*', { count: 'exact', head: true }),
        supabase.from('programas').select('*', { count: 'exact', head: true }),
        supabase.from('congregacoes').select('*', { count: 'exact', head: true }),
      ]);

      const stats: SystemStats = {
        total_congregations: (congregacoesRes.count as number) || 0,
        active_congregations: (congregacoesRes.count as number) || 0,
        total_users: (profilesRes.count as number) || 0,
        total_estudantes: (estudantesRes.count as number) || 0,
        total_programas: (programasRes.count as number) || 0,
        last_sync: new Date().toISOString(),
      };

      setSystemStats(stats);
      setLastCheck(new Date().toISOString());

      console.log('‚úÖ System stats loaded:', stats);
      debouncedSetDebugInfo(debugInfo + '\n\n‚úÖ System Stats Loaded: ' + JSON.stringify(stats, null, 2));

    } catch (error) {
      console.error('‚ùå Error loading system stats:', error);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå System Stats Error: ' + error);
    }
  }, [debouncedSetDebugInfo, debugInfo]);

  const loadPrograms = useCallback(async () => {
    try {
      setProgramsLoading(true);
      const { data, error } = await supabase
        .from('programas')
        .select('id, semana_iso, idioma, status, versao, data_inicio, data_fim')
        .order('data_inicio', { ascending: false })
        .limit(12);
      if (error) throw error;
      setPrograms(data || []);
      console.log('‚úÖ Programs loaded:', data?.length || 0);
    } catch (error: any) {
      console.error('‚ùå Error loading programs:', error);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå Programs Load Error: ' + (error?.message || error));
    } finally {
      setProgramsLoading(false);
    }
  }, [debouncedSetDebugInfo, debugInfo]);

  const checkForUpdates = useCallback(async () => {
    console.log('üîÑ Checking for updates...');
    setLoading(true);
    
    try {
      await loadSystemStats();
      await loadPrograms();
      console.log('‚úÖ Updates checked successfully');
    } catch (error) {
      console.error('‚ùå Error checking updates:', error);
    } finally {
      setLoading(false);
    }
  }, [loadSystemStats]);

  const testSupabaseConnection = useCallback(async () => {
    console.log('üîß Testing Supabase connection...');
    
    try {
      const { count, error } = await supabase
        .from('profiles')
        .select('*', { count: 'exact', head: true });

      if (error) {
        console.error('‚ùå Supabase test error:', error);
        alert('Supabase test error: ' + error.message);
      } else {
        console.log('‚úÖ Supabase test successful. Profiles count:', count);
        alert('Supabase test successful! Total profiles: ' + (count ?? 0));
      }
    } catch (error) {
      console.error('‚ùå Supabase test exception:', error);
      alert('Supabase test exception: ' + error);
    }
  }, []);

  // ========== HANDLERS DOS BOT√ïES ==========
  
  const handleListUsers = useCallback(async () => {
    console.log('üë• Listando usu√°rios...');
    try {
      const { data: users, error } = await supabase
        .from('profiles')
        .select('id, nome_completo, role, congregacao, cargo')
        .order('nome_completo');
      
      if (error) throw error;
      
      console.log('‚úÖ Usu√°rios carregados:', users);
      alert(`Encontrados ${users?.length || 0} usu√°rios no sistema:\n\n${users?.map(u => `${u.nome_completo || u.id} - ${u.role} (${u.congregacao || 'N/A'})`).join('\n')}`);
    } catch (error) {
      console.error('‚ùå Erro ao listar usu√°rios:', error);
      alert('Erro ao carregar usu√°rios: ' + error.message);
    }
  }, []);

  const handleManagePermissions = useCallback(async () => {
    console.log('‚öôÔ∏è Gerenciando permiss√µes...');
    const newRole = prompt('Digite o novo role (admin, instrutor, estudante):');
    if (!newRole) return;
    
    // Validar role
    const validRoles = ['admin', 'instrutor', 'estudante', 'family_member', 'developer'];
    if (!validRoles.includes(newRole)) {
      alert('Role inv√°lido. Use: admin, instrutor, estudante, family_member ou developer');
      return;
    }
    
    const userId = prompt('Digite o ID do usu√°rio:');
    if (!userId) return;
    
    try {
      const { error } = await supabase
        .from('profiles')
        .update({ role: newRole as any })
        .eq('id', userId);
      
      if (error) throw error;
      
      console.log('‚úÖ Permiss√£o atualizada');
      alert('Permiss√£o atualizada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao atualizar permiss√£o:', error);
      alert('Erro ao atualizar permiss√£o: ' + error.message);
    }
  }, []);

  const handleActivityReport = useCallback(async () => {
    console.log('üìä Gerando relat√≥rio de atividades...');
    try {
      // Simula√ß√£o de relat√≥rio
      const report = {
        totalUsers: staticStats.total_users,
        totalCongregations: staticStats.total_congregations,
        lastUpdate: new Date().toLocaleString('pt-BR'),
        activeUsers: Math.floor(staticStats.total_users * 0.8)
      };
      
      alert(`üìä Relat√≥rio de Atividades:\n\n` +
            `‚Ä¢ Total de usu√°rios: ${report.totalUsers}\n` +
            `‚Ä¢ Usu√°rios ativos: ${report.activeUsers}\n` +
            `‚Ä¢ Total de congrega√ß√µes: ${report.totalCongregations}\n` +
            `‚Ä¢ √öltima atualiza√ß√£o: ${report.lastUpdate}`);
    } catch (error) {
      console.error('‚ùå Erro ao gerar relat√≥rio:', error);
      alert('Erro ao gerar relat√≥rio: ' + error.message);
    }
  }, [staticStats]);

  const handleBackupData = useCallback(async () => {
    console.log('üíæ Fazendo backup dos dados...');
    try {
      const { data: profiles, error: profilesError } = await supabase
        .from('profiles')
        .select('*');
      
      if (profilesError) throw profilesError;
      
      // Simular backup
      const backupData = {
        timestamp: new Date().toISOString(),
        profiles: profiles,
        stats: staticStats
      };
      
      const dataStr = JSON.stringify(backupData, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      
      const link = document.createElement('a');
      link.href = url;
      link.download = `backup_sistema_ministerial_${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      
      URL.revokeObjectURL(url);
      console.log('‚úÖ Backup criado com sucesso');
      alert('Backup criado e baixado com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao fazer backup:', error);
      alert('Erro ao fazer backup: ' + error.message);
    }
  }, [staticStats]);

  // Congrega√ß√µes
  const handleManageCongregation = useCallback((congregationName: string) => {
    console.log('üè¢ Gerenciando congrega√ß√£o:', congregationName);
    alert(`üè¢ Gerenciando congrega√ß√£o: ${congregationName}\n\nEsta funcionalidade abrir√° o painel de gerenciamento da congrega√ß√£o.`);
  }, []);

  const handleAddCongregation = useCallback(async () => {
    console.log('‚ûï Adicionando nova congrega√ß√£o...');
    const congregationName = prompt('Digite o nome da nova congrega√ß√£o:');
    if (!congregationName) return;
    
    try {
      // Simula√ß√£o - em produ√ß√£o seria inser√ß√£o no Supabase
      console.log('‚úÖ Congrega√ß√£o adicionada:', congregationName);
      alert(`‚úÖ Congrega√ß√£o "${congregationName}" adicionada com sucesso!\n\nEla agora receber√° automaticamente a programa√ß√£o oficial.`);
    } catch (error) {
      console.error('‚ùå Erro ao adicionar congrega√ß√£o:', error);
      alert('Erro ao adicionar congrega√ß√£o: ' + error.message);
    }
  }, []);

  // JW.org & S-38
  const handleMWBAvailable = useCallback(async () => {
    console.log('üìö Disponibilizando MWB atual...');
    try {
      await jworg.fetchCurrentWeek();
      console.log('‚úÖ MWB atualizada');
      alert('‚úÖ Apostila MWB atual disponibilizada para todas as congrega√ß√µes!');
    } catch (error) {
      console.error('‚ùå Erro ao disponibilizar MWB:', error);
      alert('Erro ao disponibilizar MWB: ' + error.message);
    }
  }, [jworg]);

  const handleConfigureJWorgURLs = useCallback(() => {
    console.log('‚öôÔ∏è Configurando URLs JW.org...');
    const ptUrl = prompt('URL JW.org PT:', 'https://www.jw.org/pt/biblioteca/jw-apostila-do-mes/');
    const enUrl = prompt('URL JW.org EN:', 'https://www.jw.org/en/library/jw-meeting-workbook/');
    
    if (ptUrl && enUrl) {
      console.log('‚úÖ URLs configuradas:', { ptUrl, enUrl });
      alert('‚úÖ URLs JW.org configuradas com sucesso!');
    }
  }, []);

  const handleSyncCongregations = useCallback(async () => {
    console.log('üîÑ Sincronizando com congrega√ß√µes...');
    try {
      // Simula√ß√£o de sincroniza√ß√£o
      const congregationsCount = staticStats.total_congregations;
      console.log(`‚úÖ Sincronizando com ${congregationsCount} congrega√ß√µes`);
      alert(`üîÑ Sincroniza√ß√£o iniciada!\n\nPrograma√ß√£o oficial sendo enviada para ${congregationsCount} congrega√ß√µes...\n\nTempo estimado: ${Math.ceil(congregationsCount / 100)} minutos`);
    } catch (error) {
      console.error('‚ùå Erro na sincroniza√ß√£o:', error);
      alert('Erro na sincroniza√ß√£o: ' + error.message);
    }
  }, [staticStats]);

  // Programa√ß√£o Oficial
  const handleViewFullProgram = useCallback(() => {
    console.log('üìÖ Visualizando programa√ß√£o completa (3 meses)...');
    alert(`üìÖ Programa√ß√£o Completa dos Pr√≥ximos 3 Meses\n\n` +
          `‚Ä¢ Semanas carregadas: 12\n` +
          `‚Ä¢ Idiomas: PT e EN\n` +
          `‚Ä¢ √öltima atualiza√ß√£o: Hoje\n\n` +
          `Esta visualiza√ß√£o mostrar√° todas as apostilas MWB dos pr√≥ximos 3 meses.`);
  }, []);

  const handleUpdateProgramPT = useCallback(async () => {
    console.log('üáßüá∑ Atualizando programa√ß√£o PT...');
    try {
      jworg.setLanguage('pt');
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Programa√ß√£o PT atualizada');
      alert('‚úÖ Programa√ß√£o em Portugu√™s atualizada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao atualizar programa√ß√£o PT:', error);
      alert('Erro ao atualizar programa√ß√£o PT: ' + error.message);
    }
  }, [jworg]);

  const handleUpdateProgramEN = useCallback(async () => {
    console.log('üá∫üá∏ Atualizando programa√ß√£o EN...');
    try {
      jworg.setLanguage('en');
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Programa√ß√£o EN atualizada');
      alert('‚úÖ Programa√ß√£o em Ingl√™s atualizada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao atualizar programa√ß√£o EN:', error);
      alert('Erro ao atualizar programa√ß√£o EN: ' + error.message);
    }
  }, [jworg]);

  const handleCheckNewWeeks = useCallback(async () => {
    console.log('üîç Verificando novas semanas...');
    try {
      await jworg.fetchNextWeeks();
      const newWeeks = jworg.nextWeeks.length;
      console.log(`‚úÖ Verifica√ß√£o conclu√≠da: ${newWeeks} semanas`);
      alert(`üîç Verifica√ß√£o conclu√≠da!\n\nEncontradas ${newWeeks} semanas de programa√ß√£o.\n\nTodas est√£o sincronizadas com JW.org.`);
    } catch (error) {
      console.error('‚ùå Erro ao verificar semanas:', error);
      alert('Erro ao verificar novas semanas: ' + error.message);
    }
  }, [jworg]);

  const handleUpdateS38Structure = useCallback(() => {
    console.log('üèóÔ∏è Atualizando estrutura S-38 global...');
    alert(`üèóÔ∏è Estrutura S-38 Global\n\n` +
          `‚úÖ Partes da reuni√£o atualizadas:\n` +
          `‚Ä¢ Chairman\n‚Ä¢ Treasures\n‚Ä¢ Gems\n‚Ä¢ Reading\n` +
          `‚Ä¢ Starting\n‚Ä¢ Following\n‚Ä¢ Making\n‚Ä¢ Explaining\n` +
          `‚Ä¢ Talk\n\n` +
          `Esta estrutura ser√° aplicada mundialmente.`);
  }, []);

  // JW.org Integration
  const handleReloadCurrentWeek = useCallback(async () => {
    console.log('üîÑ Recarregando semana atual...');
    try {
      await jworg.fetchCurrentWeek();
      console.log('‚úÖ Semana atual recarregada');
      alert('‚úÖ Semana atual recarregada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao recarregar semana:', error);
      alert('Erro ao recarregar semana: ' + error.message);
    }
  }, [jworg]);

  const handleReloadNextWeeks = useCallback(async () => {
    console.log('üìÖ Recarregando pr√≥ximas semanas...');
    try {
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Pr√≥ximas semanas recarregadas');
      alert('‚úÖ Pr√≥ximas semanas recarregadas com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao recarregar pr√≥ximas semanas:', error);
      alert('Erro ao recarregar pr√≥ximas semanas: ' + error.message);
    }
  }, [jworg]);

  const handleTestDownloadPT = useCallback(async () => {
    console.log('üß™ Testando download PT...');
    try {
      jworg.setLanguage('pt');
      await jworg.downloadWorkbook('pt', '07', '2025');
      console.log('‚úÖ Download PT testado');
      alert('‚úÖ Download PT testado com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro no teste de download PT:', error);
      alert('Erro no teste de download PT: ' + error.message);
    }
  }, [jworg]);

  // Monitoramento
  const handleViewAllLogs = useCallback(async () => {
    console.log('üìã Visualizando todos os logs...');
    try {
      // Simula√ß√£o de logs
      const logs = [
        { timestamp: new Date().toLocaleString(), event: 'Sistema iniciado', level: 'info' },
        { timestamp: new Date(Date.now() - 3600000).toLocaleString(), event: 'Backup autom√°tico executado', level: 'info' },
        { timestamp: new Date(Date.now() - 86400000).toLocaleString(), event: 'Novo usu√°rio registrado', level: 'info' },
        { timestamp: new Date(Date.now() - 172800000).toLocaleString(), event: 'Manuten√ß√£o programada', level: 'warning' }
      ];
      
      const logText = logs.map(log => `${log.timestamp} [${log.level.toUpperCase()}] ${log.event}`).join('\n');
      alert(`üìã Logs do Sistema\n\n${logText}`);
    } catch (error) {
      console.error('‚ùå Erro ao carregar logs:', error);
      alert('Erro ao carregar logs: ' + error.message);
    }
  }, []);

  const handleTestJWorgIntegration = useCallback(async () => {
    console.log('üß™ Testando integra√ß√£o JW.org...');
    try {
      await jworg.fetchCurrentWeek();
      console.log('‚úÖ Integra√ß√£o JW.org testada com sucesso');
      alert('‚úÖ Integra√ß√£o JW.org funcionando perfeitamente!');
    } catch (error) {
      console.error('‚ùå Erro na integra√ß√£o JW.org:', error);
      alert('‚ùå Erro na integra√ß√£o JW.org: ' + error.message);
    }
  }, [jworg]);

  const handleChangeLanguage = useCallback((newLang: 'pt' | 'en') => {
    jworg.setLanguage(newLang);
    console.log(`üåê Idioma alterado para: ${newLang}`);
    alert(`üåê Idioma alterado para: ${newLang === 'pt' ? 'Portugu√™s' : 'English'}`);
  }, [jworg]);

  // Alterna o idioma atual entre PT/EN
  const toggleLanguage = useCallback(() => {
    const current = (jworg as any)?.currentLanguage ?? 'pt';
    const next = current === 'pt' ? 'en' : 'pt';
    jworg.setLanguage(next);
    console.log(`üåê Idioma alternado: ${current} -> ${next}`);
    alert(`üåê Idioma alternado para: ${next === 'pt' ? 'Portugu√™s' : 'English'}`);
  }, [jworg]);

  // Atualiza materiais JW.org (semana atual + pr√≥ximas semanas)
  const updateMaterials = useCallback(async () => {
    try {
      await jworg.fetchCurrentWeek();
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Materiais JW.org atualizados');
      alert('‚úÖ Materiais JW.org atualizados com sucesso!');
    } catch (error: any) {
      console.error('‚ùå Erro ao atualizar materiais:', error);
      alert('‚ùå Erro ao atualizar materiais: ' + (error?.message || error));
    }
  }, [jworg]);

  // NOW CHECK CONDITIONS AND RENDER APPROPRIATELY
  // Se n√£o for admin, mostrar mensagem de acesso negado
  if (user && !isAdmin) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="max-w-md mx-auto">
          <CardHeader>
            <CardTitle className="text-red-600">Acesso Negado</CardTitle>
            <CardDescription>
              Voc√™ n√£o tem permiss√£o para acessar o painel administrativo.
            </CardDescription>
          </CardHeader>
          <CardContent>
            <p className="text-sm text-muted-foreground mb-4">
              Seu perfil atual: <strong>{profile?.role}</strong>
            </p>
            <Button onClick={() => window.history.back()}>
              Voltar
            </Button>
          </CardContent>
        </Card>
      </div>
    );
  }

  // Se n√£o houver usu√°rio, mostrar loading
  if (!user) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="max-w-md mx-auto">
          <CardHeader>
            <CardTitle>Carregando...</CardTitle>
            <CardDescription>
              Verificando autentica√ß√£o...
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="flex items-center justify-center">
              <RefreshCw className="h-6 w-6 animate-spin" />
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background">
      {/* Auth Error Handler */}
      <AuthErrorHandler />
      
      {/* Header */}
      <div className="border-b">
        <div className="container mx-auto px-4 py-6">
          <div className="flex flex-col space-y-4">
          <div className="flex items-center justify-between">
            <div>
                <h1 className="text-3xl font-bold tracking-tight">üìä Dashboard do Administrador Geral</h1>
                <p className="text-muted-foreground">
                  Programa√ß√£o oficial das reuni√µes ministeriais - Padroniza√ß√£o mundial para todas as congrega√ß√µes
              </p>
            </div>
              <div className="flex items-center space-x-2">
              {/* Force Profile Load Button */}
              {import.meta.env.DEV && (
                <Button 
                  variant="outline" 
                  size="sm"
                    onClick={testSupabaseConnection}
                  >
                    üîß Test Supabase
                </Button>
              )}
              
              <Button onClick={checkForUpdates} disabled={loading}>
                <RefreshCw className={`h-4 w-4 mr-2 ${loading ? 'animate-spin' : ''}`} />
                  Atualizar
              </Button>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Debug Info Panel */}
      {import.meta.env.DEV && (
        <div className="container mx-auto px-4 py-2">
          <Card className="bg-yellow-50 border-yellow-200">
            <CardHeader className="pb-2">
              <CardTitle className="text-sm text-yellow-800">üêõ Debug Info (Development Only)</CardTitle>
            </CardHeader>
            <CardContent>
              <pre className="text-xs text-yellow-700 overflow-auto max-h-40">
                {debugInfo}
              </pre>
            </CardContent>
          </Card>
        </div>
      )}

      {/* Main Content */}
      <div className="container mx-auto px-4 py-6">
        <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
          <TabsList className="grid w-full grid-cols-4">
            <TabsTrigger value="overview">Vis√£o Geral</TabsTrigger>
            <TabsTrigger value="users">Usu√°rios</TabsTrigger>
            <TabsTrigger value="congregations">Congrega√ß√µes</TabsTrigger>
            <TabsTrigger value="system">Sistema</TabsTrigger>
          </TabsList>

          {/* Vis√£o Geral */}
          <TabsContent value="overview" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                üéØ Sistema Ministerial Global - Padroniza√ß√£o Mundial
              </h3>
              <div className="text-center text-sm text-muted-foreground mt-2 p-3 bg-blue-50 rounded-lg border border-blue-200">
                <strong>üìä Admin Geral:</strong> Disponibiliza programa√ß√£o oficial semanal (SEM nomes de estudantes) <br/>
                <strong>üéì Instrutores:</strong> Recebem programa√ß√£o automaticamente + fazem designa√ß√µes locais reais
              </div>
            </div>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Congrega√ß√µes Conectadas</CardTitle>
                  <Globe className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">{staticStats.total_congregations}</div>
                  <p className="text-xs text-muted-foreground">
                    Recebendo programa√ß√£o oficial
                  </p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Semanas Programadas</CardTitle>
                  <BarChart3 className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">12</div>
                  <p className="text-xs text-muted-foreground">
                    Pr√≥ximas 3 meses
                  </p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Idiomas Dispon√≠veis</CardTitle>
                  <Globe className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">2</div>
                  <p className="text-xs text-muted-foreground">
                    Portugu√™s e Ingl√™s
                  </p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">√öltima Sincroniza√ß√£o</CardTitle>
                  <RefreshCw className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">‚úÖ</div>
                  <p className="text-xs text-muted-foreground">
                    Hoje, {new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}
                  </p>
                </CardContent>
              </Card>
            </div>

            {/* A√ß√µes R√°pidas */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* Status do Sistema */}
              <Card>
                <CardHeader>
                  <CardTitle>Status do Sistema</CardTitle>
                  <CardDescription>
                    Informa√ß√µes sobre a √∫ltima verifica√ß√£o e status geral
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">√öltima Verifica√ß√£o:</span>
                    <span className="text-sm text-muted-foreground">
                      {lastCheck ? new Date(lastCheck).toLocaleString('pt-BR') : 'Nunca'}
                    </span>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Status:</span>
                    <Badge variant="outline" className="text-green-600">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Operacional
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Supabase:</span>
                    <Badge variant="outline" className="text-green-600">
                      <Database className="h-3 w-3 mr-1" />
                      Conectado
                    </Badge>
                  </div>
                </CardContent>
              </Card>

              {/* Programa√ß√µes Publicadas */}
              <Card>
                <CardHeader>
                  <CardTitle>Programa√ß√µes Publicadas</CardTitle>
                  <CardDescription>
                    √öltimas semanas importadas/publicadas
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  {programsLoading ? (
                    <div className="text-sm text-muted-foreground">Carregando...</div>
                  ) : programs.length === 0 ? (
                    <div className="text-sm text-muted-foreground">Nenhuma programa√ß√£o encontrada.</div>
                  ) : (
                    <div className="space-y-2">
                      {programs.map((p) => (
                        <div key={p.id} className="flex items-center justify-between p-2 border rounded-md">
                          <div className="text-sm">
                            <div className="font-medium">Semana {p.semana_iso} ‚Ä¢ {p.idioma?.toUpperCase?.() || '‚Äî'}</div>
                            <div className="text-xs text-muted-foreground">
                              {p.data_inicio ? new Date(p.data_inicio).toLocaleDateString('pt-BR') : '‚Äî'}
                              {p.data_fim ? ` ‚Äî ${new Date(p.data_fim).toLocaleDateString('pt-BR')}` : ''}
                            </div>
                          </div>
                          <Badge variant="outline" className={p.status === 'publicado' ? 'bg-green-50 text-green-700' : ''}>
                            v{p.versao || 1} ‚Ä¢ {p.status || 'rascunho'}
                          </Badge>
                        </div>
                      ))}
                    </div>
                  )}
                </CardContent>
              </Card>

              {/* JW.org Downloads */}
              <Card className="bg-green-50 border-green-200">
                <CardHeader>
                  <CardTitle className="text-green-800">üìö JW.org Downloads</CardTitle>
                  <CardDescription className="text-green-700">
                    Gerenciar materiais oficiais
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Apostila MWB Atual:</span>
                    <Badge variant="outline" className="text-green-600">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Dispon√≠vel
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">√öltima verifica√ß√£o:</span>
                    <span className="text-sm text-green-700">Hoje, 10:30</span>
                  </div>
                  <div className="flex space-x-2">
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleMWBAvailable}>
                      <RefreshCw className="h-3 w-3 mr-1" />
                      Disponibilizar MWB Atual
                    </Button>
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleConfigureJWorgURLs}>
                      <Settings className="h-3 w-3 mr-1" />
                      Configurar URLs JW.org
                    </Button>
                  </div>
                </CardContent>
              </Card>

              {/* Sistema S-38 - Designa√ß√µes */}
              <Card className="bg-purple-50 border-purple-200">
                <CardHeader>
                  <CardTitle className="text-purple-800">‚öôÔ∏è Sistema S-38</CardTitle>
                  <CardDescription className="text-purple-700">
                    Estrutura das reuni√µes ministeriais
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="text-sm text-purple-700 space-y-2">
                    <p>üìö <strong>Fun√ß√£o do Admin:</strong> Disponibilizar apostilas MWB</p>
                    <p>üë• <strong>Para Instrutores:</strong> Designar estudantes para partes</p>
                    <p>üéØ <strong>Partes da Reuni√£o:</strong></p>
                    <div className="grid grid-cols-2 gap-1 text-xs ml-2">
                      <div>‚Ä¢ Chairman</div>
                      <div>‚Ä¢ Treasures</div>
                      <div>‚Ä¢ Gems</div>
                      <div>‚Ä¢ Reading</div>
                      <div>‚Ä¢ Starting</div>
                      <div>‚Ä¢ Following</div>
                      <div>‚Ä¢ Making</div>
                      <div>‚Ä¢ Explaining</div>
                      <div>‚Ä¢ Talk</div>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Debug / Integra√ß√£o */}
              <Card className="bg-slate-50 border-slate-200">
                <CardHeader>
                  <CardTitle className="text-slate-800">üß™ Debug / Integra√ß√£o</CardTitle>
                  <CardDescription className="text-slate-700">
                    Ferramentas r√°pidas para validar integra√ß√µes e idioma
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-3">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Idioma Atual:</span>
                    <Badge variant="outline" className="text-slate-700">
                      {(jworg as any)?.currentLanguage === 'en' ? 'üá∫üá∏ English' : 'üáßüá∑ Portugu√™s'}
                    </Badge>
                  </div>
                  <div className="flex flex-wrap gap-2">
                    <Button size="sm" variant="outline" onClick={toggleLanguage}>
                      Alternar Idioma
                    </Button>
                    <Button size="sm" variant="outline" onClick={updateMaterials}>
                      Atualizar Materiais
                    </Button>
                    <Button size="sm" variant="outline" onClick={handleTestJWorgIntegration}>
                      Testar Integra√ß√£o JW.org
                    </Button>
                    <Button size="sm" variant="outline" onClick={checkForUpdates} disabled={loading}>
                      Atualizar Contagens
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* Usu√°rios */}
          <TabsContent value="users" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                üë• Gest√£o de Usu√°rios para Acesso √†s Apostilas MWB
              </h3>
              <p className="text-center text-sm text-muted-foreground mt-2">
                üéØ Fun√ß√£o Principal: Admin gerencia usu√°rios ‚Üí Instrutores acessam apostilas
              </p>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* Estat√≠sticas de Usu√°rios */}
            <Card>
              <CardHeader>
                  <CardTitle>Estat√≠sticas</CardTitle>
                  <CardDescription>Resumo dos usu√°rios</CardDescription>
              </CardHeader>
                <CardContent>
                  <div className="space-y-4">
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Total de Usu√°rios:</span>
                      <Badge variant="outline">{staticStats.total_users}</Badge>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Admins:</span>
                      <Badge variant="outline" className="bg-red-50 text-red-700">
                        {isAdmin ? 1 : 0}
                      </Badge>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Instrutores:</span>
                      <Badge variant="outline" className="bg-blue-50 text-blue-700">
                        {staticStats.total_users - (isAdmin ? 1 : 0)}
                      </Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Usu√°rios Registrados */}
              <Card className="lg:col-span-2">
                <CardHeader>
                  <CardTitle>Usu√°rios Registrados</CardTitle>
                  <CardDescription>√öltimos usu√°rios cadastrados no sistema</CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-center justify-between p-3 border rounded-lg">
                      <div className="flex items-center space-x-3">
                        <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                          <Users className="h-5 w-5 text-blue-600" />
                        </div>
                        <div>
                          <p className="font-medium">{profile?.nome_completo || 'Roberto Araujo da Silva'}</p>
                          <p className="text-sm text-muted-foreground">Administrator</p>
                        </div>
                      </div>
                      <Badge variant="outline" className="bg-red-50 text-red-700">
                        Admin
                      </Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* A√ß√µes Administrativas */}
            <Card>
              <CardHeader>
                <CardTitle>A√ß√µes Administrativas</CardTitle>
                <CardDescription>
                  Gerenciar usu√°rios e permiss√µes
                </CardDescription>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <Button className="w-full justify-start" variant="outline" onClick={handleListUsers}>
                    <Users className="h-4 w-4 mr-2" />
                    Listar Todos os Usu√°rios
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleManagePermissions}>
                    <Settings className="h-4 w-4 mr-2" />
                    Gerenciar Permiss√µes
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleActivityReport}>
                    <Activity className="h-4 w-4 mr-2" />
                    Relat√≥rio de Atividades
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleBackupData}>
                    <Database className="h-4 w-4 mr-2" />
                    Backup de Dados
                  </Button>
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          {/* Congrega√ß√µes */}
          <TabsContent value="congregations" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                üè¢ Gest√£o de Congrega√ß√µes para Acesso √†s Apostilas MWB
              </h3>
              <p className="text-center text-sm text-muted-foreground mt-2">
                üéØ Fun√ß√£o Principal: Admin gerencia congrega√ß√µes ‚Üí Instrutores acessam apostilas
              </p>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* Estat√≠sticas de Congrega√ß√µes */}
            <Card>
              <CardHeader>
                  <CardTitle>Estat√≠sticas</CardTitle>
                  <CardDescription>Resumo das congrega√ß√µes</CardDescription>
              </CardHeader>
              <CardContent>
                  <div className="space-y-4">
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Total de Congrega√ß√µes:</span>
                      <Badge variant="outline">{staticStats.total_congregations}</Badge>
                  </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Congrega√ß√µes Ativas:</span>
                      <Badge variant="outline" className="bg-green-50 text-green-700">
                        {staticStats.active_congregations}
                      </Badge>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Total de Estudantes:</span>
                      <Badge variant="outline">{staticStats.total_estudantes}</Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Lista de Congrega√ß√µes */}
              <Card className="lg:col-span-2">
                <CardHeader>
                  <CardTitle>Congrega√ß√µes Registradas</CardTitle>
                  <CardDescription>Lista das congrega√ß√µes no sistema</CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-center justify-between p-3 border rounded-lg">
                      <div className="flex items-center space-x-3">
                        <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                          <Package className="h-5 w-5 text-blue-600" />
                        </div>
                        <div>
                          <p className="font-medium">Sistema Ministerial Global</p>
                          <p className="text-sm text-muted-foreground">Congrega√ß√£o Principal</p>
                          </div>
                        </div>
                      <Badge variant="outline" className="bg-green-50 text-green-700">
                        Ativa
                        </Badge>
                      </div>
                  </div>
                  
                  <div className="mt-4">
                    <Button variant="outline" className="w-full" onClick={() => handleManageCongregation('Sistema Ministerial Global')}>
                      <Users className="h-4 w-4 mr-2" />
                      Gerenciar
                    </Button>
                  </div>
                  
                  <div className="mt-4">
                    <Button variant="outline" className="w-full" onClick={handleAddCongregation}>
                      <Users className="h-4 w-4 mr-2" />
                      Adicionar Nova Congrega√ß√£o
                    </Button>
                  </div>
                  
                  <div className="mt-4">
                    <Button variant="outline" className="w-full">
                      <Users className="h-4 w-4 mr-2" />
                      Expandir
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* Sistema */}
          <TabsContent value="system" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                ‚öôÔ∏è Monitoramento e Configura√ß√µes do Sistema
              </h3>
              <p className="text-center text-sm text-muted-foreground mt-2">
                üéØ Fun√ß√£o Principal: Admin monitora sistema ‚Üí Instrutores recebem apostilas est√°veis
              </p>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* Downloads JW.org */}
              <Card className="bg-green-50 border-green-200">
              <CardHeader>
                  <CardTitle className="text-green-800">üìö JW.org Downloads</CardTitle>
                  <CardDescription className="text-green-700">
                    Gerenciar materiais oficiais
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Apostila MWB Atual:</span>
                    <Badge variant="outline" className="text-green-600">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Dispon√≠vel
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">√öltima verifica√ß√£o:</span>
                    <span className="text-sm text-green-700">Hoje, 10:30</span>
                  </div>
                  <div className="flex space-x-2">
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleSyncCongregations}>
                      <RefreshCw className="h-3 w-3 mr-1" />
                      Sincronizar com Congrega√ß√µes
                    </Button>
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleViewFullProgram}>
                      <Settings className="h-3 w-3 mr-1" />
                      Ver Programa√ß√£o Completa
                    </Button>
                </div>
              </CardContent>
            </Card>

              {/* Configura√ß√µes Gerais */}
            <Card>
              <CardHeader>
                  <CardTitle>Configura√ß√µes Gerais</CardTitle>
                <CardDescription>
                    Par√¢metros do sistema
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-4">
                    <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Backup Autom√°tico:</span>
                    <Badge variant="outline" className="bg-green-50 text-green-700">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Di√°rio √†s 02:00
                      </Badge>
                    </div>
                    <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Notifica√ß√µes:</span>
                    <Badge variant="outline" className="bg-blue-50 text-blue-700">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Email + Sistema
                    </Badge>
                    </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Manuten√ß√£o:</span>
                    <span className="text-sm text-muted-foreground">√öltima: Ontem</span>
                  </div>
                  <div className="flex space-x-2">
                    <Button size="sm" variant="outline">
                      <Settings className="h-3 w-3 mr-1" />
                      Configurar
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* M√©tricas do Sistema */}
            <Card>
              <CardHeader>
                <CardTitle>M√©tricas do Sistema</CardTitle>
                <CardDescription>
                  Monitoramento em tempo real
                </CardDescription>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-green-600">99.9%</p>
                    <p className="text-sm text-muted-foreground">Uptime</p>
                  </div>
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-blue-600">~120ms</p>
                    <p className="text-sm text-muted-foreground">Lat√™ncia</p>
                  </div>
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-green-600">25%</p>
                    <p className="text-sm text-muted-foreground">CPU</p>
                  </div>
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-blue-600">33%</p>
                    <p className="text-sm text-muted-foreground">Mem√≥ria</p>
                  </div>
                </div>

                <Separator />

                <div className="space-y-3">
                    <div className="flex items-center justify-between">
                    <span className="text-sm">CPU:</span>
                    <div className="flex items-center space-x-2">
                      <div className="w-24 h-2 bg-gray-200 rounded-full">
                        <div className="w-1/4 h-2 bg-green-500 rounded-full"></div>
                    </div>
                        <span className="text-sm">25%</span>
                  </div>
                    </div>
                    
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Mem√≥ria:</span>
                      <div className="flex items-center space-x-2">
                        <div className="w-24 h-2 bg-gray-200 rounded-full">
                          <div className="w-1/3 h-2 bg-blue-500 rounded-full"></div>
                    </div>
                        <span className="text-sm">33%</span>
                      </div>
                    </div>
                    
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Banco:</span>
                      <div className="flex items-center space-x-2">
                        <CheckCircle className="h-4 w-4 text-green-500" />
                        <span className="text-sm">Conectado</span>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>

              {/* Logs e Atividades */}
              <Card>
                <CardHeader>
                  <CardTitle>Logs Recentes</CardTitle>
                  <CardDescription>
                    √öltimas atividades do sistema
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <CheckCircle className="h-4 w-4 text-green-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Sistema iniciado</p>
                        <p className="text-xs text-muted-foreground">Hoje, 08:00</p>
                      </div>
                    </div>

                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <Activity className="h-4 w-4 text-blue-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Backup autom√°tico executado</p>
                        <p className="text-xs text-muted-foreground">Hoje, 02:00</p>
                      </div>
                    </div>

                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <Users className="h-4 w-4 text-green-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Novo usu√°rio registrado</p>
                        <p className="text-xs text-muted-foreground">Ontem, 16:30</p>
                      </div>
                    </div>

                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <AlertCircle className="h-4 w-4 text-yellow-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Manuten√ß√£o programada</p>
                        <p className="text-xs text-muted-foreground">Ontem, 03:00</p>
                      </div>
                    </div>
                  </div>

                  <div className="mt-4">
                    <Button variant="outline" className="w-full" onClick={handleViewAllLogs}>
                      <FileText className="h-4 w-4 mr-2" />
                      Ver Todos os Logs
                    </Button>
                  </div>
                </CardContent>
              </Card>
          </TabsContent>
        </Tabs>
      </div>
    </div>
  );
}

```

Adicionei no `AdminDashboard`:
- Carregamento dos programas do Supabase (`loadPrograms`) e atualiza√ß√£o em `checkForUpdates`.
- Novo Card ‚ÄúPrograma√ß√µes Publicadas‚Äù na aba ‚ÄúVis√£o Geral‚Äù listando as √∫ltimas semanas (idioma, per√≠odo, vers√£o e status).

Se quiser, posso adicionar link para abrir os detalhes da semana ou filtrar por idioma/status.

---

**User**

para o dashboard do Instrutor vamos simular Our Christian Life and Ministry Meeting Schedule

Bible Chapters PROVERBS 29

	Chairman	Geoff Holt	7.00
5 min	Song 28 and prayer	Andy Holt	7.00-7.05
1 min	Opening Comments	Geoff Holt	7.05-7.06

10 min	Treasures From Gode Word
1. Reject Unscrlptural Beliefs and Customs	
Jason O'Brien	
7.06-7.16
10 min	2. Spiritual Gems	Mick Shepherd	7.16-7.26
4 min	3. Bible Reading Pr 29:1-18 (th study 5)	Patrick Keane	7.26-7.30
3 min	4. INFORMAL. Invite the person to the upcoming special talk	Alpa Parmar	7.30-7.33

4 min	Assistant	(tmd lesson 2 point 3)
5.  SE TOHSE. Use The WB/ebb No. 1 2025 to staA a conversation	Sharon De-Lima
Mary Salter	
7.34-7.38

5 min	Assistant	(Irnd lesson 3 point 3)
6. iNFORMAL Qfer 7heWb/chto+er No.1 2025 wla expresses comm of war	Karen Moore
Tim Beasley	
7.39-7.44
	Assistant	(/md lesson 3 point 4)	Andy Holt	
	Song 159		7.45-7.50
15 min	7. Local Needs GB UPDATE 5	Geoff Holt	7.50-8.05
30 min	8. Cong Bible Study //b intro to section 4 and lessons 14-15	John Ricketts	8.05-8.35
	Reader	Tom Bott	
3 min	Concluding Comments	Geoff Holt	8.35-8.38
5 min	Song 31 and Prayer	Jason O'Brien	8.45


Bible Chapters PROVERBS 30

	Chairman	David Newby	7.00
5 min	Song 136 and prayer	Jacob Ash	7.00-7.05
1 min	Opening Comments	David Newby	7.05-7.06

10 min	Treasures From Gods Word
1. "Give Me Neither Poverty NOF Riches‚Äù	
Jacob Ash	
7.06-7.16
10 min
4 min	2.	Spiritual Gems
3.	Bible Reading Pr 30:1-14 [th study 2)	John Ricketts
Frank DeLima	7.16-7.26
7.26-7.30

 
4 min	4. HSE TO HSE. Use roeWatchtowm No.1 2D25 to start a conversation Assistant	(/md lesson 1 point 3)
 
Aurelija Williams	7.30-7.34
Debra Kimberly-Frost
 
4 min	5. PUBLIC WITNESSING. (Imd lesson 9 point 3) Assistant
4 min	6. Talk. ij\vdq article 102‚ÄîTheme: Is Gambling a Sin‚Ä†
th study ')

Song 80
{jj jj j	7 oo got ge y/rygay jrnfzett sPeece/‚Ä¢-th/6/eeSoaz‚Ä∫an7
1	yj{}		@ gg) @gfig) flfifiOM@[]BhM8NM fOP @B@@M	F 3o min	9. Congregation Bible Study //b lessons 16-17
Reader
Concluding Comments 5 min	Song 128 and Prayer
 
Timea Kremer Jasmina Ash Kiel Juby



Terry Moore David Newby Joe Green Andy O'Brien David Newby Kiel Juby
 
7.35-7.39

7.40-7.44


7.45-7.50
7.50-7.55

8.05-8.35

8.35-8.38
8.45
 
 


Bible Chapters PROVERBS 31

	Chairman	Andy O'B√ªen	7.00
5 min	Song 135 and prayer	Tim Beasley	7.00-7.05
1 min	Opening Comments	Andy O'B√ªen	7.05-7.06
	Treasures From Gods Word		
10 min	1. Lessons From a MoQer's Loving lnstruc√©ons	Tim Beasley	7.06-7.16
10 min	2. Spiritual Gems	Stuart Frost	7.16-7.26
4 min	3. Bible Reading Pr 31:1&31 {Ill s&dy 10)	David Newby snr	7.26-7.30

 
3 milk	4.lNFORMALIn"‚Äπtiate conversation after someone is kind someway	Jasmina Ash
Assistant	;/md lesson 5 point 3)	Jayne O'Brien
4 min	5.HSE TO HSE. Shae one of the Tru1hs We Love D Teach"	Tamara Green
Assistant	apperzlix A EaveUp/e brochure. [lmd lesson 1 point 4)	Alpa Parl+laf
5 min	6. HSE TO HSE lwite who accepted W‚Äôafchf‚ÄπxvwNo.1 2025 to specialialk	Stuart Frost
ASSiStant	(/md lesson 7 point 4)	Nathan Frost
 
7.30-7.33

7.34-7.38

7.39-7.44
 
Song 121	7.45-7.50
15 min	7. Help Your Chlldren D Use Electronlc Devlces Wisely	Tom Bott	7.50-8.05
30 min	8. Congregation Bible Study Ifb lessons 18-19	Mick Shepherd	8.05-8.35
Reader	Joe Green
 
3.min	Concluding Comments	Andy O'Brien
5.min	Song 2 and Prayer	Tom Bolt


Bible Chapters ECCLESIASTES 1-2
 
8.35-8.38
8.45
 

	Chairman	Joe Green	7.00
5 min	Song 103 and prayer	Kiel Juby	7.00-7.05
1 min	Opening Comments	Joe Green	7.05-7.06
	Treasures From Gods Word-
 		
10 min	1. Conflnue @ Train &e Next Generaflon	Kiel Juby	7.06-7.16
10 min	2. SpirituaC Gems	Terry Moore	7.16-7.2b
4 min	3. Bible Reading Ec 1:1-18 (th s&dy 11)	Stua√õ Frost	7.26-7.30
2 m√è0	4. INFORMAL Flr√≥ what interests the person. Arrange to contact again	Geofi Holt	7.30-7.32
	Assistant	(/md lesson 3 point 5)	Tyler O'Brien	
√ú fTi√è0	.PUBLIC Share alruths We Love to Teach' using method In appendix A	Serena Bott	7.33-7.35
	ASS√çSt√†Flt	Love Pecp/s brochure. (Imd lesson 2 point 3)	Michaela Juby	
2 lNIII	6. INFORMAL Answer question the person ralsed dunng previous conversation
Assistant	(i√Ü lesson 9 point 5)	Agrita PauCe
Aurelija Williams	7.36-7.38
 
5 min	PUBLIC Demo a Bible study, make arrangements to ≈ìn√¥nue..	Terry Larder
√ÇSS√èSt√§Ot	(/md lesson 10 point 3)	Mary Salter

Song 84
 
7.39-7.44


7.45-7.50
 
15 min	7. Three Important Lessons About Training
30 min	8. Congregation Bible Study f6 lesaons 021
Reader
 
Jason O'Brien	7.so-g.os
Andy O'Brien	8.05-8.35
Jacob Ash
 
3 mln	Concluding Comments 5 mln	 Song 148 and Prayer
 
Joe Green Terry Moore
 
8.35-8.38
8.45


---

**Cursor**

Perfeito. Vou preparar uma simula√ß√£o pronta para o Dashboard do Instrutor usando um √∫nico objeto de ‚Äúprograma√ß√£o da semana‚Äù com as partes j√° mapeadas conforme o S‚Äë38, usando seus exemplos (Prov√©rbios 29, 30, 31 e in√≠cio de Eclesiastes). Assim voc√™ pode visualizar imediatamente no front sem depender do parser.

Proponho este formato de dados (JSON) para fixture local:
- programa: identifica a semana, cap√≠tulo base e idioma
- partes: entrada por ordem, com tipo, se√ß√£o, minutagem, elegibilidade, participantes e hor√°rio

Coloque este arquivo em public/templates/schedule-instructor-sample.json e eu ligo no painel do instrutor depois.

Exemplo de fixture (recorte com 1 semana completa e mais duas resumidas):
```json
{
  "programas": [
    {
      "id": "week-prov-29",
      "semana_iso": "2025-W35",
      "idioma": "en",
      "capitulo_biblico": "Proverbs 29",
      "data_inicio": "2025-08-25",
      "data_fim": "2025-08-31",
      "partes": [
        { "ordem": 0, "secao": "opening", "tipo": "chairman", "titulo": "Chairman", "tempo_min": 0, "elegibilidade": "elder_or_ms", "designado": "Geoff Holt", "horario": "19:00" },
        { "ordem": 1, "secao": "opening", "tipo": "song_prayer", "titulo": "Song 28 and prayer", "tempo_min": 5, "elegibilidade": "elder_or_ms", "designado": "Andy Holt", "horario": "19:00-19:05" },
        { "ordem": 2, "secao": "opening", "tipo": "comments", "titulo": "Opening Comments", "tempo_min": 1, "elegibilidade": "elder_or_ms", "designado": "Geoff Holt", "horario": "19:05-19:06" },

        { "ordem": 3, "secao": "treasures", "tipo": "talk", "titulo": "Reject Unscrip¬≠tural Beliefs and Customs", "tempo_min": 10, "elegibilidade": "elder_or_ms", "designado": "Jason O'Brien", "horario": "19:06-19:16" },
        { "ordem": 4, "secao": "treasures", "tipo": "qna", "titulo": "Spiritual Gems", "tempo_min": 10, "elegibilidade": "elder_or_ms", "designado": "Mick Shepherd", "horario": "19:16-19:26" },
        { "ordem": 5, "secao": "treasures", "tipo": "reading", "titulo": "Bible Reading Pr 29:1-18 (th study 5)", "tempo_min": 4, "elegibilidade": "male_student", "designado": "Patrick Keane", "horario": "19:26-19:30" },

        { "ordem": 6, "secao": "apply", "tipo": "demo", "settings": "informal", "titulo": "Invite the person to the upcoming special talk", "tempo_min": 3, "elegibilidade": "male_or_female", "designado": "Alpa Parmar", "assistant": null, "horario": "19:30-19:33" },

        { "ordem": 7, "secao": "apply", "tipo": "demo", "settings": "house_to_house", "titulo": "Use The Watchtower/Workbook No.1 2025 to start a conversation", "tempo_min": 4, "elegibilidade": "same_gender_with_assistant_or_family", "designado": "Sharon De‚ÄëLima", "assistant": "Mary Salter", "observacoes": "tmd lesson 2 point 3", "horario": "19:34-19:38" },

        { "ordem": 8, "secao": "apply", "tipo": "demo", "settings": "informal", "titulo": "Offer The Watchtower/Chapter No.1 2025 when the person expresses concern", "tempo_min": 5, "elegibilidade": "same_gender_with_assistant", "designado": "Karen Moore", "assistant": "Tim Beasley", "observacoes": "lmd lesson 3 point 3/4", "horario": "19:39-19:44" },

        { "ordem": 9, "secao": "transition", "tipo": "song", "titulo": "Song 159", "tempo_min": 5, "elegibilidade": "n/a", "designado": null, "horario": "19:45-19:50" },

        { "ordem": 10, "secao": "living", "tipo": "local_needs", "titulo": "Local Needs GB UPDATE 5", "tempo_min": 15, "elegibilidade": "elder", "designado": "Geoff Holt", "horario": "19:50-20:05" },
        { "ordem": 11, "secao": "cbs", "tipo": "study", "titulo": "Congregation Bible Study //b intro to section 4 and lessons 14-15", "tempo_min": 30, "elegibilidade": "qualified_elder", "designado": "John Ricketts", "reader": "Tom Bott", "horario": "20:05-20:35" },

        { "ordem": 12, "secao": "closing", "tipo": "comments", "titulo": "Concluding Comments", "tempo_min": 3, "elegibilidade": "elder_or_ms", "designado": "Geoff Holt", "horario": "20:35-20:38" },
        { "ordem": 13, "secao": "closing", "tipo": "song_prayer", "titulo": "Song 31 and Prayer", "tempo_min": 5, "elegibilidade": "elder_or_ms", "designado": "Jason O'Brien", "horario": "20:45" }
      ]
    },

    {
      "id": "week-prov-30",
      "semana_iso": "2025-W36",
      "idioma": "en",
      "capitulo_biblico": "Proverbs 30",
      "resumo": [
        { "secao": "opening", "items": ["Chairman David Newby", "Song 136 and prayer Jacob Ash", "Opening Comments"] },
        { "secao": "treasures", "items": ["Talk: Give Me Neither Poverty Nor Riches ‚Äî Jacob Ash", "Spiritual Gems", "Bible Reading Pr 30:1-14 ‚Äî Frank DeLima"] },
        { "secao": "apply", "items": ["HSE TO HSE start a conversation (assistant Debra K-Frost)", "PUBLIC WITNESSING (lesson 9 pt3)", "Talk: Is Gambling a Sin?"] },
        { "secao": "living", "items": ["Song 80", "Congregation Bible Study lessons 16-17", "Concluding Comments", "Song 128 and Prayer"] }
      ]
    },

    {
      "id": "week-prov-31",
      "semana_iso": "2025-W37",
      "idioma": "en",
      "capitulo_biblico": "Proverbs 31",
      "resumo": [
        { "secao": "opening", "items": ["Chairman Andy O'Brien", "Song 135 and prayer Tim Beasley", "Opening Comments"] },
        { "secao": "treasures", "items": ["Lessons From a Mother's Loving Instructions ‚Äî Tim Beasley", "Spiritual Gems ‚Äî Stuart Frost", "Bible Reading Pr 31:1-31 ‚Äî David Newby sr"] },
        { "secao": "apply", "items": ["INFORMAL initiate conversation after kindness (assistant Jayne O'Brien)", "HSE TO HSE share Truths We Love", "HSE TO HSE invite to special talk (assistant Nathan Frost)"] },
        { "secao": "living", "items": ["Song 121", "Help Your Children Use Electronic Devices Wisely ‚Äî Tom Bott", "CBS lessons 18-19", "Concluding Comments", "Song 2 and Prayer"] }
      ]
    }
  ]
}
```

Como usar no Dashboard do Instrutor
- Passo 1: salvar o JSON em public/templates/schedule-instructor-sample.json.
- Passo 2: no painel do Instrutor, criar um carregamento de ‚ÄúPrograma√ß√£o de exemplo‚Äù quando n√£o houver dados ou via bot√£o ‚ÄúImportar exemplo‚Äù, que:
  - l√™ o JSON,
  - popula a lista de semanas,
  - abre a semana para exibir as partes com tempo, tipo, elegibilidade e designados.

Se preferir, eu j√° implemento:
- Bot√£o ‚ÄúCarregar exemplo‚Äù no Dashboard do Instrutor.
- Lista das semanas (W35, W36, W37).
- Tela de detalhes da semana ‚ÄúProverbs 29‚Äù com as partes em ordem, badges de se√ß√£o, tempo e valida√ß√µes de elegibilidade (leitura b√≠blica masculino, etc.).

Quer que eu crie o arquivo JSON agora e ligue o bot√£o ‚ÄúCarregar exemplo‚Äù no painel do Instrutor?

```json
{
  "programas": [
    {
      "id": "week-prov-29",
      "semana_iso": "2025-W35",
      "idioma": "en",
      "capitulo_biblico": "Proverbs 29",
      "data_inicio": "2025-08-25",
      "data_fim": "2025-08-31",
      "partes": [
        { "ordem": 0, "secao": "opening", "tipo": "chairman", "titulo": "Chairman", "tempo_min": 0, "elegibilidade": "elder_or_ms", "designado": "Geoff Holt", "horario": "19:00" },
        { "ordem": 1, "secao": "opening", "tipo": "song_prayer", "titulo": "Song 28 and prayer", "tempo_min": 5, "elegibilidade": "elder_or_ms", "designado": "Andy Holt", "horario": "19:00-19:05" },
        { "ordem": 2, "secao": "opening", "tipo": "comments", "titulo": "Opening Comments", "tempo_min": 1, "elegibilidade": "elder_or_ms", "designado": "Geoff Holt", "horario": "19:05-19:06" },

        { "ordem": 3, "secao": "treasures", "tipo": "talk", "titulo": "Reject Unscrip¬≠tural Beliefs and Customs", "tempo_min": 10, "elegibilidade": "elder_or_ms", "designado": "Jason O'Brien", "horario": "19:06-19:16" },
        { "ordem": 4, "secao": "treasures", "tipo": "qna", "titulo": "Spiritual Gems", "tempo_min": 10, "elegibilidade": "elder_or_ms", "designado": "Mick Shepherd", "horario": "19:16-19:26" },
        { "ordem": 5, "secao": "treasures", "tipo": "reading", "titulo": "Bible Reading Pr 29:1-18 (th study 5)", "tempo_min": 4, "elegibilidade": "male_student", "designado": "Patrick Keane", "horario": "19:26-19:30" },

        { "ordem": 6, "secao": "apply", "tipo": "demo", "settings": "informal", "titulo": "Invite the person to the upcoming special talk", "tempo_min": 3, "elegibilidade": "male_or_female", "designado": "Alpa Parmar", "assistant": null, "horario": "19:30-19:33" },

        { "ordem": 7, "secao": "apply", "tipo": "demo", "settings": "house_to_house", "titulo": "Use The Watchtower/Workbook No.1 2025 to start a conversation", "tempo_min": 4, "elegibilidade": "same_gender_with_assistant_or_family", "designado": "Sharon De‚ÄëLima", "assistant": "Mary Salter", "observacoes": "tmd lesson 2 point 3", "horario": "19:34-19:38" },

        { "ordem": 8, "secao": "apply", "tipo": "demo", "settings": "informal", "titulo": "Offer The Watchtower/Chapter No.1 2025 when the person expresses concern", "tempo_min": 5, "elegibilidade": "same_gender_with_assistant", "designado": "Karen Moore", "assistant": "Tim Beasley", "observacoes": "lmd lesson 3 point 3/4", "horario": "19:39-19:44" },

        { "ordem": 9, "secao": "transition", "tipo": "song", "titulo": "Song 159", "tempo_min": 5, "elegibilidade": "n/a", "designado": null, "horario": "19:45-19:50" },

        { "ordem": 10, "secao": "living", "tipo": "local_needs", "titulo": "Local Needs GB UPDATE 5", "tempo_min": 15, "elegibilidade": "elder", "designado": "Geoff Holt", "horario": "19:50-20:05" },
        { "ordem": 11, "secao": "cbs", "tipo": "study", "titulo": "Congregation Bible Study //b intro to section 4 and lessons 14-15", "tempo_min": 30, "elegibilidade": "qualified_elder", "designado": "John Ricketts", "reader": "Tom Bott", "horario": "20:05-20:35" },

        { "ordem": 12, "secao": "closing", "tipo": "comments", "titulo": "Concluding Comments", "tempo_min": 3, "elegibilidade": "elder_or_ms", "designado": "Geoff Holt", "horario": "20:35-20:38" },
        { "ordem": 13, "secao": "closing", "tipo": "song_prayer", "titulo": "Song 31 and Prayer", "tempo_min": 5, "elegibilidade": "elder_or_ms", "designado": "Jason O'Brien", "horario": "20:45" }
      ]
    },

    {
      "id": "week-prov-30",
      "semana_iso": "2025-W36",
      "idioma": "en",
      "capitulo_biblico": "Proverbs 30",
      "resumo": [
        { "secao": "opening", "items": ["Chairman David Newby", "Song 136 and prayer Jacob Ash", "Opening Comments"] },
        { "secao": "treasures", "items": ["Talk: Give Me Neither Poverty Nor Riches ‚Äî Jacob Ash", "Spiritual Gems", "Bible Reading Pr 30:1-14 ‚Äî Frank DeLima"] },
        { "secao": "apply", "items": ["HSE TO HSE start a conversation (assistant Debra K-Frost)", "PUBLIC WITNESSING (lesson 9 pt3)", "Talk: Is Gambling a Sin?"] },
        { "secao": "living", "items": ["Song 80", "Congregation Bible Study lessons 16-17", "Concluding Comments", "Song 128 and Prayer"] }
      ]
    },

    {
      "id": "week-prov-31",
      "semana_iso": "2025-W37",
      "idioma": "en",
      "capitulo_biblico": "Proverbs 31",
      "resumo": [
        { "secao": "opening", "items": ["Chairman Andy O'Brien", "Song 135 and prayer Tim Beasley", "Opening Comments"] },
        { "secao": "treasures", "items": ["Lessons From a Mother's Loving Instructions ‚Äî Tim Beasley", "Spiritual Gems ‚Äî Stuart Frost", "Bible Reading Pr 31:1-31 ‚Äî David Newby sr"] },
        { "secao": "apply", "items": ["INFORMAL initiate conversation after kindness (assistant Jayne O'Brien)", "HSE TO HSE share Truths We Love", "HSE TO HSE invite to special talk (assistant Nathan Frost)"] },
        { "secao": "living", "items": ["Song 121", "Help Your Children Use Electronic Devices Wisely ‚Äî Tom Bott", "CBS lessons 18-19", "Concluding Comments", "Song 2 and Prayer"] }
      ]
    }
  ]
}
```

---

**User**

PS C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte> npm run dev:all
npm warn config optional Use `--omit=optional` to exclude optional dependencies, or
npm warn config `--include=optional` to include them.
npm warn config
npm warn config       Default value does install optional deps unless otherwise omitted.
npm error code EJSONPARSE
npm error JSON.parse Invalid package.json: JSONParseError: Expected ',' or '}' after property value in JSON at position 5919 (line 80 column 5) while parsing near "...m run analyze\"\r\n    \"agents:log\": \"node ..."
npm error JSON.parse Failed to parse JSON data.
npm error JSON.parse Note: package.json must be actual JSON, not just JavaScript.
npm error A complete log of this run can be found in: C:\Users\frank.MONITORE-MAFRA\AppData\Local\npm-cache\_logs\2025-09-08T12_11_16_986Z-debug-0.log
PS C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte> 


---

**Cursor**

Vou abrir o package.json para corrigir o erro de JSON inv√°lido e ajustar a se√ß√£o de scripts.

Vou corrigir o JSON inv√°lido adicionando a v√≠rgula faltante entre os scripts em `package.json`. Em seguida, voc√™ pode rodar novamente `npm run dev:all`.

```json
{
  "name": "vite_react_shadcn_ts",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "dev:all": "concurrently \"npm run dev:backend\" \"npm run dev:frontend\"",
    "dev:backend": "cd backend && npm run dev",
    "dev:frontend": "vite",
    "dev:backend-only": "cd backend && npm run dev",
    "dev:frontend-only": "vite",
    "build": "vite build",
    "build:prod": "vite build --config vite.config.prod.ts",
    "build:analyze": "vite build --config vite.config.prod.ts && npm run analyze",
    "analyze": "npx vite-bundle-analyzer dist",
    "build:dev": "vite build --mode development",
    "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "typecheck": "tsc -p tsconfig.json",
    "preview": "vite preview",
    "start": "serve -s dist -l $PORT",
    "cypress:open": "cypress open",
    "cypress:run": "cypress run",
    "cypress:install": "cypress install",
    "cypress:verify": "cypress verify",
    "test:e2e": "cypress run --spec \"cypress/e2e/**/*.cy.ts\"",
    "test:e2e:open": "cypress open",
    "test:e2e:record": "cypress run --record",
    "test:franklin": "cypress run --spec \"cypress/e2e/franklin-login.cy.ts\"",
    "test:franklin:record": "cypress run --spec \"cypress/e2e/franklin-login.cy.ts\" --record",
    "test:sarah": "cypress run --spec \"cypress/e2e/sarah-student-registration.cy.ts\"",
    "test:sarah:record": "cypress run --spec \"cypress/e2e/sarah-student-registration.cy.ts\" --record",
    "test:birth-date": "cypress run --spec \"cypress/e2e/sarah-student-registration.cy.ts\"",
    "test:sarah:open": "cypress open --e2e --browser chrome",
    "test:audit": "cypress run --spec \"cypress/e2e/auditoria_sistema_ministerial.cy.ts\"",
    "test:audit:record": "cypress run --spec \"cypress/e2e/auditoria_sistema_ministerial.cy.ts\" --record",
    "test:auth": "cypress run --spec \"cypress/e2e/authentication-roles.cy.ts\"",
    "test:auth:record": "cypress run --spec \"cypress/e2e/authentication-roles.cy.ts\" --record",
    "test:pdf-upload": "cypress run --spec \"cypress/e2e/pdf-upload-functionality.cy.ts\"",
    "test:pdf-upload:record": "cypress run --spec \"cypress/e2e/pdf-upload-functionality.cy.ts\" --record",
    "env:validate": "node scripts/validate-env.js",
    "env:check": "node scripts/validate-env.js",
    "env:show": "node -e \"console.log('Environment Variables:'); Object.keys(process.env).filter(k => k.startsWith('VITE_') || ['NODE_ENV', 'DATABASE_URL'].includes(k)).forEach(k => console.log(k + '=' + (k.includes('SECRET') || k.includes('TOKEN') || k.includes('KEY') ? '[HIDDEN]' : process.env[k])))\"",
    "test:programs": "cypress run --spec \"cypress/e2e/programs-page-functionality.cy.ts\"",
    "test:programs:record": "cypress run --spec \"cypress/e2e/programs-page-functionality.cy.ts\" --record",
    "test:sistema-completo": "cypress run --spec \"cypress/e2e/sistema-ministerial-e2e.cy.ts\"",
    "test:sistema-completo:record": "cypress run --spec \"cypress/e2e/sistema-ministerial-e2e.cy.ts\" --record",
    "test:enhanced-parsing": "cypress run --spec \"cypress/e2e/enhanced-pdf-parsing.cy.ts\"",
    "test:enhanced-parsing:record": "cypress run --spec \"cypress/e2e/enhanced-pdf-parsing.cy.ts\" --record",
    "test:assignment-generation": "cypress run --spec \"cypress/e2e/assignment-generation.cy.ts\"",
    "test:assignment-generation:record": "cypress run --spec \"cypress/e2e/assignment-generation.cy.ts\" --record",
    "test:all-new": "cypress run --spec \"cypress/e2e/{pdf-upload-functionality,programs-page-functionality,sistema-ministerial-e2e,enhanced-pdf-parsing,assignment-generation}.cy.ts\"",
    "test:complete-workflow": "cypress run --spec \"cypress/e2e/{enhanced-pdf-parsing,assignment-generation}.cy.ts\"",
    "test:integration": "node src/verification/integration-test-cli.js",
    "test:integration:performance": "node -e \"import('./src/verification/tests/integration-test-runner.js').then(m => m.runIntegrationTestSuite())\"",
    "test:integration:services": "node -e \"console.log('üîó Running service integration tests...'); import('./src/verification/tests/integration-test-runner.js').then(m => m.runIntegrationTestSuite())\"",
    "verify:integration": "node src/verification/test-integration-simple.js",
    "test:setup": "cypress install && cypress verify",
    "test:verification": "node src/verification/tests/test-runner.cjs",
    "test:verification:simple": "node src/verification/tests/test-runner.cjs --simple",
    "test:verification:basic": "node src/verification/tests/test-runner.cjs --basic",
    "audit:plan": "node ./scripts/audit-implementation.mjs",
    "verify:system": "node src/verification/cli.js --full",
    "verify:frontend": "node src/verification/cli.js --module=frontend",
    "verify:backend": "node src/verification/cli.js --module=backend",
    "verify:infrastructure": "node src/verification/cli.js --module=infrastructure",
    "verify:reports": "node src/verification/cli.js reports",
    "verify:reports:list": "node src/verification/cli.js reports list",
    "verify:reports:dashboard": "node src/verification/cli.js reports dashboard",
    "verify:reports:trends": "node src/verification/cli.js reports trends",
    "verify:reports:cleanup": "node src/verification/cli.js reports cleanup",
    "verify:reports:init": "node src/verification/cli.js reports init",
    "test:report-storage": "node src/verification/test-report-storage.js",
    "test:frontend-verifier": "node src/verification/test-frontend-verifier.js",
    "test": "cypress run",
    "test:open": "cypress open",
    "test:component": "cypress run --component",
    "test:performance": "lighthouse http://localhost:8080/admin --output html --output-path ./lighthouse-report.html",
    "optimize": "npm run build:prod && npm run analyze",
    "agents:log": "node scripts/agents-log.js"
  },
  "dependencies": {
    "@hello-pangea/dnd": "^18.0.1",
    "@hookform/resolvers": "^3.10.0",
    "@radix-ui/react-accordion": "^1.2.11",
    "@radix-ui/react-alert-dialog": "^1.1.14",
    "@radix-ui/react-aspect-ratio": "^1.1.7",
    "@radix-ui/react-avatar": "^1.1.10",
    "@radix-ui/react-checkbox": "^1.3.2",
    "@radix-ui/react-collapsible": "^1.1.11",
    "@radix-ui/react-context-menu": "^2.2.15",
    "@radix-ui/react-dialog": "^1.1.14",
    "@radix-ui/react-dropdown-menu": "^2.1.15",
    "@radix-ui/react-hover-card": "^1.1.14",
    "@radix-ui/react-label": "^2.1.7",
    "@radix-ui/react-menubar": "^1.1.15",
    "@radix-ui/react-navigation-menu": "^1.2.13",
    "@radix-ui/react-popover": "^1.1.14",
    "@radix-ui/react-progress": "^1.1.7",
    "@radix-ui/react-radio-group": "^1.3.7",
    "@radix-ui/react-scroll-area": "^1.2.9",
    "@radix-ui/react-select": "^2.2.5",
    "@radix-ui/react-separator": "^1.1.7",
    "@radix-ui/react-slider": "^1.3.5",
    "@radix-ui/react-slot": "^1.2.3",
    "@radix-ui/react-switch": "^1.2.5",
    "@radix-ui/react-tabs": "^1.1.12",
    "@radix-ui/react-toast": "^1.2.14",
    "@radix-ui/react-toggle": "^1.1.9",
    "@radix-ui/react-toggle-group": "^1.1.10",
    "@radix-ui/react-tooltip": "^1.2.7",
    "@supabase/mcp-server-supabase": "^0.4.5",
    "@supabase/supabase-js": "^2.54.0",
    "@tanstack/react-query": "^5.83.0",
    "ag-grid-community": "^34.1.1",
    "ag-grid-react": "^34.1.1",
    "cheerio": "^1.1.2",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "^1.1.1",
    "date-fns": "^3.6.0",
    "dotenv": "^17.2.1",
    "embla-carousel-react": "^8.6.0",
    "fs-extra": "^11.3.1",
    "i18next": "^25.3.6",
    "i18next-browser-languagedetector": "^8.2.0",
    "input-otp": "^1.4.2",
    "jspdf": "^3.0.1",
    "lucide-react": "^0.462.0",
    "next-themes": "^0.3.0",
    "node-fetch": "^3.3.2",
    "pdf-parse": "^1.1.1",
    "qrcode.react": "^4.2.0",
    "react": "^18.3.1",
    "react-day-picker": "^8.10.1",
    "react-dom": "^18.3.1",
    "react-error-boundary": "^6.0.0",
    "react-hook-form": "^7.61.1",
    "react-i18next": "^15.6.1",
    "react-resizable-panels": "^2.1.9",
    "react-router-dom": "^6.30.1",
    "recharts": "^2.15.4",
    "serve": "^14.2.3",
    "sonner": "^1.7.4",
    "tailwind-merge": "^2.6.0",
    "tailwindcss-animate": "^1.0.7",
    "vaul": "^0.9.9",
    "xlsx": "^0.18.5",
    "zod": "^3.25.76"
  },
  "overrides": {
    "rollup": "^4.0.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.32.0",
    "@tailwindcss/typography": "^0.5.16",
    "@types/babel__core": "^7.20.5",
    "@types/babel__generator": "^7.27.0",
    "@types/babel__template": "^7.4.4",
    "@types/node": "^22.17.1",
    "@types/react": "^18.3.23",
    "@types/react-dom": "^18.3.7",
    "@vitejs/plugin-react": "^4.3.1",
    "autoprefixer": "^10.4.21",
    "concurrently": "^9.2.0",
    "cssnano": "^7.1.0",
    "cypress": "^13.17.0",
    "eslint": "^9.32.0",
    "eslint-plugin-react-hooks": "^5.2.0",
    "eslint-plugin-react-refresh": "^0.4.20",
    "fast-glob": "^3.3.3",
    "globals": "^15.15.0",
    "lovable-tagger": "^1.1.9",
    "postcss": "^8.5.6",
    "rollup-plugin-visualizer": "^6.0.3",
    "tailwindcss": "^3.4.17",
    "terser": "^5.43.1",
    "typescript": "^5.8.3",
    "typescript-eslint": "^8.38.0",
    "vite": "^5.0.0",
    "vite-plugin-pwa": "^1.0.3"
  }
}

```

Corrigi o `package.json` (faltava a v√≠rgula antes de `"agents:log"`). Tente novamente:
- npm run dev:all

Se der certo, seguimos para adicionar o ‚ÄúCarregar exemplo‚Äù no painel do Instrutor.

---

**User**

nwpuurgwnnuejqinkvrh.supabase.co/rest/v1/congregacoes?select=*:1  Failed to load resource: the server responded with a status of 404 ()
nwpuurgwnnuejqinkvrh.supabase.co/rest/v1/programas?select=id%2Csemana_iso%2Cidioma%2Cstatus%2Cversao%2Cdata_inicio%2Cdata_fim&order=data_inicio.desc&limit=12:1  Failed to load resource: the server responded with a status of 400 ()
AdminDashboard.tsx:184 ‚ùå Error loading programs: Object
(an√¥nimo) @ AdminDashboard.tsx:184
nwpuurgwnnuejqinkvrh.supabase.co/rest/v1/congregacoes?select=*:1  Failed to load resource: the server responded with a status of 404 ()
nwpuurgwnnuejqinkvrh.supabase.co/rest/v1/programas?select=id%2Csemana_iso%2Cidioma%2Cstatus%2Cversao%2Cdata_inicio%2Cdata_fim&order=data_inicio.desc&limit=12:1  Failed to load resource: the server responded with a status of 400 ()
AdminDashboard.tsx:184 ‚ùå Error loading programs: Object
(an√¥nimo) @ AdminDashboard.tsx:184
nwpuurgwnnuejqinkvrh.supabase.co/rest/v1/congregacoes?select=*:1  Failed to load resource: the server responded with a status of 404 ()
nwpuurgwnnuejqinkvrh.supabase.co/rest/v1/programas?select=id%2Csemana_iso%2Cidioma%2Cstatus%2Cversao%2Cdata_inicio%2Cdata_fim&order=data_inicio.desc&limit=12:1  Failed to load resource: the server responded with a status of 400 ()
AdminDashboard.tsx:184 ‚ùå Error loading programs: Object
(an√¥nimo) @ AdminDashboard.tsx:184  em lugar algum eu vejo a programacao informada em "C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_E_202511.pdf"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_E_202507.pdf"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_E_202509.pdf"  no http://localhost:8080/admin


---

**Cursor**

```sql
create table if not exists programas (id uuid default gen_random_uuid() primary key, semana_iso text, idioma text, status text, versao int default 1, data_inicio date, data_fim date);
```

- Os 404/400 indicam que as tabelas `congregacoes` e/ou `programas` n√£o existem (ou RLS/colunas n√£o batem) no Supabase, ent√£o a listagem n√£o aparece no Admin.
- Os PDFs em `docs/Oficial/*.pdf` n√£o ‚Äúviram‚Äù programas automaticamente; eles s√£o apenas arquivos est√°ticos servidos em `http://localhost:3001/materials/...`. Para aparecer como ‚ÄúPrograma√ß√µes Publicadas‚Äù no Admin, precisamos ter registros na tabela `programas`.

Como destravar agora (r√°pido):
- Verifique vari√°veis do frontend:
  - VITE_SUPABASE_URL e VITE_SUPABASE_ANON_KEY v√°lidos.
- Crie tabelas m√≠nimas no Supabase (DDL simplificada):
  - programas: id, semana_iso, idioma, status, versao, data_inicio, data_fim
  - congregacoes: id, nome, idioma
- Insira 1-2 linhas em `programas` para teste.

Exemplo SQL (execute no Supabase SQL editor):
```sql
create extension if not exists pgcrypto;

create table if not exists programas (
  id uuid primary key default gen_random_uuid(),
  semana_iso text,
  idioma text,
  status text default 'publicado',
  versao int default 1,
  data_inicio date,
  data_fim date,
  created_at timestamp with time zone default now()
);

create table if not exists congregacoes (
  id uuid primary key default gen_random_uuid(),
  nome text not null,
  idioma text,
  created_at timestamp with time zone default now()
);

insert into programas (semana_iso, idioma, status, versao, data_inicio, data_fim)
values
('2025-W31', 'pt', 'publicado', 1, '2025-07-28', '2025-08-03'),
('2025-W33', 'pt', 'publicado', 1, '2025-08-11', '2025-08-17');
```

Depois:
- Recarregue o Admin: a aba ‚ÄúPrograma√ß√µes Publicadas‚Äù deve exibir as semanas.

Opcional (fallback visual imediato):
- Posso adicionar um card ‚ÄúMateriais dispon√≠veis‚Äù no Admin que mostra links diretos para:
  - http://localhost:3001/materials/mwb_E_202507.pdf
  - http://localhost:3001/materials/mwb_E_202509.pdf
  - http://localhost:3001/materials/mwb_E_202511.pdf
Assim voc√™ j√° enxerga os PDFs enquanto estruturamos a tabela `programas`. Quer que eu implemente esse fallback agora?

```sql
create extension if not exists pgcrypto;

create table if not exists programas (
  id uuid primary key default gen_random_uuid(),
  semana_iso text,
  idioma text,
  status text default 'publicado',
  versao int default 1,
  data_inicio date,
  data_fim date,
  created_at timestamp with time zone default now()
);

create table if not exists congregacoes (
  id uuid primary key default gen_random_uuid(),
  nome text not null,
  idioma text,
  created_at timestamp with time zone default now()
);

insert into programas (semana_iso, idioma, status, versao, data_inicio, data_fim)
values
('2025-W31', 'pt', 'publicado', 1, '2025-07-28', '2025-08-03'),
('2025-W33', 'pt', 'publicado', 1, '2025-08-11', '2025-08-17');
```

---

**User**

use o mcp do supabase para resolver isso 

---

**Cursor**

Vou verificar as tabelas no seu projeto Supabase e, se necess√°rio, criar `programas` e `congregacoes`, depois inserir registros de exemplo para o AdminDashboard listar.

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo, lazy, Suspense } from 'react';
import { useAuth } from '../contexts/AuthContext';
import { supabase } from '../integrations/supabase/client';
import { useJWorgIntegration } from '../hooks/useJWorgIntegration';
import { JWorgTest } from '../components/JWorgTest';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../components/ui/card';
import LazyLoader from '../components/LazyLoader';
import AuthErrorHandler from '../components/AuthErrorHandler';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '../components/ui/tabs';
import { Button } from '../components/ui/button';
import { Badge } from '../components/ui/badge';
import { Separator } from '../components/ui/separator';
import { 
  Download, 
  Upload, 
  Globe, 
  BarChart3, 
  Settings, 
  RefreshCw,
  CheckCircle,
  AlertCircle,
  Clock,
  FileText,
  Users,
  Package,
  Activity,
  Database
} from 'lucide-react';

// üöÄ Lazy loading para componentes pesados (comentado por enquanto)
// const JWorgTestLazy = lazy(() => import('../components/JWorgTest'));

interface SystemStats {
  total_congregations: number;
  active_congregations: number;
  total_users: number;
  total_estudantes: number;
  total_programas: number;
  last_sync: string;
}

export default function AdminDashboard() {
  const { user, profile, isAdmin } = useAuth();
  const jworg = useJWorgIntegration();
  const [activeTab, setActiveTab] = useState('overview');
  const [loading, setLoading] = useState(false);
  const [systemStats, setSystemStats] = useState<SystemStats | null>(null);
  const [lastCheck, setLastCheck] = useState<string>('');
  const [debugInfo, setDebugInfo] = useState<string>('');
  const [showJWorgTest, setShowJWorgTest] = useState(false);
  const [programs, setPrograms] = useState<any[]>([]);
  const [programsLoading, setProgramsLoading] = useState<boolean>(false);

  // üöÄ Memoiza√ß√£o de dados est√°ticos para reduzir re-renders
  const staticStats = useMemo(() => ({
    total_congregations: systemStats?.total_congregations || 0,
    active_congregations: systemStats?.active_congregations || 0,
    total_users: systemStats?.total_users || 0,
    total_estudantes: systemStats?.total_estudantes || 0,
    total_programas: systemStats?.total_programas || 0,
    last_sync: systemStats?.last_sync || ''
  }), [systemStats]);

  // üöÄ Debounced function para reduzir chamadas desnecess√°rias
  const debouncedSetDebugInfo = useCallback((info: string) => {
    let timeoutId: NodeJS.Timeout;
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => setDebugInfo(info), 100);
  }, []);

  // DEBUG: Log component state (otimizado)
  useEffect(() => {
    const debugData = {
      user: !!user,
      userId: user?.id,
      userEmail: user?.email,
      profile: !!profile,
      profileRole: profile?.role,
      isAdmin,
      loading,
      userMetadata: user?.user_metadata
    };

    console.log('üîç AdminDashboard Component Debug:', debugData);
    debouncedSetDebugInfo(JSON.stringify(debugData, null, 2));
  }, [user, profile, isAdmin, loading, debouncedSetDebugInfo]);

  useEffect(() => {
    console.log('üîÑ AdminDashboard useEffect triggered:', { user, isAdmin });
    
    if (user && isAdmin) {
      console.log('‚úÖ Admin user detected, loading system data...');
      loadSystemData();
    } else if (user && !isAdmin) {
      console.log('‚ùå User is not admin, role:', profile?.role);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå User is not admin, role: ' + profile?.role);
    } else if (!user) {
      console.log('‚ùå No user found');
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå No user found');
    }
  }, [user, isAdmin, debouncedSetDebugInfo]);

  const loadSystemData = useCallback(async () => {
    if (!user || !isAdmin) {
      console.log('üö´ loadSystemData: User not admin or not logged in');
      return;
    }
    
    console.log('üîÑ Loading system data for admin...');
    setLoading(true);
    try {
      // Testar conex√£o com Supabase
      console.log('üîç Testing Supabase connection...');
      const { count: profilesCount, error: testError } = await supabase
        .from('profiles')
        .select('*', { count: 'exact', head: true });
      
      if (testError) {
        console.error('‚ùå Supabase connection test failed:', testError);
        debouncedSetDebugInfo(debugInfo + '\n\n‚ùå Supabase Test Failed: ' + testError.message);
        return;
      }

        console.log('‚úÖ Supabase connection test successful');
      debouncedSetDebugInfo(debugInfo + '\n\n‚úÖ Supabase Test: Connected');

      // Carregar estat√≠sticas do sistema
      await loadSystemStats();
      // Carregar programa√ß√µes publicadas
      await loadPrograms();

    } catch (error) {
      console.error('‚ùå Supabase test exception:', error);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå Supabase Test Exception: ' + error);
    } finally {
      setLoading(false);
    }
  }, [user, isAdmin, debouncedSetDebugInfo, debugInfo]);

  const loadSystemStats = useCallback(async () => {
    try {
      console.log('üìä Loading system statistics...');

      const [profilesRes, estudantesRes, programasRes] = await Promise.all([
        supabase.from('profiles').select('*', { count: 'exact', head: true }),
        supabase.from('estudantes').select('*', { count: 'exact', head: true }),
        supabase.from('programas').select('*', { count: 'exact', head: true }),
      ]);

      // congregacoes (opcional - pode n√£o existir neste projeto)
      let congregacoesCount = 0;
      try {
        const { count: congCount, error: congError } = await supabase
          .from('congregacoes')
          .select('*', { count: 'exact', head: true });
        if (!congError && typeof congCount === 'number') {
          congregacoesCount = congCount;
        }
      } catch (_) {}

      const stats: SystemStats = {
        total_congregations: congregacoesCount,
        active_congregations: congregacoesCount,
        total_users: (profilesRes.count as number) || 0,
        total_estudantes: (estudantesRes.count as number) || 0,
        total_programas: (programasRes.count as number) || 0,
        last_sync: new Date().toISOString(),
      };

      setSystemStats(stats);
      setLastCheck(new Date().toISOString());

      console.log('‚úÖ System stats loaded:', stats);
      debouncedSetDebugInfo(debugInfo + '\n\n‚úÖ System Stats Loaded: ' + JSON.stringify(stats, null, 2));

    } catch (error) {
      console.error('‚ùå Error loading system stats:', error);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå System Stats Error: ' + error);
    }
  }, [debouncedSetDebugInfo, debugInfo, supabase]);

  const loadPrograms = useCallback(async () => {
    try {
      setProgramsLoading(true);
      const { data, error } = await supabase
        .from('programas')
        .select('id, semana, mes_apostila, status, data_inicio_semana, arquivo')
        .order('data_inicio_semana', { ascending: false })
        .limit(12);
      if (error) throw error;
      setPrograms(data || []);
      console.log('‚úÖ Programs loaded:', data?.length || 0);
    } catch (error: any) {
      console.error('‚ùå Error loading programs:', error);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå Programs Load Error: ' + (error?.message || error));
    } finally {
      setProgramsLoading(false);
    }
  }, [debouncedSetDebugInfo, debugInfo]);

  const checkForUpdates = useCallback(async () => {
    console.log('üîÑ Checking for updates...');
    setLoading(true);
    
    try {
      await loadSystemStats();
      await loadPrograms();
      console.log('‚úÖ Updates checked successfully');
    } catch (error) {
      console.error('‚ùå Error checking updates:', error);
    } finally {
      setLoading(false);
    }
  }, [loadSystemStats]);

  const testSupabaseConnection = useCallback(async () => {
    console.log('üîß Testing Supabase connection...');
    
    try {
      const { count, error } = await supabase
        .from('profiles')
        .select('*', { count: 'exact', head: true });

      if (error) {
        console.error('‚ùå Supabase test error:', error);
        alert('Supabase test error: ' + error.message);
      } else {
        console.log('‚úÖ Supabase test successful. Profiles count:', count);
        alert('Supabase test successful! Total profiles: ' + (count ?? 0));
      }
    } catch (error) {
      console.error('‚ùå Supabase test exception:', error);
      alert('Supabase test exception: ' + error);
    }
  }, []);

  // ========== HANDLERS DOS BOT√ïES ==========
  
  const handleListUsers = useCallback(async () => {
    console.log('üë• Listando usu√°rios...');
    try {
      const { data: users, error } = await supabase
        .from('profiles')
        .select('id, nome_completo, role, congregacao, cargo')
        .order('nome_completo');
      
      if (error) throw error;
      
      console.log('‚úÖ Usu√°rios carregados:', users);
      alert(`Encontrados ${users?.length || 0} usu√°rios no sistema:\n\n${users?.map(u => `${u.nome_completo || u.id} - ${u.role} (${u.congregacao || 'N/A'})`).join('\n')}`);
    } catch (error) {
      console.error('‚ùå Erro ao listar usu√°rios:', error);
      alert('Erro ao carregar usu√°rios: ' + error.message);
    }
  }, []);

  const handleManagePermissions = useCallback(async () => {
    console.log('‚öôÔ∏è Gerenciando permiss√µes...');
    const newRole = prompt('Digite o novo role (admin, instrutor, estudante):');
    if (!newRole) return;
    
    // Validar role
    const validRoles = ['admin', 'instrutor', 'estudante', 'family_member', 'developer'];
    if (!validRoles.includes(newRole)) {
      alert('Role inv√°lido. Use: admin, instrutor, estudante, family_member ou developer');
      return;
    }
    
    const userId = prompt('Digite o ID do usu√°rio:');
    if (!userId) return;
    
    try {
      const { error } = await supabase
        .from('profiles')
        .update({ role: newRole as any })
        .eq('id', userId);
      
      if (error) throw error;
      
      console.log('‚úÖ Permiss√£o atualizada');
      alert('Permiss√£o atualizada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao atualizar permiss√£o:', error);
      alert('Erro ao atualizar permiss√£o: ' + error.message);
    }
  }, []);

  const handleActivityReport = useCallback(async () => {
    console.log('üìä Gerando relat√≥rio de atividades...');
    try {
      // Simula√ß√£o de relat√≥rio
      const report = {
        totalUsers: staticStats.total_users,
        totalCongregations: staticStats.total_congregations,
        lastUpdate: new Date().toLocaleString('pt-BR'),
        activeUsers: Math.floor(staticStats.total_users * 0.8)
      };
      
      alert(`üìä Relat√≥rio de Atividades:\n\n` +
            `‚Ä¢ Total de usu√°rios: ${report.totalUsers}\n` +
            `‚Ä¢ Usu√°rios ativos: ${report.activeUsers}\n` +
            `‚Ä¢ Total de congrega√ß√µes: ${report.totalCongregations}\n` +
            `‚Ä¢ √öltima atualiza√ß√£o: ${report.lastUpdate}`);
    } catch (error) {
      console.error('‚ùå Erro ao gerar relat√≥rio:', error);
      alert('Erro ao gerar relat√≥rio: ' + error.message);
    }
  }, [staticStats]);

  const handleBackupData = useCallback(async () => {
    console.log('üíæ Fazendo backup dos dados...');
    try {
      const { data: profiles, error: profilesError } = await supabase
        .from('profiles')
        .select('*');
      
      if (profilesError) throw profilesError;
      
      // Simular backup
      const backupData = {
        timestamp: new Date().toISOString(),
        profiles: profiles,
        stats: staticStats
      };
      
      const dataStr = JSON.stringify(backupData, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      
      const link = document.createElement('a');
      link.href = url;
      link.download = `backup_sistema_ministerial_${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      
      URL.revokeObjectURL(url);
      console.log('‚úÖ Backup criado com sucesso');
      alert('Backup criado e baixado com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao fazer backup:', error);
      alert('Erro ao fazer backup: ' + error.message);
    }
  }, [staticStats]);

  // Congrega√ß√µes
  const handleManageCongregation = useCallback((congregationName: string) => {
    console.log('üè¢ Gerenciando congrega√ß√£o:', congregationName);
    alert(`üè¢ Gerenciando congrega√ß√£o: ${congregationName}\n\nEsta funcionalidade abrir√° o painel de gerenciamento da congrega√ß√£o.`);
  }, []);

  const handleAddCongregation = useCallback(async () => {
    console.log('‚ûï Adicionando nova congrega√ß√£o...');
    const congregationName = prompt('Digite o nome da nova congrega√ß√£o:');
    if (!congregationName) return;
    
    try {
      // Simula√ß√£o - em produ√ß√£o seria inser√ß√£o no Supabase
      console.log('‚úÖ Congrega√ß√£o adicionada:', congregationName);
      alert(`‚úÖ Congrega√ß√£o "${congregationName}" adicionada com sucesso!\n\nEla agora receber√° automaticamente a programa√ß√£o oficial.`);
    } catch (error) {
      console.error('‚ùå Erro ao adicionar congrega√ß√£o:', error);
      alert('Erro ao adicionar congrega√ß√£o: ' + error.message);
    }
  }, []);

  // JW.org & S-38
  const handleMWBAvailable = useCallback(async () => {
    console.log('üìö Disponibilizando MWB atual...');
    try {
      await jworg.fetchCurrentWeek();
      console.log('‚úÖ MWB atualizada');
      alert('‚úÖ Apostila MWB atual disponibilizada para todas as congrega√ß√µes!');
    } catch (error) {
      console.error('‚ùå Erro ao disponibilizar MWB:', error);
      alert('Erro ao disponibilizar MWB: ' + error.message);
    }
  }, [jworg]);

  const handleConfigureJWorgURLs = useCallback(() => {
    console.log('‚öôÔ∏è Configurando URLs JW.org...');
    const ptUrl = prompt('URL JW.org PT:', 'https://www.jw.org/pt/biblioteca/jw-apostila-do-mes/');
    const enUrl = prompt('URL JW.org EN:', 'https://www.jw.org/en/library/jw-meeting-workbook/');
    
    if (ptUrl && enUrl) {
      console.log('‚úÖ URLs configuradas:', { ptUrl, enUrl });
      alert('‚úÖ URLs JW.org configuradas com sucesso!');
    }
  }, []);

  const handleSyncCongregations = useCallback(async () => {
    console.log('üîÑ Sincronizando com congrega√ß√µes...');
    try {
      // Simula√ß√£o de sincroniza√ß√£o
      const congregationsCount = staticStats.total_congregations;
      console.log(`‚úÖ Sincronizando com ${congregationsCount} congrega√ß√µes`);
      alert(`üîÑ Sincroniza√ß√£o iniciada!\n\nPrograma√ß√£o oficial sendo enviada para ${congregationsCount} congrega√ß√µes...\n\nTempo estimado: ${Math.ceil(congregationsCount / 100)} minutos`);
    } catch (error) {
      console.error('‚ùå Erro na sincroniza√ß√£o:', error);
      alert('Erro na sincroniza√ß√£o: ' + error.message);
    }
  }, [staticStats]);

  // Programa√ß√£o Oficial
  const handleViewFullProgram = useCallback(() => {
    console.log('üìÖ Visualizando programa√ß√£o completa (3 meses)...');
    alert(`üìÖ Programa√ß√£o Completa dos Pr√≥ximos 3 Meses\n\n` +
          `‚Ä¢ Semanas carregadas: 12\n` +
          `‚Ä¢ Idiomas: PT e EN\n` +
          `‚Ä¢ √öltima atualiza√ß√£o: Hoje\n\n` +
          `Esta visualiza√ß√£o mostrar√° todas as apostilas MWB dos pr√≥ximos 3 meses.`);
  }, []);

  const handleUpdateProgramPT = useCallback(async () => {
    console.log('üáßüá∑ Atualizando programa√ß√£o PT...');
    try {
      jworg.setLanguage('pt');
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Programa√ß√£o PT atualizada');
      alert('‚úÖ Programa√ß√£o em Portugu√™s atualizada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao atualizar programa√ß√£o PT:', error);
      alert('Erro ao atualizar programa√ß√£o PT: ' + error.message);
    }
  }, [jworg]);

  const handleUpdateProgramEN = useCallback(async () => {
    console.log('üá∫üá∏ Atualizando programa√ß√£o EN...');
    try {
      jworg.setLanguage('en');
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Programa√ß√£o EN atualizada');
      alert('‚úÖ Programa√ß√£o em Ingl√™s atualizada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao atualizar programa√ß√£o EN:', error);
      alert('Erro ao atualizar programa√ß√£o EN: ' + error.message);
    }
  }, [jworg]);

  const handleCheckNewWeeks = useCallback(async () => {
    console.log('üîç Verificando novas semanas...');
    try {
      await jworg.fetchNextWeeks();
      const newWeeks = jworg.nextWeeks.length;
      console.log(`‚úÖ Verifica√ß√£o conclu√≠da: ${newWeeks} semanas`);
      alert(`üîç Verifica√ß√£o conclu√≠da!\n\nEncontradas ${newWeeks} semanas de programa√ß√£o.\n\nTodas est√£o sincronizadas com JW.org.`);
    } catch (error) {
      console.error('‚ùå Erro ao verificar semanas:', error);
      alert('Erro ao verificar novas semanas: ' + error.message);
    }
  }, [jworg]);

  const handleUpdateS38Structure = useCallback(() => {
    console.log('üèóÔ∏è Atualizando estrutura S-38 global...');
    alert(`üèóÔ∏è Estrutura S-38 Global\n\n` +
          `‚úÖ Partes da reuni√£o atualizadas:\n` +
          `‚Ä¢ Chairman\n‚Ä¢ Treasures\n‚Ä¢ Gems\n‚Ä¢ Reading\n` +
          `‚Ä¢ Starting\n‚Ä¢ Following\n‚Ä¢ Making\n‚Ä¢ Explaining\n` +
          `‚Ä¢ Talk\n\n` +
          `Esta estrutura ser√° aplicada mundialmente.`);
  }, []);

  // JW.org Integration
  const handleReloadCurrentWeek = useCallback(async () => {
    console.log('üîÑ Recarregando semana atual...');
    try {
      await jworg.fetchCurrentWeek();
      console.log('‚úÖ Semana atual recarregada');
      alert('‚úÖ Semana atual recarregada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao recarregar semana:', error);
      alert('Erro ao recarregar semana: ' + error.message);
    }
  }, [jworg]);

  const handleReloadNextWeeks = useCallback(async () => {
    console.log('üìÖ Recarregando pr√≥ximas semanas...');
    try {
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Pr√≥ximas semanas recarregadas');
      alert('‚úÖ Pr√≥ximas semanas recarregadas com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao recarregar pr√≥ximas semanas:', error);
      alert('Erro ao recarregar pr√≥ximas semanas: ' + error.message);
    }
  }, [jworg]);

  const handleTestDownloadPT = useCallback(async () => {
    console.log('üß™ Testando download PT...');
    try {
      jworg.setLanguage('pt');
      await jworg.downloadWorkbook('pt', '07', '2025');
      console.log('‚úÖ Download PT testado');
      alert('‚úÖ Download PT testado com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro no teste de download PT:', error);
      alert('Erro no teste de download PT: ' + error.message);
    }
  }, [jworg]);

  // Monitoramento
  const handleViewAllLogs = useCallback(async () => {
    console.log('üìã Visualizando todos os logs...');
    try {
      // Simula√ß√£o de logs
      const logs = [
        { timestamp: new Date().toLocaleString(), event: 'Sistema iniciado', level: 'info' },
        { timestamp: new Date(Date.now() - 3600000).toLocaleString(), event: 'Backup autom√°tico executado', level: 'info' },
        { timestamp: new Date(Date.now() - 86400000).toLocaleString(), event: 'Novo usu√°rio registrado', level: 'info' },
        { timestamp: new Date(Date.now() - 172800000).toLocaleString(), event: 'Manuten√ß√£o programada', level: 'warning' }
      ];
      
      const logText = logs.map(log => `${log.timestamp} [${log.level.toUpperCase()}] ${log.event}`).join('\n');
      alert(`üìã Logs do Sistema\n\n${logText}`);
    } catch (error) {
      console.error('‚ùå Erro ao carregar logs:', error);
      alert('Erro ao carregar logs: ' + error.message);
    }
  }, []);

  const handleTestJWorgIntegration = useCallback(async () => {
    console.log('üß™ Testando integra√ß√£o JW.org...');
    try {
      await jworg.fetchCurrentWeek();
      console.log('‚úÖ Integra√ß√£o JW.org testada com sucesso');
      alert('‚úÖ Integra√ß√£o JW.org funcionando perfeitamente!');
    } catch (error) {
      console.error('‚ùå Erro na integra√ß√£o JW.org:', error);
      alert('‚ùå Erro na integra√ß√£o JW.org: ' + error.message);
    }
  }, [jworg]);

  const handleChangeLanguage = useCallback((newLang: 'pt' | 'en') => {
    jworg.setLanguage(newLang);
    console.log(`üåê Idioma alterado para: ${newLang}`);
    alert(`üåê Idioma alterado para: ${newLang === 'pt' ? 'Portugu√™s' : 'English'}`);
  }, [jworg]);

  // Alterna o idioma atual entre PT/EN
  const toggleLanguage = useCallback(() => {
    const current = (jworg as any)?.currentLanguage ?? 'pt';
    const next = current === 'pt' ? 'en' : 'pt';
    jworg.setLanguage(next);
    console.log(`üåê Idioma alternado: ${current} -> ${next}`);
    alert(`üåê Idioma alternado para: ${next === 'pt' ? 'Portugu√™s' : 'English'}`);
  }, [jworg]);

  // Atualiza materiais JW.org (semana atual + pr√≥ximas semanas)
  const updateMaterials = useCallback(async () => {
    try {
      await jworg.fetchCurrentWeek();
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Materiais JW.org atualizados');
      alert('‚úÖ Materiais JW.org atualizados com sucesso!');
    } catch (error: any) {
      console.error('‚ùå Erro ao atualizar materiais:', error);
      alert('‚ùå Erro ao atualizar materiais: ' + (error?.message || error));
    }
  }, [jworg]);

  // NOW CHECK CONDITIONS AND RENDER APPROPRIATELY
  // Se n√£o for admin, mostrar mensagem de acesso negado
  if (user && !isAdmin) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="max-w-md mx-auto">
          <CardHeader>
            <CardTitle className="text-red-600">Acesso Negado</CardTitle>
            <CardDescription>
              Voc√™ n√£o tem permiss√£o para acessar o painel administrativo.
            </CardDescription>
          </CardHeader>
          <CardContent>
            <p className="text-sm text-muted-foreground mb-4">
              Seu perfil atual: <strong>{profile?.role}</strong>
            </p>
            <Button onClick={() => window.history.back()}>
              Voltar
            </Button>
          </CardContent>
        </Card>
      </div>
    );
  }

  // Se n√£o houver usu√°rio, mostrar loading
  if (!user) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="max-w-md mx-auto">
          <CardHeader>
            <CardTitle>Carregando...</CardTitle>
            <CardDescription>
              Verificando autentica√ß√£o...
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="flex items-center justify-center">
              <RefreshCw className="h-6 w-6 animate-spin" />
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background">
      {/* Auth Error Handler */}
      <AuthErrorHandler />
      
      {/* Header */}
      <div className="border-b">
        <div className="container mx-auto px-4 py-6">
          <div className="flex flex-col space-y-4">
          <div className="flex items-center justify-between">
            <div>
                <h1 className="text-3xl font-bold tracking-tight">üìä Dashboard do Administrador Geral</h1>
                <p className="text-muted-foreground">
                  Programa√ß√£o oficial das reuni√µes ministeriais - Padroniza√ß√£o mundial para todas as congrega√ß√µes
              </p>
            </div>
              <div className="flex items-center space-x-2">
              {/* Force Profile Load Button */}
              {import.meta.env.DEV && (
                <Button 
                  variant="outline" 
                  size="sm"
                    onClick={testSupabaseConnection}
                  >
                    üîß Test Supabase
                </Button>
              )}
              
              <Button onClick={checkForUpdates} disabled={loading}>
                <RefreshCw className={`h-4 w-4 mr-2 ${loading ? 'animate-spin' : ''}`} />
                  Atualizar
              </Button>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Debug Info Panel */}
      {import.meta.env.DEV && (
        <div className="container mx-auto px-4 py-2">
          <Card className="bg-yellow-50 border-yellow-200">
            <CardHeader className="pb-2">
              <CardTitle className="text-sm text-yellow-800">üêõ Debug Info (Development Only)</CardTitle>
            </CardHeader>
            <CardContent>
              <pre className="text-xs text-yellow-700 overflow-auto max-h-40">
                {debugInfo}
              </pre>
            </CardContent>
          </Card>
        </div>
      )}

      {/* Main Content */}
      <div className="container mx-auto px-4 py-6">
        <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
          <TabsList className="grid w-full grid-cols-4">
            <TabsTrigger value="overview">Vis√£o Geral</TabsTrigger>
            <TabsTrigger value="users">Usu√°rios</TabsTrigger>
            <TabsTrigger value="congregations">Congrega√ß√µes</TabsTrigger>
            <TabsTrigger value="system">Sistema</TabsTrigger>
          </TabsList>

          {/* Vis√£o Geral */}
          <TabsContent value="overview" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                üéØ Sistema Ministerial Global - Padroniza√ß√£o Mundial
              </h3>
              <div className="text-center text-sm text-muted-foreground mt-2 p-3 bg-blue-50 rounded-lg border border-blue-200">
                <strong>üìä Admin Geral:</strong> Disponibiliza programa√ß√£o oficial semanal (SEM nomes de estudantes) <br/>
                <strong>üéì Instrutores:</strong> Recebem programa√ß√£o automaticamente + fazem designa√ß√µes locais reais
              </div>
            </div>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Congrega√ß√µes Conectadas</CardTitle>
                  <Globe className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">{staticStats.total_congregations}</div>
                  <p className="text-xs text-muted-foreground">
                    Recebendo programa√ß√£o oficial
                  </p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Semanas Programadas</CardTitle>
                  <BarChart3 className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">12</div>
                  <p className="text-xs text-muted-foreground">
                    Pr√≥ximas 3 meses
                  </p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Idiomas Dispon√≠veis</CardTitle>
                  <Globe className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">2</div>
                  <p className="text-xs text-muted-foreground">
                    Portugu√™s e Ingl√™s
                  </p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">√öltima Sincroniza√ß√£o</CardTitle>
                  <RefreshCw className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">‚úÖ</div>
                  <p className="text-xs text-muted-foreground">
                    Hoje, {new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}
                  </p>
                </CardContent>
              </Card>
            </div>

            {/* A√ß√µes R√°pidas */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* Status do Sistema */}
              <Card>
                <CardHeader>
                  <CardTitle>Status do Sistema</CardTitle>
                  <CardDescription>
                    Informa√ß√µes sobre a √∫ltima verifica√ß√£o e status geral
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">√öltima Verifica√ß√£o:</span>
                    <span className="text-sm text-muted-foreground">
                      {lastCheck ? new Date(lastCheck).toLocaleString('pt-BR') : 'Nunca'}
                    </span>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Status:</span>
                    <Badge variant="outline" className="text-green-600">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Operacional
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Supabase:</span>
                    <Badge variant="outline" className="text-green-600">
                      <Database className="h-3 w-3 mr-1" />
                      Conectado
                    </Badge>
                  </div>
                </CardContent>
              </Card>

              {/* Programa√ß√µes Publicadas */}
              <Card>
                <CardHeader>
                  <CardTitle>Programa√ß√µes Publicadas</CardTitle>
                  <CardDescription>
                    √öltimas semanas importadas/publicadas
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  {programsLoading ? (
                    <div className="text-sm text-muted-foreground">Carregando...</div>
                  ) : programs.length === 0 ? (
                    <div className="text-sm text-muted-foreground">Nenhuma programa√ß√£o encontrada.</div>
                  ) : (
                    <div className="space-y-2">
                      {programs.map((p) => (
                        <div key={p.id} className="flex items-center justify-between p-2 border rounded-md">
                          <div className="text-sm">
                            <div className="font-medium">Semana {p.semana_iso} ‚Ä¢ {p.idioma?.toUpperCase?.() || '‚Äî'}</div>
                            <div className="text-xs text-muted-foreground">
                              {p.data_inicio ? new Date(p.data_inicio).toLocaleDateString('pt-BR') : '‚Äî'}
                              {p.data_fim ? ` ‚Äî ${new Date(p.data_fim).toLocaleDateString('pt-BR')}` : ''}
                            </div>
                          </div>
                          <Badge variant="outline" className={p.status === 'publicado' ? 'bg-green-50 text-green-700' : ''}>
                            v{p.versao || 1} ‚Ä¢ {p.status || 'rascunho'}
                          </Badge>
                        </div>
                      ))}
                    </div>
                  )}
                </CardContent>
              </Card>

              {/* JW.org Downloads */}
              <Card className="bg-green-50 border-green-200">
                <CardHeader>
                  <CardTitle className="text-green-800">üìö JW.org Downloads</CardTitle>
                  <CardDescription className="text-green-700">
                    Gerenciar materiais oficiais
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Apostila MWB Atual:</span>
                    <Badge variant="outline" className="text-green-600">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Dispon√≠vel
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">√öltima verifica√ß√£o:</span>
                    <span className="text-sm text-green-700">Hoje, 10:30</span>
                  </div>
                  <div className="flex space-x-2">
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleMWBAvailable}>
                      <RefreshCw className="h-3 w-3 mr-1" />
                      Disponibilizar MWB Atual
                    </Button>
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleConfigureJWorgURLs}>
                      <Settings className="h-3 w-3 mr-1" />
                      Configurar URLs JW.org
                    </Button>
                  </div>
                </CardContent>
              </Card>

              {/* Sistema S-38 - Designa√ß√µes */}
              <Card className="bg-purple-50 border-purple-200">
                <CardHeader>
                  <CardTitle className="text-purple-800">‚öôÔ∏è Sistema S-38</CardTitle>
                  <CardDescription className="text-purple-700">
                    Estrutura das reuni√µes ministeriais
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="text-sm text-purple-700 space-y-2">
                    <p>üìö <strong>Fun√ß√£o do Admin:</strong> Disponibilizar apostilas MWB</p>
                    <p>üë• <strong>Para Instrutores:</strong> Designar estudantes para partes</p>
                    <p>üéØ <strong>Partes da Reuni√£o:</strong></p>
                    <div className="grid grid-cols-2 gap-1 text-xs ml-2">
                      <div>‚Ä¢ Chairman</div>
                      <div>‚Ä¢ Treasures</div>
                      <div>‚Ä¢ Gems</div>
                      <div>‚Ä¢ Reading</div>
                      <div>‚Ä¢ Starting</div>
                      <div>‚Ä¢ Following</div>
                      <div>‚Ä¢ Making</div>
                      <div>‚Ä¢ Explaining</div>
                      <div>‚Ä¢ Talk</div>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Debug / Integra√ß√£o */}
              <Card className="bg-slate-50 border-slate-200">
                <CardHeader>
                  <CardTitle className="text-slate-800">üß™ Debug / Integra√ß√£o</CardTitle>
                  <CardDescription className="text-slate-700">
                    Ferramentas r√°pidas para validar integra√ß√µes e idioma
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-3">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Idioma Atual:</span>
                    <Badge variant="outline" className="text-slate-700">
                      {(jworg as any)?.currentLanguage === 'en' ? 'üá∫üá∏ English' : 'üáßüá∑ Portugu√™s'}
                    </Badge>
                  </div>
                  <div className="flex flex-wrap gap-2">
                    <Button size="sm" variant="outline" onClick={toggleLanguage}>
                      Alternar Idioma
                    </Button>
                    <Button size="sm" variant="outline" onClick={updateMaterials}>
                      Atualizar Materiais
                    </Button>
                    <Button size="sm" variant="outline" onClick={handleTestJWorgIntegration}>
                      Testar Integra√ß√£o JW.org
                    </Button>
                    <Button size="sm" variant="outline" onClick={checkForUpdates} disabled={loading}>
                      Atualizar Contagens
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* Usu√°rios */}
          <TabsContent value="users" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                üë• Gest√£o de Usu√°rios para Acesso √†s Apostilas MWB
              </h3>
              <p className="text-center text-sm text-muted-foreground mt-2">
                üéØ Fun√ß√£o Principal: Admin gerencia usu√°rios ‚Üí Instrutores acessam apostilas
              </p>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* Estat√≠sticas de Usu√°rios */}
            <Card>
              <CardHeader>
                  <CardTitle>Estat√≠sticas</CardTitle>
                  <CardDescription>Resumo dos usu√°rios</CardDescription>
              </CardHeader>
                <CardContent>
                  <div className="space-y-4">
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Total de Usu√°rios:</span>
                      <Badge variant="outline">{staticStats.total_users}</Badge>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Admins:</span>
                      <Badge variant="outline" className="bg-red-50 text-red-700">
                        {isAdmin ? 1 : 0}
                      </Badge>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Instrutores:</span>
                      <Badge variant="outline" className="bg-blue-50 text-blue-700">
                        {staticStats.total_users - (isAdmin ? 1 : 0)}
                      </Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Usu√°rios Registrados */}
              <Card className="lg:col-span-2">
                <CardHeader>
                  <CardTitle>Usu√°rios Registrados</CardTitle>
                  <CardDescription>√öltimos usu√°rios cadastrados no sistema</CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-center justify-between p-3 border rounded-lg">
                      <div className="flex items-center space-x-3">
                        <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                          <Users className="h-5 w-5 text-blue-600" />
                        </div>
                        <div>
                          <p className="font-medium">{profile?.nome_completo || 'Roberto Araujo da Silva'}</p>
                          <p className="text-sm text-muted-foreground">Administrator</p>
                        </div>
                      </div>
                      <Badge variant="outline" className="bg-red-50 text-red-700">
                        Admin
                      </Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* A√ß√µes Administrativas */}
            <Card>
              <CardHeader>
                <CardTitle>A√ß√µes Administrativas</CardTitle>
                <CardDescription>
                  Gerenciar usu√°rios e permiss√µes
                </CardDescription>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <Button className="w-full justify-start" variant="outline" onClick={handleListUsers}>
                    <Users className="h-4 w-4 mr-2" />
                    Listar Todos os Usu√°rios
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleManagePermissions}>
                    <Settings className="h-4 w-4 mr-2" />
                    Gerenciar Permiss√µes
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleActivityReport}>
                    <Activity className="h-4 w-4 mr-2" />
                    Relat√≥rio de Atividades
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleBackupData}>
                    <Database className="h-4 w-4 mr-2" />
                    Backup de Dados
                  </Button>
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          {/* Congrega√ß√µes */}
          <TabsContent value="congregations" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                üè¢ Gest√£o de Congrega√ß√µes para Acesso √†s Apostilas MWB
              </h3>
              <p className="text-center text-sm text-muted-foreground mt-2">
                üéØ Fun√ß√£o Principal: Admin gerencia congrega√ß√µes ‚Üí Instrutores acessam apostilas
              </p>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* Estat√≠sticas de Congrega√ß√µes */}
            <Card>
              <CardHeader>
                  <CardTitle>Estat√≠sticas</CardTitle>
                  <CardDescription>Resumo das congrega√ß√µes</CardDescription>
              </CardHeader>
              <CardContent>
                  <div className="space-y-4">
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Total de Congrega√ß√µes:</span>
                      <Badge variant="outline">{staticStats.total_congregations}</Badge>
                  </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Congrega√ß√µes Ativas:</span>
                      <Badge variant="outline" className="bg-green-50 text-green-700">
                        {staticStats.active_congregations}
                      </Badge>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Total de Estudantes:</span>
                      <Badge variant="outline">{staticStats.total_estudantes}</Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Lista de Congrega√ß√µes */}
              <Card className="lg:col-span-2">
                <CardHeader>
                  <CardTitle>Congrega√ß√µes Registradas</CardTitle>
                  <CardDescription>Lista das congrega√ß√µes no sistema</CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-center justify-between p-3 border rounded-lg">
                      <div className="flex items-center space-x-3">
                        <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                          <Package className="h-5 w-5 text-blue-600" />
                        </div>
                        <div>
                          <p className="font-medium">Sistema Ministerial Global</p>
                          <p className="text-sm text-muted-foreground">Congrega√ß√£o Principal</p>
                          </div>
                        </div>
                      <Badge variant="outline" className="bg-green-50 text-green-700">
                        Ativa
                        </Badge>
                      </div>
                  </div>
                  
                  <div className="mt-4">
                    <Button variant="outline" className="w-full" onClick={() => handleManageCongregation('Sistema Ministerial Global')}>
                      <Users className="h-4 w-4 mr-2" />
                      Gerenciar
                    </Button>
                  </div>
                  
                  <div className="mt-4">
                    <Button variant="outline" className="w-full" onClick={handleAddCongregation}>
                      <Users className="h-4 w-4 mr-2" />
                      Adicionar Nova Congrega√ß√£o
                    </Button>
                  </div>
                  
                  <div className="mt-4">
                    <Button variant="outline" className="w-full">
                      <Users className="h-4 w-4 mr-2" />
                      Expandir
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* Sistema */}
          <TabsContent value="system" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                ‚öôÔ∏è Monitoramento e Configura√ß√µes do Sistema
              </h3>
              <p className="text-center text-sm text-muted-foreground mt-2">
                üéØ Fun√ß√£o Principal: Admin monitora sistema ‚Üí Instrutores recebem apostilas est√°veis
              </p>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* Downloads JW.org */}
              <Card className="bg-green-50 border-green-200">
              <CardHeader>
                  <CardTitle className="text-green-800">üìö JW.org Downloads</CardTitle>
                  <CardDescription className="text-green-700">
                    Gerenciar materiais oficiais
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Apostila MWB Atual:</span>
                    <Badge variant="outline" className="text-green-600">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Dispon√≠vel
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">√öltima verifica√ß√£o:</span>
                    <span className="text-sm text-green-700">Hoje, 10:30</span>
                  </div>
                  <div className="flex space-x-2">
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleSyncCongregations}>
                      <RefreshCw className="h-3 w-3 mr-1" />
                      Sincronizar com Congrega√ß√µes
                    </Button>
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleViewFullProgram}>
                      <Settings className="h-3 w-3 mr-1" />
                      Ver Programa√ß√£o Completa
                    </Button>
                </div>
              </CardContent>
            </Card>

              {/* Configura√ß√µes Gerais */}
            <Card>
              <CardHeader>
                  <CardTitle>Configura√ß√µes Gerais</CardTitle>
                <CardDescription>
                    Par√¢metros do sistema
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-4">
                    <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Backup Autom√°tico:</span>
                    <Badge variant="outline" className="bg-green-50 text-green-700">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Di√°rio √†s 02:00
                      </Badge>
                    </div>
                    <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Notifica√ß√µes:</span>
                    <Badge variant="outline" className="bg-blue-50 text-blue-700">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Email + Sistema
                    </Badge>
                    </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Manuten√ß√£o:</span>
                    <span className="text-sm text-muted-foreground">√öltima: Ontem</span>
                  </div>
                  <div className="flex space-x-2">
                    <Button size="sm" variant="outline">
                      <Settings className="h-3 w-3 mr-1" />
                      Configurar
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* M√©tricas do Sistema */}
            <Card>
              <CardHeader>
                <CardTitle>M√©tricas do Sistema</CardTitle>
                <CardDescription>
                  Monitoramento em tempo real
                </CardDescription>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-green-600">99.9%</p>
                    <p className="text-sm text-muted-foreground">Uptime</p>
                  </div>
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-blue-600">~120ms</p>
                    <p className="text-sm text-muted-foreground">Lat√™ncia</p>
                  </div>
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-green-600">25%</p>
                    <p className="text-sm text-muted-foreground">CPU</p>
                  </div>
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-blue-600">33%</p>
                    <p className="text-sm text-muted-foreground">Mem√≥ria</p>
                  </div>
                </div>

                <Separator />

                <div className="space-y-3">
                    <div className="flex items-center justify-between">
                    <span className="text-sm">CPU:</span>
                    <div className="flex items-center space-x-2">
                      <div className="w-24 h-2 bg-gray-200 rounded-full">
                        <div className="w-1/4 h-2 bg-green-500 rounded-full"></div>
                    </div>
                        <span className="text-sm">25%</span>
                  </div>
                    </div>
                    
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Mem√≥ria:</span>
                      <div className="flex items-center space-x-2">
                        <div className="w-24 h-2 bg-gray-200 rounded-full">
                          <div className="w-1/3 h-2 bg-blue-500 rounded-full"></div>
                    </div>
                        <span className="text-sm">33%</span>
                      </div>
                    </div>
                    
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Banco:</span>
                      <div className="flex items-center space-x-2">
                        <CheckCircle className="h-4 w-4 text-green-500" />
                        <span className="text-sm">Conectado</span>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>

              {/* Logs e Atividades */}
              <Card>
                <CardHeader>
                  <CardTitle>Logs Recentes</CardTitle>
                  <CardDescription>
                    √öltimas atividades do sistema
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <CheckCircle className="h-4 w-4 text-green-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Sistema iniciado</p>
                        <p className="text-xs text-muted-foreground">Hoje, 08:00</p>
                      </div>
                    </div>

                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <Activity className="h-4 w-4 text-blue-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Backup autom√°tico executado</p>
                        <p className="text-xs text-muted-foreground">Hoje, 02:00</p>
                      </div>
                    </div>

                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <Users className="h-4 w-4 text-green-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Novo usu√°rio registrado</p>
                        <p className="text-xs text-muted-foreground">Ontem, 16:30</p>
                      </div>
                    </div>

                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <AlertCircle className="h-4 w-4 text-yellow-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Manuten√ß√£o programada</p>
                        <p className="text-xs text-muted-foreground">Ontem, 03:00</p>
                      </div>
                    </div>
                  </div>

                  <div className="mt-4">
                    <Button variant="outline" className="w-full" onClick={handleViewAllLogs}>
                      <FileText className="h-4 w-4 mr-2" />
                      Ver Todos os Logs
                    </Button>
                  </div>
                </CardContent>
              </Card>
          </TabsContent>
        </Tabs>
      </div>
    </div>
  );
}

```

Usei o MCP do Supabase para inspecionar seu schema. Ajustes feitos:

- Seu `programas` j√° existe, mas com colunas diferentes das que eu consultei no front. Atualizei o `AdminDashboard` para buscar: `id, semana, mes_apostila, status, data_inicio_semana, arquivo` e ordena√ß√£o por `data_inicio_semana`. Tamb√©m tratei a aus√™ncia de `congregacoes`.

Pr√≥ximo passo para ver algo no Admin:
- Insira pelo menos 1 registro em `public.programas` com essas colunas. Exemplo (rode no Supabase SQL editor):
```sql
insert into public.programas (semana, mes_apostila, status, data_inicio_semana, arquivo)
values ('2025-W31','2025-08','ativo','2025-07-28','mwb_E_202507.pdf');
```

Sobre os PDFs:
- Eles s√£o servidos em `http://localhost:3001/materials/<arquivo>`. Para relacionar com a UI, use a coluna `arquivo` com o nome do PDF existente (ex.: `mwb_E_202509.pdf`). Posso mostrar um link direto no card ‚ÄúPrograma√ß√µes Publicadas‚Äù. Quer que eu adicione o link agora?

```sql
insert into public.programas (semana, mes_apostila, status, data_inicio_semana, arquivo)
values ('2025-W31','2025-08','ativo','2025-07-28','mwb_E_202507.pdf');
```

---

**User**

sim

---

**Cursor**

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo, lazy, Suspense } from 'react';
import { useAuth } from '../contexts/AuthContext';
import { supabase } from '../integrations/supabase/client';
import { useJWorgIntegration } from '../hooks/useJWorgIntegration';
import { JWorgTest } from '../components/JWorgTest';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../components/ui/card';
import LazyLoader from '../components/LazyLoader';
import AuthErrorHandler from '../components/AuthErrorHandler';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '../components/ui/tabs';
import { Button } from '../components/ui/button';
import { Badge } from '../components/ui/badge';
import { Separator } from '../components/ui/separator';
import { 
  Download, 
  Upload, 
  Globe, 
  BarChart3, 
  Settings, 
  RefreshCw,
  CheckCircle,
  AlertCircle,
  Clock,
  FileText,
  Users,
  Package,
  Activity,
  Database
} from 'lucide-react';

// üöÄ Lazy loading para componentes pesados (comentado por enquanto)
// const JWorgTestLazy = lazy(() => import('../components/JWorgTest'));

interface SystemStats {
  total_congregations: number;
  active_congregations: number;
  total_users: number;
  total_estudantes: number;
  total_programas: number;
  last_sync: string;
}

export default function AdminDashboard() {
  const { user, profile, isAdmin } = useAuth();
  const jworg = useJWorgIntegration();
  const [activeTab, setActiveTab] = useState('overview');
  const [loading, setLoading] = useState(false);
  const [systemStats, setSystemStats] = useState<SystemStats | null>(null);
  const [lastCheck, setLastCheck] = useState<string>('');
  const [debugInfo, setDebugInfo] = useState<string>('');
  const [showJWorgTest, setShowJWorgTest] = useState(false);
  const [programs, setPrograms] = useState<any[]>([]);
  const [programsLoading, setProgramsLoading] = useState<boolean>(false);

  // üöÄ Memoiza√ß√£o de dados est√°ticos para reduzir re-renders
  const staticStats = useMemo(() => ({
    total_congregations: systemStats?.total_congregations || 0,
    active_congregations: systemStats?.active_congregations || 0,
    total_users: systemStats?.total_users || 0,
    total_estudantes: systemStats?.total_estudantes || 0,
    total_programas: systemStats?.total_programas || 0,
    last_sync: systemStats?.last_sync || ''
  }), [systemStats]);

  // üöÄ Debounced function para reduzir chamadas desnecess√°rias
  const debouncedSetDebugInfo = useCallback((info: string) => {
    let timeoutId: NodeJS.Timeout;
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => setDebugInfo(info), 100);
  }, []);

  // DEBUG: Log component state (otimizado)
  useEffect(() => {
    const debugData = {
      user: !!user,
      userId: user?.id,
      userEmail: user?.email,
      profile: !!profile,
      profileRole: profile?.role,
      isAdmin,
      loading,
      userMetadata: user?.user_metadata
    };

    console.log('üîç AdminDashboard Component Debug:', debugData);
    debouncedSetDebugInfo(JSON.stringify(debugData, null, 2));
  }, [user, profile, isAdmin, loading, debouncedSetDebugInfo]);

  useEffect(() => {
    console.log('üîÑ AdminDashboard useEffect triggered:', { user, isAdmin });
    
    if (user && isAdmin) {
      console.log('‚úÖ Admin user detected, loading system data...');
      loadSystemData();
    } else if (user && !isAdmin) {
      console.log('‚ùå User is not admin, role:', profile?.role);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå User is not admin, role: ' + profile?.role);
    } else if (!user) {
      console.log('‚ùå No user found');
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå No user found');
    }
  }, [user, isAdmin, debouncedSetDebugInfo]);

  const loadSystemData = useCallback(async () => {
    if (!user || !isAdmin) {
      console.log('üö´ loadSystemData: User not admin or not logged in');
      return;
    }
    
    console.log('üîÑ Loading system data for admin...');
    setLoading(true);
    try {
      // Testar conex√£o com Supabase
      console.log('üîç Testing Supabase connection...');
      const { count: profilesCount, error: testError } = await supabase
        .from('profiles')
        .select('*', { count: 'exact', head: true });
      
      if (testError) {
        console.error('‚ùå Supabase connection test failed:', testError);
        debouncedSetDebugInfo(debugInfo + '\n\n‚ùå Supabase Test Failed: ' + testError.message);
        return;
      }

        console.log('‚úÖ Supabase connection test successful');
      debouncedSetDebugInfo(debugInfo + '\n\n‚úÖ Supabase Test: Connected');

      // Carregar estat√≠sticas do sistema
      await loadSystemStats();
      // Carregar programa√ß√µes publicadas
      await loadPrograms();

    } catch (error) {
      console.error('‚ùå Supabase test exception:', error);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå Supabase Test Exception: ' + error);
    } finally {
      setLoading(false);
    }
  }, [user, isAdmin, debouncedSetDebugInfo, debugInfo]);

  const loadSystemStats = useCallback(async () => {
    try {
      console.log('üìä Loading system statistics...');

      const [profilesRes, estudantesRes, programasRes] = await Promise.all([
        supabase.from('profiles').select('*', { count: 'exact', head: true }),
        supabase.from('estudantes').select('*', { count: 'exact', head: true }),
        supabase.from('programas').select('*', { count: 'exact', head: true }),
      ]);

      // congregacoes (opcional - pode n√£o existir neste projeto)
      let congregacoesCount = 0;
      try {
        const { count: congCount, error: congError } = await supabase
          .from('congregacoes')
          .select('*', { count: 'exact', head: true });
        if (!congError && typeof congCount === 'number') {
          congregacoesCount = congCount;
        }
      } catch (_) {}

      const stats: SystemStats = {
        total_congregations: congregacoesCount,
        active_congregations: congregacoesCount,
        total_users: (profilesRes.count as number) || 0,
        total_estudantes: (estudantesRes.count as number) || 0,
        total_programas: (programasRes.count as number) || 0,
        last_sync: new Date().toISOString(),
      };

      setSystemStats(stats);
      setLastCheck(new Date().toISOString());

      console.log('‚úÖ System stats loaded:', stats);
      debouncedSetDebugInfo(debugInfo + '\n\n‚úÖ System Stats Loaded: ' + JSON.stringify(stats, null, 2));

    } catch (error) {
      console.error('‚ùå Error loading system stats:', error);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå System Stats Error: ' + error);
    }
  }, [debouncedSetDebugInfo, debugInfo, supabase]);

  const loadPrograms = useCallback(async () => {
    try {
      setProgramsLoading(true);
      const { data, error } = await supabase
        .from('programas')
        .select('id, semana, mes_apostila, status, data_inicio_semana, arquivo')
        .order('data_inicio_semana', { ascending: false })
        .limit(12);
      if (error) throw error;
      setPrograms(data || []);
      console.log('‚úÖ Programs loaded:', data?.length || 0);
    } catch (error: any) {
      console.error('‚ùå Error loading programs:', error);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå Programs Load Error: ' + (error?.message || error));
    } finally {
      setProgramsLoading(false);
    }
  }, [debouncedSetDebugInfo, debugInfo]);

  const checkForUpdates = useCallback(async () => {
    console.log('üîÑ Checking for updates...');
    setLoading(true);
    
    try {
      await loadSystemStats();
      await loadPrograms();
      console.log('‚úÖ Updates checked successfully');
    } catch (error) {
      console.error('‚ùå Error checking updates:', error);
    } finally {
      setLoading(false);
    }
  }, [loadSystemStats]);

  const testSupabaseConnection = useCallback(async () => {
    console.log('üîß Testing Supabase connection...');
    
    try {
      const { count, error } = await supabase
        .from('profiles')
        .select('*', { count: 'exact', head: true });

      if (error) {
        console.error('‚ùå Supabase test error:', error);
        alert('Supabase test error: ' + error.message);
      } else {
        console.log('‚úÖ Supabase test successful. Profiles count:', count);
        alert('Supabase test successful! Total profiles: ' + (count ?? 0));
      }
    } catch (error) {
      console.error('‚ùå Supabase test exception:', error);
      alert('Supabase test exception: ' + error);
    }
  }, []);

  // ========== HANDLERS DOS BOT√ïES ==========
  
  const handleListUsers = useCallback(async () => {
    console.log('üë• Listando usu√°rios...');
    try {
      const { data: users, error } = await supabase
        .from('profiles')
        .select('id, nome_completo, role, congregacao, cargo')
        .order('nome_completo');
      
      if (error) throw error;
      
      console.log('‚úÖ Usu√°rios carregados:', users);
      alert(`Encontrados ${users?.length || 0} usu√°rios no sistema:\n\n${users?.map(u => `${u.nome_completo || u.id} - ${u.role} (${u.congregacao || 'N/A'})`).join('\n')}`);
    } catch (error) {
      console.error('‚ùå Erro ao listar usu√°rios:', error);
      alert('Erro ao carregar usu√°rios: ' + error.message);
    }
  }, []);

  const handleManagePermissions = useCallback(async () => {
    console.log('‚öôÔ∏è Gerenciando permiss√µes...');
    const newRole = prompt('Digite o novo role (admin, instrutor, estudante):');
    if (!newRole) return;
    
    // Validar role
    const validRoles = ['admin', 'instrutor', 'estudante', 'family_member', 'developer'];
    if (!validRoles.includes(newRole)) {
      alert('Role inv√°lido. Use: admin, instrutor, estudante, family_member ou developer');
      return;
    }
    
    const userId = prompt('Digite o ID do usu√°rio:');
    if (!userId) return;
    
    try {
      const { error } = await supabase
        .from('profiles')
        .update({ role: newRole as any })
        .eq('id', userId);
      
      if (error) throw error;
      
      console.log('‚úÖ Permiss√£o atualizada');
      alert('Permiss√£o atualizada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao atualizar permiss√£o:', error);
      alert('Erro ao atualizar permiss√£o: ' + error.message);
    }
  }, []);

  const handleActivityReport = useCallback(async () => {
    console.log('üìä Gerando relat√≥rio de atividades...');
    try {
      // Simula√ß√£o de relat√≥rio
      const report = {
        totalUsers: staticStats.total_users,
        totalCongregations: staticStats.total_congregations,
        lastUpdate: new Date().toLocaleString('pt-BR'),
        activeUsers: Math.floor(staticStats.total_users * 0.8)
      };
      
      alert(`üìä Relat√≥rio de Atividades:\n\n` +
            `‚Ä¢ Total de usu√°rios: ${report.totalUsers}\n` +
            `‚Ä¢ Usu√°rios ativos: ${report.activeUsers}\n` +
            `‚Ä¢ Total de congrega√ß√µes: ${report.totalCongregations}\n` +
            `‚Ä¢ √öltima atualiza√ß√£o: ${report.lastUpdate}`);
    } catch (error) {
      console.error('‚ùå Erro ao gerar relat√≥rio:', error);
      alert('Erro ao gerar relat√≥rio: ' + error.message);
    }
  }, [staticStats]);

  const handleBackupData = useCallback(async () => {
    console.log('üíæ Fazendo backup dos dados...');
    try {
      const { data: profiles, error: profilesError } = await supabase
        .from('profiles')
        .select('*');
      
      if (profilesError) throw profilesError;
      
      // Simular backup
      const backupData = {
        timestamp: new Date().toISOString(),
        profiles: profiles,
        stats: staticStats
      };
      
      const dataStr = JSON.stringify(backupData, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      
      const link = document.createElement('a');
      link.href = url;
      link.download = `backup_sistema_ministerial_${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      
      URL.revokeObjectURL(url);
      console.log('‚úÖ Backup criado com sucesso');
      alert('Backup criado e baixado com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao fazer backup:', error);
      alert('Erro ao fazer backup: ' + error.message);
    }
  }, [staticStats]);

  // Congrega√ß√µes
  const handleManageCongregation = useCallback((congregationName: string) => {
    console.log('üè¢ Gerenciando congrega√ß√£o:', congregationName);
    alert(`üè¢ Gerenciando congrega√ß√£o: ${congregationName}\n\nEsta funcionalidade abrir√° o painel de gerenciamento da congrega√ß√£o.`);
  }, []);

  const handleAddCongregation = useCallback(async () => {
    console.log('‚ûï Adicionando nova congrega√ß√£o...');
    const congregationName = prompt('Digite o nome da nova congrega√ß√£o:');
    if (!congregationName) return;
    
    try {
      // Simula√ß√£o - em produ√ß√£o seria inser√ß√£o no Supabase
      console.log('‚úÖ Congrega√ß√£o adicionada:', congregationName);
      alert(`‚úÖ Congrega√ß√£o "${congregationName}" adicionada com sucesso!\n\nEla agora receber√° automaticamente a programa√ß√£o oficial.`);
    } catch (error) {
      console.error('‚ùå Erro ao adicionar congrega√ß√£o:', error);
      alert('Erro ao adicionar congrega√ß√£o: ' + error.message);
    }
  }, []);

  // JW.org & S-38
  const handleMWBAvailable = useCallback(async () => {
    console.log('üìö Disponibilizando MWB atual...');
    try {
      await jworg.fetchCurrentWeek();
      console.log('‚úÖ MWB atualizada');
      alert('‚úÖ Apostila MWB atual disponibilizada para todas as congrega√ß√µes!');
    } catch (error) {
      console.error('‚ùå Erro ao disponibilizar MWB:', error);
      alert('Erro ao disponibilizar MWB: ' + error.message);
    }
  }, [jworg]);

  const handleConfigureJWorgURLs = useCallback(() => {
    console.log('‚öôÔ∏è Configurando URLs JW.org...');
    const ptUrl = prompt('URL JW.org PT:', 'https://www.jw.org/pt/biblioteca/jw-apostila-do-mes/');
    const enUrl = prompt('URL JW.org EN:', 'https://www.jw.org/en/library/jw-meeting-workbook/');
    
    if (ptUrl && enUrl) {
      console.log('‚úÖ URLs configuradas:', { ptUrl, enUrl });
      alert('‚úÖ URLs JW.org configuradas com sucesso!');
    }
  }, []);

  const handleSyncCongregations = useCallback(async () => {
    console.log('üîÑ Sincronizando com congrega√ß√µes...');
    try {
      // Simula√ß√£o de sincroniza√ß√£o
      const congregationsCount = staticStats.total_congregations;
      console.log(`‚úÖ Sincronizando com ${congregationsCount} congrega√ß√µes`);
      alert(`üîÑ Sincroniza√ß√£o iniciada!\n\nPrograma√ß√£o oficial sendo enviada para ${congregationsCount} congrega√ß√µes...\n\nTempo estimado: ${Math.ceil(congregationsCount / 100)} minutos`);
    } catch (error) {
      console.error('‚ùå Erro na sincroniza√ß√£o:', error);
      alert('Erro na sincroniza√ß√£o: ' + error.message);
    }
  }, [staticStats]);

  // Programa√ß√£o Oficial
  const handleViewFullProgram = useCallback(() => {
    console.log('üìÖ Visualizando programa√ß√£o completa (3 meses)...');
    alert(`üìÖ Programa√ß√£o Completa dos Pr√≥ximos 3 Meses\n\n` +
          `‚Ä¢ Semanas carregadas: 12\n` +
          `‚Ä¢ Idiomas: PT e EN\n` +
          `‚Ä¢ √öltima atualiza√ß√£o: Hoje\n\n` +
          `Esta visualiza√ß√£o mostrar√° todas as apostilas MWB dos pr√≥ximos 3 meses.`);
  }, []);

  const handleUpdateProgramPT = useCallback(async () => {
    console.log('üáßüá∑ Atualizando programa√ß√£o PT...');
    try {
      jworg.setLanguage('pt');
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Programa√ß√£o PT atualizada');
      alert('‚úÖ Programa√ß√£o em Portugu√™s atualizada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao atualizar programa√ß√£o PT:', error);
      alert('Erro ao atualizar programa√ß√£o PT: ' + error.message);
    }
  }, [jworg]);

  const handleUpdateProgramEN = useCallback(async () => {
    console.log('üá∫üá∏ Atualizando programa√ß√£o EN...');
    try {
      jworg.setLanguage('en');
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Programa√ß√£o EN atualizada');
      alert('‚úÖ Programa√ß√£o em Ingl√™s atualizada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao atualizar programa√ß√£o EN:', error);
      alert('Erro ao atualizar programa√ß√£o EN: ' + error.message);
    }
  }, [jworg]);

  const handleCheckNewWeeks = useCallback(async () => {
    console.log('üîç Verificando novas semanas...');
    try {
      await jworg.fetchNextWeeks();
      const newWeeks = jworg.nextWeeks.length;
      console.log(`‚úÖ Verifica√ß√£o conclu√≠da: ${newWeeks} semanas`);
      alert(`üîç Verifica√ß√£o conclu√≠da!\n\nEncontradas ${newWeeks} semanas de programa√ß√£o.\n\nTodas est√£o sincronizadas com JW.org.`);
    } catch (error) {
      console.error('‚ùå Erro ao verificar semanas:', error);
      alert('Erro ao verificar novas semanas: ' + error.message);
    }
  }, [jworg]);

  const handleUpdateS38Structure = useCallback(() => {
    console.log('üèóÔ∏è Atualizando estrutura S-38 global...');
    alert(`üèóÔ∏è Estrutura S-38 Global\n\n` +
          `‚úÖ Partes da reuni√£o atualizadas:\n` +
          `‚Ä¢ Chairman\n‚Ä¢ Treasures\n‚Ä¢ Gems\n‚Ä¢ Reading\n` +
          `‚Ä¢ Starting\n‚Ä¢ Following\n‚Ä¢ Making\n‚Ä¢ Explaining\n` +
          `‚Ä¢ Talk\n\n` +
          `Esta estrutura ser√° aplicada mundialmente.`);
  }, []);

  // JW.org Integration
  const handleReloadCurrentWeek = useCallback(async () => {
    console.log('üîÑ Recarregando semana atual...');
    try {
      await jworg.fetchCurrentWeek();
      console.log('‚úÖ Semana atual recarregada');
      alert('‚úÖ Semana atual recarregada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao recarregar semana:', error);
      alert('Erro ao recarregar semana: ' + error.message);
    }
  }, [jworg]);

  const handleReloadNextWeeks = useCallback(async () => {
    console.log('üìÖ Recarregando pr√≥ximas semanas...');
    try {
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Pr√≥ximas semanas recarregadas');
      alert('‚úÖ Pr√≥ximas semanas recarregadas com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao recarregar pr√≥ximas semanas:', error);
      alert('Erro ao recarregar pr√≥ximas semanas: ' + error.message);
    }
  }, [jworg]);

  const handleTestDownloadPT = useCallback(async () => {
    console.log('üß™ Testando download PT...');
    try {
      jworg.setLanguage('pt');
      await jworg.downloadWorkbook('pt', '07', '2025');
      console.log('‚úÖ Download PT testado');
      alert('‚úÖ Download PT testado com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro no teste de download PT:', error);
      alert('Erro no teste de download PT: ' + error.message);
    }
  }, [jworg]);

  // Monitoramento
  const handleViewAllLogs = useCallback(async () => {
    console.log('üìã Visualizando todos os logs...');
    try {
      // Simula√ß√£o de logs
      const logs = [
        { timestamp: new Date().toLocaleString(), event: 'Sistema iniciado', level: 'info' },
        { timestamp: new Date(Date.now() - 3600000).toLocaleString(), event: 'Backup autom√°tico executado', level: 'info' },
        { timestamp: new Date(Date.now() - 86400000).toLocaleString(), event: 'Novo usu√°rio registrado', level: 'info' },
        { timestamp: new Date(Date.now() - 172800000).toLocaleString(), event: 'Manuten√ß√£o programada', level: 'warning' }
      ];
      
      const logText = logs.map(log => `${log.timestamp} [${log.level.toUpperCase()}] ${log.event}`).join('\n');
      alert(`üìã Logs do Sistema\n\n${logText}`);
    } catch (error) {
      console.error('‚ùå Erro ao carregar logs:', error);
      alert('Erro ao carregar logs: ' + error.message);
    }
  }, []);

  const handleTestJWorgIntegration = useCallback(async () => {
    console.log('üß™ Testando integra√ß√£o JW.org...');
    try {
      await jworg.fetchCurrentWeek();
      console.log('‚úÖ Integra√ß√£o JW.org testada com sucesso');
      alert('‚úÖ Integra√ß√£o JW.org funcionando perfeitamente!');
    } catch (error) {
      console.error('‚ùå Erro na integra√ß√£o JW.org:', error);
      alert('‚ùå Erro na integra√ß√£o JW.org: ' + error.message);
    }
  }, [jworg]);

  const handleChangeLanguage = useCallback((newLang: 'pt' | 'en') => {
    jworg.setLanguage(newLang);
    console.log(`üåê Idioma alterado para: ${newLang}`);
    alert(`üåê Idioma alterado para: ${newLang === 'pt' ? 'Portugu√™s' : 'English'}`);
  }, [jworg]);

  // Alterna o idioma atual entre PT/EN
  const toggleLanguage = useCallback(() => {
    const current = (jworg as any)?.currentLanguage ?? 'pt';
    const next = current === 'pt' ? 'en' : 'pt';
    jworg.setLanguage(next);
    console.log(`üåê Idioma alternado: ${current} -> ${next}`);
    alert(`üåê Idioma alternado para: ${next === 'pt' ? 'Portugu√™s' : 'English'}`);
  }, [jworg]);

  // Atualiza materiais JW.org (semana atual + pr√≥ximas semanas)
  const updateMaterials = useCallback(async () => {
    try {
      await jworg.fetchCurrentWeek();
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Materiais JW.org atualizados');
      alert('‚úÖ Materiais JW.org atualizados com sucesso!');
    } catch (error: any) {
      console.error('‚ùå Erro ao atualizar materiais:', error);
      alert('‚ùå Erro ao atualizar materiais: ' + (error?.message || error));
    }
  }, [jworg]);

  // NOW CHECK CONDITIONS AND RENDER APPROPRIATELY
  // Se n√£o for admin, mostrar mensagem de acesso negado
  if (user && !isAdmin) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="max-w-md mx-auto">
          <CardHeader>
            <CardTitle className="text-red-600">Acesso Negado</CardTitle>
            <CardDescription>
              Voc√™ n√£o tem permiss√£o para acessar o painel administrativo.
            </CardDescription>
          </CardHeader>
          <CardContent>
            <p className="text-sm text-muted-foreground mb-4">
              Seu perfil atual: <strong>{profile?.role}</strong>
            </p>
            <Button onClick={() => window.history.back()}>
              Voltar
            </Button>
          </CardContent>
        </Card>
      </div>
    );
  }

  // Se n√£o houver usu√°rio, mostrar loading
  if (!user) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="max-w-md mx-auto">
          <CardHeader>
            <CardTitle>Carregando...</CardTitle>
            <CardDescription>
              Verificando autentica√ß√£o...
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="flex items-center justify-center">
              <RefreshCw className="h-6 w-6 animate-spin" />
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background">
      {/* Auth Error Handler */}
      <AuthErrorHandler />
      
      {/* Header */}
      <div className="border-b">
        <div className="container mx-auto px-4 py-6">
          <div className="flex flex-col space-y-4">
          <div className="flex items-center justify-between">
            <div>
                <h1 className="text-3xl font-bold tracking-tight">üìä Dashboard do Administrador Geral</h1>
                <p className="text-muted-foreground">
                  Programa√ß√£o oficial das reuni√µes ministeriais - Padroniza√ß√£o mundial para todas as congrega√ß√µes
              </p>
            </div>
              <div className="flex items-center space-x-2">
              {/* Force Profile Load Button */}
              {import.meta.env.DEV && (
                <Button 
                  variant="outline" 
                  size="sm"
                    onClick={testSupabaseConnection}
                  >
                    üîß Test Supabase
                </Button>
              )}
              
              <Button onClick={checkForUpdates} disabled={loading}>
                <RefreshCw className={`h-4 w-4 mr-2 ${loading ? 'animate-spin' : ''}`} />
                  Atualizar
              </Button>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Debug Info Panel */}
      {import.meta.env.DEV && (
        <div className="container mx-auto px-4 py-2">
          <Card className="bg-yellow-50 border-yellow-200">
            <CardHeader className="pb-2">
              <CardTitle className="text-sm text-yellow-800">üêõ Debug Info (Development Only)</CardTitle>
            </CardHeader>
            <CardContent>
              <pre className="text-xs text-yellow-700 overflow-auto max-h-40">
                {debugInfo}
              </pre>
            </CardContent>
          </Card>
        </div>
      )}

      {/* Main Content */}
      <div className="container mx-auto px-4 py-6">
        <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
          <TabsList className="grid w-full grid-cols-4">
            <TabsTrigger value="overview">Vis√£o Geral</TabsTrigger>
            <TabsTrigger value="users">Usu√°rios</TabsTrigger>
            <TabsTrigger value="congregations">Congrega√ß√µes</TabsTrigger>
            <TabsTrigger value="system">Sistema</TabsTrigger>
          </TabsList>

          {/* Vis√£o Geral */}
          <TabsContent value="overview" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                üéØ Sistema Ministerial Global - Padroniza√ß√£o Mundial
              </h3>
              <div className="text-center text-sm text-muted-foreground mt-2 p-3 bg-blue-50 rounded-lg border border-blue-200">
                <strong>üìä Admin Geral:</strong> Disponibiliza programa√ß√£o oficial semanal (SEM nomes de estudantes) <br/>
                <strong>üéì Instrutores:</strong> Recebem programa√ß√£o automaticamente + fazem designa√ß√µes locais reais
              </div>
            </div>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Congrega√ß√µes Conectadas</CardTitle>
                  <Globe className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">{staticStats.total_congregations}</div>
                  <p className="text-xs text-muted-foreground">
                    Recebendo programa√ß√£o oficial
                  </p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Semanas Programadas</CardTitle>
                  <BarChart3 className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">12</div>
                  <p className="text-xs text-muted-foreground">
                    Pr√≥ximas 3 meses
                  </p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Idiomas Dispon√≠veis</CardTitle>
                  <Globe className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">2</div>
                  <p className="text-xs text-muted-foreground">
                    Portugu√™s e Ingl√™s
                  </p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">√öltima Sincroniza√ß√£o</CardTitle>
                  <RefreshCw className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">‚úÖ</div>
                  <p className="text-xs text-muted-foreground">
                    Hoje, {new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}
                  </p>
                </CardContent>
              </Card>
            </div>

            {/* A√ß√µes R√°pidas */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* Status do Sistema */}
              <Card>
                <CardHeader>
                  <CardTitle>Status do Sistema</CardTitle>
                  <CardDescription>
                    Informa√ß√µes sobre a √∫ltima verifica√ß√£o e status geral
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">√öltima Verifica√ß√£o:</span>
                    <span className="text-sm text-muted-foreground">
                      {lastCheck ? new Date(lastCheck).toLocaleString('pt-BR') : 'Nunca'}
                    </span>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Status:</span>
                    <Badge variant="outline" className="text-green-600">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Operacional
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Supabase:</span>
                    <Badge variant="outline" className="text-green-600">
                      <Database className="h-3 w-3 mr-1" />
                      Conectado
                    </Badge>
                  </div>
                </CardContent>
              </Card>

              {/* Programa√ß√µes Publicadas */}
              <Card>
                <CardHeader>
                  <CardTitle>Programa√ß√µes Publicadas</CardTitle>
                  <CardDescription>
                    √öltimas semanas importadas/publicadas
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  {programsLoading ? (
                    <div className="text-sm text-muted-foreground">Carregando...</div>
                  ) : programs.length === 0 ? (
                    <div className="text-sm text-muted-foreground">Nenhuma programa√ß√£o encontrada.</div>
                  ) : (
                    <div className="space-y-2">
                      {programs.map((p) => (
                        <div key={p.id} className="p-2 border rounded-md">
                          <div className="flex items-center justify-between">
                            <div className="text-sm">
                              <div className="font-medium">Semana {p.semana || '‚Äî'} ‚Ä¢ {p.mes_apostila || '‚Äî'}</div>
                              <div className="text-xs text-muted-foreground">
                                {p.data_inicio_semana ? new Date(p.data_inicio_semana).toLocaleDateString('pt-BR') : '‚Äî'}
                              </div>
                            </div>
                            <Badge variant="outline" className={p.status === 'ativo' || p.status === 'publicado' ? 'bg-green-50 text-green-700' : ''}>
                              {p.status || '‚Äî'}
                            </Badge>
                          </div>
                          {p.arquivo && (
                            <div className="mt-2">
                              <a
                                href={`http://localhost:3001/materials/${encodeURIComponent(p.arquivo)}`}
                                target="_blank"
                                rel="noopener noreferrer"
                                className="text-blue-600 text-xs underline"
                              >
                                Abrir material ({p.arquivo})
                              </a>
                            </div>
                          )}
                        </div>
                      ))}
                    </div>
                  )}
                </CardContent>
              </Card>

              {/* JW.org Downloads */}
              <Card className="bg-green-50 border-green-200">
                <CardHeader>
                  <CardTitle className="text-green-800">üìö JW.org Downloads</CardTitle>
                  <CardDescription className="text-green-700">
                    Gerenciar materiais oficiais
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Apostila MWB Atual:</span>
                    <Badge variant="outline" className="text-green-600">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Dispon√≠vel
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">√öltima verifica√ß√£o:</span>
                    <span className="text-sm text-green-700">Hoje, 10:30</span>
                  </div>
                  <div className="flex space-x-2">
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleMWBAvailable}>
                      <RefreshCw className="h-3 w-3 mr-1" />
                      Disponibilizar MWB Atual
                    </Button>
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleConfigureJWorgURLs}>
                      <Settings className="h-3 w-3 mr-1" />
                      Configurar URLs JW.org
                    </Button>
                  </div>
                </CardContent>
              </Card>

              {/* Sistema S-38 - Designa√ß√µes */}
              <Card className="bg-purple-50 border-purple-200">
                <CardHeader>
                  <CardTitle className="text-purple-800">‚öôÔ∏è Sistema S-38</CardTitle>
                  <CardDescription className="text-purple-700">
                    Estrutura das reuni√µes ministeriais
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="text-sm text-purple-700 space-y-2">
                    <p>üìö <strong>Fun√ß√£o do Admin:</strong> Disponibilizar apostilas MWB</p>
                    <p>üë• <strong>Para Instrutores:</strong> Designar estudantes para partes</p>
                    <p>üéØ <strong>Partes da Reuni√£o:</strong></p>
                    <div className="grid grid-cols-2 gap-1 text-xs ml-2">
                      <div>‚Ä¢ Chairman</div>
                      <div>‚Ä¢ Treasures</div>
                      <div>‚Ä¢ Gems</div>
                      <div>‚Ä¢ Reading</div>
                      <div>‚Ä¢ Starting</div>
                      <div>‚Ä¢ Following</div>
                      <div>‚Ä¢ Making</div>
                      <div>‚Ä¢ Explaining</div>
                      <div>‚Ä¢ Talk</div>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Debug / Integra√ß√£o */}
              <Card className="bg-slate-50 border-slate-200">
                <CardHeader>
                  <CardTitle className="text-slate-800">üß™ Debug / Integra√ß√£o</CardTitle>
                  <CardDescription className="text-slate-700">
                    Ferramentas r√°pidas para validar integra√ß√µes e idioma
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-3">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Idioma Atual:</span>
                    <Badge variant="outline" className="text-slate-700">
                      {(jworg as any)?.currentLanguage === 'en' ? 'üá∫üá∏ English' : 'üáßüá∑ Portugu√™s'}
                    </Badge>
                  </div>
                  <div className="flex flex-wrap gap-2">
                    <Button size="sm" variant="outline" onClick={toggleLanguage}>
                      Alternar Idioma
                    </Button>
                    <Button size="sm" variant="outline" onClick={updateMaterials}>
                      Atualizar Materiais
                    </Button>
                    <Button size="sm" variant="outline" onClick={handleTestJWorgIntegration}>
                      Testar Integra√ß√£o JW.org
                    </Button>
                    <Button size="sm" variant="outline" onClick={checkForUpdates} disabled={loading}>
                      Atualizar Contagens
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* Usu√°rios */}
          <TabsContent value="users" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                üë• Gest√£o de Usu√°rios para Acesso √†s Apostilas MWB
              </h3>
              <p className="text-center text-sm text-muted-foreground mt-2">
                üéØ Fun√ß√£o Principal: Admin gerencia usu√°rios ‚Üí Instrutores acessam apostilas
              </p>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* Estat√≠sticas de Usu√°rios */}
            <Card>
              <CardHeader>
                  <CardTitle>Estat√≠sticas</CardTitle>
                  <CardDescription>Resumo dos usu√°rios</CardDescription>
              </CardHeader>
                <CardContent>
                  <div className="space-y-4">
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Total de Usu√°rios:</span>
                      <Badge variant="outline">{staticStats.total_users}</Badge>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Admins:</span>
                      <Badge variant="outline" className="bg-red-50 text-red-700">
                        {isAdmin ? 1 : 0}
                      </Badge>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Instrutores:</span>
                      <Badge variant="outline" className="bg-blue-50 text-blue-700">
                        {staticStats.total_users - (isAdmin ? 1 : 0)}
                      </Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Usu√°rios Registrados */}
              <Card className="lg:col-span-2">
                <CardHeader>
                  <CardTitle>Usu√°rios Registrados</CardTitle>
                  <CardDescription>√öltimos usu√°rios cadastrados no sistema</CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-center justify-between p-3 border rounded-lg">
                      <div className="flex items-center space-x-3">
                        <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                          <Users className="h-5 w-5 text-blue-600" />
                        </div>
                        <div>
                          <p className="font-medium">{profile?.nome_completo || 'Roberto Araujo da Silva'}</p>
                          <p className="text-sm text-muted-foreground">Administrator</p>
                        </div>
                      </div>
                      <Badge variant="outline" className="bg-red-50 text-red-700">
                        Admin
                      </Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* A√ß√µes Administrativas */}
            <Card>
              <CardHeader>
                <CardTitle>A√ß√µes Administrativas</CardTitle>
                <CardDescription>
                  Gerenciar usu√°rios e permiss√µes
                </CardDescription>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <Button className="w-full justify-start" variant="outline" onClick={handleListUsers}>
                    <Users className="h-4 w-4 mr-2" />
                    Listar Todos os Usu√°rios
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleManagePermissions}>
                    <Settings className="h-4 w-4 mr-2" />
                    Gerenciar Permiss√µes
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleActivityReport}>
                    <Activity className="h-4 w-4 mr-2" />
                    Relat√≥rio de Atividades
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleBackupData}>
                    <Database className="h-4 w-4 mr-2" />
                    Backup de Dados
                  </Button>
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          {/* Congrega√ß√µes */}
          <TabsContent value="congregations" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                üè¢ Gest√£o de Congrega√ß√µes para Acesso √†s Apostilas MWB
              </h3>
              <p className="text-center text-sm text-muted-foreground mt-2">
                üéØ Fun√ß√£o Principal: Admin gerencia congrega√ß√µes ‚Üí Instrutores acessam apostilas
              </p>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* Estat√≠sticas de Congrega√ß√µes */}
            <Card>
              <CardHeader>
                  <CardTitle>Estat√≠sticas</CardTitle>
                  <CardDescription>Resumo das congrega√ß√µes</CardDescription>
              </CardHeader>
              <CardContent>
                  <div className="space-y-4">
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Total de Congrega√ß√µes:</span>
                      <Badge variant="outline">{staticStats.total_congregations}</Badge>
                  </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Congrega√ß√µes Ativas:</span>
                      <Badge variant="outline" className="bg-green-50 text-green-700">
                        {staticStats.active_congregations}
                      </Badge>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Total de Estudantes:</span>
                      <Badge variant="outline">{staticStats.total_estudantes}</Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Lista de Congrega√ß√µes */}
              <Card className="lg:col-span-2">
                <CardHeader>
                  <CardTitle>Congrega√ß√µes Registradas</CardTitle>
                  <CardDescription>Lista das congrega√ß√µes no sistema</CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-center justify-between p-3 border rounded-lg">
                      <div className="flex items-center space-x-3">
                        <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                          <Package className="h-5 w-5 text-blue-600" />
                        </div>
                        <div>
                          <p className="font-medium">Sistema Ministerial Global</p>
                          <p className="text-sm text-muted-foreground">Congrega√ß√£o Principal</p>
                          </div>
                        </div>
                      <Badge variant="outline" className="bg-green-50 text-green-700">
                        Ativa
                        </Badge>
                      </div>
                  </div>
                  
                  <div className="mt-4">
                    <Button variant="outline" className="w-full" onClick={() => handleManageCongregation('Sistema Ministerial Global')}>
                      <Users className="h-4 w-4 mr-2" />
                      Gerenciar
                    </Button>
                  </div>
                  
                  <div className="mt-4">
                    <Button variant="outline" className="w-full" onClick={handleAddCongregation}>
                      <Users className="h-4 w-4 mr-2" />
                      Adicionar Nova Congrega√ß√£o
                    </Button>
                  </div>
                  
                  <div className="mt-4">
                    <Button variant="outline" className="w-full">
                      <Users className="h-4 w-4 mr-2" />
                      Expandir
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* Sistema */}
          <TabsContent value="system" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                ‚öôÔ∏è Monitoramento e Configura√ß√µes do Sistema
              </h3>
              <p className="text-center text-sm text-muted-foreground mt-2">
                üéØ Fun√ß√£o Principal: Admin monitora sistema ‚Üí Instrutores recebem apostilas est√°veis
              </p>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* Downloads JW.org */}
              <Card className="bg-green-50 border-green-200">
              <CardHeader>
                  <CardTitle className="text-green-800">üìö JW.org Downloads</CardTitle>
                  <CardDescription className="text-green-700">
                    Gerenciar materiais oficiais
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Apostila MWB Atual:</span>
                    <Badge variant="outline" className="text-green-600">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Dispon√≠vel
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">√öltima verifica√ß√£o:</span>
                    <span className="text-sm text-green-700">Hoje, 10:30</span>
                  </div>
                  <div className="flex space-x-2">
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleSyncCongregations}>
                      <RefreshCw className="h-3 w-3 mr-1" />
                      Sincronizar com Congrega√ß√µes
                    </Button>
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleViewFullProgram}>
                      <Settings className="h-3 w-3 mr-1" />
                      Ver Programa√ß√£o Completa
                    </Button>
                </div>
              </CardContent>
            </Card>

              {/* Configura√ß√µes Gerais */}
            <Card>
              <CardHeader>
                  <CardTitle>Configura√ß√µes Gerais</CardTitle>
                <CardDescription>
                    Par√¢metros do sistema
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-4">
                    <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Backup Autom√°tico:</span>
                    <Badge variant="outline" className="bg-green-50 text-green-700">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Di√°rio √†s 02:00
                      </Badge>
                    </div>
                    <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Notifica√ß√µes:</span>
                    <Badge variant="outline" className="bg-blue-50 text-blue-700">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Email + Sistema
                    </Badge>
                    </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Manuten√ß√£o:</span>
                    <span className="text-sm text-muted-foreground">√öltima: Ontem</span>
                  </div>
                  <div className="flex space-x-2">
                    <Button size="sm" variant="outline">
                      <Settings className="h-3 w-3 mr-1" />
                      Configurar
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* M√©tricas do Sistema */}
            <Card>
              <CardHeader>
                <CardTitle>M√©tricas do Sistema</CardTitle>
                <CardDescription>
                  Monitoramento em tempo real
                </CardDescription>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-green-600">99.9%</p>
                    <p className="text-sm text-muted-foreground">Uptime</p>
                  </div>
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-blue-600">~120ms</p>
                    <p className="text-sm text-muted-foreground">Lat√™ncia</p>
                  </div>
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-green-600">25%</p>
                    <p className="text-sm text-muted-foreground">CPU</p>
                  </div>
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-blue-600">33%</p>
                    <p className="text-sm text-muted-foreground">Mem√≥ria</p>
                  </div>
                </div>

                <Separator />

                <div className="space-y-3">
                    <div className="flex items-center justify-between">
                    <span className="text-sm">CPU:</span>
                    <div className="flex items-center space-x-2">
                      <div className="w-24 h-2 bg-gray-200 rounded-full">
                        <div className="w-1/4 h-2 bg-green-500 rounded-full"></div>
                    </div>
                        <span className="text-sm">25%</span>
                  </div>
                    </div>
                    
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Mem√≥ria:</span>
                      <div className="flex items-center space-x-2">
                        <div className="w-24 h-2 bg-gray-200 rounded-full">
                          <div className="w-1/3 h-2 bg-blue-500 rounded-full"></div>
                    </div>
                        <span className="text-sm">33%</span>
                      </div>
                    </div>
                    
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Banco:</span>
                      <div className="flex items-center space-x-2">
                        <CheckCircle className="h-4 w-4 text-green-500" />
                        <span className="text-sm">Conectado</span>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>

              {/* Logs e Atividades */}
              <Card>
                <CardHeader>
                  <CardTitle>Logs Recentes</CardTitle>
                  <CardDescription>
                    √öltimas atividades do sistema
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <CheckCircle className="h-4 w-4 text-green-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Sistema iniciado</p>
                        <p className="text-xs text-muted-foreground">Hoje, 08:00</p>
                      </div>
                    </div>

                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <Activity className="h-4 w-4 text-blue-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Backup autom√°tico executado</p>
                        <p className="text-xs text-muted-foreground">Hoje, 02:00</p>
                      </div>
                    </div>

                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <Users className="h-4 w-4 text-green-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Novo usu√°rio registrado</p>
                        <p className="text-xs text-muted-foreground">Ontem, 16:30</p>
                      </div>
                    </div>

                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <AlertCircle className="h-4 w-4 text-yellow-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Manuten√ß√£o programada</p>
                        <p className="text-xs text-muted-foreground">Ontem, 03:00</p>
                      </div>
                    </div>
                  </div>

                  <div className="mt-4">
                    <Button variant="outline" className="w-full" onClick={handleViewAllLogs}>
                      <FileText className="h-4 w-4 mr-2" />
                      Ver Todos os Logs
                    </Button>
                  </div>
                </CardContent>
              </Card>
          </TabsContent>
        </Tabs>
      </div>
    </div>
  );
}

```

Adicionei no card ‚ÄúPrograma√ß√µes Publicadas‚Äù um link ‚ÄúAbrir material (arquivo)‚Äù para `http://localhost:3001/materials/<arquivo>`, usando `encodeURIComponent` para nomes com espa√ßos/par√™nteses. 

Para testar agora:
- Insira um registro em `public.programas` com `arquivo = 'mwb_E_202509.pdf'` (ou outro dos seus PDFs).
- Recarregue o Admin em http://localhost:8080/admin e clique em ‚ÄúAbrir material‚Äù.

Se quiser, adiciono um bot√£o ‚ÄúSincronizar materiais‚Äù que cria automaticamente linhas em `programas` a partir dos PDFs existentes em `docs/Oficial`.

---

**User**

client.ts:76  HEAD https://nwpuurgwnnuejqinkvrh.supabase.co/rest/v1/congregacoes?select=* 404 (Not Found)
fetch @ client.ts:76
(an√¥nimo) @ @supabase_supabase-js.js?v=a0d85490:4230
(an√¥nimo) @ @supabase_supabase-js.js?v=a0d85490:4251
fulfilled @ @supabase_supabase-js.js?v=a0d85490:4203
Promise.then
step @ @supabase_supabase-js.js?v=a0d85490:4216
(an√¥nimo) @ @supabase_supabase-js.js?v=a0d85490:4218
__awaiter6 @ @supabase_supabase-js.js?v=a0d85490:4200
(an√¥nimo) @ @supabase_supabase-js.js?v=a0d85490:4241
then @ @supabase_supabase-js.js?v=a0d85490:90


---

**Cursor**

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo, lazy, Suspense } from 'react';
import { useAuth } from '../contexts/AuthContext';
import { supabase } from '../integrations/supabase/client';
import { useJWorgIntegration } from '../hooks/useJWorgIntegration';
import { JWorgTest } from '../components/JWorgTest';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../components/ui/card';
import LazyLoader from '../components/LazyLoader';
import AuthErrorHandler from '../components/AuthErrorHandler';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '../components/ui/tabs';
import { Button } from '../components/ui/button';
import { Badge } from '../components/ui/badge';
import { Separator } from '../components/ui/separator';
import { 
  Download, 
  Upload, 
  Globe, 
  BarChart3, 
  Settings, 
  RefreshCw,
  CheckCircle,
  AlertCircle,
  Clock,
  FileText,
  Users,
  Package,
  Activity,
  Database
} from 'lucide-react';

// üöÄ Lazy loading para componentes pesados (comentado por enquanto)
// const JWorgTestLazy = lazy(() => import('../components/JWorgTest'));

interface SystemStats {
  total_congregations: number;
  active_congregations: number;
  total_users: number;
  total_estudantes: number;
  total_programas: number;
  last_sync: string;
}

export default function AdminDashboard() {
  const { user, profile, isAdmin } = useAuth();
  const jworg = useJWorgIntegration();
  const [activeTab, setActiveTab] = useState('overview');
  const [loading, setLoading] = useState(false);
  const [systemStats, setSystemStats] = useState<SystemStats | null>(null);
  const [lastCheck, setLastCheck] = useState<string>('');
  const [debugInfo, setDebugInfo] = useState<string>('');
  const [showJWorgTest, setShowJWorgTest] = useState(false);
  const [programs, setPrograms] = useState<any[]>([]);
  const [programsLoading, setProgramsLoading] = useState<boolean>(false);

  // üöÄ Memoiza√ß√£o de dados est√°ticos para reduzir re-renders
  const staticStats = useMemo(() => ({
    total_congregations: systemStats?.total_congregations || 0,
    active_congregations: systemStats?.active_congregations || 0,
    total_users: systemStats?.total_users || 0,
    total_estudantes: systemStats?.total_estudantes || 0,
    total_programas: systemStats?.total_programas || 0,
    last_sync: systemStats?.last_sync || ''
  }), [systemStats]);

  // üöÄ Debounced function para reduzir chamadas desnecess√°rias
  const debouncedSetDebugInfo = useCallback((info: string) => {
    let timeoutId: NodeJS.Timeout;
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => setDebugInfo(info), 100);
  }, []);

  // DEBUG: Log component state (otimizado)
  useEffect(() => {
    const debugData = {
      user: !!user,
      userId: user?.id,
      userEmail: user?.email,
      profile: !!profile,
      profileRole: profile?.role,
      isAdmin,
      loading,
      userMetadata: user?.user_metadata
    };

    console.log('üîç AdminDashboard Component Debug:', debugData);
    debouncedSetDebugInfo(JSON.stringify(debugData, null, 2));
  }, [user, profile, isAdmin, loading, debouncedSetDebugInfo]);

  useEffect(() => {
    console.log('üîÑ AdminDashboard useEffect triggered:', { user, isAdmin });
    
    if (user && isAdmin) {
      console.log('‚úÖ Admin user detected, loading system data...');
      loadSystemData();
    } else if (user && !isAdmin) {
      console.log('‚ùå User is not admin, role:', profile?.role);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå User is not admin, role: ' + profile?.role);
    } else if (!user) {
      console.log('‚ùå No user found');
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå No user found');
    }
  }, [user, isAdmin, debouncedSetDebugInfo]);

  const loadSystemData = useCallback(async () => {
    if (!user || !isAdmin) {
      console.log('üö´ loadSystemData: User not admin or not logged in');
      return;
    }
    
    console.log('üîÑ Loading system data for admin...');
    setLoading(true);
    try {
      // Testar conex√£o com Supabase
      console.log('üîç Testing Supabase connection...');
      const { count: profilesCount, error: testError } = await supabase
        .from('profiles')
        .select('*', { count: 'exact', head: true });
      
      if (testError) {
        console.error('‚ùå Supabase connection test failed:', testError);
        debouncedSetDebugInfo(debugInfo + '\n\n‚ùå Supabase Test Failed: ' + testError.message);
        return;
      }

        console.log('‚úÖ Supabase connection test successful');
      debouncedSetDebugInfo(debugInfo + '\n\n‚úÖ Supabase Test: Connected');

      // Carregar estat√≠sticas do sistema
      await loadSystemStats();
      // Carregar programa√ß√µes publicadas
      await loadPrograms();

    } catch (error) {
      console.error('‚ùå Supabase test exception:', error);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå Supabase Test Exception: ' + error);
    } finally {
      setLoading(false);
    }
  }, [user, isAdmin, debouncedSetDebugInfo, debugInfo]);

  const loadSystemStats = useCallback(async () => {
    try {
      console.log('üìä Loading system statistics...');

      const [profilesRes, estudantesRes, programasRes] = await Promise.all([
        supabase.from('profiles').select('*', { count: 'exact', head: true }),
        supabase.from('estudantes').select('*', { count: 'exact', head: true }),
        supabase.from('programas').select('*', { count: 'exact', head: true }),
      ]);

      // congregacoes (removido: tabela pode n√£o existir neste projeto)
      const congregacoesCount = 0;

      const stats: SystemStats = {
        total_congregations: congregacoesCount,
        active_congregations: congregacoesCount,
        total_users: (profilesRes.count as number) || 0,
        total_estudantes: (estudantesRes.count as number) || 0,
        total_programas: (programasRes.count as number) || 0,
        last_sync: new Date().toISOString(),
      };

      setSystemStats(stats);
      setLastCheck(new Date().toISOString());

      console.log('‚úÖ System stats loaded:', stats);
      debouncedSetDebugInfo(debugInfo + '\n\n‚úÖ System Stats Loaded: ' + JSON.stringify(stats, null, 2));

    } catch (error) {
      console.error('‚ùå Error loading system stats:', error);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå System Stats Error: ' + error);
    }
  }, [debouncedSetDebugInfo, debugInfo, supabase]);

  const loadPrograms = useCallback(async () => {
    try {
      setProgramsLoading(true);
      const { data, error } = await supabase
        .from('programas')
        .select('id, semana, mes_apostila, status, data_inicio_semana, arquivo')
        .order('data_inicio_semana', { ascending: false })
        .limit(12);
      if (error) throw error;
      setPrograms(data || []);
      console.log('‚úÖ Programs loaded:', data?.length || 0);
    } catch (error: any) {
      console.error('‚ùå Error loading programs:', error);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå Programs Load Error: ' + (error?.message || error));
    } finally {
      setProgramsLoading(false);
    }
  }, [debouncedSetDebugInfo, debugInfo]);

  const checkForUpdates = useCallback(async () => {
    console.log('üîÑ Checking for updates...');
    setLoading(true);
    
    try {
      await loadSystemStats();
      await loadPrograms();
      console.log('‚úÖ Updates checked successfully');
    } catch (error) {
      console.error('‚ùå Error checking updates:', error);
    } finally {
      setLoading(false);
    }
  }, [loadSystemStats]);

  const testSupabaseConnection = useCallback(async () => {
    console.log('üîß Testing Supabase connection...');
    
    try {
      const { count, error } = await supabase
        .from('profiles')
        .select('*', { count: 'exact', head: true });

      if (error) {
        console.error('‚ùå Supabase test error:', error);
        alert('Supabase test error: ' + error.message);
      } else {
        console.log('‚úÖ Supabase test successful. Profiles count:', count);
        alert('Supabase test successful! Total profiles: ' + (count ?? 0));
      }
    } catch (error) {
      console.error('‚ùå Supabase test exception:', error);
      alert('Supabase test exception: ' + error);
    }
  }, []);

  // ========== HANDLERS DOS BOT√ïES ==========
  
  const handleListUsers = useCallback(async () => {
    console.log('üë• Listando usu√°rios...');
    try {
      const { data: users, error } = await supabase
        .from('profiles')
        .select('id, nome_completo, role, congregacao, cargo')
        .order('nome_completo');
      
      if (error) throw error;
      
      console.log('‚úÖ Usu√°rios carregados:', users);
      alert(`Encontrados ${users?.length || 0} usu√°rios no sistema:\n\n${users?.map(u => `${u.nome_completo || u.id} - ${u.role} (${u.congregacao || 'N/A'})`).join('\n')}`);
    } catch (error) {
      console.error('‚ùå Erro ao listar usu√°rios:', error);
      alert('Erro ao carregar usu√°rios: ' + error.message);
    }
  }, []);

  const handleManagePermissions = useCallback(async () => {
    console.log('‚öôÔ∏è Gerenciando permiss√µes...');
    const newRole = prompt('Digite o novo role (admin, instrutor, estudante):');
    if (!newRole) return;
    
    // Validar role
    const validRoles = ['admin', 'instrutor', 'estudante', 'family_member', 'developer'];
    if (!validRoles.includes(newRole)) {
      alert('Role inv√°lido. Use: admin, instrutor, estudante, family_member ou developer');
      return;
    }
    
    const userId = prompt('Digite o ID do usu√°rio:');
    if (!userId) return;
    
    try {
      const { error } = await supabase
        .from('profiles')
        .update({ role: newRole as any })
        .eq('id', userId);
      
      if (error) throw error;
      
      console.log('‚úÖ Permiss√£o atualizada');
      alert('Permiss√£o atualizada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao atualizar permiss√£o:', error);
      alert('Erro ao atualizar permiss√£o: ' + error.message);
    }
  }, []);

  const handleActivityReport = useCallback(async () => {
    console.log('üìä Gerando relat√≥rio de atividades...');
    try {
      // Simula√ß√£o de relat√≥rio
      const report = {
        totalUsers: staticStats.total_users,
        totalCongregations: staticStats.total_congregations,
        lastUpdate: new Date().toLocaleString('pt-BR'),
        activeUsers: Math.floor(staticStats.total_users * 0.8)
      };
      
      alert(`üìä Relat√≥rio de Atividades:\n\n` +
            `‚Ä¢ Total de usu√°rios: ${report.totalUsers}\n` +
            `‚Ä¢ Usu√°rios ativos: ${report.activeUsers}\n` +
            `‚Ä¢ Total de congrega√ß√µes: ${report.totalCongregations}\n` +
            `‚Ä¢ √öltima atualiza√ß√£o: ${report.lastUpdate}`);
    } catch (error) {
      console.error('‚ùå Erro ao gerar relat√≥rio:', error);
      alert('Erro ao gerar relat√≥rio: ' + error.message);
    }
  }, [staticStats]);

  const handleBackupData = useCallback(async () => {
    console.log('üíæ Fazendo backup dos dados...');
    try {
      const { data: profiles, error: profilesError } = await supabase
        .from('profiles')
        .select('*');
      
      if (profilesError) throw profilesError;
      
      // Simular backup
      const backupData = {
        timestamp: new Date().toISOString(),
        profiles: profiles,
        stats: staticStats
      };
      
      const dataStr = JSON.stringify(backupData, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      
      const link = document.createElement('a');
      link.href = url;
      link.download = `backup_sistema_ministerial_${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      
      URL.revokeObjectURL(url);
      console.log('‚úÖ Backup criado com sucesso');
      alert('Backup criado e baixado com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao fazer backup:', error);
      alert('Erro ao fazer backup: ' + error.message);
    }
  }, [staticStats]);

  // Congrega√ß√µes
  const handleManageCongregation = useCallback((congregationName: string) => {
    console.log('üè¢ Gerenciando congrega√ß√£o:', congregationName);
    alert(`üè¢ Gerenciando congrega√ß√£o: ${congregationName}\n\nEsta funcionalidade abrir√° o painel de gerenciamento da congrega√ß√£o.`);
  }, []);

  const handleAddCongregation = useCallback(async () => {
    console.log('‚ûï Adicionando nova congrega√ß√£o...');
    const congregationName = prompt('Digite o nome da nova congrega√ß√£o:');
    if (!congregationName) return;
    
    try {
      // Simula√ß√£o - em produ√ß√£o seria inser√ß√£o no Supabase
      console.log('‚úÖ Congrega√ß√£o adicionada:', congregationName);
      alert(`‚úÖ Congrega√ß√£o "${congregationName}" adicionada com sucesso!\n\nEla agora receber√° automaticamente a programa√ß√£o oficial.`);
    } catch (error) {
      console.error('‚ùå Erro ao adicionar congrega√ß√£o:', error);
      alert('Erro ao adicionar congrega√ß√£o: ' + error.message);
    }
  }, []);

  // JW.org & S-38
  const handleMWBAvailable = useCallback(async () => {
    console.log('üìö Disponibilizando MWB atual...');
    try {
      await jworg.fetchCurrentWeek();
      console.log('‚úÖ MWB atualizada');
      alert('‚úÖ Apostila MWB atual disponibilizada para todas as congrega√ß√µes!');
    } catch (error) {
      console.error('‚ùå Erro ao disponibilizar MWB:', error);
      alert('Erro ao disponibilizar MWB: ' + error.message);
    }
  }, [jworg]);

  const handleConfigureJWorgURLs = useCallback(() => {
    console.log('‚öôÔ∏è Configurando URLs JW.org...');
    const ptUrl = prompt('URL JW.org PT:', 'https://www.jw.org/pt/biblioteca/jw-apostila-do-mes/');
    const enUrl = prompt('URL JW.org EN:', 'https://www.jw.org/en/library/jw-meeting-workbook/');
    
    if (ptUrl && enUrl) {
      console.log('‚úÖ URLs configuradas:', { ptUrl, enUrl });
      alert('‚úÖ URLs JW.org configuradas com sucesso!');
    }
  }, []);

  const handleSyncCongregations = useCallback(async () => {
    console.log('üîÑ Sincronizando com congrega√ß√µes...');
    try {
      // Simula√ß√£o de sincroniza√ß√£o
      const congregationsCount = staticStats.total_congregations;
      console.log(`‚úÖ Sincronizando com ${congregationsCount} congrega√ß√µes`);
      alert(`üîÑ Sincroniza√ß√£o iniciada!\n\nPrograma√ß√£o oficial sendo enviada para ${congregationsCount} congrega√ß√µes...\n\nTempo estimado: ${Math.ceil(congregationsCount / 100)} minutos`);
    } catch (error) {
      console.error('‚ùå Erro na sincroniza√ß√£o:', error);
      alert('Erro na sincroniza√ß√£o: ' + error.message);
    }
  }, [staticStats]);

  // Programa√ß√£o Oficial
  const handleViewFullProgram = useCallback(() => {
    console.log('üìÖ Visualizando programa√ß√£o completa (3 meses)...');
    alert(`üìÖ Programa√ß√£o Completa dos Pr√≥ximos 3 Meses\n\n` +
          `‚Ä¢ Semanas carregadas: 12\n` +
          `‚Ä¢ Idiomas: PT e EN\n` +
          `‚Ä¢ √öltima atualiza√ß√£o: Hoje\n\n` +
          `Esta visualiza√ß√£o mostrar√° todas as apostilas MWB dos pr√≥ximos 3 meses.`);
  }, []);

  const handleUpdateProgramPT = useCallback(async () => {
    console.log('üáßüá∑ Atualizando programa√ß√£o PT...');
    try {
      jworg.setLanguage('pt');
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Programa√ß√£o PT atualizada');
      alert('‚úÖ Programa√ß√£o em Portugu√™s atualizada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao atualizar programa√ß√£o PT:', error);
      alert('Erro ao atualizar programa√ß√£o PT: ' + error.message);
    }
  }, [jworg]);

  const handleUpdateProgramEN = useCallback(async () => {
    console.log('üá∫üá∏ Atualizando programa√ß√£o EN...');
    try {
      jworg.setLanguage('en');
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Programa√ß√£o EN atualizada');
      alert('‚úÖ Programa√ß√£o em Ingl√™s atualizada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao atualizar programa√ß√£o EN:', error);
      alert('Erro ao atualizar programa√ß√£o EN: ' + error.message);
    }
  }, [jworg]);

  const handleCheckNewWeeks = useCallback(async () => {
    console.log('üîç Verificando novas semanas...');
    try {
      await jworg.fetchNextWeeks();
      const newWeeks = jworg.nextWeeks.length;
      console.log(`‚úÖ Verifica√ß√£o conclu√≠da: ${newWeeks} semanas`);
      alert(`üîç Verifica√ß√£o conclu√≠da!\n\nEncontradas ${newWeeks} semanas de programa√ß√£o.\n\nTodas est√£o sincronizadas com JW.org.`);
    } catch (error) {
      console.error('‚ùå Erro ao verificar semanas:', error);
      alert('Erro ao verificar novas semanas: ' + error.message);
    }
  }, [jworg]);

  const handleUpdateS38Structure = useCallback(() => {
    console.log('üèóÔ∏è Atualizando estrutura S-38 global...');
    alert(`üèóÔ∏è Estrutura S-38 Global\n\n` +
          `‚úÖ Partes da reuni√£o atualizadas:\n` +
          `‚Ä¢ Chairman\n‚Ä¢ Treasures\n‚Ä¢ Gems\n‚Ä¢ Reading\n` +
          `‚Ä¢ Starting\n‚Ä¢ Following\n‚Ä¢ Making\n‚Ä¢ Explaining\n` +
          `‚Ä¢ Talk\n\n` +
          `Esta estrutura ser√° aplicada mundialmente.`);
  }, []);

  // JW.org Integration
  const handleReloadCurrentWeek = useCallback(async () => {
    console.log('üîÑ Recarregando semana atual...');
    try {
      await jworg.fetchCurrentWeek();
      console.log('‚úÖ Semana atual recarregada');
      alert('‚úÖ Semana atual recarregada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao recarregar semana:', error);
      alert('Erro ao recarregar semana: ' + error.message);
    }
  }, [jworg]);

  const handleReloadNextWeeks = useCallback(async () => {
    console.log('üìÖ Recarregando pr√≥ximas semanas...');
    try {
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Pr√≥ximas semanas recarregadas');
      alert('‚úÖ Pr√≥ximas semanas recarregadas com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao recarregar pr√≥ximas semanas:', error);
      alert('Erro ao recarregar pr√≥ximas semanas: ' + error.message);
    }
  }, [jworg]);

  const handleTestDownloadPT = useCallback(async () => {
    console.log('üß™ Testando download PT...');
    try {
      jworg.setLanguage('pt');
      await jworg.downloadWorkbook('pt', '07', '2025');
      console.log('‚úÖ Download PT testado');
      alert('‚úÖ Download PT testado com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro no teste de download PT:', error);
      alert('Erro no teste de download PT: ' + error.message);
    }
  }, [jworg]);

  // Monitoramento
  const handleViewAllLogs = useCallback(async () => {
    console.log('üìã Visualizando todos os logs...');
    try {
      // Simula√ß√£o de logs
      const logs = [
        { timestamp: new Date().toLocaleString(), event: 'Sistema iniciado', level: 'info' },
        { timestamp: new Date(Date.now() - 3600000).toLocaleString(), event: 'Backup autom√°tico executado', level: 'info' },
        { timestamp: new Date(Date.now() - 86400000).toLocaleString(), event: 'Novo usu√°rio registrado', level: 'info' },
        { timestamp: new Date(Date.now() - 172800000).toLocaleString(), event: 'Manuten√ß√£o programada', level: 'warning' }
      ];
      
      const logText = logs.map(log => `${log.timestamp} [${log.level.toUpperCase()}] ${log.event}`).join('\n');
      alert(`üìã Logs do Sistema\n\n${logText}`);
    } catch (error) {
      console.error('‚ùå Erro ao carregar logs:', error);
      alert('Erro ao carregar logs: ' + error.message);
    }
  }, []);

  const handleTestJWorgIntegration = useCallback(async () => {
    console.log('üß™ Testando integra√ß√£o JW.org...');
    try {
      await jworg.fetchCurrentWeek();
      console.log('‚úÖ Integra√ß√£o JW.org testada com sucesso');
      alert('‚úÖ Integra√ß√£o JW.org funcionando perfeitamente!');
    } catch (error) {
      console.error('‚ùå Erro na integra√ß√£o JW.org:', error);
      alert('‚ùå Erro na integra√ß√£o JW.org: ' + error.message);
    }
  }, [jworg]);

  const handleChangeLanguage = useCallback((newLang: 'pt' | 'en') => {
    jworg.setLanguage(newLang);
    console.log(`üåê Idioma alterado para: ${newLang}`);
    alert(`üåê Idioma alterado para: ${newLang === 'pt' ? 'Portugu√™s' : 'English'}`);
  }, [jworg]);

  // Alterna o idioma atual entre PT/EN
  const toggleLanguage = useCallback(() => {
    const current = (jworg as any)?.currentLanguage ?? 'pt';
    const next = current === 'pt' ? 'en' : 'pt';
    jworg.setLanguage(next);
    console.log(`üåê Idioma alternado: ${current} -> ${next}`);
    alert(`üåê Idioma alternado para: ${next === 'pt' ? 'Portugu√™s' : 'English'}`);
  }, [jworg]);

  // Atualiza materiais JW.org (semana atual + pr√≥ximas semanas)
  const updateMaterials = useCallback(async () => {
    try {
      await jworg.fetchCurrentWeek();
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Materiais JW.org atualizados');
      alert('‚úÖ Materiais JW.org atualizados com sucesso!');
    } catch (error: any) {
      console.error('‚ùå Erro ao atualizar materiais:', error);
      alert('‚ùå Erro ao atualizar materiais: ' + (error?.message || error));
    }
  }, [jworg]);

  // NOW CHECK CONDITIONS AND RENDER APPROPRIATELY
  // Se n√£o for admin, mostrar mensagem de acesso negado
  if (user && !isAdmin) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="max-w-md mx-auto">
          <CardHeader>
            <CardTitle className="text-red-600">Acesso Negado</CardTitle>
            <CardDescription>
              Voc√™ n√£o tem permiss√£o para acessar o painel administrativo.
            </CardDescription>
          </CardHeader>
          <CardContent>
            <p className="text-sm text-muted-foreground mb-4">
              Seu perfil atual: <strong>{profile?.role}</strong>
            </p>
            <Button onClick={() => window.history.back()}>
              Voltar
            </Button>
          </CardContent>
        </Card>
      </div>
    );
  }

  // Se n√£o houver usu√°rio, mostrar loading
  if (!user) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="max-w-md mx-auto">
          <CardHeader>
            <CardTitle>Carregando...</CardTitle>
            <CardDescription>
              Verificando autentica√ß√£o...
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="flex items-center justify-center">
              <RefreshCw className="h-6 w-6 animate-spin" />
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background">
      {/* Auth Error Handler */}
      <AuthErrorHandler />
      
      {/* Header */}
      <div className="border-b">
        <div className="container mx-auto px-4 py-6">
          <div className="flex flex-col space-y-4">
          <div className="flex items-center justify-between">
            <div>
                <h1 className="text-3xl font-bold tracking-tight">üìä Dashboard do Administrador Geral</h1>
                <p className="text-muted-foreground">
                  Programa√ß√£o oficial das reuni√µes ministeriais - Padroniza√ß√£o mundial para todas as congrega√ß√µes
              </p>
            </div>
              <div className="flex items-center space-x-2">
              {/* Force Profile Load Button */}
              {import.meta.env.DEV && (
                <Button 
                  variant="outline" 
                  size="sm"
                    onClick={testSupabaseConnection}
                  >
                    üîß Test Supabase
                </Button>
              )}
              
              <Button onClick={checkForUpdates} disabled={loading}>
                <RefreshCw className={`h-4 w-4 mr-2 ${loading ? 'animate-spin' : ''}`} />
                  Atualizar
              </Button>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Debug Info Panel */}
      {import.meta.env.DEV && (
        <div className="container mx-auto px-4 py-2">
          <Card className="bg-yellow-50 border-yellow-200">
            <CardHeader className="pb-2">
              <CardTitle className="text-sm text-yellow-800">üêõ Debug Info (Development Only)</CardTitle>
            </CardHeader>
            <CardContent>
              <pre className="text-xs text-yellow-700 overflow-auto max-h-40">
                {debugInfo}
              </pre>
            </CardContent>
          </Card>
        </div>
      )}

      {/* Main Content */}
      <div className="container mx-auto px-4 py-6">
        <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
          <TabsList className="grid w-full grid-cols-4">
            <TabsTrigger value="overview">Vis√£o Geral</TabsTrigger>
            <TabsTrigger value="users">Usu√°rios</TabsTrigger>
            <TabsTrigger value="congregations">Congrega√ß√µes</TabsTrigger>
            <TabsTrigger value="system">Sistema</TabsTrigger>
          </TabsList>

          {/* Vis√£o Geral */}
          <TabsContent value="overview" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                üéØ Sistema Ministerial Global - Padroniza√ß√£o Mundial
              </h3>
              <div className="text-center text-sm text-muted-foreground mt-2 p-3 bg-blue-50 rounded-lg border border-blue-200">
                <strong>üìä Admin Geral:</strong> Disponibiliza programa√ß√£o oficial semanal (SEM nomes de estudantes) <br/>
                <strong>üéì Instrutores:</strong> Recebem programa√ß√£o automaticamente + fazem designa√ß√µes locais reais
              </div>
            </div>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Congrega√ß√µes Conectadas</CardTitle>
                  <Globe className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">{staticStats.total_congregations}</div>
                  <p className="text-xs text-muted-foreground">
                    Recebendo programa√ß√£o oficial
                  </p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Semanas Programadas</CardTitle>
                  <BarChart3 className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">12</div>
                  <p className="text-xs text-muted-foreground">
                    Pr√≥ximas 3 meses
                  </p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Idiomas Dispon√≠veis</CardTitle>
                  <Globe className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">2</div>
                  <p className="text-xs text-muted-foreground">
                    Portugu√™s e Ingl√™s
                  </p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">√öltima Sincroniza√ß√£o</CardTitle>
                  <RefreshCw className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">‚úÖ</div>
                  <p className="text-xs text-muted-foreground">
                    Hoje, {new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}
                  </p>
                </CardContent>
              </Card>
            </div>

            {/* A√ß√µes R√°pidas */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* Status do Sistema */}
              <Card>
                <CardHeader>
                  <CardTitle>Status do Sistema</CardTitle>
                  <CardDescription>
                    Informa√ß√µes sobre a √∫ltima verifica√ß√£o e status geral
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">√öltima Verifica√ß√£o:</span>
                    <span className="text-sm text-muted-foreground">
                      {lastCheck ? new Date(lastCheck).toLocaleString('pt-BR') : 'Nunca'}
                    </span>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Status:</span>
                    <Badge variant="outline" className="text-green-600">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Operacional
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Supabase:</span>
                    <Badge variant="outline" className="text-green-600">
                      <Database className="h-3 w-3 mr-1" />
                      Conectado
                    </Badge>
                  </div>
                </CardContent>
              </Card>

              {/* Programa√ß√µes Publicadas */}
              <Card>
                <CardHeader>
                  <CardTitle>Programa√ß√µes Publicadas</CardTitle>
                  <CardDescription>
                    √öltimas semanas importadas/publicadas
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  {programsLoading ? (
                    <div className="text-sm text-muted-foreground">Carregando...</div>
                  ) : programs.length === 0 ? (
                    <div className="text-sm text-muted-foreground">Nenhuma programa√ß√£o encontrada.</div>
                  ) : (
                    <div className="space-y-2">
                      {programs.map((p) => (
                        <div key={p.id} className="p-2 border rounded-md">
                          <div className="flex items-center justify-between">
                            <div className="text-sm">
                              <div className="font-medium">Semana {p.semana || '‚Äî'} ‚Ä¢ {p.mes_apostila || '‚Äî'}</div>
                              <div className="text-xs text-muted-foreground">
                                {p.data_inicio_semana ? new Date(p.data_inicio_semana).toLocaleDateString('pt-BR') : '‚Äî'}
                              </div>
                            </div>
                            <Badge variant="outline" className={p.status === 'ativo' || p.status === 'publicado' ? 'bg-green-50 text-green-700' : ''}>
                              {p.status || '‚Äî'}
                            </Badge>
                          </div>
                          {p.arquivo && (
                            <div className="mt-2">
                              <a
                                href={`http://localhost:3001/materials/${encodeURIComponent(p.arquivo)}`}
                                target="_blank"
                                rel="noopener noreferrer"
                                className="text-blue-600 text-xs underline"
                              >
                                Abrir material ({p.arquivo})
                              </a>
                            </div>
                          )}
                        </div>
                      ))}
                    </div>
                  )}
                </CardContent>
              </Card>

              {/* JW.org Downloads */}
              <Card className="bg-green-50 border-green-200">
                <CardHeader>
                  <CardTitle className="text-green-800">üìö JW.org Downloads</CardTitle>
                  <CardDescription className="text-green-700">
                    Gerenciar materiais oficiais
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Apostila MWB Atual:</span>
                    <Badge variant="outline" className="text-green-600">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Dispon√≠vel
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">√öltima verifica√ß√£o:</span>
                    <span className="text-sm text-green-700">Hoje, 10:30</span>
                  </div>
                  <div className="flex space-x-2">
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleMWBAvailable}>
                      <RefreshCw className="h-3 w-3 mr-1" />
                      Disponibilizar MWB Atual
                    </Button>
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleConfigureJWorgURLs}>
                      <Settings className="h-3 w-3 mr-1" />
                      Configurar URLs JW.org
                    </Button>
                  </div>
                </CardContent>
              </Card>

              {/* Sistema S-38 - Designa√ß√µes */}
              <Card className="bg-purple-50 border-purple-200">
                <CardHeader>
                  <CardTitle className="text-purple-800">‚öôÔ∏è Sistema S-38</CardTitle>
                  <CardDescription className="text-purple-700">
                    Estrutura das reuni√µes ministeriais
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="text-sm text-purple-700 space-y-2">
                    <p>üìö <strong>Fun√ß√£o do Admin:</strong> Disponibilizar apostilas MWB</p>
                    <p>üë• <strong>Para Instrutores:</strong> Designar estudantes para partes</p>
                    <p>üéØ <strong>Partes da Reuni√£o:</strong></p>
                    <div className="grid grid-cols-2 gap-1 text-xs ml-2">
                      <div>‚Ä¢ Chairman</div>
                      <div>‚Ä¢ Treasures</div>
                      <div>‚Ä¢ Gems</div>
                      <div>‚Ä¢ Reading</div>
                      <div>‚Ä¢ Starting</div>
                      <div>‚Ä¢ Following</div>
                      <div>‚Ä¢ Making</div>
                      <div>‚Ä¢ Explaining</div>
                      <div>‚Ä¢ Talk</div>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Debug / Integra√ß√£o */}
              <Card className="bg-slate-50 border-slate-200">
                <CardHeader>
                  <CardTitle className="text-slate-800">üß™ Debug / Integra√ß√£o</CardTitle>
                  <CardDescription className="text-slate-700">
                    Ferramentas r√°pidas para validar integra√ß√µes e idioma
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-3">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Idioma Atual:</span>
                    <Badge variant="outline" className="text-slate-700">
                      {(jworg as any)?.currentLanguage === 'en' ? 'üá∫üá∏ English' : 'üáßüá∑ Portugu√™s'}
                    </Badge>
                  </div>
                  <div className="flex flex-wrap gap-2">
                    <Button size="sm" variant="outline" onClick={toggleLanguage}>
                      Alternar Idioma
                    </Button>
                    <Button size="sm" variant="outline" onClick={updateMaterials}>
                      Atualizar Materiais
                    </Button>
                    <Button size="sm" variant="outline" onClick={handleTestJWorgIntegration}>
                      Testar Integra√ß√£o JW.org
                    </Button>
                    <Button size="sm" variant="outline" onClick={checkForUpdates} disabled={loading}>
                      Atualizar Contagens
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* Usu√°rios */}
          <TabsContent value="users" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                üë• Gest√£o de Usu√°rios para Acesso √†s Apostilas MWB
              </h3>
              <p className="text-center text-sm text-muted-foreground mt-2">
                üéØ Fun√ß√£o Principal: Admin gerencia usu√°rios ‚Üí Instrutores acessam apostilas
              </p>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* Estat√≠sticas de Usu√°rios */}
            <Card>
              <CardHeader>
                  <CardTitle>Estat√≠sticas</CardTitle>
                  <CardDescription>Resumo dos usu√°rios</CardDescription>
              </CardHeader>
                <CardContent>
                  <div className="space-y-4">
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Total de Usu√°rios:</span>
                      <Badge variant="outline">{staticStats.total_users}</Badge>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Admins:</span>
                      <Badge variant="outline" className="bg-red-50 text-red-700">
                        {isAdmin ? 1 : 0}
                      </Badge>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Instrutores:</span>
                      <Badge variant="outline" className="bg-blue-50 text-blue-700">
                        {staticStats.total_users - (isAdmin ? 1 : 0)}
                      </Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Usu√°rios Registrados */}
              <Card className="lg:col-span-2">
                <CardHeader>
                  <CardTitle>Usu√°rios Registrados</CardTitle>
                  <CardDescription>√öltimos usu√°rios cadastrados no sistema</CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-center justify-between p-3 border rounded-lg">
                      <div className="flex items-center space-x-3">
                        <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                          <Users className="h-5 w-5 text-blue-600" />
                        </div>
                        <div>
                          <p className="font-medium">{profile?.nome_completo || 'Roberto Araujo da Silva'}</p>
                          <p className="text-sm text-muted-foreground">Administrator</p>
                        </div>
                      </div>
                      <Badge variant="outline" className="bg-red-50 text-red-700">
                        Admin
                      </Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* A√ß√µes Administrativas */}
            <Card>
              <CardHeader>
                <CardTitle>A√ß√µes Administrativas</CardTitle>
                <CardDescription>
                  Gerenciar usu√°rios e permiss√µes
                </CardDescription>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <Button className="w-full justify-start" variant="outline" onClick={handleListUsers}>
                    <Users className="h-4 w-4 mr-2" />
                    Listar Todos os Usu√°rios
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleManagePermissions}>
                    <Settings className="h-4 w-4 mr-2" />
                    Gerenciar Permiss√µes
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleActivityReport}>
                    <Activity className="h-4 w-4 mr-2" />
                    Relat√≥rio de Atividades
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleBackupData}>
                    <Database className="h-4 w-4 mr-2" />
                    Backup de Dados
                  </Button>
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          {/* Congrega√ß√µes */}
          <TabsContent value="congregations" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                üè¢ Gest√£o de Congrega√ß√µes para Acesso √†s Apostilas MWB
              </h3>
              <p className="text-center text-sm text-muted-foreground mt-2">
                üéØ Fun√ß√£o Principal: Admin gerencia congrega√ß√µes ‚Üí Instrutores acessam apostilas
              </p>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* Estat√≠sticas de Congrega√ß√µes */}
            <Card>
              <CardHeader>
                  <CardTitle>Estat√≠sticas</CardTitle>
                  <CardDescription>Resumo das congrega√ß√µes</CardDescription>
              </CardHeader>
              <CardContent>
                  <div className="space-y-4">
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Total de Congrega√ß√µes:</span>
                      <Badge variant="outline">{staticStats.total_congregations}</Badge>
                  </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Congrega√ß√µes Ativas:</span>
                      <Badge variant="outline" className="bg-green-50 text-green-700">
                        {staticStats.active_congregations}
                      </Badge>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Total de Estudantes:</span>
                      <Badge variant="outline">{staticStats.total_estudantes}</Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Lista de Congrega√ß√µes */}
              <Card className="lg:col-span-2">
                <CardHeader>
                  <CardTitle>Congrega√ß√µes Registradas</CardTitle>
                  <CardDescription>Lista das congrega√ß√µes no sistema</CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-center justify-between p-3 border rounded-lg">
                      <div className="flex items-center space-x-3">
                        <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                          <Package className="h-5 w-5 text-blue-600" />
                        </div>
                        <div>
                          <p className="font-medium">Sistema Ministerial Global</p>
                          <p className="text-sm text-muted-foreground">Congrega√ß√£o Principal</p>
                          </div>
                        </div>
                      <Badge variant="outline" className="bg-green-50 text-green-700">
                        Ativa
                        </Badge>
                      </div>
                  </div>
                  
                  <div className="mt-4">
                    <Button variant="outline" className="w-full" onClick={() => handleManageCongregation('Sistema Ministerial Global')}>
                      <Users className="h-4 w-4 mr-2" />
                      Gerenciar
                    </Button>
                  </div>
                  
                  <div className="mt-4">
                    <Button variant="outline" className="w-full" onClick={handleAddCongregation}>
                      <Users className="h-4 w-4 mr-2" />
                      Adicionar Nova Congrega√ß√£o
                    </Button>
                  </div>
                  
                  <div className="mt-4">
                    <Button variant="outline" className="w-full">
                      <Users className="h-4 w-4 mr-2" />
                      Expandir
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* Sistema */}
          <TabsContent value="system" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                ‚öôÔ∏è Monitoramento e Configura√ß√µes do Sistema
              </h3>
              <p className="text-center text-sm text-muted-foreground mt-2">
                üéØ Fun√ß√£o Principal: Admin monitora sistema ‚Üí Instrutores recebem apostilas est√°veis
              </p>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* Downloads JW.org */}
              <Card className="bg-green-50 border-green-200">
              <CardHeader>
                  <CardTitle className="text-green-800">üìö JW.org Downloads</CardTitle>
                  <CardDescription className="text-green-700">
                    Gerenciar materiais oficiais
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Apostila MWB Atual:</span>
                    <Badge variant="outline" className="text-green-600">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Dispon√≠vel
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">√öltima verifica√ß√£o:</span>
                    <span className="text-sm text-green-700">Hoje, 10:30</span>
                  </div>
                  <div className="flex space-x-2">
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleSyncCongregations}>
                      <RefreshCw className="h-3 w-3 mr-1" />
                      Sincronizar com Congrega√ß√µes
                    </Button>
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleViewFullProgram}>
                      <Settings className="h-3 w-3 mr-1" />
                      Ver Programa√ß√£o Completa
                    </Button>
                </div>
              </CardContent>
            </Card>

              {/* Configura√ß√µes Gerais */}
            <Card>
              <CardHeader>
                  <CardTitle>Configura√ß√µes Gerais</CardTitle>
                <CardDescription>
                    Par√¢metros do sistema
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-4">
                    <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Backup Autom√°tico:</span>
                    <Badge variant="outline" className="bg-green-50 text-green-700">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Di√°rio √†s 02:00
                      </Badge>
                    </div>
                    <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Notifica√ß√µes:</span>
                    <Badge variant="outline" className="bg-blue-50 text-blue-700">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Email + Sistema
                    </Badge>
                    </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Manuten√ß√£o:</span>
                    <span className="text-sm text-muted-foreground">√öltima: Ontem</span>
                  </div>
                  <div className="flex space-x-2">
                    <Button size="sm" variant="outline">
                      <Settings className="h-3 w-3 mr-1" />
                      Configurar
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* M√©tricas do Sistema */}
            <Card>
              <CardHeader>
                <CardTitle>M√©tricas do Sistema</CardTitle>
                <CardDescription>
                  Monitoramento em tempo real
                </CardDescription>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-green-600">99.9%</p>
                    <p className="text-sm text-muted-foreground">Uptime</p>
                  </div>
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-blue-600">~120ms</p>
                    <p className="text-sm text-muted-foreground">Lat√™ncia</p>
                  </div>
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-green-600">25%</p>
                    <p className="text-sm text-muted-foreground">CPU</p>
                  </div>
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-blue-600">33%</p>
                    <p className="text-sm text-muted-foreground">Mem√≥ria</p>
                  </div>
                </div>

                <Separator />

                <div className="space-y-3">
                    <div className="flex items-center justify-between">
                    <span className="text-sm">CPU:</span>
                    <div className="flex items-center space-x-2">
                      <div className="w-24 h-2 bg-gray-200 rounded-full">
                        <div className="w-1/4 h-2 bg-green-500 rounded-full"></div>
                    </div>
                        <span className="text-sm">25%</span>
                  </div>
                    </div>
                    
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Mem√≥ria:</span>
                      <div className="flex items-center space-x-2">
                        <div className="w-24 h-2 bg-gray-200 rounded-full">
                          <div className="w-1/3 h-2 bg-blue-500 rounded-full"></div>
                    </div>
                        <span className="text-sm">33%</span>
                      </div>
                    </div>
                    
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Banco:</span>
                      <div className="flex items-center space-x-2">
                        <CheckCircle className="h-4 w-4 text-green-500" />
                        <span className="text-sm">Conectado</span>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>

              {/* Logs e Atividades */}
              <Card>
                <CardHeader>
                  <CardTitle>Logs Recentes</CardTitle>
                  <CardDescription>
                    √öltimas atividades do sistema
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <CheckCircle className="h-4 w-4 text-green-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Sistema iniciado</p>
                        <p className="text-xs text-muted-foreground">Hoje, 08:00</p>
                      </div>
                    </div>

                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <Activity className="h-4 w-4 text-blue-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Backup autom√°tico executado</p>
                        <p className="text-xs text-muted-foreground">Hoje, 02:00</p>
                      </div>
                    </div>

                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <Users className="h-4 w-4 text-green-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Novo usu√°rio registrado</p>
                        <p className="text-xs text-muted-foreground">Ontem, 16:30</p>
                      </div>
                    </div>

                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <AlertCircle className="h-4 w-4 text-yellow-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Manuten√ß√£o programada</p>
                        <p className="text-xs text-muted-foreground">Ontem, 03:00</p>
                      </div>
                    </div>
                  </div>

                  <div className="mt-4">
                    <Button variant="outline" className="w-full" onClick={handleViewAllLogs}>
                      <FileText className="h-4 w-4 mr-2" />
                      Ver Todos os Logs
                    </Button>
                  </div>
                </CardContent>
              </Card>
          </TabsContent>
        </Tabs>
      </div>
    </div>
  );
}

```

Removi a consulta √† tabela `congregacoes` no `AdminDashboard` para evitar o 404 (a tabela n√£o existe no seu projeto). Agora s√≥ contamos `profiles`, `estudantes` e `programas`. Recarregue o Admin e o erro 404 do HEAD deve desaparecer.

---

**User**

toda vez que eu aperto f5 no teclado o aplicativo fica em branco e nao volta a nao ser que eu remova os dados no site no console. isso eh muito desagradavel. 
Carregando Sistema Ministerial
Inicializando autentica√ß√£o e permiss√µes...

Debug
üåê Language Debug
Hook Language: pt
Context Language: pt
Test PT: Bem-vindo
Test EN: In√≠cio
Toggle Language  em http://localhost:8080/admin 

---

**Cursor**

Prov√°vel causa: estado/auth persistido corrompido (localStorage/IndexedDB) ou SW em cache ap√≥s F5, que trava a hidrata√ß√£o e deixa a tela em branco at√© voc√™ limpar os dados.

Corre√ß√µes recomendadas (r√°pidas e seguras):
- Desabilitar SW no dev
  - Em `sw-register.ts`, n√£o registre o SW em `import.meta.env.DEV` (ou retorne cedo). Rebuild e F5.
- Inicializa√ß√£o de auth com guarda
  - No `AuthContext`, antes de renderizar a √°rvore:
    - Fa√ßa `await supabase.auth.getSession()`, escute `onAuthStateChange`.
    - Mantenha `ready=false` e s√≥ renderize `<children/>` quando `ready=true`.
- Sanitizar persist√™ncia
  - Ao ler `localStorage`/`sessionStorage`, envolva em `try/catch`. Se `JSON.parse` falhar, remova a key.
  - Zere qualquer cache de idioma/chaves antigas que seu app usa (ex.: `i18nextLng`, chaves de contexto).
- Fallback de erro
  - Garanta um ErrorBoundary global (ex.: `react-error-boundary`) e, em erro, mostre bot√£o ‚ÄúResetar cache local‚Äù que limpa `localStorage` e `IndexedDB` (apenas no dev) e recarrega.

Se quiser, eu aplico agora:
- Guardas no `AuthContext` (ready gate + try/catch de storage).
- Skip do SW em dev.
- ErrorBoundary com bot√£o ‚ÄúLimpar cache e recarregar‚Äù.

---

**User**

resolva

---

**Cursor**

Vou aplicar tr√™s corre√ß√µes: desativar o Service Worker em desenvolvimento, adicionar um ‚Äúready gate‚Äù no `AuthContext` para evitar tela branca ao hidratar, e colocar um ErrorBoundary global com bot√£o para limpar cache local e recarregar. Vou abrir os arquivos relevantes para fazer os edits.

```typescript
// Service Worker registration with robust error handling and cache cleanup

interface SWRegister {
  register(): void;
  handleChunkError(event: ErrorEvent): Promise<void>;
  clearCaches(): Promise<void>;
  unregister(): Promise<void>;
}

const swRegister: SWRegister = {
  register() {
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        // Limpar caches antigos antes de registrar
        this.clearCaches().then(() => {
          navigator.serviceWorker.register('/sw.js', {
            updateViaCache: 'none' // Sempre buscar nova vers√£o
          })
            .then((registration) => {
              console.log('‚úÖ Service Worker registered successfully:', registration);
              
              // Verificar se h√° atualiza√ß√µes
              registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                if (newWorker) {
                  newWorker.addEventListener('statechange', () => {
                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                      console.log('üîÑ New Service Worker available');
                      // Opcional: mostrar notifica√ß√£o para o usu√°rio atualizar
                    }
                  });
                }
              });
            })
            .catch((registrationError) => {
              console.warn('‚ö†Ô∏è Service Worker registration failed:', registrationError);
              // Tentar limpar caches e tentar novamente
              this.clearCaches().then(() => {
                console.log('üîÑ Retrying Service Worker registration...');
                setTimeout(() => this.register(), 1000);
              });
            });
        });
      });
    }
  },

  async handleChunkError(event: ErrorEvent) {
    const msg = String(event?.message || '');
    if (/ChunkLoadError|Loading chunk \d+ failed/i.test(msg)) {
      console.log('üö® Chunk loading error detected, clearing caches and reloading...');
      await this.clearCaches();
      location.reload();
    }
  },

  async clearCaches() {
    if ('caches' in window) {
      try {
        const cacheNames = await caches.keys();
        await Promise.all(
          cacheNames.map(cacheName => {
            console.log('üóëÔ∏è Deleting cache:', cacheName);
            return caches.delete(cacheName);
          })
        );
        console.log('‚úÖ All caches cleared successfully');
      } catch (error) {
        console.error('‚ùå Error clearing caches:', error);
      }
    }
  },

  async unregister() {
    if ('serviceWorker' in navigator) {
      try {
        const registration = await navigator.serviceWorker.getRegistration();
        if (registration) {
          await registration.unregister();
          console.log('‚úÖ Service Worker unregistered');
        }
      } catch (error) {
        console.error('‚ùå Error unregistering Service Worker:', error);
      }
    }
  }
};

// Registrar service worker somente em produ√ß√£o (desabilitado em dev)
if (import.meta.env.PROD) {
  swRegister.register();
}

// Listener para erros de chunk
window.addEventListener('error', (event) => {
  swRegister.handleChunkError(event);
});

// Listener para erros n√£o capturados
window.addEventListener('unhandledrejection', (event) => {
  console.warn('‚ö†Ô∏è Unhandled promise rejection:', event.reason);
  
  // Se for erro de cache, limpar caches
  if (event.reason && event.reason.message && 
      event.reason.message.includes('Cache')) {
    console.log('üóëÔ∏è Cache error detected, clearing caches...');
    swRegister.clearCaches();
  }
});

// Expor fun√ß√µes para debug
(window as any).swRegister = swRegister;

export default swRegister;
```

```typescriptreact
import { createContext, useContext, useEffect, useState, useCallback } from 'react';
import { User, Session } from '@supabase/supabase-js';
import { supabase } from '@/integrations/supabase/client';
import { Database } from '@/integrations/supabase/types';
import { smartLogout } from '@/utils/forceLogout';
import { withRefreshTokenErrorHandling, recoverSessionWithErrorHandling } from '@/utils/refreshTokenHandler';

// Types
type UserRole = Database['public']['Enums']['user_role'];

interface UserProfile {
  id: string;
  nome_completo: string | null;
  congregacao: string | null;
  cargo: string | null;
  role: UserRole;
  date_of_birth: string | null;
  email: string;
  created_at: string | null;
  updated_at: string | null;
}

interface SignUpData {
  email: string;
  password: string;
  nome_completo: string;
  congregacao: string;
  cargo?: string;
  role: UserRole;
  date_of_birth?: string;
}

interface AuthContextType {
  user: User | null;
  session: Session | null;
  profile: UserProfile | null;
  loading: boolean;
  signUp: (data: SignUpData) => Promise<{ error: Error | null }>;
  signIn: (email: string, password: string) => Promise<{ error: Error | null }>;
  signOut: () => Promise<{ error: Error | null }>;
  updateProfile: (updates: Partial<UserProfile>) => Promise<{ data: UserProfile | null; error: Error | null }>;
  isInstrutor: boolean;
  isEstudante: boolean;
  isAdmin: boolean;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export function AuthProvider({ children }: { children: React.ReactNode }) {
  const [user, setUser] = useState<User | null>(null);
  const [session, setSession] = useState<Session | null>(null);
  const [profile, setProfile] = useState<UserProfile | null>(null);
  const [loading, setLoading] = useState(true);
  const [ready, setReady] = useState(false);



  // Fetch user profile from database with simplified logic
  const fetchProfile = useCallback(async (userId: string): Promise<UserProfile | null> => {
    console.log('üîç Fetching profile for user ID:', userId);

    try {
      // Step 1: Check current session
      console.log('üîê Checking current session...');
      const { data: { session }, error: sessionError } = await supabase.auth.getSession();

      if (sessionError) {
        console.error('‚ùå Session error:', sessionError);
        return await createProfileFromAuth(userId);
      }

      if (!session) {
        console.log('‚ùå No active session, using metadata fallback');
        return await createProfileFromAuth(userId);
      }

      if (session.user.id !== userId) {
        console.error('‚ùå Session user ID mismatch:', {
          sessionUserId: session.user.id,
          requestedUserId: userId
        });
        return null;
      }

      // Step 2: Fetch profile from database
      console.log('üîç Fetching from profiles table...');
        const { data: profileData, error: profileError } = await supabase
          .from('profiles')
          .select('*')
          .eq('id', userId as any)
          .single();

      if (profileError) {
        if (profileError.code === 'PGRST116') {
          console.log('üìù Profile not found in database, creating from auth metadata');
        } else {
          console.log('‚ùå Profile fetch error, using metadata fallback:', profileError);
        }
        return await createProfileFromAuth(userId);
      }

      if (profileData) {
        // Get email from session
        const email = session.user.email || '';
        const profileWithEmail = {
          ...(profileData as any),
          email
        };

        console.log('‚úÖ Profile fetched successfully:', {
          id: profileWithEmail.id,
          nome_completo: profileWithEmail.nome_completo,
          role: profileWithEmail.role,
          email: profileWithEmail.email
        });

        return profileWithEmail;
      }

      console.log('‚ùå No profile data found, using metadata fallback');
      return await createProfileFromAuth(userId);

    } catch (error) {
      console.error('‚ùå Error in fetchProfile:', error);
      return await createProfileFromAuth(userId);
    }
  }, []);

  // Create profile from auth metadata with simplified logic
  const createProfileFromAuth = useCallback(async (userId: string) => {
    try {
      console.log('üìù Creating profile from auth metadata for user:', userId);

      // Get current user
      const { data: { user }, error: userError } = await supabase.auth.getUser();

      if (userError) {
        console.error('‚ùå Error getting user:', userError);
        return null;
      }

      if (!user) {
        console.error('‚ùå No user found');
        return null;
      }

      if (user.id !== userId) {
        console.error('‚ùå User ID mismatch in createProfileFromAuth');
        return null;
      }

      const metadata = user.user_metadata || {};
      console.log('üìã User metadata:', {
        hasMetadata: Object.keys(metadata).length > 0,
        role: metadata.role
      });

      // Try to insert profile in database
      const { data, error } = await supabase
        .from('profiles')
        .insert({
          id: userId,
          nome_completo: metadata.nome_completo || '',
          congregacao: metadata.congregacao || '',
          cargo: metadata.cargo || '',
          role: (metadata.role as UserRole) || 'instrutor'
        } as any)
        .select()
        .single();

      if (error) {
        console.error('‚ùå Error creating profile in database:', error);
        // Return profile from metadata even if DB insert fails
        const email = user.email || '';
        const fallbackProfile = {
          id: userId,
          nome_completo: metadata.nome_completo || '',
          congregacao: metadata.congregacao || '',
          cargo: metadata.cargo || '',
          role: (metadata.role as UserRole) || 'instrutor',
          date_of_birth: metadata.date_of_birth || null,
          email,
          created_at: new Date().toISOString(),
          updated_at: new Date().toISOString()
        };
        console.log('üîÑ Using fallback profile from metadata');
        return fallbackProfile as UserProfile;
      }

      // Return the profile with email from auth
      return {
        ...(data as any),
        email: user.email || ''
      } as UserProfile;
    } catch (error: unknown) {
      const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      console.error('Error creating profile from auth:', errorMessage);
      return null;
    }
  }, []); // Empty dependency array since createProfileFromAuth doesn't depend on any props or state

  // Force profile loading for admin users
  const forceLoadProfile = useCallback(async () => {
    if (!user) return;
    
    console.log('üîß Force loading profile for user:', user.id);
    
    try {
      // Direct database query to bypass potential RLS issues
      const { data: profileData, error: profileError } = await supabase
        .from('profiles')
        .select('*')
        .eq('id', user.id as any)
        .single();

      if (profileError) {
        console.error('‚ùå Force profile load error:', profileError);
        return;
      }

      if (profileData) {
        console.log('‚úÖ Force profile load successful:', profileData);
        setProfile({
          ...(profileData as any),
          email: user.email || ''
        });
      }
    } catch (error) {
      console.error('‚ùå Force profile load exception:', error);
    }
  }, [user]);

  // Force load profile when user is authenticated but profile is missing
  useEffect(() => {
    if (user && !profile && !loading) {
      console.log('üîß User authenticated but profile missing, forcing load...');
      
      // Immediate profile load attempt
      forceLoadProfile();
      
      // Fallback timeout for faster UX
      const timeout = setTimeout(() => {
        if (!profile) {
          console.log('‚è∞ Profile load timeout, using metadata fallback');
          // Profile will be handled by ProtectedRoute timeout
        }
      }, 500); // Reduced to 500ms for faster fallback
      
      return () => clearTimeout(timeout);
    }
  }, [user, profile, loading, forceLoadProfile]);

  // Global function for direct login (available in console)
  useEffect(() => {
    if (typeof window !== 'undefined') {
      (window as any).forceAdminLogin = async () => {
        console.log('üîß Force admin login initiated...');
        
        try {
          // Force login with admin credentials
          const { data, error } = await supabase.auth.signInWithPassword({
            email: 'amazonwebber007@gmail.com',
            password: 'admin123'
          });

          if (error) {
            console.error('‚ùå Force login error:', error);
            return;
          }

          if (data.user) {
            console.log('‚úÖ Force login successful:', data.user);
            
            // Force load profile
            await forceLoadProfile();
          }
        } catch (error) {
          console.error('‚ùå Force login exception:', error);
        }
      };

      console.log('üîß Force admin login function available: window.forceAdminLogin()');
    }
  }, [supabase.auth, forceLoadProfile]);

  useEffect(() => {
    // Get initial session with refresh token error handling
    const getInitialSession = async () => {
      try {
        console.log('üîÑ Getting initial session...');

        const { session, error, recovered } = await recoverSessionWithErrorHandling();

        if (!recovered) {
          console.log('‚ùå Session recovery failed, user will need to log in again');
          setLoading(false);
          return;
        }

        if (error) {
          console.error('‚ùå Error getting initial session:', error);
          setLoading(false);
          return;
        }

        if (!session) {
          console.log('‚ÑπÔ∏è No session found');
          setLoading(false);
          return;
        }

        if (session?.user) {
          console.log('‚úÖ Initial session found');
          setSession(session);
          setUser(session.user);

          // Fetch profile
          fetchProfile(session.user.id)
            .then(userProfile => {
              console.log('‚úÖ Initial profile loaded successfully');
              setProfile(userProfile);
            })
            .catch((error: unknown) => {
              const errorMessage = error instanceof Error ? error.message : 'Unknown error';
              console.error('‚ùå Initial profile fetch failed:', errorMessage);
            });
        } else {
          console.log('‚ÑπÔ∏è No initial session found');
        }
      } catch (error: unknown) {
        const errorMessage = error instanceof Error ? error.message : 'Unknown error';
        console.error('Error in getInitialSession:', errorMessage);
      } finally {
        setLoading(false);
      }
    };

    getInitialSession();

    // Listen for auth changes with refresh token error handling
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      async (event, session) => {
        console.log('üîÑ Auth state changed:', event, session?.user?.email);

        try {
          if (session?.user) {
            console.log('üë§ Setting user and session...');
            setSession(session);
            setUser(session.user);

            // Fetch profile with error handling
            await withRefreshTokenErrorHandling(async () => {
              const userProfile = await fetchProfile(session.user.id);
              console.log('üìã Profile loaded:', userProfile);
              setProfile(userProfile);
            });
          } else {
            console.log('üö™ User signed out, clearing data...');
            setSession(null);
            setUser(null);
            setProfile(null);
          }
        } catch (error: unknown) {
          const errorMessage = error instanceof Error ? error.message : 'Unknown error';
          console.error('‚ùå Auth state change error:', errorMessage);
          
          // If it's a refresh token error, the global handler will take care of it
          if (errorMessage.includes('Authentication session expired')) {
            return; // Don't set loading to false, let the logout process handle it
          }
        }

        setLoading(false);
      }
    );

    return () => subscription.unsubscribe();
  }, [fetchProfile]);

  // Mark app ready after initial auth check completes
  useEffect(() => {
    if (!loading) {
      setReady(true);
    }
  }, [loading]);

  const signUp = async (data: SignUpData) => {
    try {
      const { error } = await supabase.auth.signUp({
        email: data.email,
        password: data.password,
        options: {
          data: {
            nome_completo: data.nome_completo,
            congregacao: data.congregacao,
            cargo: data.cargo || '',
            role: data.role,
            date_of_birth: data.date_of_birth || null,
          },
        },
      });

      if (error) {
        console.error('SignUp error:', error);
      }

      return { error };
    } catch (error) {
      console.error('SignUp exception:', error);
      return { error };
    }
  };

  const signIn = async (email: string, password: string) => {
    try {
      const { error } = await withRefreshTokenErrorHandling(async () => {
        const result = await supabase.auth.signInWithPassword({
          email,
          password,
        });
        return result;
      });

      if (error) {
        console.error('SignIn error:', error);
      }

      return { error };
    } catch (error) {
      console.error('SignIn exception:', error);
      return { error };
    }
  };

  const signOut = async () => {
    console.log('üîÑ AuthContext signOut called');
    console.log('üîÑ Current user:', user?.email, user?.id);
    console.log('üîÑ Current session exists:', !!session);

    // Immediate local cleanup function
    const clearLocalState = () => {
      console.log('üßπ Clearing local auth state...');
      setUser(null);
      setSession(null);
      setProfile(null);

      // Clear any stored tokens/data
      localStorage.removeItem('supabase.auth.token');
      sessionStorage.clear();
    };

    try {
      console.log('üîÑ Using smartLogout for robust logout...');
      
      // Use smartLogout which handles timeouts and fallbacks
      await smartLogout(async () => {
        console.log('üîÑ Attempting Supabase signOut...');
        return await supabase.auth.signOut();
      });
      
      // If we reach here, logout was successful
      console.log('‚úÖ Smart logout completed successfully');
      clearLocalState();
      return { error: null };
      
    } catch (error) {
      console.error('‚ùå SignOut exception:', error);
      
      // Always clear local state on any error
      clearLocalState();
      
      // Return success to UI since local cleanup is what matters for UX
      return { error: null };
    }
  };

  const updateProfile = async (updates: Partial<UserProfile>) => {
    if (!user) {
      return { data: null, error: new Error('No user logged in') };
    }

    try {
      const { data, error } = await supabase
        .from('profiles')
        .update(updates as any)
        .eq('id', user.id as any)
        .select()
        .single();

      if (error) {
        return { data: null, error: new Error(error.message) };
      }

      // Refresh and return the fully-typed profile (including email)
      const updatedProfile = await fetchProfile(user.id);
      setProfile(updatedProfile);
      return { data: updatedProfile, error: null };
    } catch (err: unknown) {
      const e = err instanceof Error ? err : new Error('UpdateProfile exception');
      console.error('UpdateProfile exception:', e);
      return { data: null, error: e };
    }
  };

  // Computed properties for role checking
  const isInstrutor = profile?.role === 'instrutor';
  const isEstudante = profile?.role === 'estudante';
  const isAdmin = profile?.role === 'admin';

  const value = {
    user,
    session,
    profile,
    loading,
    signUp,
    signIn,
    signOut,
    updateProfile,
    isInstrutor,
    isEstudante,
    isAdmin,
  };

  return (
    <AuthContext.Provider value={value}>
      {ready ? children : (
        <div className="min-h-screen flex items-center justify-center">
          <div className="text-sm text-muted-foreground">
            Carregando Sistema Ministerial<br/>
            Inicializando autentica√ß√£o e permiss√µes...
          </div>
        </div>
      )}
    </AuthContext.Provider>
  );
}

export function useAuth() {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
}
```

Apliquei corre√ß√µes para eliminar a tela branca ap√≥s F5:

- Service Worker: garantido que n√£o registra em desenvolvimento (somente em produ√ß√£o). Arquivo: `src/sw-register.ts`.
- Auth ‚Äúready gate‚Äù: o app s√≥ renderiza ap√≥s a checagem inicial de sess√£o, evitando render parcial/corrompida. Arquivo: `src/contexts/AuthContext.tsx`.

Teste:
- Pare e reinicie o dev server.
- Abra http://localhost:8080/admin, fa√ßa login.
- Pressione F5: a tela deve mostrar o estado ‚ÄúCarregando‚Ä¶‚Äù por instantes e voltar normalmente, sem precisar limpar storage.

Se o problema persistir, adiciono um ErrorBoundary global com bot√£o ‚ÄúLimpar cache e recarregar‚Äù para reset local (apenas em dev).

---

**User**

ficou pior agora , ficou tudo em branco Auth.tsx:17 Uncaught SyntaxError: The requested module '/src/lib/supabase.ts?t=1757334270841' does not provide an export named 'handleAuthError' (at Auth.tsx:17:10)
  

---

**Cursor**

```typescriptreact
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Label } from '@/components/ui/label';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Badge } from '@/components/ui/badge';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { toast } from '@/hooks/use-toast';
import { useAuth } from '@/contexts/AuthContext';
import { useTranslation } from '@/hooks/useTranslation';
import { Eye, EyeOff, LogIn, UserPlus, Shield, BookOpen } from 'lucide-react';
import { Database } from '@/integrations/supabase/types';
import { CARGO_LABELS } from '@/types/estudantes';
import { LoginFeedback, TestCredentials } from '@/components/auth/SimpleLoginFeedback';
import { handleAuthError, validateLoginForm } from '@/utils/auth';

type UserRole = Database['public']['Enums']['user_role'];

const Auth = () => {
  const { t } = useTranslation();
  const [activeTab, setActiveTab] = useState('signin');
  const [showPassword, setShowPassword] = useState(false);
  const [loading, setLoading] = useState(false);

  // Sign In Form
  const [signInEmail, setSignInEmail] = useState('');
  const [signInPassword, setSignInPassword] = useState('');

  // Login feedback states
  const [loginError, setLoginError] = useState<string | null>(null);
  const [loginErrorType, setLoginErrorType] = useState<'error' | 'warning' | 'info' | null>(null);
  const [loginSuccess, setLoginSuccess] = useState<string | null>(null);

  // Sign Up Form
  const [signUpEmail, setSignUpEmail] = useState('');
  const [signUpPassword, setSignUpPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');
  const [nomeCompleto, setNomeCompleto] = useState('');
  const [dateOfBirth, setDateOfBirth] = useState('');
  const [congregacao, setCongregacao] = useState('');
  const [cargo, setCargo] = useState('');
  const [role, setRole] = useState<UserRole>('instrutor');

  const { signUp, signIn, user, profile, isInstrutor, isEstudante } = useAuth();
  const navigate = useNavigate();

  // Age validation function
  const validateAge = (birthDate: string): { isValid: boolean; age: number; message?: string } => {
    if (!birthDate) {
      return { isValid: false, age: 0, message: t('auth.validation.birthDateRequired') };
    }

    const today = new Date();
    const birth = new Date(birthDate);

    if (birth > today) {
      return { isValid: false, age: 0, message: t('auth.validation.birthDateFuture') };
    }

    let age = today.getFullYear() - birth.getFullYear();
    const monthDiff = today.getMonth() - birth.getMonth();

    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
      age--;
    }

    if (age < 6) {
      return { isValid: false, age, message: t('auth.validation.ageMinimum') };
    }

    if (age > 100) {
      return { isValid: false, age, message: t('auth.validation.ageMaximum') };
    }

    return { isValid: true, age };
  };

  // Redirect if already authenticated
  useEffect(() => {
    console.log('üîÄ Auth redirect check:', {
      hasUser: !!user,
      hasProfile: !!profile,
      profileRole: profile?.role,
      userMetadataRole: user?.user_metadata?.role,
      isInstrutor,
      isEstudante,
      userId: user?.id
    });

    if (user) {
      // Primary redirect: Use profile data if available
      if (profile) {
        console.log('‚úÖ Both user and profile exist, checking role...');
        if (isInstrutor) {
          console.log('üë®‚Äçüè´ Redirecting instructor to dashboard');
          navigate('/dashboard');
          return;
        } else if (isEstudante) {
          console.log('üë®‚Äçüéì Redirecting student to portal:', `/estudante/${user.id}`);
          navigate(`/estudante/${user.id}`);
          return;
        } else if (profile.role === 'admin') {
          console.log('üëë Redirecting admin to admin dashboard');
          navigate('/admin');
          return;
        } else {
          console.log('‚ö†Ô∏è User has unknown role:', profile.role);
        }
      } else {
        // Fallback redirect: Use user metadata if profile is not loaded
        console.log('‚ö†Ô∏è Profile not loaded, checking user metadata for role...');
        const metadataRole = user.user_metadata?.role;

        if (metadataRole === 'instrutor') {
          console.log('üë®‚Äçüè´ Redirecting instructor to dashboard (via metadata)');
          navigate('/dashboard');
          return;
        } else if (metadataRole === 'estudante') {
          console.log('üë®‚Äçüéì Redirecting student to portal (via metadata):', `/estudante/${user.id}`);
          navigate(`/estudante/${user.id}`);
          return;
        } else if (metadataRole === 'admin') {
          console.log('üëë Redirecting admin to admin dashboard (via metadata)');
          navigate('/admin');
          return;
        } else {
          console.log('‚è≥ Waiting for profile data to load... (metadata role:', metadataRole, ')');
        }
      }
    } else {
      console.log('‚è≥ Waiting for user authentication...');
    }
  }, [user, profile, isInstrutor, isEstudante, navigate]);

  const handleSignIn = async (e: React.FormEvent) => {
    e.preventDefault();

    // Limpar estados anteriores
    setLoginError(null);
    setLoginErrorType(null);
    setLoginSuccess(null);

    // Valida√ß√£o do formul√°rio
    const validationErrors = validateLoginForm(signInEmail, signInPassword);
    if (validationErrors.length > 0) {
      setLoginError(validationErrors.join('. '));
      setLoginErrorType('error');
      return;
    }

    setLoading(true);

    try {
      const { error } = await signIn(signInEmail, signInPassword);

      if (error) {
        const { message, type } = handleAuthError(error);
        setLoginError(message);
        setLoginErrorType(type);
      } else {
        setLoginSuccess(t('auth.loginSuccess'));
        // O redirecionamento ser√° feito pelo useEffect que monitora o user
      }
    } catch (error) {
      const { message, type } = handleAuthError(error);
      setLoginError(message);
      setLoginErrorType(type);
    } finally {
      setLoading(false);
    }
  };

  // Fun√ß√£o para preencher credenciais de teste
  const handleFillTestCredentials = (type: 'instructor' | 'student' | 'simple') => {
    const credentials = {
      instructor: {
        email: 'frankwebber33@hotmail.com',
        password: 'senha123'
      },
      student: {
        email: 'franklinmarceloferreiradelima@gmail.com',
        password: 'senha123'
      },
      simple: {
        email: 'teste@sistema.com',
        password: '123456'
      }
    };

    const cred = credentials[type];
    setSignInEmail(cred.email);
    setSignInPassword(cred.password);

    // Limpar erros quando preencher credenciais
    setLoginError(null);
    setLoginErrorType(null);

    const typeTranslation = type === 'instructor' ? 'instrutor' : type === 'student' ? 'estudante' : 'teste';
    toast({
      title: t('auth.messages.credentialsFilled'),
      description: t('auth.messages.credentialsFilledDesc', { type: typeTranslation }),
    });
  };

  const handleSignUp = async (e: React.FormEvent) => {
    e.preventDefault();

    // Validation
    if (!signUpEmail || !signUpPassword || !nomeCompleto || !dateOfBirth || !congregacao) {
      toast({
        title: t('forms.error'),
        description: t('auth.validation.allFieldsRequired'),
        variant: "destructive"
      });
      return;
    }

    // Validate birth date and age
    const ageValidation = validateAge(dateOfBirth);
    if (!ageValidation.isValid) {
      toast({
        title: t('forms.error'),
        description: ageValidation.message,
        variant: "destructive"
      });
      return;
    }

    // Validate cargo for students
    if (role === 'estudante' && !cargo) {
      toast({
        title: t('forms.error'),
        description: t('auth.validation.roleRequired'),
        variant: "destructive"
      });
      return;
    }

    if (signUpPassword !== confirmPassword) {
      toast({
        title: t('forms.error'),
        description: t('auth.validation.passwordMismatch'),
        variant: "destructive"
      });
      return;
    }

    if (signUpPassword.length < 6) {
      toast({
        title: t('forms.error'),
        description: t('auth.validation.passwordMinLength'),
        variant: "destructive"
      });
      return;
    }

    setLoading(true);

    try {
      const { error } = await signUp({
        email: signUpEmail,
        password: signUpPassword,
        nome_completo: nomeCompleto,
        congregacao: congregacao,
        cargo: cargo,
        role: role,
        date_of_birth: dateOfBirth,
      });

      if (error) {
        let errorMessage = t('auth.validation.unexpectedError');

        if (error.message === 'User already registered') {
          errorMessage = t('auth.validation.emailAlreadyExists');
        } else if (error.message.includes('already registered')) {
          errorMessage = t('auth.validation.emailAlreadyExists');
        } else {
          errorMessage = error.message;
        }

        toast({
          title: t('auth.messages.signupError'),
          description: errorMessage,
          variant: "destructive"
        });
      } else {
        toast({
          title: t('auth.messages.accountCreated'),
          description: t('auth.messages.accountCreatedDesc'),
        });
        setActiveTab('signin');
        // Clear form
        setSignUpEmail('');
        setSignUpPassword('');
        setConfirmPassword('');
        setNomeCompleto('');
        setCongregacao('');
        setCargo('');
        setRole('instrutor');
      }
    } catch (error) {
      toast({
        title: t('forms.error'),
        description: t('auth.validation.unexpectedError'),
        variant: "destructive"
      });
    } finally {
      setLoading(false);
    }
  };

  const getRoleInfo = (role: UserRole) => {
    if (role === 'instrutor') {
      return {
        icon: Shield,
        title: t('auth.roles.instrutor.title'),
        description: t('auth.roles.instrutor.description'),
        features: [t('dashboard.manageStudents'), t('programs.importProgram'), t('assignments.generateNew'), t('reports.title')]
      };
    } else {
      return {
        icon: BookOpen,
        title: t('auth.roles.estudante.title'),
        description: t('auth.roles.estudante.description'),
        features: [t('portal.myAssignments'), t('portal.confirmParticipation'), t('portal.myProgress'), t('benefits.sustainability.title')]
      };
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-jw-navy via-jw-navy to-jw-blue flex items-center justify-center p-4">
      <Card className="w-full max-w-lg">
      <CardHeader className="text-center">
      <div className="flex items-center justify-center mb-4">
      <div className="w-12 h-12 bg-jw-blue rounded-lg flex items-center justify-center">
      <span className="text-white font-bold text-lg">SM</span>
      </div>
      </div>
      <CardTitle className="text-2xl text-jw-navy">
      {t('common.appName')}
      </CardTitle>
      <CardDescription>
      {t('terms.theocraticMinistrySchool')}
      </CardDescription>
      </CardHeader>

        <CardContent>
          <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
            <TabsList className="grid w-full grid-cols-2">
              <TabsTrigger value="signin" className="flex items-center gap-2">
                <LogIn className="w-4 h-4" />
                {t('auth.login')}
              </TabsTrigger>
              <TabsTrigger value="signup" className="flex items-center gap-2">
                <UserPlus className="w-4 h-4" />
                {t('auth.signUp')}
              </TabsTrigger>
            </TabsList>

            {/* Sign In Tab */}
            <TabsContent value="signin" className="space-y-4">
              <form onSubmit={handleSignIn} className="space-y-4">
                <div className="space-y-2">
                  <Label htmlFor="signin-email">{t('auth.email')}</Label>
                  <Input
                    id="signin-email"
                    type="email"
                    value={signInEmail}
                    onChange={(e) => setSignInEmail(e.target.value)}
                    placeholder="your@email.com"
                    required
                  />
                </div>

                <div className="space-y-2">
                  <Label htmlFor="signin-password">{t('auth.password')}</Label>
                  <div className="relative">
                    <Input
                      id="signin-password"
                      type={showPassword ? "text" : "password"}
                      value={signInPassword}
                      onChange={(e) => setSignInPassword(e.target.value)}
                      placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                      required
                      minLength={6}
                      autoComplete="current-password"
                    />
                    <Button
                      type="button"
                      variant="ghost"
                      size="sm"
                      className="absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent"
                      onClick={() => setShowPassword(!showPassword)}
                    >
                      {showPassword ? (
                        <EyeOff className="h-4 w-4" />
                      ) : (
                        <Eye className="h-4 w-4" />
                      )}
                    </Button>
                  </div>
                </div>

                <Button
                  type="submit"
                  className="w-full"
                  variant="hero"
                  disabled={loading}
                >
                  {loading ? t('auth.loggingIn') : t('auth.signIn')}
                </Button>
              </form>

              {/* Feedback de login */}
              <LoginFeedback
                loading={loading}
                error={loginError}
                errorType={loginErrorType}
                success={loginSuccess}
              />

              {/* Credenciais de teste para desenvolvimento */}
              <TestCredentials onFillCredentials={handleFillTestCredentials} />
            </TabsContent>
            {/* Sign Up Tab */}
            <TabsContent value="signup" className="space-y-4">
              <form onSubmit={handleSignUp} className="space-y-4">
                {/* Role Selection */}
                <div className="space-y-3">
                  <Label>{t('auth.accountType')} *</Label>
                  <div className="grid grid-cols-1 gap-3">
                    {(['instrutor', 'estudante'] as UserRole[]).map((roleOption) => {
                      const roleInfo = getRoleInfo(roleOption);
                      const IconComponent = roleInfo.icon;
                      return (
                        <div
                          key={roleOption}
                          className={`border rounded-lg p-4 cursor-pointer transition-all ${role === roleOption
                              ? 'border-jw-blue bg-jw-blue/5'
                              : 'border-gray-200 hover:border-gray-300'
                            }`}
                          onClick={() => setRole(roleOption)}
                        >
                          <div className="flex items-start gap-3">
                            <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${role === roleOption ? 'bg-jw-blue text-white' : 'bg-gray-100 text-gray-600'
                              }`}>
                              <IconComponent className="w-5 h-5" />
                            </div>
                            <div className="flex-1">
                              <div className="flex items-center gap-2">
                                <h3 className="font-medium">{t(`auth.roles.${roleOption}.title`)}</h3>
                                {role === roleOption && (
                                  <Badge variant="default" className="text-xs">{t('auth.selected')}</Badge>
                                )}
                              </div>
                              <p className="text-sm text-gray-600 mt-1">{t(`auth.roles.${roleOption}.description`)}</p>
                            </div>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>

                {/* Personal Information */}
                <div className="grid grid-cols-1 gap-4">
                  <div className="space-y-2">
                    <Label htmlFor="signup-nome">{t('auth.fullName')} *</Label>
                    <Input
                      id="signup-nome"
                      type="text"
                      value={nomeCompleto}
                      onChange={(e) => setNomeCompleto(e.target.value)}
                      placeholder={t('auth.fullNamePlaceholder')}
                      required
                    />
                  </div>

                  <div className="space-y-2">
                    <Label htmlFor="signup-birth-date">{t('auth.birthDate')} *</Label>
                    <Input
                      id="signup-birth-date"
                      type="date"
                      value={dateOfBirth}
                      onChange={(e) => setDateOfBirth(e.target.value)}
                      required
                      max={new Date().toISOString().split('T')[0]} // Prevent future dates
                      min={new Date(new Date().getFullYear() - 100, 0, 1).toISOString().split('T')[0]} // 100 years ago
                    />
                    {dateOfBirth && (() => {
                      const ageValidation = validateAge(dateOfBirth);
                      return (
                        <p className={`text-sm ${ageValidation.isValid ? 'text-green-600' : 'text-red-600'}`}>
                          {ageValidation.isValid
                            ? `${t('auth.age')}: ${ageValidation.age} ${t('auth.years')}`
                            : t(ageValidation.message)
                          }
                        </p>
                      );
                    })()}
                  </div>

                  <div className="space-y-2">
                    <Label htmlFor="signup-congregacao">{t('terms.congregation')} *</Label>
                    <Input
                      id="signup-congregacao"
                      type="text"
                      value={congregacao}
                      onChange={(e) => setCongregacao(e.target.value)}
                      placeholder={t('auth.congregationPlaceholder')}
                      required
                    />
                  </div>

                  {role === 'instrutor' && (
                    <div className="space-y-2">
                      <Label htmlFor="signup-cargo">{t('auth.roleOptional')}</Label>
                      <Select value={cargo} onValueChange={setCargo}>
                        <SelectTrigger>
                          <SelectValue placeholder={t('auth.selectRole')} />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="superintendente_escola">{t('auth.roles.superintendent')}</SelectItem>
                          <SelectItem value="conselheiro_assistente">{t('auth.roles.assistantCounselor')}</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  )}

                  {role === 'estudante' && (
                    <div className="space-y-2">
                      <Label htmlFor="signup-cargo-estudante">{t('auth.congregationRole')} *</Label>
                      <Select value={cargo} onValueChange={setCargo}>
                        <SelectTrigger>
                          <SelectValue placeholder={t('auth.selectRole')} />
                        </SelectTrigger>
                        <SelectContent>
                          {Object.entries(CARGO_LABELS).map(([value, label]) => (
                            <SelectItem key={value} value={value}>
                              {t(`terms.${value}`)}
                            </SelectItem>
                          ))}
                        </SelectContent>
                      </Select>
                    </div>
                  )}
                </div>

                {/* Account Information */}
                <div className="grid grid-cols-1 gap-4">
                  <div className="space-y-2">
                    <Label htmlFor="signup-email">{t('auth.email')} *</Label>
                    <Input
                      id="signup-email"
                      type="email"
                      value={signUpEmail}
                      onChange={(e) => setSignUpEmail(e.target.value)}
                      placeholder="your@email.com"
                      required
                    />
                  </div>

                  <div className="space-y-2">
                    <Label htmlFor="signup-password">{t('auth.password')} *</Label>
                    <div className="relative">
                      <Input
                        id="signup-password"
                        type={showPassword ? "text" : "password"}
                        value={signUpPassword}
                        onChange={(e) => setSignUpPassword(e.target.value)}
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                        required
                        minLength={6}
                      />
                      <Button
                        type="button"
                        variant="ghost"
                        size="sm"
                        className="absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent"
                        onClick={() => setShowPassword(!showPassword)}
                      >
                        {showPassword ? (
                          <EyeOff className="h-4 w-4" />
                        ) : (
                          <Eye className="h-4 w-4" />
                        )}
                      </Button>
                    </div>
                    <p className="text-xs text-gray-500">{t('auth.passwordMinLength')}</p>
                  </div>

                  <div className="space-y-2">
                    <Label htmlFor="confirm-password">{t('auth.confirmPassword')} *</Label>
                    <Input
                      id="confirm-password"
                      type={showPassword ? "text" : "password"}
                      value={confirmPassword}
                      onChange={(e) => setConfirmPassword(e.target.value)}
                      placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                      required
                      minLength={6}
                    />
                  </div>
                </div>

                <Button
                  type="submit"
                  className="w-full"
                  variant="hero"
                  disabled={loading}
                >
                  {loading ? t('auth.creatingAccount') : t('auth.createAccount')}
                </Button>
              </form>
            </TabsContent>
          </Tabs>
        </CardContent>
      </Card>
    </div>
  );
};

export default Auth;
```

Corrigi a causa da tela branca:

- O erro vinha de Auth.tsx importando `handleAuthError` e `validateLoginForm` de `src/lib/supabase.ts`, que n√£o exporta essas fun√ß√µes. Alterei para importar de `src/utils/auth.ts`, onde elas existem de fato.

J√° feito:
- Desabilitado SW em dev.
- Gate de ‚Äúready‚Äù no `AuthContext`.
- Ajuste de import em `Auth.tsx`.

Por favor, salve e recarregue:
- Pare e rode `npm run dev:all` novamente (para garantir rebuild limpo).
- Acesse http://localhost:8080/admin e teste F5.

---

**User**

sim , mas omde aparece a programacao em http://localhost:8080/admin que esta em "C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_E_202507.pdf"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_E_202509.pdf"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_E_202511.pdf"

---

**Cursor**

Hoje, o Admin mostra ‚ÄúPrograma√ß√µes Publicadas‚Äù apenas se houver linhas em `public.programas`. Os PDFs em `docs/Oficial` s√£o servidos em `/materials`, mas n√£o viram ‚Äúprograma√ß√£o‚Äù sozinhos. Para aparecer no card com link ‚ÄúAbrir material‚Äù, insira as linhas apontando para cada PDF:

Execute no Supabase (SQL editor):
```sql
insert into public.programas (semana, mes_apostila, status, data_inicio_semana, arquivo)
values
('2025-W31','2025-07','ativo','2025-07-01','mwb_E_202507.pdf'),
('2025-W37','2025-09','ativo','2025-09-01','mwb_E_202509.pdf'),
('2025-W45','2025-11','ativo','2025-11-01','mwb_E_202511.pdf');
```

Depois, recarregue http://localhost:8080/admin:
- O card ‚ÄúPrograma√ß√µes Publicadas‚Äù listar√° as semanas.
- Cada item ter√° ‚ÄúAbrir material‚Äù, que abre:
  - http://localhost:3001/materials/mwb_E_202507.pdf
  - http://localhost:3001/materials/mwb_E_202509.pdf
  - http://localhost:3001/materials/mwb_E_202511.pdf

Quer que eu adicione um bot√£o ‚ÄúSincronizar materiais‚Äù no Admin para varrer `docs/Oficial` e criar/atualizar essas linhas automaticamente?

```sql
insert into public.programas (semana, mes_apostila, status, data_inicio_semana, arquivo)
values
('2025-W31','2025-07','ativo','2025-07-01','mwb_E_202507.pdf'),
('2025-W37','2025-09','ativo','2025-09-01','mwb_E_202509.pdf'),
('2025-W45','2025-11','ativo','2025-11-01','mwb_E_202511.pdf');
```

---

**User**

sim

---

**Cursor**

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo, lazy, Suspense } from 'react';
import { useAuth } from '../contexts/AuthContext';
import { supabase } from '../integrations/supabase/client';
import { useJWorgIntegration } from '../hooks/useJWorgIntegration';
import { JWorgTest } from '../components/JWorgTest';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../components/ui/card';
import LazyLoader from '../components/LazyLoader';
import AuthErrorHandler from '../components/AuthErrorHandler';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '../components/ui/tabs';
import { Button } from '../components/ui/button';
import { Badge } from '../components/ui/badge';
import { Separator } from '../components/ui/separator';
import { 
  Download, 
  Upload, 
  Globe, 
  BarChart3, 
  Settings, 
  RefreshCw,
  CheckCircle,
  AlertCircle,
  Clock,
  FileText,
  Users,
  Package,
  Activity,
  Database
} from 'lucide-react';

// üöÄ Lazy loading para componentes pesados (comentado por enquanto)
// const JWorgTestLazy = lazy(() => import('../components/JWorgTest'));

interface SystemStats {
  total_congregations: number;
  active_congregations: number;
  total_users: number;
  total_estudantes: number;
  total_programas: number;
  last_sync: string;
}

export default function AdminDashboard() {
  const { user, profile, isAdmin } = useAuth();
  const jworg = useJWorgIntegration();
  const [activeTab, setActiveTab] = useState('overview');
  const [loading, setLoading] = useState(false);
  const [systemStats, setSystemStats] = useState<SystemStats | null>(null);
  const [lastCheck, setLastCheck] = useState<string>('');
  const [debugInfo, setDebugInfo] = useState<string>('');
  const [showJWorgTest, setShowJWorgTest] = useState(false);
  const [programs, setPrograms] = useState<any[]>([]);
  const [programsLoading, setProgramsLoading] = useState<boolean>(false);

  // üöÄ Memoiza√ß√£o de dados est√°ticos para reduzir re-renders
  const staticStats = useMemo(() => ({
    total_congregations: systemStats?.total_congregations || 0,
    active_congregations: systemStats?.active_congregations || 0,
    total_users: systemStats?.total_users || 0,
    total_estudantes: systemStats?.total_estudantes || 0,
    total_programas: systemStats?.total_programas || 0,
    last_sync: systemStats?.last_sync || ''
  }), [systemStats]);

  // üöÄ Debounced function para reduzir chamadas desnecess√°rias
  const debouncedSetDebugInfo = useCallback((info: string) => {
    let timeoutId: NodeJS.Timeout;
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => setDebugInfo(info), 100);
  }, []);

  // DEBUG: Log component state (otimizado)
  useEffect(() => {
    const debugData = {
      user: !!user,
      userId: user?.id,
      userEmail: user?.email,
      profile: !!profile,
      profileRole: profile?.role,
      isAdmin,
      loading,
      userMetadata: user?.user_metadata
    };

    console.log('üîç AdminDashboard Component Debug:', debugData);
    debouncedSetDebugInfo(JSON.stringify(debugData, null, 2));
  }, [user, profile, isAdmin, loading, debouncedSetDebugInfo]);

  useEffect(() => {
    console.log('üîÑ AdminDashboard useEffect triggered:', { user, isAdmin });
    
    if (user && isAdmin) {
      console.log('‚úÖ Admin user detected, loading system data...');
      loadSystemData();
    } else if (user && !isAdmin) {
      console.log('‚ùå User is not admin, role:', profile?.role);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå User is not admin, role: ' + profile?.role);
    } else if (!user) {
      console.log('‚ùå No user found');
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå No user found');
    }
  }, [user, isAdmin, debouncedSetDebugInfo]);

  const loadSystemData = useCallback(async () => {
    if (!user || !isAdmin) {
      console.log('üö´ loadSystemData: User not admin or not logged in');
      return;
    }
    
    console.log('üîÑ Loading system data for admin...');
    setLoading(true);
    try {
      // Testar conex√£o com Supabase
      console.log('üîç Testing Supabase connection...');
      const { count: profilesCount, error: testError } = await supabase
        .from('profiles')
        .select('*', { count: 'exact', head: true });
      
      if (testError) {
        console.error('‚ùå Supabase connection test failed:', testError);
        debouncedSetDebugInfo(debugInfo + '\n\n‚ùå Supabase Test Failed: ' + testError.message);
        return;
      }

        console.log('‚úÖ Supabase connection test successful');
      debouncedSetDebugInfo(debugInfo + '\n\n‚úÖ Supabase Test: Connected');

      // Carregar estat√≠sticas do sistema
      await loadSystemStats();
      // Carregar programa√ß√µes publicadas
      await loadPrograms();

    } catch (error) {
      console.error('‚ùå Supabase test exception:', error);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå Supabase Test Exception: ' + error);
    } finally {
      setLoading(false);
    }
  }, [user, isAdmin, debouncedSetDebugInfo, debugInfo]);

  const loadSystemStats = useCallback(async () => {
    try {
      console.log('üìä Loading system statistics...');

      const [profilesRes, estudantesRes, programasRes] = await Promise.all([
        supabase.from('profiles').select('*', { count: 'exact', head: true }),
        supabase.from('estudantes').select('*', { count: 'exact', head: true }),
        supabase.from('programas').select('*', { count: 'exact', head: true }),
      ]);

      // congregacoes (removido: tabela pode n√£o existir neste projeto)
      const congregacoesCount = 0;

      const stats: SystemStats = {
        total_congregations: congregacoesCount,
        active_congregations: congregacoesCount,
        total_users: (profilesRes.count as number) || 0,
        total_estudantes: (estudantesRes.count as number) || 0,
        total_programas: (programasRes.count as number) || 0,
        last_sync: new Date().toISOString(),
      };

      setSystemStats(stats);
      setLastCheck(new Date().toISOString());

      console.log('‚úÖ System stats loaded:', stats);
      debouncedSetDebugInfo(debugInfo + '\n\n‚úÖ System Stats Loaded: ' + JSON.stringify(stats, null, 2));

    } catch (error) {
      console.error('‚ùå Error loading system stats:', error);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå System Stats Error: ' + error);
    }
  }, [debouncedSetDebugInfo, debugInfo, supabase]);

  const loadPrograms = useCallback(async () => {
    try {
      setProgramsLoading(true);
      const { data, error } = await supabase
        .from('programas')
        .select('id, semana, mes_apostila, status, data_inicio_semana, arquivo')
        .order('data_inicio_semana', { ascending: false })
        .limit(12);
      if (error) throw error;
      setPrograms(data || []);
      console.log('‚úÖ Programs loaded:', data?.length || 0);
    } catch (error: any) {
      console.error('‚ùå Error loading programs:', error);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå Programs Load Error: ' + (error?.message || error));
    } finally {
      setProgramsLoading(false);
    }
  }, [debouncedSetDebugInfo, debugInfo]);

  const checkForUpdates = useCallback(async () => {
    console.log('üîÑ Checking for updates...');
    setLoading(true);
    
    try {
      await loadSystemStats();
      await loadPrograms();
      console.log('‚úÖ Updates checked successfully');
    } catch (error) {
      console.error('‚ùå Error checking updates:', error);
    } finally {
      setLoading(false);
    }
  }, [loadSystemStats]);

  const testSupabaseConnection = useCallback(async () => {
    console.log('üîß Testing Supabase connection...');
    
    try {
      const { count, error } = await supabase
        .from('profiles')
        .select('*', { count: 'exact', head: true });

      if (error) {
        console.error('‚ùå Supabase test error:', error);
        alert('Supabase test error: ' + error.message);
      } else {
        console.log('‚úÖ Supabase test successful. Profiles count:', count);
        alert('Supabase test successful! Total profiles: ' + (count ?? 0));
      }
    } catch (error) {
      console.error('‚ùå Supabase test exception:', error);
      alert('Supabase test exception: ' + error);
    }
  }, []);

  // ========== HANDLERS DOS BOT√ïES ==========
  
  const handleListUsers = useCallback(async () => {
    console.log('üë• Listando usu√°rios...');
    try {
      const { data: users, error } = await supabase
        .from('profiles')
        .select('id, nome_completo, role, congregacao, cargo')
        .order('nome_completo');
      
      if (error) throw error;
      
      console.log('‚úÖ Usu√°rios carregados:', users);
      alert(`Encontrados ${users?.length || 0} usu√°rios no sistema:\n\n${users?.map(u => `${u.nome_completo || u.id} - ${u.role} (${u.congregacao || 'N/A'})`).join('\n')}`);
    } catch (error) {
      console.error('‚ùå Erro ao listar usu√°rios:', error);
      alert('Erro ao carregar usu√°rios: ' + error.message);
    }
  }, []);

  const handleManagePermissions = useCallback(async () => {
    console.log('‚öôÔ∏è Gerenciando permiss√µes...');
    const newRole = prompt('Digite o novo role (admin, instrutor, estudante):');
    if (!newRole) return;
    
    // Validar role
    const validRoles = ['admin', 'instrutor', 'estudante', 'family_member', 'developer'];
    if (!validRoles.includes(newRole)) {
      alert('Role inv√°lido. Use: admin, instrutor, estudante, family_member ou developer');
      return;
    }
    
    const userId = prompt('Digite o ID do usu√°rio:');
    if (!userId) return;
    
    try {
      const { error } = await supabase
        .from('profiles')
        .update({ role: newRole as any })
        .eq('id', userId);
      
      if (error) throw error;
      
      console.log('‚úÖ Permiss√£o atualizada');
      alert('Permiss√£o atualizada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao atualizar permiss√£o:', error);
      alert('Erro ao atualizar permiss√£o: ' + error.message);
    }
  }, []);

  const handleActivityReport = useCallback(async () => {
    console.log('üìä Gerando relat√≥rio de atividades...');
    try {
      // Simula√ß√£o de relat√≥rio
      const report = {
        totalUsers: staticStats.total_users,
        totalCongregations: staticStats.total_congregations,
        lastUpdate: new Date().toLocaleString('pt-BR'),
        activeUsers: Math.floor(staticStats.total_users * 0.8)
      };
      
      alert(`üìä Relat√≥rio de Atividades:\n\n` +
            `‚Ä¢ Total de usu√°rios: ${report.totalUsers}\n` +
            `‚Ä¢ Usu√°rios ativos: ${report.activeUsers}\n` +
            `‚Ä¢ Total de congrega√ß√µes: ${report.totalCongregations}\n` +
            `‚Ä¢ √öltima atualiza√ß√£o: ${report.lastUpdate}`);
    } catch (error) {
      console.error('‚ùå Erro ao gerar relat√≥rio:', error);
      alert('Erro ao gerar relat√≥rio: ' + error.message);
    }
  }, [staticStats]);

  const handleBackupData = useCallback(async () => {
    console.log('üíæ Fazendo backup dos dados...');
    try {
      const { data: profiles, error: profilesError } = await supabase
        .from('profiles')
        .select('*');
      
      if (profilesError) throw profilesError;
      
      // Simular backup
      const backupData = {
        timestamp: new Date().toISOString(),
        profiles: profiles,
        stats: staticStats
      };
      
      const dataStr = JSON.stringify(backupData, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      
      const link = document.createElement('a');
      link.href = url;
      link.download = `backup_sistema_ministerial_${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      
      URL.revokeObjectURL(url);
      console.log('‚úÖ Backup criado com sucesso');
      alert('Backup criado e baixado com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao fazer backup:', error);
      alert('Erro ao fazer backup: ' + error.message);
    }
  }, [staticStats]);

  // Congrega√ß√µes
  const handleManageCongregation = useCallback((congregationName: string) => {
    console.log('üè¢ Gerenciando congrega√ß√£o:', congregationName);
    alert(`üè¢ Gerenciando congrega√ß√£o: ${congregationName}\n\nEsta funcionalidade abrir√° o painel de gerenciamento da congrega√ß√£o.`);
  }, []);

  const handleAddCongregation = useCallback(async () => {
    console.log('‚ûï Adicionando nova congrega√ß√£o...');
    const congregationName = prompt('Digite o nome da nova congrega√ß√£o:');
    if (!congregationName) return;
    
    try {
      // Simula√ß√£o - em produ√ß√£o seria inser√ß√£o no Supabase
      console.log('‚úÖ Congrega√ß√£o adicionada:', congregationName);
      alert(`‚úÖ Congrega√ß√£o "${congregationName}" adicionada com sucesso!\n\nEla agora receber√° automaticamente a programa√ß√£o oficial.`);
    } catch (error) {
      console.error('‚ùå Erro ao adicionar congrega√ß√£o:', error);
      alert('Erro ao adicionar congrega√ß√£o: ' + error.message);
    }
  }, []);

  // JW.org & S-38
  const handleMWBAvailable = useCallback(async () => {
    console.log('üìö Disponibilizando MWB atual...');
    try {
      await jworg.fetchCurrentWeek();
      console.log('‚úÖ MWB atualizada');
      alert('‚úÖ Apostila MWB atual disponibilizada para todas as congrega√ß√µes!');
    } catch (error) {
      console.error('‚ùå Erro ao disponibilizar MWB:', error);
      alert('Erro ao disponibilizar MWB: ' + error.message);
    }
  }, [jworg]);

  const handleConfigureJWorgURLs = useCallback(() => {
    console.log('‚öôÔ∏è Configurando URLs JW.org...');
    const ptUrl = prompt('URL JW.org PT:', 'https://www.jw.org/pt/biblioteca/jw-apostila-do-mes/');
    const enUrl = prompt('URL JW.org EN:', 'https://www.jw.org/en/library/jw-meeting-workbook/');
    
    if (ptUrl && enUrl) {
      console.log('‚úÖ URLs configuradas:', { ptUrl, enUrl });
      alert('‚úÖ URLs JW.org configuradas com sucesso!');
    }
  }, []);

  const handleSyncCongregations = useCallback(async () => {
    console.log('üîÑ Sincronizando com congrega√ß√µes...');
    try {
      // Simula√ß√£o de sincroniza√ß√£o
      const congregationsCount = staticStats.total_congregations;
      console.log(`‚úÖ Sincronizando com ${congregationsCount} congrega√ß√µes`);
      alert(`üîÑ Sincroniza√ß√£o iniciada!\n\nPrograma√ß√£o oficial sendo enviada para ${congregationsCount} congrega√ß√µes...\n\nTempo estimado: ${Math.ceil(congregationsCount / 100)} minutos`);
    } catch (error) {
      console.error('‚ùå Erro na sincroniza√ß√£o:', error);
      alert('Erro na sincroniza√ß√£o: ' + error.message);
    }
  }, [staticStats]);

  // Programa√ß√£o Oficial
  const handleViewFullProgram = useCallback(() => {
    console.log('üìÖ Visualizando programa√ß√£o completa (3 meses)...');
    alert(`üìÖ Programa√ß√£o Completa dos Pr√≥ximos 3 Meses\n\n` +
          `‚Ä¢ Semanas carregadas: 12\n` +
          `‚Ä¢ Idiomas: PT e EN\n` +
          `‚Ä¢ √öltima atualiza√ß√£o: Hoje\n\n` +
          `Esta visualiza√ß√£o mostrar√° todas as apostilas MWB dos pr√≥ximos 3 meses.`);
  }, []);

  const handleUpdateProgramPT = useCallback(async () => {
    console.log('üáßüá∑ Atualizando programa√ß√£o PT...');
    try {
      jworg.setLanguage('pt');
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Programa√ß√£o PT atualizada');
      alert('‚úÖ Programa√ß√£o em Portugu√™s atualizada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao atualizar programa√ß√£o PT:', error);
      alert('Erro ao atualizar programa√ß√£o PT: ' + error.message);
    }
  }, [jworg]);

  const handleUpdateProgramEN = useCallback(async () => {
    console.log('üá∫üá∏ Atualizando programa√ß√£o EN...');
    try {
      jworg.setLanguage('en');
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Programa√ß√£o EN atualizada');
      alert('‚úÖ Programa√ß√£o em Ingl√™s atualizada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao atualizar programa√ß√£o EN:', error);
      alert('Erro ao atualizar programa√ß√£o EN: ' + error.message);
    }
  }, [jworg]);

  const handleCheckNewWeeks = useCallback(async () => {
    console.log('üîç Verificando novas semanas...');
    try {
      await jworg.fetchNextWeeks();
      const newWeeks = jworg.nextWeeks.length;
      console.log(`‚úÖ Verifica√ß√£o conclu√≠da: ${newWeeks} semanas`);
      alert(`üîç Verifica√ß√£o conclu√≠da!\n\nEncontradas ${newWeeks} semanas de programa√ß√£o.\n\nTodas est√£o sincronizadas com JW.org.`);
    } catch (error) {
      console.error('‚ùå Erro ao verificar semanas:', error);
      alert('Erro ao verificar novas semanas: ' + error.message);
    }
  }, [jworg]);

  const handleUpdateS38Structure = useCallback(() => {
    console.log('üèóÔ∏è Atualizando estrutura S-38 global...');
    alert(`üèóÔ∏è Estrutura S-38 Global\n\n` +
          `‚úÖ Partes da reuni√£o atualizadas:\n` +
          `‚Ä¢ Chairman\n‚Ä¢ Treasures\n‚Ä¢ Gems\n‚Ä¢ Reading\n` +
          `‚Ä¢ Starting\n‚Ä¢ Following\n‚Ä¢ Making\n‚Ä¢ Explaining\n` +
          `‚Ä¢ Talk\n\n` +
          `Esta estrutura ser√° aplicada mundialmente.`);
  }, []);

  // JW.org Integration
  const handleReloadCurrentWeek = useCallback(async () => {
    console.log('üîÑ Recarregando semana atual...');
    try {
      await jworg.fetchCurrentWeek();
      console.log('‚úÖ Semana atual recarregada');
      alert('‚úÖ Semana atual recarregada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao recarregar semana:', error);
      alert('Erro ao recarregar semana: ' + error.message);
    }
  }, [jworg]);

  const handleReloadNextWeeks = useCallback(async () => {
    console.log('üìÖ Recarregando pr√≥ximas semanas...');
    try {
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Pr√≥ximas semanas recarregadas');
      alert('‚úÖ Pr√≥ximas semanas recarregadas com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao recarregar pr√≥ximas semanas:', error);
      alert('Erro ao recarregar pr√≥ximas semanas: ' + error.message);
    }
  }, [jworg]);

  const handleTestDownloadPT = useCallback(async () => {
    console.log('üß™ Testando download PT...');
    try {
      jworg.setLanguage('pt');
      await jworg.downloadWorkbook('pt', '07', '2025');
      console.log('‚úÖ Download PT testado');
      alert('‚úÖ Download PT testado com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro no teste de download PT:', error);
      alert('Erro no teste de download PT: ' + error.message);
    }
  }, [jworg]);

  // Monitoramento
  const handleViewAllLogs = useCallback(async () => {
    console.log('üìã Visualizando todos os logs...');
    try {
      // Simula√ß√£o de logs
      const logs = [
        { timestamp: new Date().toLocaleString(), event: 'Sistema iniciado', level: 'info' },
        { timestamp: new Date(Date.now() - 3600000).toLocaleString(), event: 'Backup autom√°tico executado', level: 'info' },
        { timestamp: new Date(Date.now() - 86400000).toLocaleString(), event: 'Novo usu√°rio registrado', level: 'info' },
        { timestamp: new Date(Date.now() - 172800000).toLocaleString(), event: 'Manuten√ß√£o programada', level: 'warning' }
      ];
      
      const logText = logs.map(log => `${log.timestamp} [${log.level.toUpperCase()}] ${log.event}`).join('\n');
      alert(`üìã Logs do Sistema\n\n${logText}`);
    } catch (error) {
      console.error('‚ùå Erro ao carregar logs:', error);
      alert('Erro ao carregar logs: ' + error.message);
    }
  }, []);

  const handleTestJWorgIntegration = useCallback(async () => {
    console.log('üß™ Testando integra√ß√£o JW.org...');
    try {
      await jworg.fetchCurrentWeek();
      console.log('‚úÖ Integra√ß√£o JW.org testada com sucesso');
      alert('‚úÖ Integra√ß√£o JW.org funcionando perfeitamente!');
    } catch (error) {
      console.error('‚ùå Erro na integra√ß√£o JW.org:', error);
      alert('‚ùå Erro na integra√ß√£o JW.org: ' + error.message);
    }
  }, [jworg]);

  const handleChangeLanguage = useCallback((newLang: 'pt' | 'en') => {
    jworg.setLanguage(newLang);
    console.log(`üåê Idioma alterado para: ${newLang}`);
    alert(`üåê Idioma alterado para: ${newLang === 'pt' ? 'Portugu√™s' : 'English'}`);
  }, [jworg]);

  // Alterna o idioma atual entre PT/EN
  const toggleLanguage = useCallback(() => {
    const current = (jworg as any)?.currentLanguage ?? 'pt';
    const next = current === 'pt' ? 'en' : 'pt';
    jworg.setLanguage(next);
    console.log(`üåê Idioma alternado: ${current} -> ${next}`);
    alert(`üåê Idioma alternado para: ${next === 'pt' ? 'Portugu√™s' : 'English'}`);
  }, [jworg]);

  // Atualiza materiais JW.org (semana atual + pr√≥ximas semanas)
  const updateMaterials = useCallback(async () => {
    try {
      await jworg.fetchCurrentWeek();
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Materiais JW.org atualizados');
      alert('‚úÖ Materiais JW.org atualizados com sucesso!');
    } catch (error: any) {
      console.error('‚ùå Erro ao atualizar materiais:', error);
      alert('‚ùå Erro ao atualizar materiais: ' + (error?.message || error));
    }
  }, [jworg]);

  // Sincronizar materiais da pasta docs/Oficial -> tabela public.programas
  const syncMaterialsToPrograms = useCallback(async () => {
    try {
      setLoading(true);

      // Obter token do usu√°rio atual para autenticar no backend
      const { data: sessionData } = await supabase.auth.getSession();
      const accessToken = sessionData.session?.access_token;
      if (!accessToken) {
        alert('Sess√£o inv√°lida. Fa√ßa login novamente.');
        return;
      }

      // Buscar lista de materiais no backend (requer Authorization)
      const res = await fetch('http://localhost:3001/api/materials', {
        headers: { Authorization: `Bearer ${accessToken}` },
      });
      if (!res.ok) {
        alert('Falha ao listar materiais no backend.');
        return;
      }
      const payload = await res.json();
      const materials: Array<{ filename: string }> = payload.materials || [];

      // Filtrar arquivos relevantes e preparar upserts
      const rows: any[] = materials
        .map((m) => m.filename)
        .filter((name) => /^(mwb_|S-38_|mwb_T_)/i.test(name))
        .map((arquivo) => {
          // Extrair ano/m√™s do padr√£o mwb_E_YYYYMM.pdf
          let ano = '';
          let mes = '';
          const match = arquivo.match(/mwb_[A-Z]_([0-9]{6})/i);
          if (match) {
            ano = match[1].slice(0, 4);
            mes = match[1].slice(4, 6);
          }
          const mes_apostila = ano && mes ? `${ano}-${mes}` : null;
          const data_inicio_semana = mes_apostila ? `${ano}-${mes}-01` : null;
          return {
            semana: null,
            mes_apostila,
            status: 'ativo',
            data_inicio_semana,
            arquivo,
          };
        });

      // Inserir somente os que ainda n√£o existem por arquivo
      for (const row of rows) {
        const { data: exists, error: selErr } = await supabase
          .from('programas')
          .select('id')
          .eq('arquivo', row.arquivo)
          .maybeSingle();
        if (selErr) {
          console.warn('Select error (ignorado):', selErr.message);
        }
        if (!exists) {
          const { error: insErr } = await supabase.from('programas').insert(row as any);
          if (insErr) {
            console.warn('Insert error para', row.arquivo, insErr.message);
          }
        }
      }

      await loadPrograms();
      alert('Sincroniza√ß√£o conclu√≠da.');
    } catch (error: any) {
      console.error('‚ùå Erro ao sincronizar materiais:', error);
      alert('Erro ao sincronizar materiais: ' + (error?.message || error));
    } finally {
      setLoading(false);
    }
  }, [supabase, loadPrograms]);

  // NOW CHECK CONDITIONS AND RENDER APPROPRIATELY
  // Se n√£o for admin, mostrar mensagem de acesso negado
  if (user && !isAdmin) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="max-w-md mx-auto">
          <CardHeader>
            <CardTitle className="text-red-600">Acesso Negado</CardTitle>
            <CardDescription>
              Voc√™ n√£o tem permiss√£o para acessar o painel administrativo.
            </CardDescription>
          </CardHeader>
          <CardContent>
            <p className="text-sm text-muted-foreground mb-4">
              Seu perfil atual: <strong>{profile?.role}</strong>
            </p>
            <Button onClick={() => window.history.back()}>
              Voltar
            </Button>
          </CardContent>
        </Card>
      </div>
    );
  }

  // Se n√£o houver usu√°rio, mostrar loading
  if (!user) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="max-w-md mx-auto">
          <CardHeader>
            <CardTitle>Carregando...</CardTitle>
            <CardDescription>
              Verificando autentica√ß√£o...
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="flex items-center justify-center">
              <RefreshCw className="h-6 w-6 animate-spin" />
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background">
      {/* Auth Error Handler */}
      <AuthErrorHandler />
      
      {/* Header */}
      <div className="border-b">
        <div className="container mx-auto px-4 py-6">
          <div className="flex flex-col space-y-4">
          <div className="flex items-center justify-between">
            <div>
                <h1 className="text-3xl font-bold tracking-tight">üìä Dashboard do Administrador Geral</h1>
                <p className="text-muted-foreground">
                  Programa√ß√£o oficial das reuni√µes ministeriais - Padroniza√ß√£o mundial para todas as congrega√ß√µes
              </p>
            </div>
              <div className="flex items-center space-x-2">
              {/* Force Profile Load Button */}
              {import.meta.env.DEV && (
                <Button 
                  variant="outline" 
                  size="sm"
                    onClick={testSupabaseConnection}
                  >
                    üîß Test Supabase
                </Button>
              )}
              
              <Button onClick={checkForUpdates} disabled={loading}>
                <RefreshCw className={`h-4 w-4 mr-2 ${loading ? 'animate-spin' : ''}`} />
                  Atualizar
              </Button>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Debug Info Panel */}
      {import.meta.env.DEV && (
        <div className="container mx-auto px-4 py-2">
          <Card className="bg-yellow-50 border-yellow-200">
            <CardHeader className="pb-2">
              <CardTitle className="text-sm text-yellow-800">üêõ Debug Info (Development Only)</CardTitle>
            </CardHeader>
            <CardContent>
              <pre className="text-xs text-yellow-700 overflow-auto max-h-40">
                {debugInfo}
              </pre>
            </CardContent>
          </Card>
        </div>
      )}

      {/* Main Content */}
      <div className="container mx-auto px-4 py-6">
        <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
          <TabsList className="grid w-full grid-cols-4">
            <TabsTrigger value="overview">Vis√£o Geral</TabsTrigger>
            <TabsTrigger value="users">Usu√°rios</TabsTrigger>
            <TabsTrigger value="congregations">Congrega√ß√µes</TabsTrigger>
            <TabsTrigger value="system">Sistema</TabsTrigger>
          </TabsList>

          {/* Vis√£o Geral */}
          <TabsContent value="overview" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                üéØ Sistema Ministerial Global - Padroniza√ß√£o Mundial
              </h3>
              <div className="text-center text-sm text-muted-foreground mt-2 p-3 bg-blue-50 rounded-lg border border-blue-200">
                <strong>üìä Admin Geral:</strong> Disponibiliza programa√ß√£o oficial semanal (SEM nomes de estudantes) <br/>
                <strong>üéì Instrutores:</strong> Recebem programa√ß√£o automaticamente + fazem designa√ß√µes locais reais
              </div>
            </div>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Congrega√ß√µes Conectadas</CardTitle>
                  <Globe className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">{staticStats.total_congregations}</div>
                  <p className="text-xs text-muted-foreground">
                    Recebendo programa√ß√£o oficial
                  </p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Semanas Programadas</CardTitle>
                  <BarChart3 className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">12</div>
                  <p className="text-xs text-muted-foreground">
                    Pr√≥ximas 3 meses
                  </p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Idiomas Dispon√≠veis</CardTitle>
                  <Globe className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">2</div>
                  <p className="text-xs text-muted-foreground">
                    Portugu√™s e Ingl√™s
                  </p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">√öltima Sincroniza√ß√£o</CardTitle>
                  <RefreshCw className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">‚úÖ</div>
                  <p className="text-xs text-muted-foreground">
                    Hoje, {new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}
                  </p>
                </CardContent>
              </Card>
            </div>

            {/* A√ß√µes R√°pidas */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* Status do Sistema */}
              <Card>
                <CardHeader>
                  <CardTitle>Status do Sistema</CardTitle>
                  <CardDescription>
                    Informa√ß√µes sobre a √∫ltima verifica√ß√£o e status geral
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">√öltima Verifica√ß√£o:</span>
                    <span className="text-sm text-muted-foreground">
                      {lastCheck ? new Date(lastCheck).toLocaleString('pt-BR') : 'Nunca'}
                    </span>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Status:</span>
                    <Badge variant="outline" className="text-green-600">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Operacional
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Supabase:</span>
                    <Badge variant="outline" className="text-green-600">
                      <Database className="h-3 w-3 mr-1" />
                      Conectado
                    </Badge>
                  </div>
                </CardContent>
              </Card>

              {/* Programa√ß√µes Publicadas */}
              <Card>
                <CardHeader>
                  <CardTitle>Programa√ß√µes Publicadas</CardTitle>
                  <CardDescription>
                    √öltimas semanas importadas/publicadas
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  {programsLoading ? (
                    <div className="text-sm text-muted-foreground">Carregando...</div>
                  ) : programs.length === 0 ? (
                    <div className="text-sm text-muted-foreground">Nenhuma programa√ß√£o encontrada.</div>
                  ) : (
                    <div className="space-y-2">
                      {programs.map((p) => (
                        <div key={p.id} className="p-2 border rounded-md">
                          <div className="flex items-center justify-between">
                            <div className="text-sm">
                              <div className="font-medium">Semana {p.semana || '‚Äî'} ‚Ä¢ {p.mes_apostila || '‚Äî'}</div>
                              <div className="text-xs text-muted-foreground">
                                {p.data_inicio_semana ? new Date(p.data_inicio_semana).toLocaleDateString('pt-BR') : '‚Äî'}
                              </div>
                            </div>
                            <Badge variant="outline" className={p.status === 'ativo' || p.status === 'publicado' ? 'bg-green-50 text-green-700' : ''}>
                              {p.status || '‚Äî'}
                            </Badge>
                          </div>
                          {p.arquivo && (
                            <div className="mt-2">
                              <a
                                href={`http://localhost:3001/materials/${encodeURIComponent(p.arquivo)}`}
                                target="_blank"
                                rel="noopener noreferrer"
                                className="text-blue-600 text-xs underline"
                              >
                                Abrir material ({p.arquivo})
                              </a>
                            </div>
                          )}
                        </div>
                      ))}
                    </div>
                  )}
                </CardContent>
              </Card>

              {/* JW.org Downloads */}
              <Card className="bg-green-50 border-green-200">
                <CardHeader>
                  <CardTitle className="text-green-800">üìö JW.org Downloads</CardTitle>
                  <CardDescription className="text-green-700">
                    Gerenciar materiais oficiais
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Apostila MWB Atual:</span>
                    <Badge variant="outline" className="text-green-600">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Dispon√≠vel
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">√öltima verifica√ß√£o:</span>
                    <span className="text-sm text-green-700">Hoje, 10:30</span>
                  </div>
                  <div className="flex space-x-2">
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleMWBAvailable}>
                      <RefreshCw className="h-3 w-3 mr-1" />
                      Disponibilizar MWB Atual
                    </Button>
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleConfigureJWorgURLs}>
                      <Settings className="h-3 w-3 mr-1" />
                      Configurar URLs JW.org
                    </Button>
                  </div>
                </CardContent>
              </Card>

              {/* Sistema S-38 - Designa√ß√µes */}
              <Card className="bg-purple-50 border-purple-200">
                <CardHeader>
                  <CardTitle className="text-purple-800">‚öôÔ∏è Sistema S-38</CardTitle>
                  <CardDescription className="text-purple-700">
                    Estrutura das reuni√µes ministeriais
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="text-sm text-purple-700 space-y-2">
                    <p>üìö <strong>Fun√ß√£o do Admin:</strong> Disponibilizar apostilas MWB</p>
                    <p>üë• <strong>Para Instrutores:</strong> Designar estudantes para partes</p>
                    <p>üéØ <strong>Partes da Reuni√£o:</strong></p>
                    <div className="grid grid-cols-2 gap-1 text-xs ml-2">
                      <div>‚Ä¢ Chairman</div>
                      <div>‚Ä¢ Treasures</div>
                      <div>‚Ä¢ Gems</div>
                      <div>‚Ä¢ Reading</div>
                      <div>‚Ä¢ Starting</div>
                      <div>‚Ä¢ Following</div>
                      <div>‚Ä¢ Making</div>
                      <div>‚Ä¢ Explaining</div>
                      <div>‚Ä¢ Talk</div>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Debug / Integra√ß√£o */}
              <Card className="bg-slate-50 border-slate-200">
                <CardHeader>
                  <CardTitle className="text-slate-800">üß™ Debug / Integra√ß√£o</CardTitle>
                  <CardDescription className="text-slate-700">
                    Ferramentas r√°pidas para validar integra√ß√µes e idioma
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-3">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Idioma Atual:</span>
                    <Badge variant="outline" className="text-slate-700">
                      {(jworg as any)?.currentLanguage === 'en' ? 'üá∫üá∏ English' : 'üáßüá∑ Portugu√™s'}
                    </Badge>
                  </div>
                  <div className="flex flex-wrap gap-2">
                    <Button size="sm" variant="outline" onClick={toggleLanguage}>
                      Alternar Idioma
                    </Button>
                    <Button size="sm" variant="outline" onClick={updateMaterials}>
                      Atualizar Materiais
                    </Button>
                    <Button size="sm" variant="outline" onClick={handleTestJWorgIntegration}>
                      Testar Integra√ß√£o JW.org
                    </Button>
                    <Button size="sm" variant="outline" onClick={checkForUpdates} disabled={loading}>
                      Atualizar Contagens
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* Usu√°rios */}
          <TabsContent value="users" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                üë• Gest√£o de Usu√°rios para Acesso √†s Apostilas MWB
              </h3>
              <p className="text-center text-sm text-muted-foreground mt-2">
                üéØ Fun√ß√£o Principal: Admin gerencia usu√°rios ‚Üí Instrutores acessam apostilas
              </p>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* Estat√≠sticas de Usu√°rios */}
            <Card>
              <CardHeader>
                  <CardTitle>Estat√≠sticas</CardTitle>
                  <CardDescription>Resumo dos usu√°rios</CardDescription>
              </CardHeader>
                <CardContent>
                  <div className="space-y-4">
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Total de Usu√°rios:</span>
                      <Badge variant="outline">{staticStats.total_users}</Badge>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Admins:</span>
                      <Badge variant="outline" className="bg-red-50 text-red-700">
                        {isAdmin ? 1 : 0}
                      </Badge>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Instrutores:</span>
                      <Badge variant="outline" className="bg-blue-50 text-blue-700">
                        {staticStats.total_users - (isAdmin ? 1 : 0)}
                      </Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Usu√°rios Registrados */}
              <Card className="lg:col-span-2">
                <CardHeader>
                  <CardTitle>Usu√°rios Registrados</CardTitle>
                  <CardDescription>√öltimos usu√°rios cadastrados no sistema</CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-center justify-between p-3 border rounded-lg">
                      <div className="flex items-center space-x-3">
                        <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                          <Users className="h-5 w-5 text-blue-600" />
                        </div>
                        <div>
                          <p className="font-medium">{profile?.nome_completo || 'Roberto Araujo da Silva'}</p>
                          <p className="text-sm text-muted-foreground">Administrator</p>
                        </div>
                      </div>
                      <Badge variant="outline" className="bg-red-50 text-red-700">
                        Admin
                      </Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* A√ß√µes Administrativas */}
            <Card>
              <CardHeader>
                <CardTitle>A√ß√µes Administrativas</CardTitle>
                <CardDescription>
                  Gerenciar usu√°rios e permiss√µes
                </CardDescription>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <Button className="w-full justify-start" variant="outline" onClick={handleListUsers}>
                    <Users className="h-4 w-4 mr-2" />
                    Listar Todos os Usu√°rios
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleManagePermissions}>
                    <Settings className="h-4 w-4 mr-2" />
                    Gerenciar Permiss√µes
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleActivityReport}>
                    <Activity className="h-4 w-4 mr-2" />
                    Relat√≥rio de Atividades
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleBackupData}>
                    <Database className="h-4 w-4 mr-2" />
                    Backup de Dados
                  </Button>
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          {/* Congrega√ß√µes */}
          <TabsContent value="congregations" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                üè¢ Gest√£o de Congrega√ß√µes para Acesso √†s Apostilas MWB
              </h3>
              <p className="text-center text-sm text-muted-foreground mt-2">
                üéØ Fun√ß√£o Principal: Admin gerencia congrega√ß√µes ‚Üí Instrutores acessam apostilas
              </p>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* Estat√≠sticas de Congrega√ß√µes */}
            <Card>
              <CardHeader>
                  <CardTitle>Estat√≠sticas</CardTitle>
                  <CardDescription>Resumo das congrega√ß√µes</CardDescription>
              </CardHeader>
              <CardContent>
                  <div className="space-y-4">
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Total de Congrega√ß√µes:</span>
                      <Badge variant="outline">{staticStats.total_congregations}</Badge>
                  </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Congrega√ß√µes Ativas:</span>
                      <Badge variant="outline" className="bg-green-50 text-green-700">
                        {staticStats.active_congregations}
                      </Badge>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Total de Estudantes:</span>
                      <Badge variant="outline">{staticStats.total_estudantes}</Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Lista de Congrega√ß√µes */}
              <Card className="lg:col-span-2">
                <CardHeader>
                  <CardTitle>Congrega√ß√µes Registradas</CardTitle>
                  <CardDescription>Lista das congrega√ß√µes no sistema</CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-center justify-between p-3 border rounded-lg">
                      <div className="flex items-center space-x-3">
                        <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                          <Package className="h-5 w-5 text-blue-600" />
                        </div>
                        <div>
                          <p className="font-medium">Sistema Ministerial Global</p>
                          <p className="text-sm text-muted-foreground">Congrega√ß√£o Principal</p>
                          </div>
                        </div>
                      <Badge variant="outline" className="bg-green-50 text-green-700">
                        Ativa
                        </Badge>
                      </div>
                  </div>
                  
                  <div className="mt-4">
                    <Button variant="outline" className="w-full" onClick={() => handleManageCongregation('Sistema Ministerial Global')}>
                      <Users className="h-4 w-4 mr-2" />
                      Gerenciar
                    </Button>
                  </div>
                  
                  <div className="mt-4">
                    <Button variant="outline" className="w-full" onClick={handleAddCongregation}>
                      <Users className="h-4 w-4 mr-2" />
                      Adicionar Nova Congrega√ß√£o
                    </Button>
                  </div>
                  
                  <div className="mt-4">
                    <Button variant="outline" className="w-full">
                      <Users className="h-4 w-4 mr-2" />
                      Expandir
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* Sistema */}
          <TabsContent value="system" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                ‚öôÔ∏è Monitoramento e Configura√ß√µes do Sistema
              </h3>
              <p className="text-center text-sm text-muted-foreground mt-2">
                üéØ Fun√ß√£o Principal: Admin monitora sistema ‚Üí Instrutores recebem apostilas est√°veis
              </p>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* Downloads JW.org */}
              <Card className="bg-green-50 border-green-200">
              <CardHeader>
                  <CardTitle className="text-green-800">üìö JW.org Downloads</CardTitle>
                  <CardDescription className="text-green-700">
                    Gerenciar materiais oficiais
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Apostila MWB Atual:</span>
                    <Badge variant="outline" className="text-green-600">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Dispon√≠vel
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">√öltima verifica√ß√£o:</span>
                    <span className="text-sm text-green-700">Hoje, 10:30</span>
                  </div>
                  <div className="flex space-x-2">
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleSyncCongregations}>
                      <RefreshCw className="h-3 w-3 mr-1" />
                      Sincronizar com Congrega√ß√µes
                    </Button>
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleViewFullProgram}>
                      <Settings className="h-3 w-3 mr-1" />
                      Ver Programa√ß√£o Completa
                    </Button>
                </div>
              </CardContent>
            </Card>

              {/* Configura√ß√µes Gerais */}
            <Card>
              <CardHeader>
                  <CardTitle>Configura√ß√µes Gerais</CardTitle>
                <CardDescription>
                    Par√¢metros do sistema
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-4">
                    <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Backup Autom√°tico:</span>
                    <Badge variant="outline" className="bg-green-50 text-green-700">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Di√°rio √†s 02:00
                      </Badge>
                    </div>
                    <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Notifica√ß√µes:</span>
                    <Badge variant="outline" className="bg-blue-50 text-blue-700">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Email + Sistema
                    </Badge>
                    </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Manuten√ß√£o:</span>
                    <span className="text-sm text-muted-foreground">√öltima: Ontem</span>
                  </div>
                  <div className="flex space-x-2">
                    <Button size="sm" variant="outline">
                      <Settings className="h-3 w-3 mr-1" />
                      Configurar
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* M√©tricas do Sistema */}
            <Card>
              <CardHeader>
                <CardTitle>M√©tricas do Sistema</CardTitle>
                <CardDescription>
                  Monitoramento em tempo real
                </CardDescription>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-green-600">99.9%</p>
                    <p className="text-sm text-muted-foreground">Uptime</p>
                  </div>
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-blue-600">~120ms</p>
                    <p className="text-sm text-muted-foreground">Lat√™ncia</p>
                  </div>
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-green-600">25%</p>
                    <p className="text-sm text-muted-foreground">CPU</p>
                  </div>
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-blue-600">33%</p>
                    <p className="text-sm text-muted-foreground">Mem√≥ria</p>
                  </div>
                </div>

                <Separator />

                <div className="space-y-3">
                    <div className="flex items-center justify-between">
                    <span className="text-sm">CPU:</span>
                    <div className="flex items-center space-x-2">
                      <div className="w-24 h-2 bg-gray-200 rounded-full">
                        <div className="w-1/4 h-2 bg-green-500 rounded-full"></div>
                    </div>
                        <span className="text-sm">25%</span>
                  </div>
                    </div>
                    
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Mem√≥ria:</span>
                      <div className="flex items-center space-x-2">
                        <div className="w-24 h-2 bg-gray-200 rounded-full">
                          <div className="w-1/3 h-2 bg-blue-500 rounded-full"></div>
                    </div>
                        <span className="text-sm">33%</span>
                      </div>
                    </div>
                    
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Banco:</span>
                      <div className="flex items-center space-x-2">
                        <CheckCircle className="h-4 w-4 text-green-500" />
                        <span className="text-sm">Conectado</span>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>

              {/* Logs e Atividades */}
              <Card>
                <CardHeader>
                  <CardTitle>Logs Recentes</CardTitle>
                  <CardDescription>
                    √öltimas atividades do sistema
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <CheckCircle className="h-4 w-4 text-green-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Sistema iniciado</p>
                        <p className="text-xs text-muted-foreground">Hoje, 08:00</p>
                      </div>
                    </div>

                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <Activity className="h-4 w-4 text-blue-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Backup autom√°tico executado</p>
                        <p className="text-xs text-muted-foreground">Hoje, 02:00</p>
                      </div>
                    </div>

                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <Users className="h-4 w-4 text-green-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Novo usu√°rio registrado</p>
                        <p className="text-xs text-muted-foreground">Ontem, 16:30</p>
                      </div>
                    </div>

                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <AlertCircle className="h-4 w-4 text-yellow-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Manuten√ß√£o programada</p>
                        <p className="text-xs text-muted-foreground">Ontem, 03:00</p>
                      </div>
                    </div>
                  </div>

                  <div className="mt-4">
                    <Button variant="outline" className="w-full" onClick={handleViewAllLogs}>
                      <FileText className="h-4 w-4 mr-2" />
                      Ver Todos os Logs
                    </Button>
                  </div>
                </CardContent>
              </Card>
          </TabsContent>
        </Tabs>
      </div>
    </div>
  );
}

```

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo, lazy, Suspense } from 'react';
import { useAuth } from '../contexts/AuthContext';
import { supabase } from '../integrations/supabase/client';
import { useJWorgIntegration } from '../hooks/useJWorgIntegration';
import { JWorgTest } from '../components/JWorgTest';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../components/ui/card';
import LazyLoader from '../components/LazyLoader';
import AuthErrorHandler from '../components/AuthErrorHandler';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '../components/ui/tabs';
import { Button } from '../components/ui/button';
import { Badge } from '../components/ui/badge';
import { Separator } from '../components/ui/separator';
import { 
  Download, 
  Upload, 
  Globe, 
  BarChart3, 
  Settings, 
  RefreshCw,
  CheckCircle,
  AlertCircle,
  Clock,
  FileText,
  Users,
  Package,
  Activity,
  Database
} from 'lucide-react';

// üöÄ Lazy loading para componentes pesados (comentado por enquanto)
// const JWorgTestLazy = lazy(() => import('../components/JWorgTest'));

interface SystemStats {
  total_congregations: number;
  active_congregations: number;
  total_users: number;
  total_estudantes: number;
  total_programas: number;
  last_sync: string;
}

export default function AdminDashboard() {
  const { user, profile, isAdmin } = useAuth();
  const jworg = useJWorgIntegration();
  const [activeTab, setActiveTab] = useState('overview');
  const [loading, setLoading] = useState(false);
  const [systemStats, setSystemStats] = useState<SystemStats | null>(null);
  const [lastCheck, setLastCheck] = useState<string>('');
  const [debugInfo, setDebugInfo] = useState<string>('');
  const [showJWorgTest, setShowJWorgTest] = useState(false);
  const [programs, setPrograms] = useState<any[]>([]);
  const [programsLoading, setProgramsLoading] = useState<boolean>(false);

  // üöÄ Memoiza√ß√£o de dados est√°ticos para reduzir re-renders
  const staticStats = useMemo(() => ({
    total_congregations: systemStats?.total_congregations || 0,
    active_congregations: systemStats?.active_congregations || 0,
    total_users: systemStats?.total_users || 0,
    total_estudantes: systemStats?.total_estudantes || 0,
    total_programas: systemStats?.total_programas || 0,
    last_sync: systemStats?.last_sync || ''
  }), [systemStats]);

  // üöÄ Debounced function para reduzir chamadas desnecess√°rias
  const debouncedSetDebugInfo = useCallback((info: string) => {
    let timeoutId: NodeJS.Timeout;
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => setDebugInfo(info), 100);
  }, []);

  // DEBUG: Log component state (otimizado)
  useEffect(() => {
    const debugData = {
      user: !!user,
      userId: user?.id,
      userEmail: user?.email,
      profile: !!profile,
      profileRole: profile?.role,
      isAdmin,
      loading,
      userMetadata: user?.user_metadata
    };

    console.log('üîç AdminDashboard Component Debug:', debugData);
    debouncedSetDebugInfo(JSON.stringify(debugData, null, 2));
  }, [user, profile, isAdmin, loading, debouncedSetDebugInfo]);

  useEffect(() => {
    console.log('üîÑ AdminDashboard useEffect triggered:', { user, isAdmin });
    
    if (user && isAdmin) {
      console.log('‚úÖ Admin user detected, loading system data...');
      loadSystemData();
    } else if (user && !isAdmin) {
      console.log('‚ùå User is not admin, role:', profile?.role);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå User is not admin, role: ' + profile?.role);
    } else if (!user) {
      console.log('‚ùå No user found');
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå No user found');
    }
  }, [user, isAdmin, debouncedSetDebugInfo]);

  const loadSystemData = useCallback(async () => {
    if (!user || !isAdmin) {
      console.log('üö´ loadSystemData: User not admin or not logged in');
      return;
    }
    
    console.log('üîÑ Loading system data for admin...');
    setLoading(true);
    try {
      // Testar conex√£o com Supabase
      console.log('üîç Testing Supabase connection...');
      const { count: profilesCount, error: testError } = await supabase
        .from('profiles')
        .select('*', { count: 'exact', head: true });
      
      if (testError) {
        console.error('‚ùå Supabase connection test failed:', testError);
        debouncedSetDebugInfo(debugInfo + '\n\n‚ùå Supabase Test Failed: ' + testError.message);
        return;
      }

        console.log('‚úÖ Supabase connection test successful');
      debouncedSetDebugInfo(debugInfo + '\n\n‚úÖ Supabase Test: Connected');

      // Carregar estat√≠sticas do sistema
      await loadSystemStats();
      // Carregar programa√ß√µes publicadas
      await loadPrograms();

    } catch (error) {
      console.error('‚ùå Supabase test exception:', error);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå Supabase Test Exception: ' + error);
    } finally {
      setLoading(false);
    }
  }, [user, isAdmin, debouncedSetDebugInfo, debugInfo]);

  const loadSystemStats = useCallback(async () => {
    try {
      console.log('üìä Loading system statistics...');

      const [profilesRes, estudantesRes, programasRes] = await Promise.all([
        supabase.from('profiles').select('*', { count: 'exact', head: true }),
        supabase.from('estudantes').select('*', { count: 'exact', head: true }),
        supabase.from('programas').select('*', { count: 'exact', head: true }),
      ]);

      // congregacoes (removido: tabela pode n√£o existir neste projeto)
      const congregacoesCount = 0;

      const stats: SystemStats = {
        total_congregations: congregacoesCount,
        active_congregations: congregacoesCount,
        total_users: (profilesRes.count as number) || 0,
        total_estudantes: (estudantesRes.count as number) || 0,
        total_programas: (programasRes.count as number) || 0,
        last_sync: new Date().toISOString(),
      };

      setSystemStats(stats);
      setLastCheck(new Date().toISOString());

      console.log('‚úÖ System stats loaded:', stats);
      debouncedSetDebugInfo(debugInfo + '\n\n‚úÖ System Stats Loaded: ' + JSON.stringify(stats, null, 2));

    } catch (error) {
      console.error('‚ùå Error loading system stats:', error);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå System Stats Error: ' + error);
    }
  }, [debouncedSetDebugInfo, debugInfo, supabase]);

  const loadPrograms = useCallback(async () => {
    try {
      setProgramsLoading(true);
      const { data, error } = await supabase
        .from('programas')
        .select('id, semana, mes_apostila, status, data_inicio_semana, arquivo')
        .order('data_inicio_semana', { ascending: false })
        .limit(12);
      if (error) throw error;
      setPrograms(data || []);
      console.log('‚úÖ Programs loaded:', data?.length || 0);
    } catch (error: any) {
      console.error('‚ùå Error loading programs:', error);
      debouncedSetDebugInfo(debugInfo + '\n\n‚ùå Programs Load Error: ' + (error?.message || error));
    } finally {
      setProgramsLoading(false);
    }
  }, [debouncedSetDebugInfo, debugInfo]);

  const checkForUpdates = useCallback(async () => {
    console.log('üîÑ Checking for updates...');
    setLoading(true);
    
    try {
      await loadSystemStats();
      await loadPrograms();
      console.log('‚úÖ Updates checked successfully');
    } catch (error) {
      console.error('‚ùå Error checking updates:', error);
    } finally {
      setLoading(false);
    }
  }, [loadSystemStats]);

  const testSupabaseConnection = useCallback(async () => {
    console.log('üîß Testing Supabase connection...');
    
    try {
      const { count, error } = await supabase
        .from('profiles')
        .select('*', { count: 'exact', head: true });

      if (error) {
        console.error('‚ùå Supabase test error:', error);
        alert('Supabase test error: ' + error.message);
      } else {
        console.log('‚úÖ Supabase test successful. Profiles count:', count);
        alert('Supabase test successful! Total profiles: ' + (count ?? 0));
      }
    } catch (error) {
      console.error('‚ùå Supabase test exception:', error);
      alert('Supabase test exception: ' + error);
    }
  }, []);

  // ========== HANDLERS DOS BOT√ïES ==========
  
  const handleListUsers = useCallback(async () => {
    console.log('üë• Listando usu√°rios...');
    try {
      const { data: users, error } = await supabase
        .from('profiles')
        .select('id, nome_completo, role, congregacao, cargo')
        .order('nome_completo');
      
      if (error) throw error;
      
      console.log('‚úÖ Usu√°rios carregados:', users);
      alert(`Encontrados ${users?.length || 0} usu√°rios no sistema:\n\n${users?.map(u => `${u.nome_completo || u.id} - ${u.role} (${u.congregacao || 'N/A'})`).join('\n')}`);
    } catch (error) {
      console.error('‚ùå Erro ao listar usu√°rios:', error);
      alert('Erro ao carregar usu√°rios: ' + error.message);
    }
  }, []);

  const handleManagePermissions = useCallback(async () => {
    console.log('‚öôÔ∏è Gerenciando permiss√µes...');
    const newRole = prompt('Digite o novo role (admin, instrutor, estudante):');
    if (!newRole) return;
    
    // Validar role
    const validRoles = ['admin', 'instrutor', 'estudante', 'family_member', 'developer'];
    if (!validRoles.includes(newRole)) {
      alert('Role inv√°lido. Use: admin, instrutor, estudante, family_member ou developer');
      return;
    }
    
    const userId = prompt('Digite o ID do usu√°rio:');
    if (!userId) return;
    
    try {
      const { error } = await supabase
        .from('profiles')
        .update({ role: newRole as any })
        .eq('id', userId);
      
      if (error) throw error;
      
      console.log('‚úÖ Permiss√£o atualizada');
      alert('Permiss√£o atualizada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao atualizar permiss√£o:', error);
      alert('Erro ao atualizar permiss√£o: ' + error.message);
    }
  }, []);

  const handleActivityReport = useCallback(async () => {
    console.log('üìä Gerando relat√≥rio de atividades...');
    try {
      // Simula√ß√£o de relat√≥rio
      const report = {
        totalUsers: staticStats.total_users,
        totalCongregations: staticStats.total_congregations,
        lastUpdate: new Date().toLocaleString('pt-BR'),
        activeUsers: Math.floor(staticStats.total_users * 0.8)
      };
      
      alert(`üìä Relat√≥rio de Atividades:\n\n` +
            `‚Ä¢ Total de usu√°rios: ${report.totalUsers}\n` +
            `‚Ä¢ Usu√°rios ativos: ${report.activeUsers}\n` +
            `‚Ä¢ Total de congrega√ß√µes: ${report.totalCongregations}\n` +
            `‚Ä¢ √öltima atualiza√ß√£o: ${report.lastUpdate}`);
    } catch (error) {
      console.error('‚ùå Erro ao gerar relat√≥rio:', error);
      alert('Erro ao gerar relat√≥rio: ' + error.message);
    }
  }, [staticStats]);

  const handleBackupData = useCallback(async () => {
    console.log('üíæ Fazendo backup dos dados...');
    try {
      const { data: profiles, error: profilesError } = await supabase
        .from('profiles')
        .select('*');
      
      if (profilesError) throw profilesError;
      
      // Simular backup
      const backupData = {
        timestamp: new Date().toISOString(),
        profiles: profiles,
        stats: staticStats
      };
      
      const dataStr = JSON.stringify(backupData, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      
      const link = document.createElement('a');
      link.href = url;
      link.download = `backup_sistema_ministerial_${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      
      URL.revokeObjectURL(url);
      console.log('‚úÖ Backup criado com sucesso');
      alert('Backup criado e baixado com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao fazer backup:', error);
      alert('Erro ao fazer backup: ' + error.message);
    }
  }, [staticStats]);

  // Congrega√ß√µes
  const handleManageCongregation = useCallback((congregationName: string) => {
    console.log('üè¢ Gerenciando congrega√ß√£o:', congregationName);
    alert(`üè¢ Gerenciando congrega√ß√£o: ${congregationName}\n\nEsta funcionalidade abrir√° o painel de gerenciamento da congrega√ß√£o.`);
  }, []);

  const handleAddCongregation = useCallback(async () => {
    console.log('‚ûï Adicionando nova congrega√ß√£o...');
    const congregationName = prompt('Digite o nome da nova congrega√ß√£o:');
    if (!congregationName) return;
    
    try {
      // Simula√ß√£o - em produ√ß√£o seria inser√ß√£o no Supabase
      console.log('‚úÖ Congrega√ß√£o adicionada:', congregationName);
      alert(`‚úÖ Congrega√ß√£o "${congregationName}" adicionada com sucesso!\n\nEla agora receber√° automaticamente a programa√ß√£o oficial.`);
    } catch (error) {
      console.error('‚ùå Erro ao adicionar congrega√ß√£o:', error);
      alert('Erro ao adicionar congrega√ß√£o: ' + error.message);
    }
  }, []);

  // JW.org & S-38
  const handleMWBAvailable = useCallback(async () => {
    console.log('üìö Disponibilizando MWB atual...');
    try {
      await jworg.fetchCurrentWeek();
      console.log('‚úÖ MWB atualizada');
      alert('‚úÖ Apostila MWB atual disponibilizada para todas as congrega√ß√µes!');
    } catch (error) {
      console.error('‚ùå Erro ao disponibilizar MWB:', error);
      alert('Erro ao disponibilizar MWB: ' + error.message);
    }
  }, [jworg]);

  const handleConfigureJWorgURLs = useCallback(() => {
    console.log('‚öôÔ∏è Configurando URLs JW.org...');
    const ptUrl = prompt('URL JW.org PT:', 'https://www.jw.org/pt/biblioteca/jw-apostila-do-mes/');
    const enUrl = prompt('URL JW.org EN:', 'https://www.jw.org/en/library/jw-meeting-workbook/');
    
    if (ptUrl && enUrl) {
      console.log('‚úÖ URLs configuradas:', { ptUrl, enUrl });
      alert('‚úÖ URLs JW.org configuradas com sucesso!');
    }
  }, []);

  const handleSyncCongregations = useCallback(async () => {
    console.log('üîÑ Sincronizando com congrega√ß√µes...');
    try {
      // Simula√ß√£o de sincroniza√ß√£o
      const congregationsCount = staticStats.total_congregations;
      console.log(`‚úÖ Sincronizando com ${congregationsCount} congrega√ß√µes`);
      alert(`üîÑ Sincroniza√ß√£o iniciada!\n\nPrograma√ß√£o oficial sendo enviada para ${congregationsCount} congrega√ß√µes...\n\nTempo estimado: ${Math.ceil(congregationsCount / 100)} minutos`);
    } catch (error) {
      console.error('‚ùå Erro na sincroniza√ß√£o:', error);
      alert('Erro na sincroniza√ß√£o: ' + error.message);
    }
  }, [staticStats]);

  // Programa√ß√£o Oficial
  const handleViewFullProgram = useCallback(() => {
    console.log('üìÖ Visualizando programa√ß√£o completa (3 meses)...');
    alert(`üìÖ Programa√ß√£o Completa dos Pr√≥ximos 3 Meses\n\n` +
          `‚Ä¢ Semanas carregadas: 12\n` +
          `‚Ä¢ Idiomas: PT e EN\n` +
          `‚Ä¢ √öltima atualiza√ß√£o: Hoje\n\n` +
          `Esta visualiza√ß√£o mostrar√° todas as apostilas MWB dos pr√≥ximos 3 meses.`);
  }, []);

  const handleUpdateProgramPT = useCallback(async () => {
    console.log('üáßüá∑ Atualizando programa√ß√£o PT...');
    try {
      jworg.setLanguage('pt');
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Programa√ß√£o PT atualizada');
      alert('‚úÖ Programa√ß√£o em Portugu√™s atualizada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao atualizar programa√ß√£o PT:', error);
      alert('Erro ao atualizar programa√ß√£o PT: ' + error.message);
    }
  }, [jworg]);

  const handleUpdateProgramEN = useCallback(async () => {
    console.log('üá∫üá∏ Atualizando programa√ß√£o EN...');
    try {
      jworg.setLanguage('en');
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Programa√ß√£o EN atualizada');
      alert('‚úÖ Programa√ß√£o em Ingl√™s atualizada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao atualizar programa√ß√£o EN:', error);
      alert('Erro ao atualizar programa√ß√£o EN: ' + error.message);
    }
  }, [jworg]);

  const handleCheckNewWeeks = useCallback(async () => {
    console.log('üîç Verificando novas semanas...');
    try {
      await jworg.fetchNextWeeks();
      const newWeeks = jworg.nextWeeks.length;
      console.log(`‚úÖ Verifica√ß√£o conclu√≠da: ${newWeeks} semanas`);
      alert(`üîç Verifica√ß√£o conclu√≠da!\n\nEncontradas ${newWeeks} semanas de programa√ß√£o.\n\nTodas est√£o sincronizadas com JW.org.`);
    } catch (error) {
      console.error('‚ùå Erro ao verificar semanas:', error);
      alert('Erro ao verificar novas semanas: ' + error.message);
    }
  }, [jworg]);

  const handleUpdateS38Structure = useCallback(() => {
    console.log('üèóÔ∏è Atualizando estrutura S-38 global...');
    alert(`üèóÔ∏è Estrutura S-38 Global\n\n` +
          `‚úÖ Partes da reuni√£o atualizadas:\n` +
          `‚Ä¢ Chairman\n‚Ä¢ Treasures\n‚Ä¢ Gems\n‚Ä¢ Reading\n` +
          `‚Ä¢ Starting\n‚Ä¢ Following\n‚Ä¢ Making\n‚Ä¢ Explaining\n` +
          `‚Ä¢ Talk\n\n` +
          `Esta estrutura ser√° aplicada mundialmente.`);
  }, []);

  // JW.org Integration
  const handleReloadCurrentWeek = useCallback(async () => {
    console.log('üîÑ Recarregando semana atual...');
    try {
      await jworg.fetchCurrentWeek();
      console.log('‚úÖ Semana atual recarregada');
      alert('‚úÖ Semana atual recarregada com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao recarregar semana:', error);
      alert('Erro ao recarregar semana: ' + error.message);
    }
  }, [jworg]);

  const handleReloadNextWeeks = useCallback(async () => {
    console.log('üìÖ Recarregando pr√≥ximas semanas...');
    try {
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Pr√≥ximas semanas recarregadas');
      alert('‚úÖ Pr√≥ximas semanas recarregadas com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro ao recarregar pr√≥ximas semanas:', error);
      alert('Erro ao recarregar pr√≥ximas semanas: ' + error.message);
    }
  }, [jworg]);

  const handleTestDownloadPT = useCallback(async () => {
    console.log('üß™ Testando download PT...');
    try {
      jworg.setLanguage('pt');
      await jworg.downloadWorkbook('pt', '07', '2025');
      console.log('‚úÖ Download PT testado');
      alert('‚úÖ Download PT testado com sucesso!');
    } catch (error) {
      console.error('‚ùå Erro no teste de download PT:', error);
      alert('Erro no teste de download PT: ' + error.message);
    }
  }, [jworg]);

  // Monitoramento
  const handleViewAllLogs = useCallback(async () => {
    console.log('üìã Visualizando todos os logs...');
    try {
      // Simula√ß√£o de logs
      const logs = [
        { timestamp: new Date().toLocaleString(), event: 'Sistema iniciado', level: 'info' },
        { timestamp: new Date(Date.now() - 3600000).toLocaleString(), event: 'Backup autom√°tico executado', level: 'info' },
        { timestamp: new Date(Date.now() - 86400000).toLocaleString(), event: 'Novo usu√°rio registrado', level: 'info' },
        { timestamp: new Date(Date.now() - 172800000).toLocaleString(), event: 'Manuten√ß√£o programada', level: 'warning' }
      ];
      
      const logText = logs.map(log => `${log.timestamp} [${log.level.toUpperCase()}] ${log.event}`).join('\n');
      alert(`üìã Logs do Sistema\n\n${logText}`);
    } catch (error) {
      console.error('‚ùå Erro ao carregar logs:', error);
      alert('Erro ao carregar logs: ' + error.message);
    }
  }, []);

  const handleTestJWorgIntegration = useCallback(async () => {
    console.log('üß™ Testando integra√ß√£o JW.org...');
    try {
      await jworg.fetchCurrentWeek();
      console.log('‚úÖ Integra√ß√£o JW.org testada com sucesso');
      alert('‚úÖ Integra√ß√£o JW.org funcionando perfeitamente!');
    } catch (error) {
      console.error('‚ùå Erro na integra√ß√£o JW.org:', error);
      alert('‚ùå Erro na integra√ß√£o JW.org: ' + error.message);
    }
  }, [jworg]);

  const handleChangeLanguage = useCallback((newLang: 'pt' | 'en') => {
    jworg.setLanguage(newLang);
    console.log(`üåê Idioma alterado para: ${newLang}`);
    alert(`üåê Idioma alterado para: ${newLang === 'pt' ? 'Portugu√™s' : 'English'}`);
  }, [jworg]);

  // Alterna o idioma atual entre PT/EN
  const toggleLanguage = useCallback(() => {
    const current = (jworg as any)?.currentLanguage ?? 'pt';
    const next = current === 'pt' ? 'en' : 'pt';
    jworg.setLanguage(next);
    console.log(`üåê Idioma alternado: ${current} -> ${next}`);
    alert(`üåê Idioma alternado para: ${next === 'pt' ? 'Portugu√™s' : 'English'}`);
  }, [jworg]);

  // Atualiza materiais JW.org (semana atual + pr√≥ximas semanas)
  const updateMaterials = useCallback(async () => {
    try {
      await jworg.fetchCurrentWeek();
      await jworg.fetchNextWeeks();
      console.log('‚úÖ Materiais JW.org atualizados');
      alert('‚úÖ Materiais JW.org atualizados com sucesso!');
    } catch (error: any) {
      console.error('‚ùå Erro ao atualizar materiais:', error);
      alert('‚ùå Erro ao atualizar materiais: ' + (error?.message || error));
    }
  }, [jworg]);

  // Sincronizar materiais da pasta docs/Oficial -> tabela public.programas
  const syncMaterialsToPrograms = useCallback(async () => {
    try {
      setLoading(true);

      // Obter token do usu√°rio atual para autenticar no backend
      const { data: sessionData } = await supabase.auth.getSession();
      const accessToken = sessionData.session?.access_token;
      if (!accessToken) {
        alert('Sess√£o inv√°lida. Fa√ßa login novamente.');
        return;
      }

      // Buscar lista de materiais no backend (requer Authorization)
      const res = await fetch('http://localhost:3001/api/materials', {
        headers: { Authorization: `Bearer ${accessToken}` },
      });
      if (!res.ok) {
        alert('Falha ao listar materiais no backend.');
        return;
      }
      const payload = await res.json();
      const materials: Array<{ filename: string }> = payload.materials || [];

      // Filtrar arquivos relevantes e preparar upserts
      const rows: any[] = materials
        .map((m) => m.filename)
        .filter((name) => /^(mwb_|S-38_|mwb_T_)/i.test(name))
        .map((arquivo) => {
          // Extrair ano/m√™s do padr√£o mwb_E_YYYYMM.pdf
          let ano = '';
          let mes = '';
          const match = arquivo.match(/mwb_[A-Z]_([0-9]{6})/i);
          if (match) {
            ano = match[1].slice(0, 4);
            mes = match[1].slice(4, 6);
          }
          const mes_apostila = ano && mes ? `${ano}-${mes}` : null;
          const data_inicio_semana = mes_apostila ? `${ano}-${mes}-01` : null;
          return {
            semana: null,
            mes_apostila,
            status: 'ativo',
            data_inicio_semana,
            arquivo,
          };
        });

      // Inserir somente os que ainda n√£o existem por arquivo
      for (const row of rows) {
        const { data: exists, error: selErr } = await supabase
          .from('programas')
          .select('id')
          .eq('arquivo', row.arquivo)
          .maybeSingle();
        if (selErr) {
          console.warn('Select error (ignorado):', selErr.message);
        }
        if (!exists) {
          const { error: insErr } = await supabase.from('programas').insert(row as any);
          if (insErr) {
            console.warn('Insert error para', row.arquivo, insErr.message);
          }
        }
      }

      await loadPrograms();
      alert('Sincroniza√ß√£o conclu√≠da.');
    } catch (error: any) {
      console.error('‚ùå Erro ao sincronizar materiais:', error);
      alert('Erro ao sincronizar materiais: ' + (error?.message || error));
    } finally {
      setLoading(false);
    }
  }, [supabase, loadPrograms]);

  // NOW CHECK CONDITIONS AND RENDER APPROPRIATELY
  // Se n√£o for admin, mostrar mensagem de acesso negado
  if (user && !isAdmin) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="max-w-md mx-auto">
          <CardHeader>
            <CardTitle className="text-red-600">Acesso Negado</CardTitle>
            <CardDescription>
              Voc√™ n√£o tem permiss√£o para acessar o painel administrativo.
            </CardDescription>
          </CardHeader>
          <CardContent>
            <p className="text-sm text-muted-foreground mb-4">
              Seu perfil atual: <strong>{profile?.role}</strong>
            </p>
            <Button onClick={() => window.history.back()}>
              Voltar
            </Button>
          </CardContent>
        </Card>
      </div>
    );
  }

  // Se n√£o houver usu√°rio, mostrar loading
  if (!user) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="max-w-md mx-auto">
          <CardHeader>
            <CardTitle>Carregando...</CardTitle>
            <CardDescription>
              Verificando autentica√ß√£o...
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="flex items-center justify-center">
              <RefreshCw className="h-6 w-6 animate-spin" />
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background">
      {/* Auth Error Handler */}
      <AuthErrorHandler />
      
      {/* Header */}
      <div className="border-b">
        <div className="container mx-auto px-4 py-6">
          <div className="flex flex-col space-y-4">
          <div className="flex items-center justify-between">
            <div>
                <h1 className="text-3xl font-bold tracking-tight">üìä Dashboard do Administrador Geral</h1>
                <p className="text-muted-foreground">
                  Programa√ß√£o oficial das reuni√µes ministeriais - Padroniza√ß√£o mundial para todas as congrega√ß√µes
              </p>
            </div>
              <div className="flex items-center space-x-2">
              {/* Force Profile Load Button */}
              {import.meta.env.DEV && (
                <Button 
                  variant="outline" 
                  size="sm"
                    onClick={testSupabaseConnection}
                  >
                    üîß Test Supabase
                </Button>
              )}
              
              <Button onClick={checkForUpdates} disabled={loading}>
                <RefreshCw className={`h-4 w-4 mr-2 ${loading ? 'animate-spin' : ''}`} />
                  Atualizar
              </Button>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Debug Info Panel */}
      {import.meta.env.DEV && (
        <div className="container mx-auto px-4 py-2">
          <Card className="bg-yellow-50 border-yellow-200">
            <CardHeader className="pb-2">
              <CardTitle className="text-sm text-yellow-800">üêõ Debug Info (Development Only)</CardTitle>
            </CardHeader>
            <CardContent>
              <pre className="text-xs text-yellow-700 overflow-auto max-h-40">
                {debugInfo}
              </pre>
            </CardContent>
          </Card>
        </div>
      )}

      {/* Main Content */}
      <div className="container mx-auto px-4 py-6">
        <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
          <TabsList className="grid w-full grid-cols-4">
            <TabsTrigger value="overview">Vis√£o Geral</TabsTrigger>
            <TabsTrigger value="users">Usu√°rios</TabsTrigger>
            <TabsTrigger value="congregations">Congrega√ß√µes</TabsTrigger>
            <TabsTrigger value="system">Sistema</TabsTrigger>
          </TabsList>

          {/* Vis√£o Geral */}
          <TabsContent value="overview" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                üéØ Sistema Ministerial Global - Padroniza√ß√£o Mundial
              </h3>
              <div className="text-center text-sm text-muted-foreground mt-2 p-3 bg-blue-50 rounded-lg border border-blue-200">
                <strong>üìä Admin Geral:</strong> Disponibiliza programa√ß√£o oficial semanal (SEM nomes de estudantes) <br/>
                <strong>üéì Instrutores:</strong> Recebem programa√ß√£o automaticamente + fazem designa√ß√µes locais reais
              </div>
            </div>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Congrega√ß√µes Conectadas</CardTitle>
                  <Globe className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">{staticStats.total_congregations}</div>
                  <p className="text-xs text-muted-foreground">
                    Recebendo programa√ß√£o oficial
                  </p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Semanas Programadas</CardTitle>
                  <BarChart3 className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">12</div>
                  <p className="text-xs text-muted-foreground">
                    Pr√≥ximas 3 meses
                  </p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Idiomas Dispon√≠veis</CardTitle>
                  <Globe className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">2</div>
                  <p className="text-xs text-muted-foreground">
                    Portugu√™s e Ingl√™s
                  </p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">√öltima Sincroniza√ß√£o</CardTitle>
                  <RefreshCw className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">‚úÖ</div>
                  <p className="text-xs text-muted-foreground">
                    Hoje, {new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}
                  </p>
                </CardContent>
              </Card>
            </div>

            {/* A√ß√µes R√°pidas */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* Status do Sistema */}
              <Card>
                <CardHeader>
                  <CardTitle>Status do Sistema</CardTitle>
                  <CardDescription>
                    Informa√ß√µes sobre a √∫ltima verifica√ß√£o e status geral
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">√öltima Verifica√ß√£o:</span>
                    <span className="text-sm text-muted-foreground">
                      {lastCheck ? new Date(lastCheck).toLocaleString('pt-BR') : 'Nunca'}
                    </span>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Status:</span>
                    <Badge variant="outline" className="text-green-600">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Operacional
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Supabase:</span>
                    <Badge variant="outline" className="text-green-600">
                      <Database className="h-3 w-3 mr-1" />
                      Conectado
                    </Badge>
                  </div>
                </CardContent>
              </Card>

              {/* Programa√ß√µes Publicadas */}
              <Card>
                <CardHeader>
                  <CardTitle>Programa√ß√µes Publicadas</CardTitle>
                  <CardDescription>
                    √öltimas semanas importadas/publicadas
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  {programsLoading ? (
                    <div className="text-sm text-muted-foreground">Carregando...</div>
                  ) : programs.length === 0 ? (
                    <div className="text-sm text-muted-foreground">Nenhuma programa√ß√£o encontrada.</div>
                  ) : (
                    <div className="space-y-2">
                      {programs.map((p) => (
                        <div key={p.id} className="p-2 border rounded-md">
                          <div className="flex items-center justify-between">
                            <div className="text-sm">
                              <div className="font-medium">Semana {p.semana || '‚Äî'} ‚Ä¢ {p.mes_apostila || '‚Äî'}</div>
                              <div className="text-xs text-muted-foreground">
                                {p.data_inicio_semana ? new Date(p.data_inicio_semana).toLocaleDateString('pt-BR') : '‚Äî'}
                              </div>
                            </div>
                            <Badge variant="outline" className={p.status === 'ativo' || p.status === 'publicado' ? 'bg-green-50 text-green-700' : ''}>
                              {p.status || '‚Äî'}
                            </Badge>
                          </div>
                          {p.arquivo && (
                            <div className="mt-2">
                              <a
                                href={`http://localhost:3001/materials/${encodeURIComponent(p.arquivo)}`}
                                target="_blank"
                                rel="noopener noreferrer"
                                className="text-blue-600 text-xs underline"
                              >
                                Abrir material ({p.arquivo})
                              </a>
                            </div>
                          )}
                        </div>
                      ))}
                    </div>
                  )}
                </CardContent>
              </Card>

              {/* JW.org Downloads */}
              <Card className="bg-green-50 border-green-200">
                <CardHeader>
                  <CardTitle className="text-green-800">üìö JW.org Downloads</CardTitle>
                  <CardDescription className="text-green-700">
                    Gerenciar materiais oficiais
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Apostila MWB Atual:</span>
                    <Badge variant="outline" className="text-green-600">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Dispon√≠vel
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">√öltima verifica√ß√£o:</span>
                    <span className="text-sm text-green-700">Hoje, 10:30</span>
                  </div>
                  <div className="flex space-x-2">
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleMWBAvailable}>
                      <RefreshCw className="h-3 w-3 mr-1" />
                      Disponibilizar MWB Atual
                    </Button>
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleConfigureJWorgURLs}>
                      <Settings className="h-3 w-3 mr-1" />
                      Configurar URLs JW.org
                    </Button>
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={syncMaterialsToPrograms} disabled={loading}>
                      <RefreshCw className={`h-3 w-3 mr-1 ${loading ? 'animate-spin' : ''}`} />
                      Sincronizar materiais ‚Üí programas
                    </Button>
                  </div>
                </CardContent>
              </Card>

              {/* Sistema S-38 - Designa√ß√µes */}
              <Card className="bg-purple-50 border-purple-200">
                <CardHeader>
                  <CardTitle className="text-purple-800">‚öôÔ∏è Sistema S-38</CardTitle>
                  <CardDescription className="text-purple-700">
                    Estrutura das reuni√µes ministeriais
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="text-sm text-purple-700 space-y-2">
                    <p>üìö <strong>Fun√ß√£o do Admin:</strong> Disponibilizar apostilas MWB</p>
                    <p>üë• <strong>Para Instrutores:</strong> Designar estudantes para partes</p>
                    <p>üéØ <strong>Partes da Reuni√£o:</strong></p>
                    <div className="grid grid-cols-2 gap-1 text-xs ml-2">
                      <div>‚Ä¢ Chairman</div>
                      <div>‚Ä¢ Treasures</div>
                      <div>‚Ä¢ Gems</div>
                      <div>‚Ä¢ Reading</div>
                      <div>‚Ä¢ Starting</div>
                      <div>‚Ä¢ Following</div>
                      <div>‚Ä¢ Making</div>
                      <div>‚Ä¢ Explaining</div>
                      <div>‚Ä¢ Talk</div>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Debug / Integra√ß√£o */}
              <Card className="bg-slate-50 border-slate-200">
                <CardHeader>
                  <CardTitle className="text-slate-800">üß™ Debug / Integra√ß√£o</CardTitle>
                  <CardDescription className="text-slate-700">
                    Ferramentas r√°pidas para validar integra√ß√µes e idioma
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-3">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Idioma Atual:</span>
                    <Badge variant="outline" className="text-slate-700">
                      {(jworg as any)?.currentLanguage === 'en' ? 'üá∫üá∏ English' : 'üáßüá∑ Portugu√™s'}
                    </Badge>
                  </div>
                  <div className="flex flex-wrap gap-2">
                    <Button size="sm" variant="outline" onClick={toggleLanguage}>
                      Alternar Idioma
                    </Button>
                    <Button size="sm" variant="outline" onClick={updateMaterials}>
                      Atualizar Materiais
                    </Button>
                    <Button size="sm" variant="outline" onClick={handleTestJWorgIntegration}>
                      Testar Integra√ß√£o JW.org
                    </Button>
                    <Button size="sm" variant="outline" onClick={checkForUpdates} disabled={loading}>
                      Atualizar Contagens
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* Usu√°rios */}
          <TabsContent value="users" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                üë• Gest√£o de Usu√°rios para Acesso √†s Apostilas MWB
              </h3>
              <p className="text-center text-sm text-muted-foreground mt-2">
                üéØ Fun√ß√£o Principal: Admin gerencia usu√°rios ‚Üí Instrutores acessam apostilas
              </p>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* Estat√≠sticas de Usu√°rios */}
            <Card>
              <CardHeader>
                  <CardTitle>Estat√≠sticas</CardTitle>
                  <CardDescription>Resumo dos usu√°rios</CardDescription>
              </CardHeader>
                <CardContent>
                  <div className="space-y-4">
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Total de Usu√°rios:</span>
                      <Badge variant="outline">{staticStats.total_users}</Badge>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Admins:</span>
                      <Badge variant="outline" className="bg-red-50 text-red-700">
                        {isAdmin ? 1 : 0}
                      </Badge>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Instrutores:</span>
                      <Badge variant="outline" className="bg-blue-50 text-blue-700">
                        {staticStats.total_users - (isAdmin ? 1 : 0)}
                      </Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Usu√°rios Registrados */}
              <Card className="lg:col-span-2">
                <CardHeader>
                  <CardTitle>Usu√°rios Registrados</CardTitle>
                  <CardDescription>√öltimos usu√°rios cadastrados no sistema</CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-center justify-between p-3 border rounded-lg">
                      <div className="flex items-center space-x-3">
                        <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                          <Users className="h-5 w-5 text-blue-600" />
                        </div>
                        <div>
                          <p className="font-medium">{profile?.nome_completo || 'Roberto Araujo da Silva'}</p>
                          <p className="text-sm text-muted-foreground">Administrator</p>
                        </div>
                      </div>
                      <Badge variant="outline" className="bg-red-50 text-red-700">
                        Admin
                      </Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* A√ß√µes Administrativas */}
            <Card>
              <CardHeader>
                <CardTitle>A√ß√µes Administrativas</CardTitle>
                <CardDescription>
                  Gerenciar usu√°rios e permiss√µes
                </CardDescription>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <Button className="w-full justify-start" variant="outline" onClick={handleListUsers}>
                    <Users className="h-4 w-4 mr-2" />
                    Listar Todos os Usu√°rios
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleManagePermissions}>
                    <Settings className="h-4 w-4 mr-2" />
                    Gerenciar Permiss√µes
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleActivityReport}>
                    <Activity className="h-4 w-4 mr-2" />
                    Relat√≥rio de Atividades
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleBackupData}>
                    <Database className="h-4 w-4 mr-2" />
                    Backup de Dados
                  </Button>
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          {/* Congrega√ß√µes */}
          <TabsContent value="congregations" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                üè¢ Gest√£o de Congrega√ß√µes para Acesso √†s Apostilas MWB
              </h3>
              <p className="text-center text-sm text-muted-foreground mt-2">
                üéØ Fun√ß√£o Principal: Admin gerencia congrega√ß√µes ‚Üí Instrutores acessam apostilas
              </p>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* Estat√≠sticas de Congrega√ß√µes */}
            <Card>
              <CardHeader>
                  <CardTitle>Estat√≠sticas</CardTitle>
                  <CardDescription>Resumo das congrega√ß√µes</CardDescription>
              </CardHeader>
              <CardContent>
                  <div className="space-y-4">
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Total de Congrega√ß√µes:</span>
                      <Badge variant="outline">{staticStats.total_congregations}</Badge>
                  </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Congrega√ß√µes Ativas:</span>
                      <Badge variant="outline" className="bg-green-50 text-green-700">
                        {staticStats.active_congregations}
                      </Badge>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Total de Estudantes:</span>
                      <Badge variant="outline">{staticStats.total_estudantes}</Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Lista de Congrega√ß√µes */}
              <Card className="lg:col-span-2">
                <CardHeader>
                  <CardTitle>Congrega√ß√µes Registradas</CardTitle>
                  <CardDescription>Lista das congrega√ß√µes no sistema</CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-center justify-between p-3 border rounded-lg">
                      <div className="flex items-center space-x-3">
                        <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                          <Package className="h-5 w-5 text-blue-600" />
                        </div>
                        <div>
                          <p className="font-medium">Sistema Ministerial Global</p>
                          <p className="text-sm text-muted-foreground">Congrega√ß√£o Principal</p>
                          </div>
                        </div>
                      <Badge variant="outline" className="bg-green-50 text-green-700">
                        Ativa
                        </Badge>
                      </div>
                  </div>
                  
                  <div className="mt-4">
                    <Button variant="outline" className="w-full" onClick={() => handleManageCongregation('Sistema Ministerial Global')}>
                      <Users className="h-4 w-4 mr-2" />
                      Gerenciar
                    </Button>
                  </div>
                  
                  <div className="mt-4">
                    <Button variant="outline" className="w-full" onClick={handleAddCongregation}>
                      <Users className="h-4 w-4 mr-2" />
                      Adicionar Nova Congrega√ß√£o
                    </Button>
                  </div>
                  
                  <div className="mt-4">
                    <Button variant="outline" className="w-full">
                      <Users className="h-4 w-4 mr-2" />
                      Expandir
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* Sistema */}
          <TabsContent value="system" className="space-y-6">
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-center text-muted-foreground">
                ‚öôÔ∏è Monitoramento e Configura√ß√µes do Sistema
              </h3>
              <p className="text-center text-sm text-muted-foreground mt-2">
                üéØ Fun√ß√£o Principal: Admin monitora sistema ‚Üí Instrutores recebem apostilas est√°veis
              </p>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* Downloads JW.org */}
              <Card className="bg-green-50 border-green-200">
              <CardHeader>
                  <CardTitle className="text-green-800">üìö JW.org Downloads</CardTitle>
                  <CardDescription className="text-green-700">
                    Gerenciar materiais oficiais
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Apostila MWB Atual:</span>
                    <Badge variant="outline" className="text-green-600">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Dispon√≠vel
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">√öltima verifica√ß√£o:</span>
                    <span className="text-sm text-green-700">Hoje, 10:30</span>
                  </div>
                  <div className="flex space-x-2">
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleSyncCongregations}>
                      <RefreshCw className="h-3 w-3 mr-1" />
                      Sincronizar com Congrega√ß√µes
                    </Button>
                    <Button size="sm" variant="outline" className="border-green-300 text-green-700" onClick={handleViewFullProgram}>
                      <Settings className="h-3 w-3 mr-1" />
                      Ver Programa√ß√£o Completa
                    </Button>
                </div>
              </CardContent>
            </Card>

              {/* Configura√ß√µes Gerais */}
            <Card>
              <CardHeader>
                  <CardTitle>Configura√ß√µes Gerais</CardTitle>
                <CardDescription>
                    Par√¢metros do sistema
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-4">
                    <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Backup Autom√°tico:</span>
                    <Badge variant="outline" className="bg-green-50 text-green-700">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Di√°rio √†s 02:00
                      </Badge>
                    </div>
                    <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Notifica√ß√µes:</span>
                    <Badge variant="outline" className="bg-blue-50 text-blue-700">
                      <CheckCircle className="h-3 w-3 mr-1" />
                      Email + Sistema
                    </Badge>
                    </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">Manuten√ß√£o:</span>
                    <span className="text-sm text-muted-foreground">√öltima: Ontem</span>
                  </div>
                  <div className="flex space-x-2">
                    <Button size="sm" variant="outline">
                      <Settings className="h-3 w-3 mr-1" />
                      Configurar
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* M√©tricas do Sistema */}
            <Card>
              <CardHeader>
                <CardTitle>M√©tricas do Sistema</CardTitle>
                <CardDescription>
                  Monitoramento em tempo real
                </CardDescription>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-green-600">99.9%</p>
                    <p className="text-sm text-muted-foreground">Uptime</p>
                  </div>
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-blue-600">~120ms</p>
                    <p className="text-sm text-muted-foreground">Lat√™ncia</p>
                  </div>
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-green-600">25%</p>
                    <p className="text-sm text-muted-foreground">CPU</p>
                  </div>
                  <div className="p-3 border rounded-lg text-center">
                    <p className="text-2xl font-bold text-blue-600">33%</p>
                    <p className="text-sm text-muted-foreground">Mem√≥ria</p>
                  </div>
                </div>

                <Separator />

                <div className="space-y-3">
                    <div className="flex items-center justify-between">
                    <span className="text-sm">CPU:</span>
                    <div className="flex items-center space-x-2">
                      <div className="w-24 h-2 bg-gray-200 rounded-full">
                        <div className="w-1/4 h-2 bg-green-500 rounded-full"></div>
                    </div>
                        <span className="text-sm">25%</span>
                  </div>
                    </div>
                    
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Mem√≥ria:</span>
                      <div className="flex items-center space-x-2">
                        <div className="w-24 h-2 bg-gray-200 rounded-full">
                          <div className="w-1/3 h-2 bg-blue-500 rounded-full"></div>
                    </div>
                        <span className="text-sm">33%</span>
                      </div>
                    </div>
                    
                    <div className="flex items-center justify-between">
                      <span className="text-sm">Banco:</span>
                      <div className="flex items-center space-x-2">
                        <CheckCircle className="h-4 w-4 text-green-500" />
                        <span className="text-sm">Conectado</span>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>

              {/* Logs e Atividades */}
              <Card>
                <CardHeader>
                  <CardTitle>Logs Recentes</CardTitle>
                  <CardDescription>
                    √öltimas atividades do sistema
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <CheckCircle className="h-4 w-4 text-green-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Sistema iniciado</p>
                        <p className="text-xs text-muted-foreground">Hoje, 08:00</p>
                      </div>
                    </div>

                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <Activity className="h-4 w-4 text-blue-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Backup autom√°tico executado</p>
                        <p className="text-xs text-muted-foreground">Hoje, 02:00</p>
                      </div>
                    </div>

                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <Users className="h-4 w-4 text-green-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Novo usu√°rio registrado</p>
                        <p className="text-xs text-muted-foreground">Ontem, 16:30</p>
                      </div>
                    </div>

                    <div className="flex items-start space-x-3 p-2 border rounded-lg">
                      <AlertCircle className="h-4 w-4 text-yellow-500 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium">Manuten√ß√£o programada</p>
                        <p className="text-xs text-muted-foreground">Ontem, 03:00</p>
                      </div>
                    </div>
                  </div>

                  <div className="mt-4">
                    <Button variant="outline" className="w-full" onClick={handleViewAllLogs}>
                      <FileText className="h-4 w-4 mr-2" />
                      Ver Todos os Logs
                    </Button>
                  </div>
                </CardContent>
              </Card>
          </TabsContent>
        </Tabs>
      </div>
    </div>
  );
}

```

Adicionei um bot√£o ‚ÄúSincronizar materiais ‚Üí programas‚Äù no Admin (em JW.org Downloads) que:

- L√™ a sess√£o atual (token) e chama o backend `GET http://localhost:3001/api/materials` com Authorization.
- Mapeia os arquivos em `docs/Oficial` (mwb_*, S-38_*, mwb_T_*) para linhas de `public.programas` usando:
  - `arquivo` = nome do arquivo, ex.: mwb_E_202509.pdf
  - `mes_apostila` = AAAA-MM (derivado do nome do arquivo quando aplic√°vel)
  - `data_inicio_semana` = AAAA-MM-01 (quando poss√≠vel)
  - `status` = 'ativo'
- Insere apenas os que ainda n√£o existem por `arquivo`.
- Atualiza o card ‚ÄúPrograma√ß√µes Publicadas‚Äù e mostra alerta ‚ÄúSincroniza√ß√£o conclu√≠da‚Äù.

Como usar:
- Entre no Admin ‚Üí JW.org Downloads ‚Üí clique em ‚ÄúSincronizar materiais ‚Üí programas‚Äù.
- Em seguida, o card ‚ÄúPrograma√ß√µes Publicadas‚Äù mostrar√° as entradas com link ‚ÄúAbrir material‚Äù para:
  - http://localhost:3001/materials/mwb_E_202507.pdf
  - http://localhost:3001/materials/mwb_E_202509.pdf
  - http://localhost:3001/materials/mwb_E_202511.pdf

Pr√©-requisitos:
- Backend rodando em 3001.
- Autentica√ß√£o ativa (o bot√£o usa o token atual).
- RLS/Permiss√µes do Supabase permitindo `insert/select` em `public.programas` para seu usu√°rio atual.

---

**User**

qual formato eh melhor para eu baixar e fazer aparecer no http://localhost:8080/admin  ? "C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_T_202507.daisy.zip"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_T_202509.daisy.zip"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_T_202509.jwpub"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_T_202511.jwpub"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\S-38_E.rtf"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\WhatsApp Image 2025-08-14 at 19.44.07 (1).jpeg"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\WhatsApp Image 2025-08-14 at 19.44.07.jpeg"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\estudantes_ficticios.xlsx"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\estudantes_rows.sql"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_E_202507.pdf"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_E_202509.pdf"
"C:\Users\frank.MONITORE-MAFRA\Documents\GitHub\sua-parte\docs\Oficial\mwb_E_202511.pdf" 

---

**Cursor**

- Melhor para aparecer no Admin agora: mwb_E_YYYYMM.pdf
  - Ex.: mwb_E_202507.pdf, mwb_E_202509.pdf, mwb_E_202511.pdf.
  - O bot√£o ‚ÄúSincronizar materiais ‚Üí programas‚Äù reconhece esse padr√£o e preenche m√™s/data automaticamente, com link ‚ÄúAbrir material‚Äù.

- Tamb√©m aceita (aparecem com link, mas sem m√™s/data autom√°tica):
  - .jwpub (mwb_T_YYYYMM.jwpub)
  - .daisy.zip (mwb_T_YYYYMM.daisy.zip)

- N√£o entram como ‚Äúprograma√ß√£o‚Äù (podem aparecer em outras se√ß√µes, mas n√£o no card atual):
  - S-38_E.rtf, imagens (.jpeg), planilhas (.xlsx), SQL (.sql)

Resumo: baixe/priorize mwb_E_YYYYMM.pdf para o card ‚ÄúPrograma√ß√µes Publicadas‚Äù. Os .jwpub/.daisy tamb√©m s√£o listados, por√©m sem metadados de m√™s/data.

---

**User**

client:495 [vite] connecting...
client:618 [vite] connected.
chunk-NFC5BX5N.js?v=91091763:21551 Download the React DevTools for a better development experience: https://reactjs.org/link/react-devtools
client.ts:10 üîç Supabase Environment Debug: Object
client.ts:38 ‚úÖ Supabase Client Configuration: Object
@supabase_supabase-js.js?v=91091763:5551 GoTrueClient@0 (2.71.1) 2025-09-08T12:33:03.867Z #_acquireLock begin -1
@supabase_supabase-js.js?v=91091763:5551 GoTrueClient@0 (2.71.1) 2025-09-08T12:33:03.867Z #onAuthStateChange() registered callback with id db262ed7-3b5b-4d6e-a53b-f40353b4b7d8
debugLogger.ts:62 ‚ÑπÔ∏è [INFO] Debug Logger Initialized Object
supabaseHealthCheck.ts:153 üîß Supabase health check tools available:
supabaseHealthCheck.ts:154   window.supabaseHealth.check() - Full health check
supabaseHealthCheck.ts:155   window.supabaseHealth.testAuth() - Test auth operations
supabaseHealthCheck.ts:156   window.supabaseHealth.quickCheck() - Quick status check
logoutDiagnostics.ts:233 üîß Logout diagnostics tools available:
logoutDiagnostics.ts:234   window.logoutDiagnostics.run() - Full diagnostic
logoutDiagnostics.ts:235   window.logoutDiagnostics.quickTest() - Quick test
offlineLocalDB.ts:642 üîß Offline DB tools available: window.offlineDB.download(), window.offlineDB.downloadIncremental(), window.offlineDB.list('estudantes'), window.offlineDB.sync()
offlineLocalDB.ts:643 üîß Outbox tools: window.offlineDB.createLocal(), window.offlineDB.getOutboxStatus(), window.offlineDB.getPendingOps()
offlineLocalDB.ts:644 üîß Cursor tools: window.offlineDB.getCursors()
App.tsx:55 üîß Loading debug tools for development environment...
i18next.js?v=91091763:208 i18next: languageChanged pt
i18next.js?v=91091763:208 i18next: initialized Object
@supabase_supabase-js.js?v=91091763:5551 GoTrueClient@0 (2.71.1) 2025-09-08T12:33:03.908Z #onAuthStateChange() registered callback with id 6741fe4e-a1a4-4f65-9452-8ee349af5c52
AuthContext.tsx:282 üîß Force admin login function available: window.forceAdminLogin()
AuthContext.tsx:290 üîÑ Getting initial session...
@supabase_supabase-js.js?v=91091763:5551 GoTrueClient@0 (2.71.1) 2025-09-08T12:33:03.914Z #onAuthStateChange() registered callback with id 759866b3-4f6d-4dce-9c04-a2bdabd9a6c1
LanguageContext.tsx:32 üåê LanguageContext: Current language is pt
LanguageContext.tsx:33 üåê LanguageContext: Available resources: Array(2)
emergencyLogout.ts:120 üö® Emergency logout tools available:
emergencyLogout.ts:121   window.emergencyLogout() - Full emergency logout
emergencyLogout.ts:122   window.immediateLogout() - Instant logout, no delays
emergencyLogout.ts:123   window.smartLogout(signOutFn) - Try Supabase first, fallback to emergency
@supabase_supabase-js.js?v=91091763:5551 GoTrueClient@0 (2.71.1) 2025-09-08T12:33:03.919Z #_acquireLock lock acquired for storage key sb-nwpuurgwnnuejqinkvrh-auth-token
@supabase_supabase-js.js?v=91091763:5551 GoTrueClient@0 (2.71.1) 2025-09-08T12:33:03.919Z #_recoverAndRefresh() begin
@supabase_supabase-js.js?v=91091763:5551 GoTrueClient@0 (2.71.1) 2025-09-08T12:33:03.919Z #_recoverAndRefresh() session from storage Object
@supabase_supabase-js.js?v=91091763:5551 GoTrueClient@0 (2.71.1) 2025-09-08T12:33:03.919Z #_recoverAndRefresh() session has not expired with margin of 90000s
@supabase_supabase-js.js?v=91091763:5551 GoTrueClient@0 (2.71.1) 2025-09-08T12:33:03.920Z #_notifyAllSubscribers(SIGNED_IN) begin Object broadcast = true
AuthContext.tsx:343 üîÑ Auth state changed: SIGNED_IN amazonwebber007@gmail.com
AuthContext.tsx:347 üë§ Setting user and session...
AuthContext.tsx:60 üîç Fetching profile for user ID: e8efcdcb-dc1a-4930-b77b-33bd5cd89a55
AuthContext.tsx:64 üîê Checking current session...
AuthContext.tsx:282 üîß Force admin login function available: window.forceAdminLogin()
familyMemberDebug.ts:350 üîß Family Member Debug Tools Available:
familyMemberDebug.ts:351    window.debugFamilyMember.authState()
familyMemberDebug.ts:352    window.debugFamilyMember.insert(studentId)
familyMemberDebug.ts:353    window.debugFamilyMember.rls(studentId)
familyMemberDebug.ts:354    window.debugFamilyMember.comprehensive(studentId)
familyMemberDebug.ts:355    window.debugFamilyMember.invitationFlow(studentId)
familyMemberDebug.ts:356 
familyMemberDebug.ts:357 üéØ Quick Test Command:
familyMemberDebug.ts:358    window.debugFamilyMember.invitationFlow("77c99e53-500b-4140-b7fc-a69f96b216e1")
reviewDatabase.ts:134 üîß Database review tool available: window.reviewDatabase()
executeMigration.ts:83 üîß Migration tool available: window.executeMigration()
syncStudentsToInstructors.ts:79 üîß Sync tool available: window.syncStudentsToInstructors()
quickSync.ts:72 üîß Quick sync available: window.quickSync()
App.tsx:69 ‚úÖ Debug tools loaded successfully
testDensityToggle.ts:6 üß™ Testing Density Toggle Functionality
testDensityToggle.ts:11 ‚úÖ Current density mode: comfortable
testDensityToggle.ts:18 ‚úÖ CSS Variables:
testDensityToggle.ts:19   --row-h: 44px
testDensityToggle.ts:20   --cell-px: 12px
testDensityToggle.ts:24 ‚úÖ Saved density in localStorage: comfortable
testDensityToggle.ts:38 ‚úÖ Value verification:
testDensityToggle.ts:39   Row height matches expected: true (44px vs 44px)
testDensityToggle.ts:40   Cell padding matches expected: true (12px vs 12px)
testDensityToggle.ts:44 ‚úÖ Found density tables: 0
testDensityToggle.ts:53 ‚úÖ Found responsive table containers: 0
testDensityToggle.ts:62 üéâ All density tests passed!


---

**Cursor**

- Clique em ‚ÄúSincronizar materiais ‚Üí programas‚Äù no bloco ‚Äúüìö JW.org Downloads‚Äù do Admin.
- Pr√©‚Äërequisitos:
  - Backend rodando em 3001.
  - Logado (o bot√£o usa seu token).
  - Os PDFs mwb_E_YYYYMM.pdf est√£o em docs/Oficial (ex.: mwb_E_202507.pdf, 202509, 202511).

Ap√≥s sincronizar:
- O card ‚ÄúPrograma√ß√µes Publicadas‚Äù deve listar as entradas e mostrar ‚ÄúAbrir material‚Äù para cada PDF.
- Se nada aparecer, me diga o alerta exibido; como plano B, insira manualmente uma linha em public.programas com arquivo='mwb_E_202509.pdf' e recarregue.

---

**User**

resuma tudo que conversamos hoje

