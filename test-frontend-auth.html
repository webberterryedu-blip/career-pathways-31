<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Autentica√ß√£o Frontend</title>
    <script src="https://cdn.skypack.dev/@supabase/supabase-js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        #status { font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste de Autentica√ß√£o Frontend</h1>
        <p>Esta p√°gina testa a configura√ß√£o de autentica√ß√£o do Supabase no frontend.</p>
        
        <div class="test-section">
            <h3>üìã Status do Teste</h3>
            <div id="status">Aguardando...</div>
        </div>

        <div class="test-section">
            <h3>üîê Teste de Autentica√ß√£o</h3>
            <button onclick="testAuth()">Testar Login</button>
            <div id="auth-result"></div>
        </div>

        <div class="test-section">
            <h3>üë§ Teste de Carregamento de Perfil</h3>
            <button onclick="testProfile()">Carregar Perfil</button>
            <div id="profile-result"></div>
        </div>

        <div class="test-section">
            <h3>üìä Teste de Dados do Dashboard</h3>
            <button onclick="testDashboardData()">Carregar Dados do Dashboard</button>
            <div id="dashboard-result"></div>
        </div>

        <div class="test-section">
            <h3>üîÑ Teste de Configura√ß√£o</h3>
            <button onclick="testConfig()">Verificar Configura√ß√£o</button>
            <div id="config-result"></div>
        </div>
    </div>

    <script>
        // Configura√ß√£o do Supabase - usando vari√°veis de ambiente do Vite
        const supabaseUrl = import.meta.env?.VITE_SUPABASE_URL || 'https://nwpuurgwnnuejqinkvrh.supabase.co';
        const supabaseKey = import.meta.env?.VITE_SUPABASE_ANON_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsdm9qb2x2ZHNxcmZjempqanV3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1ODcwNjUsImV4cCI6MjA3MzE2MzA2NX0.J5CE7TrRJj8C0gWjbokSkMSRW1S-q8AwKUV5Z7xuODQ';
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        let currentUser = null;
        let currentProfile = null;

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = type;
        }

        async function testConfig() {
            const configResult = document.getElementById('config-result');
            configResult.innerHTML = '<p>üîç Verificando configura√ß√£o...</p>';
            
            try {
                // Verificar se as vari√°veis de ambiente est√£o dispon√≠veis
                const envUrl = import.meta.env?.VITE_SUPABASE_URL;
                const envKey = import.meta.env?.VITE_SUPABASE_ANON_KEY;
                
                configResult.innerHTML = `
                    <p class="info">üîß Configura√ß√£o atual:</p>
                    <p><strong>URL:</strong> ${supabaseUrl}</p>
                    <p><strong>Key:</strong> ${supabaseKey.substring(0, 20)}...</p>
                    <p><strong>Vari√°veis de ambiente:</strong> ${envUrl ? '‚úÖ Encontradas' : '‚ùå N√£o encontradas'}</p>
                `;
                
                // Testar conex√£o b√°sica
                configResult.innerHTML += '<p>üì° Testando conex√£o...</p>';
                const { data, error } = await supabase.from('profiles').select('count').limit(1);
                
                if (error) {
                    configResult.innerHTML += `<p class="error">‚ùå Erro de conex√£o: ${error.message}</p>`;
                } else {
                    configResult.innerHTML += '<p class="success">‚úÖ Conex√£o bem-sucedida!</p>';
                }
            } catch (error) {
                configResult.innerHTML = `<p class="error">‚ùå Erro na verifica√ß√£o: ${error.message}</p>`;
            }
        }

        async function testAuth() {
            const authResult = document.getElementById('auth-result');
            authResult.innerHTML = '<p>üîê Tentando login...</p>';
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: 'frankwebber33@hotmail.com',
                    password: 'senha123'
                });
                
                if (error) {
                    authResult.innerHTML = `<p class="error">‚ùå Login falhou: ${error.message}</p>`;
                    updateStatus('Login falhou', 'error');
                } else {
                    currentUser = data.user;
                    authResult.innerHTML = `
                        <p class="success">‚úÖ Login bem-sucedido!</p>
                        <p><strong>Email:</strong> ${data.user.email}</p>
                        <p><strong>User ID:</strong> ${data.user.id}</p>
                        <button onclick="testLogout()">Logout</button>
                    `;
                    updateStatus('Autenticado', 'success');
                }
            } catch (error) {
                authResult.innerHTML = `<p class="error">‚ùå Erro: ${error.message}</p>`;
                updateStatus('Erro de autentica√ß√£o', 'error');
            }
        }

        async function testLogout() {
            const authResult = document.getElementById('auth-result');
            authResult.innerHTML = '<p>üö™ Fazendo logout...</p>';
            
            try {
                const { error } = await supabase.auth.signOut();
                
                if (error) {
                    authResult.innerHTML = `<p class="error">‚ùå Logout falhou: ${error.message}</p>`;
                    updateStatus('Logout falhou', 'error');
                } else {
                    currentUser = null;
                    currentProfile = null;
                    authResult.innerHTML = '<p class="success">‚úÖ Logout bem-sucedido!</p>';
                    updateStatus('Desconectado', 'info');
                    
                    // Limpar resultados de perfil
                    document.getElementById('profile-result').innerHTML = '';
                    document.getElementById('dashboard-result').innerHTML = '';
                }
            } catch (error) {
                authResult.innerHTML = `<p class="error">‚ùå Erro: ${error.message}</p>`;
                updateStatus('Erro de logout', 'error');
            }
        }

        async function testProfile() {
            const profileResult = document.getElementById('profile-result');
            
            if (!currentUser) {
                profileResult.innerHTML = '<p class="error">‚ùå Nenhum usu√°rio autenticado</p>';
                return;
            }
            
            profileResult.innerHTML = '<p>üë§ Carregando perfil...</p>';
            
            try {
                const { data, error } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();
                
                if (error) {
                    profileResult.innerHTML = `<p class="error">‚ùå Erro ao carregar perfil: ${error.message}</p>`;
                } else {
                    currentProfile = data;
                    profileResult.innerHTML = `
                        <p class="success">‚úÖ Perfil carregado!</p>
                        <p><strong>Nome:</strong> ${data.nome_completo || 'N√£o definido'}</p>
                        <p><strong>Congrega√ß√£o:</strong> ${data.congregacao || 'N√£o definida'}</p>
                        <p><strong>Cargo:</strong> ${data.cargo || 'N√£o definido'}</p>
                        <p><strong>Role:</strong> ${data.role || 'N√£o definido'}</p>
                    `;
                }
            } catch (error) {
                profileResult.innerHTML = `<p class="error">‚ùå Erro: ${error.message}</p>`;
            }
        }

        async function testDashboardData() {
            const dashboardResult = document.getElementById('dashboard-result');
            
            if (!currentUser) {
                dashboardResult.innerHTML = '<p class="error">‚ùå Nenhum usu√°rio autenticado</p>';
                return;
            }
            
            dashboardResult.innerHTML = '<p>üìä Carregando dados do dashboard...</p>';
            
            try {
                // Contar estudantes ativos
                const { count: activeStudents, error: studentsError } = await supabase
                    .from('estudantes')
                    .select('*', { count: 'exact', head: true })
                    .eq('ativo', true);
                
                if (studentsError) {
                    dashboardResult.innerHTML = `<p class="error">‚ùå Erro ao contar estudantes: ${studentsError.message}</p>`;
                    return;
                }
                
                // Contar programa√ß√µes
                const { count: programs, error: programsError } = await supabase
                    .from('programacoes')
                    .select('*', { count: 'exact', head: true });
                
                if (programsError) {
                    dashboardResult.innerHTML = `<p class="error">‚ùå Erro ao contar programa√ß√µes: ${programsError.message}</p>`;
                    return;
                }
                
                dashboardResult.innerHTML = `
                    <p class="success">‚úÖ Dados carregados!</p>
                    <p><strong>Estudantes ativos:</strong> ${activeStudents}</p>
                    <p><strong>Programa√ß√µes:</strong> ${programs}</p>
                `;
            } catch (error) {
                dashboardResult.innerHTML = `<p class="error">‚ùå Erro: ${error.message}</p>`;
            }
        }

        // Inicializar
        updateStatus('Pronto para testes', 'info');
        console.log('üîß Supabase configurado:', { supabaseUrl, supabaseKey });
    </script>
</body>
</html>